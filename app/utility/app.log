2025-08-22 19:05:38,397 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:05:38,397 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:05:38,397 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:05:38,397 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:05:38,397 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:05:38,399 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:05:38,399 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:05:38,399 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:05:38,549 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:05:38,549 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:05:38,549 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:05:38,554 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:05:38,554 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:05:40,345 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:05:40,345 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:05:40,345 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:05:40,346 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:05:40,346 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:05:40,346 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:05:40,417 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:05:40,418 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:05:40,418 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:05:40,420 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:05:40,420 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:05:40,420 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:05:40,420 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:05:40,420 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:05:40,422 [INFO] main: Creating FastAPI app
2025-08-22 19:05:40,422 [INFO] main: CORS middleware added
2025-08-22 19:05:40,423 [INFO] main: API router included
2025-08-22 19:05:40,821 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-22 19:05:40,822 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-22 19:05:40,822 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-22 19:05:40,822 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-22 19:05:40,822 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-22 19:05:40,830 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:40,869 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:40,870 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-22 19:05:40,910 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ffed160>
2025-08-22 19:05:40,910 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11f5dbd10> server_hostname='api.openai.com' timeout=None
2025-08-22 19:05:40,938 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ffa4f50>
2025-08-22 19:05:40,938 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:40,939 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:40,939 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:40,939 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:40,939 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:41,639 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:41 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'432'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'447'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_6a53a25bd3d94bf2b1dc735dfaf26372'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=hXvNv8zIgbEH71X.Z3_4sUkSihb.UbVSX.V7etXj_8Y-1755882341-1.0.1.1-0VwLjPG3I0jxQqP_4FGCdnsJP8Db7PTebWLa2G_7zBMQKpGgeSgpqNOowLAMILX65NlEnf8DjdpDbpalibftV7HRtJdqJ8EZeqCw18c8lkQ; path=/; expires=Fri, 22-Aug-25 17:35:41 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=DEoIkOiQ74JxbthoBngLi4XkfqlGGGmNrJvfGan48Xo-1755882341719-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4d77e9ada11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:41,641 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:41,641 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:41,641 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:41,641 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:41,641 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:41,641 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Fri, 22 Aug 2025 17:05:41 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '432'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '447'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_6a53a25bd3d94bf2b1dc735dfaf26372'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=hXvNv8zIgbEH71X.Z3_4sUkSihb.UbVSX.V7etXj_8Y-1755882341-1.0.1.1-0VwLjPG3I0jxQqP_4FGCdnsJP8Db7PTebWLa2G_7zBMQKpGgeSgpqNOowLAMILX65NlEnf8DjdpDbpalibftV7HRtJdqJ8EZeqCw18c8lkQ; path=/; expires=Fri, 22-Aug-25 17:35:41 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=DEoIkOiQ74JxbthoBngLi4XkfqlGGGmNrJvfGan48Xo-1755882341719-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9733f4d77e9ada11-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-22 19:05:41,642 [DEBUG] openai._base_client: request_id: req_6a53a25bd3d94bf2b1dc735dfaf26372
2025-08-22 19:05:41,649 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-22 19:05:41,649 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-22 19:05:41,652 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:41,653 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:41,654 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:41,654 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:41,654 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:41,654 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:41,654 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:42,214 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:42 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'342'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'369'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_9df71954b7384279a2085eef9e7e139f'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4dbea5eda11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:42,215 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:42,215 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:42,225 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:42,225 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:42,225 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:42,225 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:42 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '342', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '369', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_9df71954b7384279a2085eef9e7e139f', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f4dbea5eda11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:42,226 [DEBUG] openai._base_client: request_id: req_9df71954b7384279a2085eef9e7e139f
2025-08-22 19:05:42,226 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-22 19:05:42,226 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history=''
2025-08-22 19:05:42,227 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 19:05:42,227 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 19:05:42,227 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 19:05:42,227 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 19:05:42,385 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:05:42,386 [DEBUG] app.services.data_processing_service: Institution list: Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Grand hôpital de l'Est-Francilien, Fondation Rothschild, Centre Hospitalier d'Erstein, Clinique Trenel, Centre François-Baclesse (CLCC), CHU - Gabriel-Montpied, CHU - Hôpital Haut-Lévêque, Polyclinique de la Région-Mantaise, Clinique Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Durieux, Centre Georges-François-Leclerc (CLCC), Hôpital de la Timone (enfants), Clinique du Parc-Monceau, Polyclinique du Grand-Sud, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital privé Clairval, Centre Hospitalier Les Murets, Clinique Kennedy, Polyclinique Saint-Jean, CHU - Institut cœur-poumon, Hôpital privé des Peupliers, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique urologique Nantes-Atlantis, Hôpital privé Vert-Coteau, Institut Jean-Godinot (CLCC), Clinique Océane, GH Paul Guiraud, Institut universitaire de la face et du cou, Clinique mutualiste de Bonneveine, Polyclinique de Limoges - site Chénieux, Clinique Saint-Michel, Institut Curie (CLCC), Institut Paoli-Calmettes (CLCC), Clinique d’Occitanie, Clinique des Orchidées, Centre cardiologique du Nord, Hôpital Pierre-Wertheimer, Hôpital Beaujon, CHU d'Amiens/Institut ophtalmologique de Picardie, Polyclinique du Maine, CH Henri-Laborit, Clinique Saint-Amé, CHU - Hôpital de l’Archet, Hôpital Nord Franche-Comté-Belfort, Clinique de l’Yvette, Hôpital Nord, Centre Hospitalier Maurice Despinoy, Centre Psychothérapique, Clinique mutualiste catalane, Institut de cancérologie de Lorraine (CLCC), Polyclinique du Parc-Drevon, CHU - Hôpital Dupuytren, Hôpital de la Timone (adultes), CHU - Hôpital de la Mère et de l’Enfant, Hôpital de la Timone (Enfants), Polyclinique de Reims-Bezannes, Hôpital Edouard-Herriot, CH Basse-Terre (Guadeloupe), Clinique Tivoli-Ducos, CH Édouard-Toulouse, CHU - Hôpital Sud, CHU de Pointe-à-Pitre, Centre Léon-Bérard (CLCC), Hôpital de la Croix Rousse (HCL) / CH, CHU - Hôpital de la Cavale-Blanche, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de Bordeaux-Tondu, Hôpital privé La Montagne Lambert, Clinique Saint-Joseph, Clinique de l’Orangerie, Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Clocheville, CHU - American Memorial Hospital, Epsan, Polyclinique Saint-Côme, Clinique de la Miséricorde, CHU de Martinique, Clinique Esquirol-Saint-Hilaire, Clinique Jean le Bon, Hôpital européen, Institut mutualiste Montsouris, Hôpital privé, Institut franco-britannique Kléber, GCS Clinique du Ter, Clinique Sainte-Clotilde, Clinique Saint-Léonard, Clinique de la Part-Dieu, Hôpital Henri-Mondor, Clinique mutualiste de la Porte-de-l'Orient, EPS Ville-Évrard, Hôpital Belle-Isle, CHU - Hôpital d’Estaing, Hôpital Trousseau, Hôpital Robert Schuman, Infirmerie protestante de Lyon, HCL - Hôpital Femme-mère-enfant, Centre Jean-Perrin (CLCC), Institut Arnault-Tzanck, Centre Oscar-Lambret (CLCC), CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé de Villeneuve-d’Ascq, Clinique Bretéché, Clinique Marcel-Sembat, CHU de La Réunion - Félix-Guyon, Clinique Saint-George, CHU - Hôpital Pasteur, Polyclinique Saint-Roch, CMCO Côte d’Opale, Hôtel-Dieu, Hôpital Renée-Sabran, Hôpitaux de Saint-Maurice, Hôpital d'instruction des armées Laveran, Clinique mutualiste Jules-Verne, Clinique de Bercy, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique Saint-Jean l’Ermitage, Pôle santé Oréliance, CHU - Centre chirurgical Emile-Gallé, Hôpital privé de Marne-la-Vallée, Hôpital Cochin, Hôpital Albert Schweitzer, CHU Sud-Réunion, CHU - Hôpital Purpan, EPSM de Saône-et-Loire, Maison de santé Bagatelle, Clinique du Tertre-Rouge, Hôpital de la Croix-Saint-Simon, CH privé Claude-Galien, Polyclinique Bordeaux-Rive droite, Clinique Delay, Clinique Saint-Nabor, Clinique Victor-Pauchet, Clinique Saint-Vincent, Clinique Charcot, CHU - Hôpital de Hautepierre, Clinique Ormeau centre, Hôpital privé Jean-Mermoz, Hôpital privé Pays-de-Savoie, CHU - Hôpital Lapeyronie, Hôpital privé de l’Est lyonnais, Institut de cancérologie de l’Ouest, Polyclinique Médipôle Saint-Roch, Clinique générale, Clinique Maussins-Nollet, Polyclinique Urbain-V, Hôpital des Diaconesses, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical et obstétrical, Hôpital privé Nord Parisien, Clinique Saint-Jean-de-Dieu, Polyclinique Aguilera, Polyclinique du Parc, Clinique Les Fontaines, CHU - Hôpital Central, Clinique de l’Union, Groupe hospitalier Nord-Essonne, Euromed Cardio, Hôpital privé de la Seine-Saint-Denis, Clinique des Cèdres, Hôpitaux Sud, CHI, Nouvelle clinique de Tours, Clinique Notre-Dame-de-l’Espérance, Centre Clinical, Clinique Clémentville, Polyclinique, Clinique Arago, Hôpital privé Le Bois, Clinique du Trocadéro, CHU - Hôpitaux mère-enfants, Hôpital Louis-Pradel, Clinique du Pré, GH, Hôpital Necker-Enfants-Malades, CMC de Parly-II, Institut ophtalmique, Institut du cancer de Montpellier (CLCC), Hôpital d'instruction des armées Legouest, Clinique du Val-d’Or, Hôpital de la Pitié-Salpêtrière, Polyclinique Vauban, Clinique du Fief-de-Grimoire, Hôpital Louis-Mourier, Hôpital privé La Châtaigneraie, Clinique Turin, CH Esquirol, Clinique Rhône Durance, Hôpital Antoine-Béclère, CHU de Nantes, Pôle Santé République, Hôpital privé Arras-Les Bonnettes, Polyclinique du Beaujolais, Hôpital privé Paul-d’Égine, Hôpital Jean-Verdier, EPSM Lille-Métropole, Centre Hospitalier du Rouvray, Clinique Saint-Hilaire, Clinique du Cèdre, Polyclinique Santa-Maria, CM Bénigne-Joly, Clinique de l’Atlantique, Clinique Bon-Secours, Clinique Rhéna, Clinique Saint-André, Nouvelle clinique Bel-Air, CHU d’Amiens, Polyclinique de Kerio, Clinique mutualiste La Sagesse, Polyclinique de Picardie, Hôpital d'instruction des armées Percy, Clinique du Croisé-Laroche, EPS Barthélemy-Durand, Pôle santé Léonard-de-Vinci, Clinique de l’Estrée, Hôpital privé de l’Estuaire, Hôpital privé Saint-Martin, Clinique mutualiste, Institut de cancérologie Strasbourg Europe, CMC Pierre-Cherest, Hôpital privé de l’Ouest parisien, CHU - Hôpital Robert-Debré, Hôpitaux civils, Hôpital privé Natecia, Hôpital privé Drôme-Ardèche, CHU - Hôpital Bretonneau, Hôpital privé Armand-Brillard, Médipôle Hôpital Privé, CHU Réunion, Polyclinique Les Fleurs, Hôpital Ambroise-Paré, CHU de Martinique - site Mère-Enfant, Institut hospitalier Jacques-Cartier, Clinique Jouvenet, Hôpital de la Conception, CHU - Hôpital Larrey, Hôpital Bichat, Hôpital Corentin-Celton, Clinique du Grand-Large, Centre chirurgical Marie-Lannelongue, CHU - Hôpital Rangueil, Clinique Ormeau Pyrénées, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique de Keraudren, Clinique Monticelli-Vélodrome, Clinique Claude-Bernard, CH Montfavet, Hôpital Foch, Centre Hospitalier Sainte-Marie, Polyclinique de Limoges - site Émailleurs, Clinique La Croix du Sud, Centre Hospitalier des Pyrénées, Espm de L’agglomeration Lilloise, Hôpital européen Georges-Pompidou, Polyclinique de Navarre, CHU - Hôpital Pontchaillou, Centre Henri-Becquerel (CLCC), CHU - site Nord, Polyclinique Côte-Basque-Sud, Centre cardiologique, Clinique du Renaison, Clinique Belledonne, IUCT Oncopole, CH intercommunal, Centre Hospitalier Le Mas Careiron, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Axium, Hôpital privé de Marne Chantereine, Clinique de la Plaine, CHU - Hôpital civil, Clinique du Diaconat-Roosevelt, Hôpital Robert-Debré, Clinique Ambroise-Paré, Hôpital Tenon, Hôpital Saint-Vincent-de-Paul (GHICL), Clinique Honoré-Cave, Clinique ambulatoire de Domont, Clinique Paris Lilas, Hôpital privé du Confluent, Clinique Saint-Pierre, Institut Bergonié (CLCC), Centre Hospitalier de Vauclaire, Hôpital Privé Nancy Lorraine, Hôpital privé de la Casamance, Hopital Joseph-Ducuing, Polyclinique de la Baie, CHU-Hôpital Purpan/HFE, Clinique Saint-Charles, Polyclinique de Reims-Bezannes (Marne), Centre de la main, Clinique des Ormeaux, Centre Hospitalier Gérard-Marchant, CH privé Saint-Grégoire, Polyclinique de Poitiers, Clinique Juge, Clinique du Diaconat-Fonderie, Clinique de la Sauvegarde, Clinique Saint-Augustin, Polyclinique Saint-Privat, Hôpital d'instruction des armées Bégin, Hôpital privé Beauregard, Clinique Bizet, CHU - Hôpital de la Côte de nacre, Nouvel Hôpital de Navarre, Polyclinique Saint Laurent, Clinique de l’Anjou, Polyclinique Saint-François, EPSM Etienne-Gourmelen, CHU - Hôpital Pellegrin, CHU - Hôpital Saint-André, CHU - Hôpitaux de Brabois, Hôpital Hôtel-Dieu, Hôpital-clinique Claude-Bernard, Groupe Hospitalier de la Rochelle, Centre de cardiologie du Pays basque, Clinique ophtalmologique Thiers, Gustave-Roussy (CLCC), Clinique Fontvert, Clinique Geoffroy-Saint-Hilaire, Clinique Toulouse-Lautrec, Centre psychothérapique de Nancy, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique Sainte-Marie, CHU Nantes - Hôpital Mère Enfant, Clinique Pasteur-Lanroze, CH Charles-Perrens, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, Clinique du sport, Hôpital d'instruction des armées Sainte-Anne, Polyclinique Jean-Villar, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Clinique Bouchard, Clinique des Franciscaines, CHU - Hôpital Claude-Huriez, Hôpital privé de Provence, CHU - Hôpital Arnaud-de-Villeneuve, CHP de l’Europe, Hôpital Lariboisière, Clinique cardiologique, Clinique Remusat, Clinique Les Eaux-Claires, Hôpital Saint-Philibert (GHICL), Hôpital privé Dijon-Bourgogne, IUCT/Oncopole, CHU Grenoble - Site Nord, Centre Hospitalier Le Vinatier, Centre Hospitalier Henri Guerin, Santé Atlantique, Clinique mutualiste de l’Estuaire, CH Guillaume-Régnier, Médipôle de Savoie, Clinique Chantecler, CHU - Hôpital Nord, GH mutualiste, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Belharra, Clinique Saint-Jean - Sud de France, Centre orthopédique médico-chirurgical, Hôpital Saint-Antoine, Clinique Sainte-Marie (GHICL), Clinique la Pergola, Hôpital Avicenne, CH/clinique, Clinique Saint-Antoine, CHU - Hôpital Saint-Eloi, CHR, Clinique Mathilde, CHU - Hôpital Maison-Blanche, Hôpital Paul-Brousse, Hôpital Saint-Camille, Clinique du Cambrésis, CH/Clinique, Hôpital privé de La Miotte, CHU - Hôpital Gui-de-Chauliac, CHR de Metz-Thionville - Hôpital de Mercy, Centre ambulatoire Kleber, Clinique Jean Causse, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique Bordeaux-Nord-Aquitaine, CH privé du Montgardé, Clinique de l’Europe, GHI, CHU - Maternité, CH Saint-Joseph-Saint-Luc, Clinique Anne-Artois, ASM, Clinique de la Muette, Centre Eugène-Marquis (CLCC), EPSM Morbihan, Pôle de Santé du Villeneuvois, Hôpital privé Sévigné, Hôpital privé Paris-Essonne, Clinique Rive-Gauche, Les Franciscaines, Hôpital privé de la Loire, Hôpital privé des Côtes-d’Armor, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Charles-Nicolle, Hôpital privé Cannes-Oxford, Polyclinique de Blois, Clinique Victor-Hugo, Hôpital des Massues, GHU Paris Psychiatrie et neurosciences, Clinique Saint-Paul, CHU - Hôpital Trousseau, Hôpital privé La Louvière, CHU Grenoble - Hôpital Sud, Institut Curie, Hôpital privé d’Antony, Polyclinique Lyon-Nord, Centre Hospitalier Drôme Vivarais, Centre Hospitalier Montperrin, Clinique Louis-Pasteur, CMC Floréal, Clinique de l'Alma, Clinique de l'Essonne, Clinique du Parc, Clinique de l’Espérance, Clinique du Val-d’Ouest Vendôme, EPSM de la Marne, Polyclinique Majorelle, Clinique Beau-Soleil, Hôpital Paris Saint-Joseph, CHU - Hôpital Morvan, Clinique du Millénaire, Clinique Convert, Médipôle Garonne, Clinique du Lac et d’Argonay, Hôpital d'instruction des armées Desgenettes, Centre de chirurgie ophtalmologique, Hôpital privé du Vert-Galant, Hôpitaux Nord (Croix-Rousse), Institut Arthur-Vernes, Clinique Saint-François, Clinique Sainte-Anne, Clinique Lille-Sud, Centre Hospitalier La Chartreuse, Hôpital Saint-Joseph, Hôpital Bicêtre, Polyclinique La Ligne bleue, CH Georges-Daumezon, Hôpitaux pédiatriques, Clinique du Pont-de-Chaume, Clinique Conti, CHU - Hôpital Roger-Salengro, Centre Hospitalier George Sand, Polyclinique Francheville, Institut Calot, CMCO, Hôpital Saint-Louis
2025-08-22 19:05:42,387 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Grand hôpital de l'Est-Francilien, Fondation Rothschild, Centre Hospitalier d'Erstein, Clinique Trenel, Centre François-Baclesse (CLCC), CHU - Gabriel-Montpied, CHU - Hôpital Haut-Lévêque, Polyclinique de la Région-Mantaise, Clinique Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Durieux, Centre Georges-François-Leclerc (CLCC), Hôpital de la Timone (enfants), Clinique du Parc-Monceau, Polyclinique du Grand-Sud, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital privé Clairval, Centre Hospitalier Les Murets, Clinique Kennedy, Polyclinique Saint-Jean, CHU - Institut cœur-poumon, Hôpital privé des Peupliers, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique urologique Nantes-Atlantis, Hôpital privé Vert-Coteau, Institut Jean-Godinot (CLCC), Clinique Océane, GH Paul Guiraud, Institut universitaire de la face et du cou, Clinique mutualiste de Bonneveine, Polyclinique de Limoges - site Chénieux, Clinique Saint-Michel, Institut Curie (CLCC), Institut Paoli-Calmettes (CLCC), Clinique d’Occitanie, Clinique des Orchidées, Centre cardiologique du Nord, Hôpital Pierre-Wertheimer, Hôpital Beaujon, CHU d'Amiens/Institut ophtalmologique de Picardie, Polyclinique du Maine, CH Henri-Laborit, Clinique Saint-Amé, CHU - Hôpital de l’Archet, Hôpital Nord Franche-Comté-Belfort, Clinique de l’Yvette, Hôpital Nord, Centre Hospitalier Maurice Despinoy, Centre Psychothérapique, Clinique mutualiste catalane, Institut de cancérologie de Lorraine (CLCC), Polyclinique du Parc-Drevon, CHU - Hôpital Dupuytren, Hôpital de la Timone (adultes), CHU - Hôpital de la Mère et de l’Enfant, Hôpital de la Timone (Enfants), Polyclinique de Reims-Bezannes, Hôpital Edouard-Herriot, CH Basse-Terre (Guadeloupe), Clinique Tivoli-Ducos, CH Édouard-Toulouse, CHU - Hôpital Sud, CHU de Pointe-à-Pitre, Centre Léon-Bérard (CLCC), Hôpital de la Croix Rousse (HCL) / CH, CHU - Hôpital de la Cavale-Blanche, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de Bordeaux-Tondu, Hôpital privé La Montagne Lambert, Clinique Saint-Joseph, Clinique de l’Orangerie, Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Clocheville, CHU - American Memorial Hospital, Epsan, Polyclinique Saint-Côme, Clinique de la Miséricorde, CHU de Martinique, Clinique Esquirol-Saint-Hilaire, Clinique Jean le Bon, Hôpital européen, Institut mutualiste Montsouris, Hôpital privé, Institut franco-britannique Kléber, GCS Clinique du Ter, Clinique Sainte-Clotilde, Clinique Saint-Léonard, Clinique de la Part-Dieu, Hôpital Henri-Mondor, Clinique mutualiste de la Porte-de-l'Orient, EPS Ville-Évrard, Hôpital Belle-Isle, CHU - Hôpital d’Estaing, Hôpital Trousseau, Hôpital Robert Schuman, Infirmerie protestante de Lyon, HCL - Hôpital Femme-mère-enfant, Centre Jean-Perrin (CLCC), Institut Arnault-Tzanck, Centre Oscar-Lambret (CLCC), CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé de Villeneuve-d’Ascq, Clinique Bretéché, Clinique Marcel-Sembat, CHU de La Réunion - Félix-Guyon, Clinique Saint-George, CHU - Hôpital Pasteur, Polyclinique Saint-Roch, CMCO Côte d’Opale, Hôtel-Dieu, Hôpital Renée-Sabran, Hôpitaux de Saint-Maurice, Hôpital d'instruction des armées Laveran, Clinique mutualiste Jules-Verne, Clinique de Bercy, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique Saint-Jean l’Ermitage, Pôle santé Oréliance, CHU - Centre chirurgical Emile-Gallé, Hôpital privé de Marne-la-Vallée, Hôpital Cochin, Hôpital Albert Schweitzer, CHU Sud-Réunion, CHU - Hôpital Purpan, EPSM de Saône-et-Loire, Maison de santé Bagatelle, Clinique du Tertre-Rouge, Hôpital de la Croix-Saint-Simon, CH privé Claude-Galien, Polyclinique Bordeaux-Rive droite, Clinique Delay, Clinique Saint-Nabor, Clinique Victor-Pauchet, Clinique Saint-Vincent, Clinique Charcot, CHU - Hôpital de Hautepierre, Clinique Ormeau centre, Hôpital privé Jean-Mermoz, Hôpital privé Pays-de-Savoie, CHU - Hôpital Lapeyronie, Hôpital privé de l’Est lyonnais, Institut de cancérologie de l’Ouest, Polyclinique Médipôle Saint-Roch, Clinique générale, Clinique Maussins-Nollet, Polyclinique Urbain-V, Hôpital des Diaconesses, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical et obstétrical, Hôpital privé Nord Parisien, Clinique Saint-Jean-de-Dieu, Polyclinique Aguilera, Polyclinique du Parc, Clinique Les Fontaines, CHU - Hôpital Central, Clinique de l’Union, Groupe hospitalier Nord-Essonne, Euromed Cardio, Hôpital privé de la Seine-Saint-Denis, Clinique des Cèdres, Hôpitaux Sud, CHI, Nouvelle clinique de Tours, Clinique Notre-Dame-de-l’Espérance, Centre Clinical, Clinique Clémentville, Polyclinique, Clinique Arago, Hôpital privé Le Bois, Clinique du Trocadéro, CHU - Hôpitaux mère-enfants, Hôpital Louis-Pradel, Clinique du Pré, GH, Hôpital Necker-Enfants-Malades, CMC de Parly-II, Institut ophtalmique, Institut du cancer de Montpellier (CLCC), Hôpital d'instruction des armées Legouest, Clinique du Val-d’Or, Hôpital de la Pitié-Salpêtrière, Polyclinique Vauban, Clinique du Fief-de-Grimoire, Hôpital Louis-Mourier, Hôpital privé La Châtaigneraie, Clinique Turin, CH Esquirol, Clinique Rhône Durance, Hôpital Antoine-Béclère, CHU de Nantes, Pôle Santé République, Hôpital privé Arras-Les Bonnettes, Polyclinique du Beaujolais, Hôpital privé Paul-d’Égine, Hôpital Jean-Verdier, EPSM Lille-Métropole, Centre Hospitalier du Rouvray, Clinique Saint-Hilaire, Clinique du Cèdre, Polyclinique Santa-Maria, CM Bénigne-Joly, Clinique de l’Atlantique, Clinique Bon-Secours, Clinique Rhéna, Clinique Saint-André, Nouvelle clinique Bel-Air, CHU d’Amiens, Polyclinique de Kerio, Clinique mutualiste La Sagesse, Polyclinique de Picardie, Hôpital d'instruction des armées Percy, Clinique du Croisé-Laroche, EPS Barthélemy-Durand, Pôle santé Léonard-de-Vinci, Clinique de l’Estrée, Hôpital privé de l’Estuaire, Hôpital privé Saint-Martin, Clinique mutualiste, Institut de cancérologie Strasbourg Europe, CMC Pierre-Cherest, Hôpital privé de l’Ouest parisien, CHU - Hôpital Robert-Debré, Hôpitaux civils, Hôpital privé Natecia, Hôpital privé Drôme-Ardèche, CHU - Hôpital Bretonneau, Hôpital privé Armand-Brillard, Médipôle Hôpital Privé, CHU Réunion, Polyclinique Les Fleurs, Hôpital Ambroise-Paré, CHU de Martinique - site Mère-Enfant, Institut hospitalier Jacques-Cartier, Clinique Jouvenet, Hôpital de la Conception, CHU - Hôpital Larrey, Hôpital Bichat, Hôpital Corentin-Celton, Clinique du Grand-Large, Centre chirurgical Marie-Lannelongue, CHU - Hôpital Rangueil, Clinique Ormeau Pyrénées, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique de Keraudren, Clinique Monticelli-Vélodrome, Clinique Claude-Bernard, CH Montfavet, Hôpital Foch, Centre Hospitalier Sainte-Marie, Polyclinique de Limoges - site Émailleurs, Clinique La Croix du Sud, Centre Hospitalier des Pyrénées, Espm de L’agglomeration Lilloise, Hôpital européen Georges-Pompidou, Polyclinique de Navarre, CHU - Hôpital Pontchaillou, Centre Henri-Becquerel (CLCC), CHU - site Nord, Polyclinique Côte-Basque-Sud, Centre cardiologique, Clinique du Renaison, Clinique Belledonne, IUCT Oncopole, CH intercommunal, Centre Hospitalier Le Mas Careiron, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Axium, Hôpital privé de Marne Chantereine, Clinique de la Plaine, CHU - Hôpital civil, Clinique du Diaconat-Roosevelt, Hôpital Robert-Debré, Clinique Ambroise-Paré, Hôpital Tenon, Hôpital Saint-Vincent-de-Paul (GHICL), Clinique Honoré-Cave, Clinique ambulatoire de Domont, Clinique Paris Lilas, Hôpital privé du Confluent, Clinique Saint-Pierre, Institut Bergonié (CLCC), Centre Hospitalier de Vauclaire, Hôpital Privé Nancy Lorraine, Hôpital privé de la Casamance, Hopital Joseph-Ducuing, Polyclinique de la Baie, CHU-Hôpital Purpan/HFE, Clinique Saint-Charles, Polyclinique de Reims-Bezannes (Marne), Centre de la main, Clinique des Ormeaux, Centre Hospitalier Gérard-Marchant, CH privé Saint-Grégoire, Polyclinique de Poitiers, Clinique Juge, Clinique du Diaconat-Fonderie, Clinique de la Sauvegarde, Clinique Saint-Augustin, Polyclinique Saint-Privat, Hôpital d'instruction des armées Bégin, Hôpital privé Beauregard, Clinique Bizet, CHU - Hôpital de la Côte de nacre, Nouvel Hôpital de Navarre, Polyclinique Saint Laurent, Clinique de l’Anjou, Polyclinique Saint-François, EPSM Etienne-Gourmelen, CHU - Hôpital Pellegrin, CHU - Hôpital Saint-André, CHU - Hôpitaux de Brabois, Hôpital Hôtel-Dieu, Hôpital-clinique Claude-Bernard, Groupe Hospitalier de la Rochelle, Centre de cardiologie du Pays basque, Clinique ophtalmologique Thiers, Gustave-Roussy (CLCC), Clinique Fontvert, Clinique Geoffroy-Saint-Hilaire, Clinique Toulouse-Lautrec, Centre psychothérapique de Nancy, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique Sainte-Marie, CHU Nantes - Hôpital Mère Enfant, Clinique Pasteur-Lanroze, CH Charles-Perrens, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, Clinique du sport, Hôpital d'instruction des armées Sainte-Anne, Polyclinique Jean-Villar, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Clinique Bouchard, Clinique des Franciscaines, CHU - Hôpital Claude-Huriez, Hôpital privé de Provence, CHU - Hôpital Arnaud-de-Villeneuve, CHP de l’Europe, Hôpital Lariboisière, Clinique cardiologique, Clinique Remusat, Clinique Les Eaux-Claires, Hôpital Saint-Philibert (GHICL), Hôpital privé Dijon-Bourgogne, IUCT/Oncopole, CHU Grenoble - Site Nord, Centre Hospitalier Le Vinatier, Centre Hospitalier Henri Guerin, Santé Atlantique, Clinique mutualiste de l’Estuaire, CH Guillaume-Régnier, Médipôle de Savoie, Clinique Chantecler, CHU - Hôpital Nord, GH mutualiste, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Belharra, Clinique Saint-Jean - Sud de France, Centre orthopédique médico-chirurgical, Hôpital Saint-Antoine, Clinique Sainte-Marie (GHICL), Clinique la Pergola, Hôpital Avicenne, CH/clinique, Clinique Saint-Antoine, CHU - Hôpital Saint-Eloi, CHR, Clinique Mathilde, CHU - Hôpital Maison-Blanche, Hôpital Paul-Brousse, Hôpital Saint-Camille, Clinique du Cambrésis, CH/Clinique, Hôpital privé de La Miotte, CHU - Hôpital Gui-de-Chauliac, CHR de Metz-Thionville - Hôpital de Mercy, Centre ambulatoire Kleber, Clinique Jean Causse, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique Bordeaux-Nord-Aquitaine, CH privé du Montgardé, Clinique de l’Europe, GHI, CHU - Maternité, CH Saint-Joseph-Saint-Luc, Clinique Anne-Artois, ASM, Clinique de la Muette, Centre Eugène-Marquis (CLCC), EPSM Morbihan, Pôle de Santé du Villeneuvois, Hôpital privé Sévigné, Hôpital privé Paris-Essonne, Clinique Rive-Gauche, Les Franciscaines, Hôpital privé de la Loire, Hôpital privé des Côtes-d’Armor, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Charles-Nicolle, Hôpital privé Cannes-Oxford, Polyclinique de Blois, Clinique Victor-Hugo, Hôpital des Massues, GHU Paris Psychiatrie et neurosciences, Clinique Saint-Paul, CHU - Hôpital Trousseau, Hôpital privé La Louvière, CHU Grenoble - Hôpital Sud, Institut Curie, Hôpital privé d’Antony, Polyclinique Lyon-Nord, Centre Hospitalier Drôme Vivarais, Centre Hospitalier Montperrin, Clinique Louis-Pasteur, CMC Floréal, Clinique de l'Alma, Clinique de l'Essonne, Clinique du Parc, Clinique de l’Espérance, Clinique du Val-d’Ouest Vendôme, EPSM de la Marne, Polyclinique Majorelle, Clinique Beau-Soleil, Hôpital Paris Saint-Joseph, CHU - Hôpital Morvan, Clinique du Millénaire, Clinique Convert, Médipôle Garonne, Clinique du Lac et d’Argonay, Hôpital d'instruction des armées Desgenettes, Centre de chirurgie ophtalmologique, Hôpital privé du Vert-Galant, Hôpitaux Nord (Croix-Rousse), Institut Arthur-Vernes, Clinique Saint-François, Clinique Sainte-Anne, Clinique Lille-Sud, Centre Hospitalier La Chartreuse, Hôpital Saint-Joseph, Hôpital Bicêtre, Polyclinique La Ligne bleue, CH Georges-Daumezon, Hôpitaux pédiatriques, Clinique du Pont-de-Chaume, Clinique Conti, CHU - Hôpital Roger-Salengro, Centre Hospitalier George Sand, Polyclinique Francheville, Institut Calot, CMCO, Hôpital Saint-Louis
2025-08-22 19:05:42,387 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:05:42,390 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-22 19:05:42,390 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-22 19:05:42,393 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:42,394 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:42,394 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:42,394 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:42,394 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:42,395 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:42,395 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:42,905 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:42 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'331'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'349'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_b70dcc50a9334ccc938e661e10a69d78'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4e08e58da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:42,905 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:42,906 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:42,912 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:42,912 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:42,912 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:42,913 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:42 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '331', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '349', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_b70dcc50a9334ccc938e661e10a69d78', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f4e08e58da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:42,913 [DEBUG] openai._base_client: request_id: req_b70dcc50a9334ccc938e661e10a69d78
2025-08-22 19:05:42,914 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:42,914 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:42,914 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:05:42,914 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:42,917 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:42,918 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:42,918 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:42,919 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:42,919 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:42,919 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:42,919 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:43,428 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:43 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'248'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'347'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_eb7574f885704dd5be7fdc9dc6b1b70f'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4e3de85da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:43,428 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:43,428 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:43,435 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:43,436 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:43,436 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:43,436 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:43 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '248', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '347', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_eb7574f885704dd5be7fdc9dc6b1b70f', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f4e3de85da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:43,436 [DEBUG] openai._base_client: request_id: req_eb7574f885704dd5be7fdc9dc6b1b70f
2025-08-22 19:05:43,437 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:05:43,437 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:05:43,437 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:05:43,437 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:43,439 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:43,440 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:43,440 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:43,440 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:43,441 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:43,441 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:43,441 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:45,169 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:45 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1544'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1565'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_ca13a1a3ef604b41b15721f5a1eb1184'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4e71f64da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:45,170 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:45,170 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:45,173 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:45,173 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:45,173 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:45,173 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:45 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '1544', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1565', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_ca13a1a3ef604b41b15721f5a1eb1184', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f4e71f64da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:45,174 [DEBUG] openai._base_client: request_id: req_ca13a1a3ef604b41b15721f5a1eb1184
2025-08-22 19:05:45,174 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:05:45,174 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:05:45,175 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:05:45,175 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-22 19:05:45,175 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:45,175 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:45,175 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:05:45,175 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:45,178 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:45,178 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:45,179 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:45,179 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:45,179 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:45,179 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:45,179 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:45,616 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:45 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'250'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'272'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_2c84119ae1b64fe8ad537e66f2cd13e5'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4f1fbbeda11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:45,617 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:45,617 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:45,623 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:45,624 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:45,624 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:45,624 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:45 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '250', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '272', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_2c84119ae1b64fe8ad537e66f2cd13e5', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f4f1fbbeda11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:45,624 [DEBUG] openai._base_client: request_id: req_2c84119ae1b64fe8ad537e66f2cd13e5
2025-08-22 19:05:45,625 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:05:45,625 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:05:45,625 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:05:45,625 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:45,628 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:45,629 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:45,629 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:45,629 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:45,630 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:45,630 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:45,630 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:47,770 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:47 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1446'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1978'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_8c36deb7136045a88557e64512d49fcc'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f4f4cb4ada11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:47,771 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:47,771 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:47,775 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:47,775 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:47,775 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:47,775 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:47 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '1446', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1978', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_8c36deb7136045a88557e64512d49fcc', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f4f4cb4ada11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:47,775 [DEBUG] openai._base_client: request_id: req_8c36deb7136045a88557e64512d49fcc
2025-08-22 19:05:47,776 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:05:47,776 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:05:47,776 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:05:47,776 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-22 19:05:47,776 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-22 19:05:47,779 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:47,779 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:47,780 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:47,780 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:47,780 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:47,780 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:47,780 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:48,367 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:48 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'394'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'416'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_57e74c2da084446dbd8cf14a712e2915'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f5023805da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:48,368 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:48,368 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:48,373 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:48,373 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:48,373 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:48,373 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:48 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '394', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '416', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_57e74c2da084446dbd8cf14a712e2915', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f5023805da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:48,373 [DEBUG] openai._base_client: request_id: req_57e74c2da084446dbd8cf14a712e2915
2025-08-22 19:05:48,374 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 19:05:48,374 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 19:05:48,374 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 19:05:48,377 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:48,378 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:48,378 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:48,378 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:48,378 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:48,378 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:48,378 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:49,018 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'459'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'481'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_321a35dec9ce4262812fad0605492a30'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f505fa24da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:49,019 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:49,019 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:49,023 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:49,023 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:49,023 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:49,023 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:49 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '459', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '481', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_321a35dec9ce4262812fad0605492a30', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f505fa24da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:49,023 [DEBUG] openai._base_client: request_id: req_321a35dec9ce4262812fad0605492a30
2025-08-22 19:05:49,024 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-22 19:05:49,024 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-22 19:05:49,024 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-22 19:05:49,024 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-22 19:05:49,024 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-22 19:05:49,024 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 19:05:49,024 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-22 19:05:49,025 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-22 19:05:49,025 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 19:05:49,025 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 19:05:49,061 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:05:49,062 [DEBUG] app.services.data_processing_service: Institution list: Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Grand hôpital de l'Est-Francilien, Fondation Rothschild, Centre Hospitalier d'Erstein, Clinique Trenel, Centre François-Baclesse (CLCC), CHU - Gabriel-Montpied, CHU - Hôpital Haut-Lévêque, Polyclinique de la Région-Mantaise, Clinique Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Durieux, Centre Georges-François-Leclerc (CLCC), Hôpital de la Timone (enfants), Clinique du Parc-Monceau, Polyclinique du Grand-Sud, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital privé Clairval, Centre Hospitalier Les Murets, Clinique Kennedy, Polyclinique Saint-Jean, CHU - Institut cœur-poumon, Hôpital privé des Peupliers, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique urologique Nantes-Atlantis, Hôpital privé Vert-Coteau, Institut Jean-Godinot (CLCC), Clinique Océane, GH Paul Guiraud, Institut universitaire de la face et du cou, Clinique mutualiste de Bonneveine, Polyclinique de Limoges - site Chénieux, Clinique Saint-Michel, Institut Curie (CLCC), Institut Paoli-Calmettes (CLCC), Clinique d’Occitanie, Clinique des Orchidées, Centre cardiologique du Nord, Hôpital Pierre-Wertheimer, Hôpital Beaujon, CHU d'Amiens/Institut ophtalmologique de Picardie, Polyclinique du Maine, CH Henri-Laborit, Clinique Saint-Amé, CHU - Hôpital de l’Archet, Hôpital Nord Franche-Comté-Belfort, Clinique de l’Yvette, Hôpital Nord, Centre Hospitalier Maurice Despinoy, Centre Psychothérapique, Clinique mutualiste catalane, Institut de cancérologie de Lorraine (CLCC), Polyclinique du Parc-Drevon, CHU - Hôpital Dupuytren, Hôpital de la Timone (adultes), CHU - Hôpital de la Mère et de l’Enfant, Hôpital de la Timone (Enfants), Polyclinique de Reims-Bezannes, Hôpital Edouard-Herriot, CH Basse-Terre (Guadeloupe), Clinique Tivoli-Ducos, CH Édouard-Toulouse, CHU - Hôpital Sud, CHU de Pointe-à-Pitre, Centre Léon-Bérard (CLCC), Hôpital de la Croix Rousse (HCL) / CH, CHU - Hôpital de la Cavale-Blanche, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de Bordeaux-Tondu, Hôpital privé La Montagne Lambert, Clinique Saint-Joseph, Clinique de l’Orangerie, Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Clocheville, CHU - American Memorial Hospital, Epsan, Polyclinique Saint-Côme, Clinique de la Miséricorde, CHU de Martinique, Clinique Esquirol-Saint-Hilaire, Clinique Jean le Bon, Hôpital européen, Institut mutualiste Montsouris, Hôpital privé, Institut franco-britannique Kléber, GCS Clinique du Ter, Clinique Sainte-Clotilde, Clinique Saint-Léonard, Clinique de la Part-Dieu, Hôpital Henri-Mondor, Clinique mutualiste de la Porte-de-l'Orient, EPS Ville-Évrard, Hôpital Belle-Isle, CHU - Hôpital d’Estaing, Hôpital Trousseau, Hôpital Robert Schuman, Infirmerie protestante de Lyon, HCL - Hôpital Femme-mère-enfant, Centre Jean-Perrin (CLCC), Institut Arnault-Tzanck, Centre Oscar-Lambret (CLCC), CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé de Villeneuve-d’Ascq, Clinique Bretéché, Clinique Marcel-Sembat, CHU de La Réunion - Félix-Guyon, Clinique Saint-George, CHU - Hôpital Pasteur, Polyclinique Saint-Roch, CMCO Côte d’Opale, Hôtel-Dieu, Hôpital Renée-Sabran, Hôpitaux de Saint-Maurice, Hôpital d'instruction des armées Laveran, Clinique mutualiste Jules-Verne, Clinique de Bercy, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique Saint-Jean l’Ermitage, Pôle santé Oréliance, CHU - Centre chirurgical Emile-Gallé, Hôpital privé de Marne-la-Vallée, Hôpital Cochin, Hôpital Albert Schweitzer, CHU Sud-Réunion, CHU - Hôpital Purpan, EPSM de Saône-et-Loire, Maison de santé Bagatelle, Clinique du Tertre-Rouge, Hôpital de la Croix-Saint-Simon, CH privé Claude-Galien, Polyclinique Bordeaux-Rive droite, Clinique Delay, Clinique Saint-Nabor, Clinique Victor-Pauchet, Clinique Saint-Vincent, Clinique Charcot, CHU - Hôpital de Hautepierre, Clinique Ormeau centre, Hôpital privé Jean-Mermoz, Hôpital privé Pays-de-Savoie, CHU - Hôpital Lapeyronie, Hôpital privé de l’Est lyonnais, Institut de cancérologie de l’Ouest, Polyclinique Médipôle Saint-Roch, Clinique générale, Clinique Maussins-Nollet, Polyclinique Urbain-V, Hôpital des Diaconesses, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical et obstétrical, Hôpital privé Nord Parisien, Clinique Saint-Jean-de-Dieu, Polyclinique Aguilera, Polyclinique du Parc, Clinique Les Fontaines, CHU - Hôpital Central, Clinique de l’Union, Groupe hospitalier Nord-Essonne, Euromed Cardio, Hôpital privé de la Seine-Saint-Denis, Clinique des Cèdres, Hôpitaux Sud, CHI, Nouvelle clinique de Tours, Clinique Notre-Dame-de-l’Espérance, Centre Clinical, Clinique Clémentville, Polyclinique, Clinique Arago, Hôpital privé Le Bois, Clinique du Trocadéro, CHU - Hôpitaux mère-enfants, Hôpital Louis-Pradel, Clinique du Pré, GH, Hôpital Necker-Enfants-Malades, CMC de Parly-II, Institut ophtalmique, Institut du cancer de Montpellier (CLCC), Hôpital d'instruction des armées Legouest, Clinique du Val-d’Or, Hôpital de la Pitié-Salpêtrière, Polyclinique Vauban, Clinique du Fief-de-Grimoire, Hôpital Louis-Mourier, Hôpital privé La Châtaigneraie, Clinique Turin, CH Esquirol, Clinique Rhône Durance, Hôpital Antoine-Béclère, CHU de Nantes, Pôle Santé République, Hôpital privé Arras-Les Bonnettes, Polyclinique du Beaujolais, Hôpital privé Paul-d’Égine, Hôpital Jean-Verdier, EPSM Lille-Métropole, Centre Hospitalier du Rouvray, Clinique Saint-Hilaire, Clinique du Cèdre, Polyclinique Santa-Maria, CM Bénigne-Joly, Clinique de l’Atlantique, Clinique Bon-Secours, Clinique Rhéna, Clinique Saint-André, Nouvelle clinique Bel-Air, CHU d’Amiens, Polyclinique de Kerio, Clinique mutualiste La Sagesse, Polyclinique de Picardie, Hôpital d'instruction des armées Percy, Clinique du Croisé-Laroche, EPS Barthélemy-Durand, Pôle santé Léonard-de-Vinci, Clinique de l’Estrée, Hôpital privé de l’Estuaire, Hôpital privé Saint-Martin, Clinique mutualiste, Institut de cancérologie Strasbourg Europe, CMC Pierre-Cherest, Hôpital privé de l’Ouest parisien, CHU - Hôpital Robert-Debré, Hôpitaux civils, Hôpital privé Natecia, Hôpital privé Drôme-Ardèche, CHU - Hôpital Bretonneau, Hôpital privé Armand-Brillard, Médipôle Hôpital Privé, CHU Réunion, Polyclinique Les Fleurs, Hôpital Ambroise-Paré, CHU de Martinique - site Mère-Enfant, Institut hospitalier Jacques-Cartier, Clinique Jouvenet, Hôpital de la Conception, CHU - Hôpital Larrey, Hôpital Bichat, Hôpital Corentin-Celton, Clinique du Grand-Large, Centre chirurgical Marie-Lannelongue, CHU - Hôpital Rangueil, Clinique Ormeau Pyrénées, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique de Keraudren, Clinique Monticelli-Vélodrome, Clinique Claude-Bernard, CH Montfavet, Hôpital Foch, Centre Hospitalier Sainte-Marie, Polyclinique de Limoges - site Émailleurs, Clinique La Croix du Sud, Centre Hospitalier des Pyrénées, Espm de L’agglomeration Lilloise, Hôpital européen Georges-Pompidou, Polyclinique de Navarre, CHU - Hôpital Pontchaillou, Centre Henri-Becquerel (CLCC), CHU - site Nord, Polyclinique Côte-Basque-Sud, Centre cardiologique, Clinique du Renaison, Clinique Belledonne, IUCT Oncopole, CH intercommunal, Centre Hospitalier Le Mas Careiron, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Axium, Hôpital privé de Marne Chantereine, Clinique de la Plaine, CHU - Hôpital civil, Clinique du Diaconat-Roosevelt, Hôpital Robert-Debré, Clinique Ambroise-Paré, Hôpital Tenon, Hôpital Saint-Vincent-de-Paul (GHICL), Clinique Honoré-Cave, Clinique ambulatoire de Domont, Clinique Paris Lilas, Hôpital privé du Confluent, Clinique Saint-Pierre, Institut Bergonié (CLCC), Centre Hospitalier de Vauclaire, Hôpital Privé Nancy Lorraine, Hôpital privé de la Casamance, Hopital Joseph-Ducuing, Polyclinique de la Baie, CHU-Hôpital Purpan/HFE, Clinique Saint-Charles, Polyclinique de Reims-Bezannes (Marne), Centre de la main, Clinique des Ormeaux, Centre Hospitalier Gérard-Marchant, CH privé Saint-Grégoire, Polyclinique de Poitiers, Clinique Juge, Clinique du Diaconat-Fonderie, Clinique de la Sauvegarde, Clinique Saint-Augustin, Polyclinique Saint-Privat, Hôpital d'instruction des armées Bégin, Hôpital privé Beauregard, Clinique Bizet, CHU - Hôpital de la Côte de nacre, Nouvel Hôpital de Navarre, Polyclinique Saint Laurent, Clinique de l’Anjou, Polyclinique Saint-François, EPSM Etienne-Gourmelen, CHU - Hôpital Pellegrin, CHU - Hôpital Saint-André, CHU - Hôpitaux de Brabois, Hôpital Hôtel-Dieu, Hôpital-clinique Claude-Bernard, Groupe Hospitalier de la Rochelle, Centre de cardiologie du Pays basque, Clinique ophtalmologique Thiers, Gustave-Roussy (CLCC), Clinique Fontvert, Clinique Geoffroy-Saint-Hilaire, Clinique Toulouse-Lautrec, Centre psychothérapique de Nancy, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique Sainte-Marie, CHU Nantes - Hôpital Mère Enfant, Clinique Pasteur-Lanroze, CH Charles-Perrens, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, Clinique du sport, Hôpital d'instruction des armées Sainte-Anne, Polyclinique Jean-Villar, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Clinique Bouchard, Clinique des Franciscaines, CHU - Hôpital Claude-Huriez, Hôpital privé de Provence, CHU - Hôpital Arnaud-de-Villeneuve, CHP de l’Europe, Hôpital Lariboisière, Clinique cardiologique, Clinique Remusat, Clinique Les Eaux-Claires, Hôpital Saint-Philibert (GHICL), Hôpital privé Dijon-Bourgogne, IUCT/Oncopole, CHU Grenoble - Site Nord, Centre Hospitalier Le Vinatier, Centre Hospitalier Henri Guerin, Santé Atlantique, Clinique mutualiste de l’Estuaire, CH Guillaume-Régnier, Médipôle de Savoie, Clinique Chantecler, CHU - Hôpital Nord, GH mutualiste, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Belharra, Clinique Saint-Jean - Sud de France, Centre orthopédique médico-chirurgical, Hôpital Saint-Antoine, Clinique Sainte-Marie (GHICL), Clinique la Pergola, Hôpital Avicenne, CH/clinique, Clinique Saint-Antoine, CHU - Hôpital Saint-Eloi, CHR, Clinique Mathilde, CHU - Hôpital Maison-Blanche, Hôpital Paul-Brousse, Hôpital Saint-Camille, Clinique du Cambrésis, CH/Clinique, Hôpital privé de La Miotte, CHU - Hôpital Gui-de-Chauliac, CHR de Metz-Thionville - Hôpital de Mercy, Centre ambulatoire Kleber, Clinique Jean Causse, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique Bordeaux-Nord-Aquitaine, CH privé du Montgardé, Clinique de l’Europe, GHI, CHU - Maternité, CH Saint-Joseph-Saint-Luc, Clinique Anne-Artois, ASM, Clinique de la Muette, Centre Eugène-Marquis (CLCC), EPSM Morbihan, Pôle de Santé du Villeneuvois, Hôpital privé Sévigné, Hôpital privé Paris-Essonne, Clinique Rive-Gauche, Les Franciscaines, Hôpital privé de la Loire, Hôpital privé des Côtes-d’Armor, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Charles-Nicolle, Hôpital privé Cannes-Oxford, Polyclinique de Blois, Clinique Victor-Hugo, Hôpital des Massues, GHU Paris Psychiatrie et neurosciences, Clinique Saint-Paul, CHU - Hôpital Trousseau, Hôpital privé La Louvière, CHU Grenoble - Hôpital Sud, Institut Curie, Hôpital privé d’Antony, Polyclinique Lyon-Nord, Centre Hospitalier Drôme Vivarais, Centre Hospitalier Montperrin, Clinique Louis-Pasteur, CMC Floréal, Clinique de l'Alma, Clinique de l'Essonne, Clinique du Parc, Clinique de l’Espérance, Clinique du Val-d’Ouest Vendôme, EPSM de la Marne, Polyclinique Majorelle, Clinique Beau-Soleil, Hôpital Paris Saint-Joseph, CHU - Hôpital Morvan, Clinique du Millénaire, Clinique Convert, Médipôle Garonne, Clinique du Lac et d’Argonay, Hôpital d'instruction des armées Desgenettes, Centre de chirurgie ophtalmologique, Hôpital privé du Vert-Galant, Hôpitaux Nord (Croix-Rousse), Institut Arthur-Vernes, Clinique Saint-François, Clinique Sainte-Anne, Clinique Lille-Sud, Centre Hospitalier La Chartreuse, Hôpital Saint-Joseph, Hôpital Bicêtre, Polyclinique La Ligne bleue, CH Georges-Daumezon, Hôpitaux pédiatriques, Clinique du Pont-de-Chaume, Clinique Conti, CHU - Hôpital Roger-Salengro, Centre Hospitalier George Sand, Polyclinique Francheville, Institut Calot, CMCO, Hôpital Saint-Louis
2025-08-22 19:05:49,063 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 19:05:49,283 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 19:05:49,283 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 19:05:49,283 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-22 19:05:49,283 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-22 19:05:49,283 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 19:05:49,283 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-22 19:05:49,283 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 19:05:49,284 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 19:05:49,284 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-22 19:05:49,284 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-22 19:05:49,284 [DEBUG] app.services.pipeline_orchestrator_service: Calling build_ranking_dataframe_with_distances
2025-08-22 19:05:49,284 [INFO] app.services.pipeline_orchestrator_service: Building ranking DataFrame with distances: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', excel_path='/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx', detected_specialty='no specialty match'
2025-08-22 19:05:49,284 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history='None'
2025-08-22 19:05:49,284 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 19:05:49,284 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 19:05:49,284 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 19:05:49,284 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 19:05:49,436 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:05:49,436 [DEBUG] app.services.data_processing_service: Institution list: Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Grand hôpital de l'Est-Francilien, Fondation Rothschild, Centre Hospitalier d'Erstein, Clinique Trenel, Centre François-Baclesse (CLCC), CHU - Gabriel-Montpied, CHU - Hôpital Haut-Lévêque, Polyclinique de la Région-Mantaise, Clinique Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Durieux, Centre Georges-François-Leclerc (CLCC), Hôpital de la Timone (enfants), Clinique du Parc-Monceau, Polyclinique du Grand-Sud, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital privé Clairval, Centre Hospitalier Les Murets, Clinique Kennedy, Polyclinique Saint-Jean, CHU - Institut cœur-poumon, Hôpital privé des Peupliers, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique urologique Nantes-Atlantis, Hôpital privé Vert-Coteau, Institut Jean-Godinot (CLCC), Clinique Océane, GH Paul Guiraud, Institut universitaire de la face et du cou, Clinique mutualiste de Bonneveine, Polyclinique de Limoges - site Chénieux, Clinique Saint-Michel, Institut Curie (CLCC), Institut Paoli-Calmettes (CLCC), Clinique d’Occitanie, Clinique des Orchidées, Centre cardiologique du Nord, Hôpital Pierre-Wertheimer, Hôpital Beaujon, CHU d'Amiens/Institut ophtalmologique de Picardie, Polyclinique du Maine, CH Henri-Laborit, Clinique Saint-Amé, CHU - Hôpital de l’Archet, Hôpital Nord Franche-Comté-Belfort, Clinique de l’Yvette, Hôpital Nord, Centre Hospitalier Maurice Despinoy, Centre Psychothérapique, Clinique mutualiste catalane, Institut de cancérologie de Lorraine (CLCC), Polyclinique du Parc-Drevon, CHU - Hôpital Dupuytren, Hôpital de la Timone (adultes), CHU - Hôpital de la Mère et de l’Enfant, Hôpital de la Timone (Enfants), Polyclinique de Reims-Bezannes, Hôpital Edouard-Herriot, CH Basse-Terre (Guadeloupe), Clinique Tivoli-Ducos, CH Édouard-Toulouse, CHU - Hôpital Sud, CHU de Pointe-à-Pitre, Centre Léon-Bérard (CLCC), Hôpital de la Croix Rousse (HCL) / CH, CHU - Hôpital de la Cavale-Blanche, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de Bordeaux-Tondu, Hôpital privé La Montagne Lambert, Clinique Saint-Joseph, Clinique de l’Orangerie, Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Clocheville, CHU - American Memorial Hospital, Epsan, Polyclinique Saint-Côme, Clinique de la Miséricorde, CHU de Martinique, Clinique Esquirol-Saint-Hilaire, Clinique Jean le Bon, Hôpital européen, Institut mutualiste Montsouris, Hôpital privé, Institut franco-britannique Kléber, GCS Clinique du Ter, Clinique Sainte-Clotilde, Clinique Saint-Léonard, Clinique de la Part-Dieu, Hôpital Henri-Mondor, Clinique mutualiste de la Porte-de-l'Orient, EPS Ville-Évrard, Hôpital Belle-Isle, CHU - Hôpital d’Estaing, Hôpital Trousseau, Hôpital Robert Schuman, Infirmerie protestante de Lyon, HCL - Hôpital Femme-mère-enfant, Centre Jean-Perrin (CLCC), Institut Arnault-Tzanck, Centre Oscar-Lambret (CLCC), CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé de Villeneuve-d’Ascq, Clinique Bretéché, Clinique Marcel-Sembat, CHU de La Réunion - Félix-Guyon, Clinique Saint-George, CHU - Hôpital Pasteur, Polyclinique Saint-Roch, CMCO Côte d’Opale, Hôtel-Dieu, Hôpital Renée-Sabran, Hôpitaux de Saint-Maurice, Hôpital d'instruction des armées Laveran, Clinique mutualiste Jules-Verne, Clinique de Bercy, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique Saint-Jean l’Ermitage, Pôle santé Oréliance, CHU - Centre chirurgical Emile-Gallé, Hôpital privé de Marne-la-Vallée, Hôpital Cochin, Hôpital Albert Schweitzer, CHU Sud-Réunion, CHU - Hôpital Purpan, EPSM de Saône-et-Loire, Maison de santé Bagatelle, Clinique du Tertre-Rouge, Hôpital de la Croix-Saint-Simon, CH privé Claude-Galien, Polyclinique Bordeaux-Rive droite, Clinique Delay, Clinique Saint-Nabor, Clinique Victor-Pauchet, Clinique Saint-Vincent, Clinique Charcot, CHU - Hôpital de Hautepierre, Clinique Ormeau centre, Hôpital privé Jean-Mermoz, Hôpital privé Pays-de-Savoie, CHU - Hôpital Lapeyronie, Hôpital privé de l’Est lyonnais, Institut de cancérologie de l’Ouest, Polyclinique Médipôle Saint-Roch, Clinique générale, Clinique Maussins-Nollet, Polyclinique Urbain-V, Hôpital des Diaconesses, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical et obstétrical, Hôpital privé Nord Parisien, Clinique Saint-Jean-de-Dieu, Polyclinique Aguilera, Polyclinique du Parc, Clinique Les Fontaines, CHU - Hôpital Central, Clinique de l’Union, Groupe hospitalier Nord-Essonne, Euromed Cardio, Hôpital privé de la Seine-Saint-Denis, Clinique des Cèdres, Hôpitaux Sud, CHI, Nouvelle clinique de Tours, Clinique Notre-Dame-de-l’Espérance, Centre Clinical, Clinique Clémentville, Polyclinique, Clinique Arago, Hôpital privé Le Bois, Clinique du Trocadéro, CHU - Hôpitaux mère-enfants, Hôpital Louis-Pradel, Clinique du Pré, GH, Hôpital Necker-Enfants-Malades, CMC de Parly-II, Institut ophtalmique, Institut du cancer de Montpellier (CLCC), Hôpital d'instruction des armées Legouest, Clinique du Val-d’Or, Hôpital de la Pitié-Salpêtrière, Polyclinique Vauban, Clinique du Fief-de-Grimoire, Hôpital Louis-Mourier, Hôpital privé La Châtaigneraie, Clinique Turin, CH Esquirol, Clinique Rhône Durance, Hôpital Antoine-Béclère, CHU de Nantes, Pôle Santé République, Hôpital privé Arras-Les Bonnettes, Polyclinique du Beaujolais, Hôpital privé Paul-d’Égine, Hôpital Jean-Verdier, EPSM Lille-Métropole, Centre Hospitalier du Rouvray, Clinique Saint-Hilaire, Clinique du Cèdre, Polyclinique Santa-Maria, CM Bénigne-Joly, Clinique de l’Atlantique, Clinique Bon-Secours, Clinique Rhéna, Clinique Saint-André, Nouvelle clinique Bel-Air, CHU d’Amiens, Polyclinique de Kerio, Clinique mutualiste La Sagesse, Polyclinique de Picardie, Hôpital d'instruction des armées Percy, Clinique du Croisé-Laroche, EPS Barthélemy-Durand, Pôle santé Léonard-de-Vinci, Clinique de l’Estrée, Hôpital privé de l’Estuaire, Hôpital privé Saint-Martin, Clinique mutualiste, Institut de cancérologie Strasbourg Europe, CMC Pierre-Cherest, Hôpital privé de l’Ouest parisien, CHU - Hôpital Robert-Debré, Hôpitaux civils, Hôpital privé Natecia, Hôpital privé Drôme-Ardèche, CHU - Hôpital Bretonneau, Hôpital privé Armand-Brillard, Médipôle Hôpital Privé, CHU Réunion, Polyclinique Les Fleurs, Hôpital Ambroise-Paré, CHU de Martinique - site Mère-Enfant, Institut hospitalier Jacques-Cartier, Clinique Jouvenet, Hôpital de la Conception, CHU - Hôpital Larrey, Hôpital Bichat, Hôpital Corentin-Celton, Clinique du Grand-Large, Centre chirurgical Marie-Lannelongue, CHU - Hôpital Rangueil, Clinique Ormeau Pyrénées, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique de Keraudren, Clinique Monticelli-Vélodrome, Clinique Claude-Bernard, CH Montfavet, Hôpital Foch, Centre Hospitalier Sainte-Marie, Polyclinique de Limoges - site Émailleurs, Clinique La Croix du Sud, Centre Hospitalier des Pyrénées, Espm de L’agglomeration Lilloise, Hôpital européen Georges-Pompidou, Polyclinique de Navarre, CHU - Hôpital Pontchaillou, Centre Henri-Becquerel (CLCC), CHU - site Nord, Polyclinique Côte-Basque-Sud, Centre cardiologique, Clinique du Renaison, Clinique Belledonne, IUCT Oncopole, CH intercommunal, Centre Hospitalier Le Mas Careiron, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Axium, Hôpital privé de Marne Chantereine, Clinique de la Plaine, CHU - Hôpital civil, Clinique du Diaconat-Roosevelt, Hôpital Robert-Debré, Clinique Ambroise-Paré, Hôpital Tenon, Hôpital Saint-Vincent-de-Paul (GHICL), Clinique Honoré-Cave, Clinique ambulatoire de Domont, Clinique Paris Lilas, Hôpital privé du Confluent, Clinique Saint-Pierre, Institut Bergonié (CLCC), Centre Hospitalier de Vauclaire, Hôpital Privé Nancy Lorraine, Hôpital privé de la Casamance, Hopital Joseph-Ducuing, Polyclinique de la Baie, CHU-Hôpital Purpan/HFE, Clinique Saint-Charles, Polyclinique de Reims-Bezannes (Marne), Centre de la main, Clinique des Ormeaux, Centre Hospitalier Gérard-Marchant, CH privé Saint-Grégoire, Polyclinique de Poitiers, Clinique Juge, Clinique du Diaconat-Fonderie, Clinique de la Sauvegarde, Clinique Saint-Augustin, Polyclinique Saint-Privat, Hôpital d'instruction des armées Bégin, Hôpital privé Beauregard, Clinique Bizet, CHU - Hôpital de la Côte de nacre, Nouvel Hôpital de Navarre, Polyclinique Saint Laurent, Clinique de l’Anjou, Polyclinique Saint-François, EPSM Etienne-Gourmelen, CHU - Hôpital Pellegrin, CHU - Hôpital Saint-André, CHU - Hôpitaux de Brabois, Hôpital Hôtel-Dieu, Hôpital-clinique Claude-Bernard, Groupe Hospitalier de la Rochelle, Centre de cardiologie du Pays basque, Clinique ophtalmologique Thiers, Gustave-Roussy (CLCC), Clinique Fontvert, Clinique Geoffroy-Saint-Hilaire, Clinique Toulouse-Lautrec, Centre psychothérapique de Nancy, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique Sainte-Marie, CHU Nantes - Hôpital Mère Enfant, Clinique Pasteur-Lanroze, CH Charles-Perrens, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, Clinique du sport, Hôpital d'instruction des armées Sainte-Anne, Polyclinique Jean-Villar, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Clinique Bouchard, Clinique des Franciscaines, CHU - Hôpital Claude-Huriez, Hôpital privé de Provence, CHU - Hôpital Arnaud-de-Villeneuve, CHP de l’Europe, Hôpital Lariboisière, Clinique cardiologique, Clinique Remusat, Clinique Les Eaux-Claires, Hôpital Saint-Philibert (GHICL), Hôpital privé Dijon-Bourgogne, IUCT/Oncopole, CHU Grenoble - Site Nord, Centre Hospitalier Le Vinatier, Centre Hospitalier Henri Guerin, Santé Atlantique, Clinique mutualiste de l’Estuaire, CH Guillaume-Régnier, Médipôle de Savoie, Clinique Chantecler, CHU - Hôpital Nord, GH mutualiste, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Belharra, Clinique Saint-Jean - Sud de France, Centre orthopédique médico-chirurgical, Hôpital Saint-Antoine, Clinique Sainte-Marie (GHICL), Clinique la Pergola, Hôpital Avicenne, CH/clinique, Clinique Saint-Antoine, CHU - Hôpital Saint-Eloi, CHR, Clinique Mathilde, CHU - Hôpital Maison-Blanche, Hôpital Paul-Brousse, Hôpital Saint-Camille, Clinique du Cambrésis, CH/Clinique, Hôpital privé de La Miotte, CHU - Hôpital Gui-de-Chauliac, CHR de Metz-Thionville - Hôpital de Mercy, Centre ambulatoire Kleber, Clinique Jean Causse, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique Bordeaux-Nord-Aquitaine, CH privé du Montgardé, Clinique de l’Europe, GHI, CHU - Maternité, CH Saint-Joseph-Saint-Luc, Clinique Anne-Artois, ASM, Clinique de la Muette, Centre Eugène-Marquis (CLCC), EPSM Morbihan, Pôle de Santé du Villeneuvois, Hôpital privé Sévigné, Hôpital privé Paris-Essonne, Clinique Rive-Gauche, Les Franciscaines, Hôpital privé de la Loire, Hôpital privé des Côtes-d’Armor, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Charles-Nicolle, Hôpital privé Cannes-Oxford, Polyclinique de Blois, Clinique Victor-Hugo, Hôpital des Massues, GHU Paris Psychiatrie et neurosciences, Clinique Saint-Paul, CHU - Hôpital Trousseau, Hôpital privé La Louvière, CHU Grenoble - Hôpital Sud, Institut Curie, Hôpital privé d’Antony, Polyclinique Lyon-Nord, Centre Hospitalier Drôme Vivarais, Centre Hospitalier Montperrin, Clinique Louis-Pasteur, CMC Floréal, Clinique de l'Alma, Clinique de l'Essonne, Clinique du Parc, Clinique de l’Espérance, Clinique du Val-d’Ouest Vendôme, EPSM de la Marne, Polyclinique Majorelle, Clinique Beau-Soleil, Hôpital Paris Saint-Joseph, CHU - Hôpital Morvan, Clinique du Millénaire, Clinique Convert, Médipôle Garonne, Clinique du Lac et d’Argonay, Hôpital d'instruction des armées Desgenettes, Centre de chirurgie ophtalmologique, Hôpital privé du Vert-Galant, Hôpitaux Nord (Croix-Rousse), Institut Arthur-Vernes, Clinique Saint-François, Clinique Sainte-Anne, Clinique Lille-Sud, Centre Hospitalier La Chartreuse, Hôpital Saint-Joseph, Hôpital Bicêtre, Polyclinique La Ligne bleue, CH Georges-Daumezon, Hôpitaux pédiatriques, Clinique du Pont-de-Chaume, Clinique Conti, CHU - Hôpital Roger-Salengro, Centre Hospitalier George Sand, Polyclinique Francheville, Institut Calot, CMCO, Hôpital Saint-Louis
2025-08-22 19:05:49,437 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Grand hôpital de l'Est-Francilien, Fondation Rothschild, Centre Hospitalier d'Erstein, Clinique Trenel, Centre François-Baclesse (CLCC), CHU - Gabriel-Montpied, CHU - Hôpital Haut-Lévêque, Polyclinique de la Région-Mantaise, Clinique Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Durieux, Centre Georges-François-Leclerc (CLCC), Hôpital de la Timone (enfants), Clinique du Parc-Monceau, Polyclinique du Grand-Sud, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital privé Clairval, Centre Hospitalier Les Murets, Clinique Kennedy, Polyclinique Saint-Jean, CHU - Institut cœur-poumon, Hôpital privé des Peupliers, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique urologique Nantes-Atlantis, Hôpital privé Vert-Coteau, Institut Jean-Godinot (CLCC), Clinique Océane, GH Paul Guiraud, Institut universitaire de la face et du cou, Clinique mutualiste de Bonneveine, Polyclinique de Limoges - site Chénieux, Clinique Saint-Michel, Institut Curie (CLCC), Institut Paoli-Calmettes (CLCC), Clinique d’Occitanie, Clinique des Orchidées, Centre cardiologique du Nord, Hôpital Pierre-Wertheimer, Hôpital Beaujon, CHU d'Amiens/Institut ophtalmologique de Picardie, Polyclinique du Maine, CH Henri-Laborit, Clinique Saint-Amé, CHU - Hôpital de l’Archet, Hôpital Nord Franche-Comté-Belfort, Clinique de l’Yvette, Hôpital Nord, Centre Hospitalier Maurice Despinoy, Centre Psychothérapique, Clinique mutualiste catalane, Institut de cancérologie de Lorraine (CLCC), Polyclinique du Parc-Drevon, CHU - Hôpital Dupuytren, Hôpital de la Timone (adultes), CHU - Hôpital de la Mère et de l’Enfant, Hôpital de la Timone (Enfants), Polyclinique de Reims-Bezannes, Hôpital Edouard-Herriot, CH Basse-Terre (Guadeloupe), Clinique Tivoli-Ducos, CH Édouard-Toulouse, CHU - Hôpital Sud, CHU de Pointe-à-Pitre, Centre Léon-Bérard (CLCC), Hôpital de la Croix Rousse (HCL) / CH, CHU - Hôpital de la Cavale-Blanche, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de Bordeaux-Tondu, Hôpital privé La Montagne Lambert, Clinique Saint-Joseph, Clinique de l’Orangerie, Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Clocheville, CHU - American Memorial Hospital, Epsan, Polyclinique Saint-Côme, Clinique de la Miséricorde, CHU de Martinique, Clinique Esquirol-Saint-Hilaire, Clinique Jean le Bon, Hôpital européen, Institut mutualiste Montsouris, Hôpital privé, Institut franco-britannique Kléber, GCS Clinique du Ter, Clinique Sainte-Clotilde, Clinique Saint-Léonard, Clinique de la Part-Dieu, Hôpital Henri-Mondor, Clinique mutualiste de la Porte-de-l'Orient, EPS Ville-Évrard, Hôpital Belle-Isle, CHU - Hôpital d’Estaing, Hôpital Trousseau, Hôpital Robert Schuman, Infirmerie protestante de Lyon, HCL - Hôpital Femme-mère-enfant, Centre Jean-Perrin (CLCC), Institut Arnault-Tzanck, Centre Oscar-Lambret (CLCC), CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé de Villeneuve-d’Ascq, Clinique Bretéché, Clinique Marcel-Sembat, CHU de La Réunion - Félix-Guyon, Clinique Saint-George, CHU - Hôpital Pasteur, Polyclinique Saint-Roch, CMCO Côte d’Opale, Hôtel-Dieu, Hôpital Renée-Sabran, Hôpitaux de Saint-Maurice, Hôpital d'instruction des armées Laveran, Clinique mutualiste Jules-Verne, Clinique de Bercy, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique Saint-Jean l’Ermitage, Pôle santé Oréliance, CHU - Centre chirurgical Emile-Gallé, Hôpital privé de Marne-la-Vallée, Hôpital Cochin, Hôpital Albert Schweitzer, CHU Sud-Réunion, CHU - Hôpital Purpan, EPSM de Saône-et-Loire, Maison de santé Bagatelle, Clinique du Tertre-Rouge, Hôpital de la Croix-Saint-Simon, CH privé Claude-Galien, Polyclinique Bordeaux-Rive droite, Clinique Delay, Clinique Saint-Nabor, Clinique Victor-Pauchet, Clinique Saint-Vincent, Clinique Charcot, CHU - Hôpital de Hautepierre, Clinique Ormeau centre, Hôpital privé Jean-Mermoz, Hôpital privé Pays-de-Savoie, CHU - Hôpital Lapeyronie, Hôpital privé de l’Est lyonnais, Institut de cancérologie de l’Ouest, Polyclinique Médipôle Saint-Roch, Clinique générale, Clinique Maussins-Nollet, Polyclinique Urbain-V, Hôpital des Diaconesses, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical et obstétrical, Hôpital privé Nord Parisien, Clinique Saint-Jean-de-Dieu, Polyclinique Aguilera, Polyclinique du Parc, Clinique Les Fontaines, CHU - Hôpital Central, Clinique de l’Union, Groupe hospitalier Nord-Essonne, Euromed Cardio, Hôpital privé de la Seine-Saint-Denis, Clinique des Cèdres, Hôpitaux Sud, CHI, Nouvelle clinique de Tours, Clinique Notre-Dame-de-l’Espérance, Centre Clinical, Clinique Clémentville, Polyclinique, Clinique Arago, Hôpital privé Le Bois, Clinique du Trocadéro, CHU - Hôpitaux mère-enfants, Hôpital Louis-Pradel, Clinique du Pré, GH, Hôpital Necker-Enfants-Malades, CMC de Parly-II, Institut ophtalmique, Institut du cancer de Montpellier (CLCC), Hôpital d'instruction des armées Legouest, Clinique du Val-d’Or, Hôpital de la Pitié-Salpêtrière, Polyclinique Vauban, Clinique du Fief-de-Grimoire, Hôpital Louis-Mourier, Hôpital privé La Châtaigneraie, Clinique Turin, CH Esquirol, Clinique Rhône Durance, Hôpital Antoine-Béclère, CHU de Nantes, Pôle Santé République, Hôpital privé Arras-Les Bonnettes, Polyclinique du Beaujolais, Hôpital privé Paul-d’Égine, Hôpital Jean-Verdier, EPSM Lille-Métropole, Centre Hospitalier du Rouvray, Clinique Saint-Hilaire, Clinique du Cèdre, Polyclinique Santa-Maria, CM Bénigne-Joly, Clinique de l’Atlantique, Clinique Bon-Secours, Clinique Rhéna, Clinique Saint-André, Nouvelle clinique Bel-Air, CHU d’Amiens, Polyclinique de Kerio, Clinique mutualiste La Sagesse, Polyclinique de Picardie, Hôpital d'instruction des armées Percy, Clinique du Croisé-Laroche, EPS Barthélemy-Durand, Pôle santé Léonard-de-Vinci, Clinique de l’Estrée, Hôpital privé de l’Estuaire, Hôpital privé Saint-Martin, Clinique mutualiste, Institut de cancérologie Strasbourg Europe, CMC Pierre-Cherest, Hôpital privé de l’Ouest parisien, CHU - Hôpital Robert-Debré, Hôpitaux civils, Hôpital privé Natecia, Hôpital privé Drôme-Ardèche, CHU - Hôpital Bretonneau, Hôpital privé Armand-Brillard, Médipôle Hôpital Privé, CHU Réunion, Polyclinique Les Fleurs, Hôpital Ambroise-Paré, CHU de Martinique - site Mère-Enfant, Institut hospitalier Jacques-Cartier, Clinique Jouvenet, Hôpital de la Conception, CHU - Hôpital Larrey, Hôpital Bichat, Hôpital Corentin-Celton, Clinique du Grand-Large, Centre chirurgical Marie-Lannelongue, CHU - Hôpital Rangueil, Clinique Ormeau Pyrénées, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique de Keraudren, Clinique Monticelli-Vélodrome, Clinique Claude-Bernard, CH Montfavet, Hôpital Foch, Centre Hospitalier Sainte-Marie, Polyclinique de Limoges - site Émailleurs, Clinique La Croix du Sud, Centre Hospitalier des Pyrénées, Espm de L’agglomeration Lilloise, Hôpital européen Georges-Pompidou, Polyclinique de Navarre, CHU - Hôpital Pontchaillou, Centre Henri-Becquerel (CLCC), CHU - site Nord, Polyclinique Côte-Basque-Sud, Centre cardiologique, Clinique du Renaison, Clinique Belledonne, IUCT Oncopole, CH intercommunal, Centre Hospitalier Le Mas Careiron, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Axium, Hôpital privé de Marne Chantereine, Clinique de la Plaine, CHU - Hôpital civil, Clinique du Diaconat-Roosevelt, Hôpital Robert-Debré, Clinique Ambroise-Paré, Hôpital Tenon, Hôpital Saint-Vincent-de-Paul (GHICL), Clinique Honoré-Cave, Clinique ambulatoire de Domont, Clinique Paris Lilas, Hôpital privé du Confluent, Clinique Saint-Pierre, Institut Bergonié (CLCC), Centre Hospitalier de Vauclaire, Hôpital Privé Nancy Lorraine, Hôpital privé de la Casamance, Hopital Joseph-Ducuing, Polyclinique de la Baie, CHU-Hôpital Purpan/HFE, Clinique Saint-Charles, Polyclinique de Reims-Bezannes (Marne), Centre de la main, Clinique des Ormeaux, Centre Hospitalier Gérard-Marchant, CH privé Saint-Grégoire, Polyclinique de Poitiers, Clinique Juge, Clinique du Diaconat-Fonderie, Clinique de la Sauvegarde, Clinique Saint-Augustin, Polyclinique Saint-Privat, Hôpital d'instruction des armées Bégin, Hôpital privé Beauregard, Clinique Bizet, CHU - Hôpital de la Côte de nacre, Nouvel Hôpital de Navarre, Polyclinique Saint Laurent, Clinique de l’Anjou, Polyclinique Saint-François, EPSM Etienne-Gourmelen, CHU - Hôpital Pellegrin, CHU - Hôpital Saint-André, CHU - Hôpitaux de Brabois, Hôpital Hôtel-Dieu, Hôpital-clinique Claude-Bernard, Groupe Hospitalier de la Rochelle, Centre de cardiologie du Pays basque, Clinique ophtalmologique Thiers, Gustave-Roussy (CLCC), Clinique Fontvert, Clinique Geoffroy-Saint-Hilaire, Clinique Toulouse-Lautrec, Centre psychothérapique de Nancy, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique Sainte-Marie, CHU Nantes - Hôpital Mère Enfant, Clinique Pasteur-Lanroze, CH Charles-Perrens, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, Clinique du sport, Hôpital d'instruction des armées Sainte-Anne, Polyclinique Jean-Villar, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Clinique Bouchard, Clinique des Franciscaines, CHU - Hôpital Claude-Huriez, Hôpital privé de Provence, CHU - Hôpital Arnaud-de-Villeneuve, CHP de l’Europe, Hôpital Lariboisière, Clinique cardiologique, Clinique Remusat, Clinique Les Eaux-Claires, Hôpital Saint-Philibert (GHICL), Hôpital privé Dijon-Bourgogne, IUCT/Oncopole, CHU Grenoble - Site Nord, Centre Hospitalier Le Vinatier, Centre Hospitalier Henri Guerin, Santé Atlantique, Clinique mutualiste de l’Estuaire, CH Guillaume-Régnier, Médipôle de Savoie, Clinique Chantecler, CHU - Hôpital Nord, GH mutualiste, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Belharra, Clinique Saint-Jean - Sud de France, Centre orthopédique médico-chirurgical, Hôpital Saint-Antoine, Clinique Sainte-Marie (GHICL), Clinique la Pergola, Hôpital Avicenne, CH/clinique, Clinique Saint-Antoine, CHU - Hôpital Saint-Eloi, CHR, Clinique Mathilde, CHU - Hôpital Maison-Blanche, Hôpital Paul-Brousse, Hôpital Saint-Camille, Clinique du Cambrésis, CH/Clinique, Hôpital privé de La Miotte, CHU - Hôpital Gui-de-Chauliac, CHR de Metz-Thionville - Hôpital de Mercy, Centre ambulatoire Kleber, Clinique Jean Causse, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique Bordeaux-Nord-Aquitaine, CH privé du Montgardé, Clinique de l’Europe, GHI, CHU - Maternité, CH Saint-Joseph-Saint-Luc, Clinique Anne-Artois, ASM, Clinique de la Muette, Centre Eugène-Marquis (CLCC), EPSM Morbihan, Pôle de Santé du Villeneuvois, Hôpital privé Sévigné, Hôpital privé Paris-Essonne, Clinique Rive-Gauche, Les Franciscaines, Hôpital privé de la Loire, Hôpital privé des Côtes-d’Armor, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Charles-Nicolle, Hôpital privé Cannes-Oxford, Polyclinique de Blois, Clinique Victor-Hugo, Hôpital des Massues, GHU Paris Psychiatrie et neurosciences, Clinique Saint-Paul, CHU - Hôpital Trousseau, Hôpital privé La Louvière, CHU Grenoble - Hôpital Sud, Institut Curie, Hôpital privé d’Antony, Polyclinique Lyon-Nord, Centre Hospitalier Drôme Vivarais, Centre Hospitalier Montperrin, Clinique Louis-Pasteur, CMC Floréal, Clinique de l'Alma, Clinique de l'Essonne, Clinique du Parc, Clinique de l’Espérance, Clinique du Val-d’Ouest Vendôme, EPSM de la Marne, Polyclinique Majorelle, Clinique Beau-Soleil, Hôpital Paris Saint-Joseph, CHU - Hôpital Morvan, Clinique du Millénaire, Clinique Convert, Médipôle Garonne, Clinique du Lac et d’Argonay, Hôpital d'instruction des armées Desgenettes, Centre de chirurgie ophtalmologique, Hôpital privé du Vert-Galant, Hôpitaux Nord (Croix-Rousse), Institut Arthur-Vernes, Clinique Saint-François, Clinique Sainte-Anne, Clinique Lille-Sud, Centre Hospitalier La Chartreuse, Hôpital Saint-Joseph, Hôpital Bicêtre, Polyclinique La Ligne bleue, CH Georges-Daumezon, Hôpitaux pédiatriques, Clinique du Pont-de-Chaume, Clinique Conti, CHU - Hôpital Roger-Salengro, Centre Hospitalier George Sand, Polyclinique Francheville, Institut Calot, CMCO, Hôpital Saint-Louis
2025-08-22 19:05:49,438 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:05:49,438 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-22 19:05:49,438 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-22 19:05:49,441 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:49,442 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:49,442 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:49,442 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:49,442 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:49,443 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:49,443 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:49,935 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'307'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'331'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_731886dd081c4d05b5f022bc7ef704f2'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f50c9c02da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:49,935 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:49,935 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:49,940 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:49,940 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:49,940 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:49,940 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:50 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '307', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '331', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_731886dd081c4d05b5f022bc7ef704f2', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f50c9c02da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:49,941 [DEBUG] openai._base_client: request_id: req_731886dd081c4d05b5f022bc7ef704f2
2025-08-22 19:05:49,942 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:49,942 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:49,942 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:05:49,942 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:49,945 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:49,946 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:49,946 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:49,946 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:49,946 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:49,947 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:49,947 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:50,342 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'217'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'232'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_be65d18727514dac8711ed8279123ff3'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f50fcd09da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:50,343 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:50,343 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:50,347 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:50,347 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:50,348 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:50,348 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:50 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '217', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '232', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_be65d18727514dac8711ed8279123ff3', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f50fcd09da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:50,348 [DEBUG] openai._base_client: request_id: req_be65d18727514dac8711ed8279123ff3
2025-08-22 19:05:50,349 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:05:50,349 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:05:50,349 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:05:50,349 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:50,352 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:50,353 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:50,353 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:50,353 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:50,354 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:50,354 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:50,354 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:51,898 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:51 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1352'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1376'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_e577bfcfb8d44aa8a925f1602d094561'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f5124c2fda11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:51,898 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:51,898 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:51,911 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:51,912 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:51,912 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:51,912 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:51 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '1352', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1376', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_e577bfcfb8d44aa8a925f1602d094561', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f5124c2fda11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:51,912 [DEBUG] openai._base_client: request_id: req_e577bfcfb8d44aa8a925f1602d094561
2025-08-22 19:05:51,913 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:05:51,913 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:05:51,913 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:05:51,913 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-22 19:05:51,913 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:51,913 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:51,913 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:05:51,913 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:51,916 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:51,916 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:51,917 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:51,917 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:51,917 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:51,917 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:51,917 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:52,282 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:52 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'184'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'198'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_028b8c1657ea40239771aadb11539253'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f51c1db4da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:52,283 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:52,283 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:52,290 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:52,291 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:52,291 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:52,291 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:52 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '184', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '198', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_028b8c1657ea40239771aadb11539253', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f51c1db4da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:52,291 [DEBUG] openai._base_client: request_id: req_028b8c1657ea40239771aadb11539253
2025-08-22 19:05:52,292 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:05:52,292 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:05:52,292 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:05:52,292 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:05:52,295 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:52,295 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:52,296 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:52,296 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:52,296 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:52,296 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:52,296 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:53,791 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:53 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1292'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1308'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_dae162b1ce3e4fc79d1cdec1b5ea68cd'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f51e7c19da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:53,792 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:53,792 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:53,796 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:53,797 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:53,797 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:53,797 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:53 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '1292', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1308', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_dae162b1ce3e4fc79d1cdec1b5ea68cd', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f51e7c19da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:53,798 [DEBUG] openai._base_client: request_id: req_dae162b1ce3e4fc79d1cdec1b5ea68cd
2025-08-22 19:05:53,798 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:05:53,799 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:05:53,799 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:05:53,799 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-22 19:05:53,799 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-22 19:05:53,802 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:53,803 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:53,803 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:53,804 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:53,804 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:53,804 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:53,804 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:54,481 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:54 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'496'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'516'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_1ba7ca10aa65484e95e0d272a57dc816'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f527dbc6da11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:54,482 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:54,482 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:54,484 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:54,485 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:54,485 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:54,485 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:54 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '496', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '516', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_1ba7ca10aa65484e95e0d272a57dc816', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f527dbc6da11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:54,485 [DEBUG] openai._base_client: request_id: req_1ba7ca10aa65484e95e0d272a57dc816
2025-08-22 19:05:54,486 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 19:05:54,486 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 19:05:54,486 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 19:05:54,488 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:05:54,489 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:05:54,490 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:05:54,490 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:05:54,490 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:05:54,490 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:05:54,490 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:05:55,021 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:05:55 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'336'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'358'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_d68efc3996594db99822c715d972167d'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9733f52c2eabda11-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:05:55,022 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:05:55,022 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:05:55,031 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:05:55,031 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:05:55,031 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:05:55,032 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:05:55 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '336', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '358', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_d68efc3996594db99822c715d972167d', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9733f52c2eabda11-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:05:55,032 [DEBUG] openai._base_client: request_id: req_d68efc3996594db99822c715d972167d
2025-08-22 19:05:55,033 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-22 19:05:55,033 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-22 19:05:55,033 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-22 19:05:55,033 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-22 19:05:55,033 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-22 19:05:55,033 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 19:05:55,033 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-22 19:05:55,033 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-22 19:05:55,034 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 19:05:55,034 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 19:05:55,067 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:05:55,067 [DEBUG] app.services.data_processing_service: Institution list: Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Grand hôpital de l'Est-Francilien, Fondation Rothschild, Centre Hospitalier d'Erstein, Clinique Trenel, Centre François-Baclesse (CLCC), CHU - Gabriel-Montpied, CHU - Hôpital Haut-Lévêque, Polyclinique de la Région-Mantaise, Clinique Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Durieux, Centre Georges-François-Leclerc (CLCC), Hôpital de la Timone (enfants), Clinique du Parc-Monceau, Polyclinique du Grand-Sud, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital privé Clairval, Centre Hospitalier Les Murets, Clinique Kennedy, Polyclinique Saint-Jean, CHU - Institut cœur-poumon, Hôpital privé des Peupliers, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique urologique Nantes-Atlantis, Hôpital privé Vert-Coteau, Institut Jean-Godinot (CLCC), Clinique Océane, GH Paul Guiraud, Institut universitaire de la face et du cou, Clinique mutualiste de Bonneveine, Polyclinique de Limoges - site Chénieux, Clinique Saint-Michel, Institut Curie (CLCC), Institut Paoli-Calmettes (CLCC), Clinique d’Occitanie, Clinique des Orchidées, Centre cardiologique du Nord, Hôpital Pierre-Wertheimer, Hôpital Beaujon, CHU d'Amiens/Institut ophtalmologique de Picardie, Polyclinique du Maine, CH Henri-Laborit, Clinique Saint-Amé, CHU - Hôpital de l’Archet, Hôpital Nord Franche-Comté-Belfort, Clinique de l’Yvette, Hôpital Nord, Centre Hospitalier Maurice Despinoy, Centre Psychothérapique, Clinique mutualiste catalane, Institut de cancérologie de Lorraine (CLCC), Polyclinique du Parc-Drevon, CHU - Hôpital Dupuytren, Hôpital de la Timone (adultes), CHU - Hôpital de la Mère et de l’Enfant, Hôpital de la Timone (Enfants), Polyclinique de Reims-Bezannes, Hôpital Edouard-Herriot, CH Basse-Terre (Guadeloupe), Clinique Tivoli-Ducos, CH Édouard-Toulouse, CHU - Hôpital Sud, CHU de Pointe-à-Pitre, Centre Léon-Bérard (CLCC), Hôpital de la Croix Rousse (HCL) / CH, CHU - Hôpital de la Cavale-Blanche, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de Bordeaux-Tondu, Hôpital privé La Montagne Lambert, Clinique Saint-Joseph, Clinique de l’Orangerie, Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Clocheville, CHU - American Memorial Hospital, Epsan, Polyclinique Saint-Côme, Clinique de la Miséricorde, CHU de Martinique, Clinique Esquirol-Saint-Hilaire, Clinique Jean le Bon, Hôpital européen, Institut mutualiste Montsouris, Hôpital privé, Institut franco-britannique Kléber, GCS Clinique du Ter, Clinique Sainte-Clotilde, Clinique Saint-Léonard, Clinique de la Part-Dieu, Hôpital Henri-Mondor, Clinique mutualiste de la Porte-de-l'Orient, EPS Ville-Évrard, Hôpital Belle-Isle, CHU - Hôpital d’Estaing, Hôpital Trousseau, Hôpital Robert Schuman, Infirmerie protestante de Lyon, HCL - Hôpital Femme-mère-enfant, Centre Jean-Perrin (CLCC), Institut Arnault-Tzanck, Centre Oscar-Lambret (CLCC), CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé de Villeneuve-d’Ascq, Clinique Bretéché, Clinique Marcel-Sembat, CHU de La Réunion - Félix-Guyon, Clinique Saint-George, CHU - Hôpital Pasteur, Polyclinique Saint-Roch, CMCO Côte d’Opale, Hôtel-Dieu, Hôpital Renée-Sabran, Hôpitaux de Saint-Maurice, Hôpital d'instruction des armées Laveran, Clinique mutualiste Jules-Verne, Clinique de Bercy, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique Saint-Jean l’Ermitage, Pôle santé Oréliance, CHU - Centre chirurgical Emile-Gallé, Hôpital privé de Marne-la-Vallée, Hôpital Cochin, Hôpital Albert Schweitzer, CHU Sud-Réunion, CHU - Hôpital Purpan, EPSM de Saône-et-Loire, Maison de santé Bagatelle, Clinique du Tertre-Rouge, Hôpital de la Croix-Saint-Simon, CH privé Claude-Galien, Polyclinique Bordeaux-Rive droite, Clinique Delay, Clinique Saint-Nabor, Clinique Victor-Pauchet, Clinique Saint-Vincent, Clinique Charcot, CHU - Hôpital de Hautepierre, Clinique Ormeau centre, Hôpital privé Jean-Mermoz, Hôpital privé Pays-de-Savoie, CHU - Hôpital Lapeyronie, Hôpital privé de l’Est lyonnais, Institut de cancérologie de l’Ouest, Polyclinique Médipôle Saint-Roch, Clinique générale, Clinique Maussins-Nollet, Polyclinique Urbain-V, Hôpital des Diaconesses, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical et obstétrical, Hôpital privé Nord Parisien, Clinique Saint-Jean-de-Dieu, Polyclinique Aguilera, Polyclinique du Parc, Clinique Les Fontaines, CHU - Hôpital Central, Clinique de l’Union, Groupe hospitalier Nord-Essonne, Euromed Cardio, Hôpital privé de la Seine-Saint-Denis, Clinique des Cèdres, Hôpitaux Sud, CHI, Nouvelle clinique de Tours, Clinique Notre-Dame-de-l’Espérance, Centre Clinical, Clinique Clémentville, Polyclinique, Clinique Arago, Hôpital privé Le Bois, Clinique du Trocadéro, CHU - Hôpitaux mère-enfants, Hôpital Louis-Pradel, Clinique du Pré, GH, Hôpital Necker-Enfants-Malades, CMC de Parly-II, Institut ophtalmique, Institut du cancer de Montpellier (CLCC), Hôpital d'instruction des armées Legouest, Clinique du Val-d’Or, Hôpital de la Pitié-Salpêtrière, Polyclinique Vauban, Clinique du Fief-de-Grimoire, Hôpital Louis-Mourier, Hôpital privé La Châtaigneraie, Clinique Turin, CH Esquirol, Clinique Rhône Durance, Hôpital Antoine-Béclère, CHU de Nantes, Pôle Santé République, Hôpital privé Arras-Les Bonnettes, Polyclinique du Beaujolais, Hôpital privé Paul-d’Égine, Hôpital Jean-Verdier, EPSM Lille-Métropole, Centre Hospitalier du Rouvray, Clinique Saint-Hilaire, Clinique du Cèdre, Polyclinique Santa-Maria, CM Bénigne-Joly, Clinique de l’Atlantique, Clinique Bon-Secours, Clinique Rhéna, Clinique Saint-André, Nouvelle clinique Bel-Air, CHU d’Amiens, Polyclinique de Kerio, Clinique mutualiste La Sagesse, Polyclinique de Picardie, Hôpital d'instruction des armées Percy, Clinique du Croisé-Laroche, EPS Barthélemy-Durand, Pôle santé Léonard-de-Vinci, Clinique de l’Estrée, Hôpital privé de l’Estuaire, Hôpital privé Saint-Martin, Clinique mutualiste, Institut de cancérologie Strasbourg Europe, CMC Pierre-Cherest, Hôpital privé de l’Ouest parisien, CHU - Hôpital Robert-Debré, Hôpitaux civils, Hôpital privé Natecia, Hôpital privé Drôme-Ardèche, CHU - Hôpital Bretonneau, Hôpital privé Armand-Brillard, Médipôle Hôpital Privé, CHU Réunion, Polyclinique Les Fleurs, Hôpital Ambroise-Paré, CHU de Martinique - site Mère-Enfant, Institut hospitalier Jacques-Cartier, Clinique Jouvenet, Hôpital de la Conception, CHU - Hôpital Larrey, Hôpital Bichat, Hôpital Corentin-Celton, Clinique du Grand-Large, Centre chirurgical Marie-Lannelongue, CHU - Hôpital Rangueil, Clinique Ormeau Pyrénées, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique de Keraudren, Clinique Monticelli-Vélodrome, Clinique Claude-Bernard, CH Montfavet, Hôpital Foch, Centre Hospitalier Sainte-Marie, Polyclinique de Limoges - site Émailleurs, Clinique La Croix du Sud, Centre Hospitalier des Pyrénées, Espm de L’agglomeration Lilloise, Hôpital européen Georges-Pompidou, Polyclinique de Navarre, CHU - Hôpital Pontchaillou, Centre Henri-Becquerel (CLCC), CHU - site Nord, Polyclinique Côte-Basque-Sud, Centre cardiologique, Clinique du Renaison, Clinique Belledonne, IUCT Oncopole, CH intercommunal, Centre Hospitalier Le Mas Careiron, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Axium, Hôpital privé de Marne Chantereine, Clinique de la Plaine, CHU - Hôpital civil, Clinique du Diaconat-Roosevelt, Hôpital Robert-Debré, Clinique Ambroise-Paré, Hôpital Tenon, Hôpital Saint-Vincent-de-Paul (GHICL), Clinique Honoré-Cave, Clinique ambulatoire de Domont, Clinique Paris Lilas, Hôpital privé du Confluent, Clinique Saint-Pierre, Institut Bergonié (CLCC), Centre Hospitalier de Vauclaire, Hôpital Privé Nancy Lorraine, Hôpital privé de la Casamance, Hopital Joseph-Ducuing, Polyclinique de la Baie, CHU-Hôpital Purpan/HFE, Clinique Saint-Charles, Polyclinique de Reims-Bezannes (Marne), Centre de la main, Clinique des Ormeaux, Centre Hospitalier Gérard-Marchant, CH privé Saint-Grégoire, Polyclinique de Poitiers, Clinique Juge, Clinique du Diaconat-Fonderie, Clinique de la Sauvegarde, Clinique Saint-Augustin, Polyclinique Saint-Privat, Hôpital d'instruction des armées Bégin, Hôpital privé Beauregard, Clinique Bizet, CHU - Hôpital de la Côte de nacre, Nouvel Hôpital de Navarre, Polyclinique Saint Laurent, Clinique de l’Anjou, Polyclinique Saint-François, EPSM Etienne-Gourmelen, CHU - Hôpital Pellegrin, CHU - Hôpital Saint-André, CHU - Hôpitaux de Brabois, Hôpital Hôtel-Dieu, Hôpital-clinique Claude-Bernard, Groupe Hospitalier de la Rochelle, Centre de cardiologie du Pays basque, Clinique ophtalmologique Thiers, Gustave-Roussy (CLCC), Clinique Fontvert, Clinique Geoffroy-Saint-Hilaire, Clinique Toulouse-Lautrec, Centre psychothérapique de Nancy, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique Sainte-Marie, CHU Nantes - Hôpital Mère Enfant, Clinique Pasteur-Lanroze, CH Charles-Perrens, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, Clinique du sport, Hôpital d'instruction des armées Sainte-Anne, Polyclinique Jean-Villar, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Clinique Bouchard, Clinique des Franciscaines, CHU - Hôpital Claude-Huriez, Hôpital privé de Provence, CHU - Hôpital Arnaud-de-Villeneuve, CHP de l’Europe, Hôpital Lariboisière, Clinique cardiologique, Clinique Remusat, Clinique Les Eaux-Claires, Hôpital Saint-Philibert (GHICL), Hôpital privé Dijon-Bourgogne, IUCT/Oncopole, CHU Grenoble - Site Nord, Centre Hospitalier Le Vinatier, Centre Hospitalier Henri Guerin, Santé Atlantique, Clinique mutualiste de l’Estuaire, CH Guillaume-Régnier, Médipôle de Savoie, Clinique Chantecler, CHU - Hôpital Nord, GH mutualiste, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Belharra, Clinique Saint-Jean - Sud de France, Centre orthopédique médico-chirurgical, Hôpital Saint-Antoine, Clinique Sainte-Marie (GHICL), Clinique la Pergola, Hôpital Avicenne, CH/clinique, Clinique Saint-Antoine, CHU - Hôpital Saint-Eloi, CHR, Clinique Mathilde, CHU - Hôpital Maison-Blanche, Hôpital Paul-Brousse, Hôpital Saint-Camille, Clinique du Cambrésis, CH/Clinique, Hôpital privé de La Miotte, CHU - Hôpital Gui-de-Chauliac, CHR de Metz-Thionville - Hôpital de Mercy, Centre ambulatoire Kleber, Clinique Jean Causse, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique Bordeaux-Nord-Aquitaine, CH privé du Montgardé, Clinique de l’Europe, GHI, CHU - Maternité, CH Saint-Joseph-Saint-Luc, Clinique Anne-Artois, ASM, Clinique de la Muette, Centre Eugène-Marquis (CLCC), EPSM Morbihan, Pôle de Santé du Villeneuvois, Hôpital privé Sévigné, Hôpital privé Paris-Essonne, Clinique Rive-Gauche, Les Franciscaines, Hôpital privé de la Loire, Hôpital privé des Côtes-d’Armor, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Charles-Nicolle, Hôpital privé Cannes-Oxford, Polyclinique de Blois, Clinique Victor-Hugo, Hôpital des Massues, GHU Paris Psychiatrie et neurosciences, Clinique Saint-Paul, CHU - Hôpital Trousseau, Hôpital privé La Louvière, CHU Grenoble - Hôpital Sud, Institut Curie, Hôpital privé d’Antony, Polyclinique Lyon-Nord, Centre Hospitalier Drôme Vivarais, Centre Hospitalier Montperrin, Clinique Louis-Pasteur, CMC Floréal, Clinique de l'Alma, Clinique de l'Essonne, Clinique du Parc, Clinique de l’Espérance, Clinique du Val-d’Ouest Vendôme, EPSM de la Marne, Polyclinique Majorelle, Clinique Beau-Soleil, Hôpital Paris Saint-Joseph, CHU - Hôpital Morvan, Clinique du Millénaire, Clinique Convert, Médipôle Garonne, Clinique du Lac et d’Argonay, Hôpital d'instruction des armées Desgenettes, Centre de chirurgie ophtalmologique, Hôpital privé du Vert-Galant, Hôpitaux Nord (Croix-Rousse), Institut Arthur-Vernes, Clinique Saint-François, Clinique Sainte-Anne, Clinique Lille-Sud, Centre Hospitalier La Chartreuse, Hôpital Saint-Joseph, Hôpital Bicêtre, Polyclinique La Ligne bleue, CH Georges-Daumezon, Hôpitaux pédiatriques, Clinique du Pont-de-Chaume, Clinique Conti, CHU - Hôpital Roger-Salengro, Centre Hospitalier George Sand, Polyclinique Francheville, Institut Calot, CMCO, Hôpital Saint-Louis
2025-08-22 19:05:55,068 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 19:05:55,227 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 19:05:55,227 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 19:05:55,227 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-22 19:05:55,227 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-22 19:05:55,227 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 19:05:55,227 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-22 19:05:55,227 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 19:05:55,227 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 19:05:55,228 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-22 19:05:55,228 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-22 19:05:55,228 [INFO] app.services.data_processing_service: generate_data_response called
2025-08-22 19:05:55,228 [DEBUG] app.services.data_processing_service: Extracted values - specialty: 'Cancer de la vessie', institution_type: 'aucune correspondance', city: 'Paris'
2025-08-22 19:05:55,228 [DEBUG] app.services.data_processing_service: No institution type match found, loading by specialty only
2025-08-22 19:05:55,228 [INFO] app.services.data_processing_service: Filtering ranking by criteria: specialty='Cancer de la vessie', institution_type='None'
2025-08-22 19:05:55,228 [DEBUG] app.services.data_processing_service: Filtering ranking data - specialty: 'Cancer de la vessie', institution_type: 'None'
2025-08-22 19:05:55,228 [DEBUG] app.services.data_processing_service: Specialty type: <class 'str'>, length: 19
2025-08-22 19:05:55,229 [DEBUG] app.services.data_processing_service: Available specialties in ranking data: ['Ablation des varices' 'Accidents vasculaires cérébraux'
 'Accouchements à risques' 'Accouchements normaux'
 'Adénome de la prostate' 'Amygdales et végétations'
 'Angioplastie coronaire' 'Appendicite' 'Arthrose de la main' 'Audition'
 'Calculs urinaires' "Cancer de l'estomac et de l'œsophage"
 "Cancer de l'ovaire" "Cancer de l'utérus" 'Cancer de la prostate'
 'Cancer de la thyroïde' 'Cancer de la vessie'
 "Cancer des os de l'enfant et de l'adolescent"
 "Cancer du colon ou de l'intestin" 'Cancer du foie' 'Cancer du pancréas'
 'Cancer du poumon' 'Cancer du rein' 'Cancer du sein' 'Cancer ORL'
 'Cancers de la peau' 'Cardiologie interventionnelle' 'Cataracte'
 'Chirurgie cardiaque adulte' 'Chirurgie cardiaque pédiatrique'
 "Chirurgie de l'épaule" "Chirurgie de l'obésité"
 'Chirurgie de la cheville' 'Chirurgie de la cornée'
 'Chirurgie dentaire et orale de l’adulte'
 'Chirurgie dentaire et orale de l’enfant et de l’adolescent'
 'Chirurgie des artères' "Chirurgie des cancers osseux de l'adulte"
 'Chirurgie des carotides' 'Chirurgie des sarcomes des tissus mous'
 "Chirurgie des testicules de l'adulte"
 "Chirurgie des testicules de l'enfant et de l'adolescent"
 'Chirurgie du canal carpien' "Chirurgie du dos de l'adulte"
 "Chirurgie du dos de l'enfant et de l'adolescent"
 'Chirurgie du nez et des sinus' 'Chirurgie du pied' 'Chirurgie du rectum'
 'Chirurgie maxillo-faciale' 'Dépression' "Diabète de l'adulte"
 "Diabète de l'enfant et de l'adolescent" 'Endométriose'
 "Epilepsie de l'adulte" "Epilepsie de l'enfant et de l'adolescent"
 'Fibrome utérin' 'Glandes salivaires' 'Glaucome' "Hernies de l'abdomen"
 'Hypertension artérielle' 'Infarctus du myocarde'
 'Insuffisance cardiaque' "Leucémie de l'adulte"
 "Leucémie de l'enfant et de l'adolescent" 'Ligaments du genou'
 "Lymphome-Myélome de l'adulte" 'Maladie de Parkinson'
 "Maladies inflammatoires chroniques de l'intestin (MICI)"
 'Médecine vasculaire' 'Pneumologie' 'Proctologie' 'Prothèse de genou'
 'Prothèse de hanche' 'Rétine' 'Schizophrénie' 'Sclérose en plaques'
 'Stimulateurs cardiaques' 'Strabisme'
 'Stress post-traumatique de l’adulte' 'Troubles bipolaires'
 "Tumeurs du cerveau de l'adulte"
 "Tumeurs du cerveau de l'enfant et de l'adolescent" 'Urgences de la main'
 'Vésicule biliaire']
2025-08-22 19:05:55,229 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-22 19:05:55,230 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-22 19:05:55,230 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-22 19:05:55,230 [DEBUG] app.services.data_processing_service: Normalizing string: Accidents vasculaires cérébraux
2025-08-22 19:05:55,231 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements à risques
2025-08-22 19:05:55,231 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements normaux
2025-08-22 19:05:55,231 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-22 19:05:55,231 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-22 19:05:55,231 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-22 19:05:55,231 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'estomac et de l'œsophage
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-22 19:05:55,232 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer des os de l'enfant et de l'adolescent
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-22 19:05:55,233 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du foie
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du pancréas
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cancers de la peau
2025-08-22 19:05:55,234 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque pédiatrique
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-22 19:05:55,235 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des cancers osseux de l'adulte
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des sarcomes des tissus mous
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-22 19:05:55,236 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'enfant et de l'adolescent
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-22 19:05:55,237 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du rectum
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Dépression
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'adulte
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'enfant et de l'adolescent
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'adulte
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'enfant et de l'adolescent
2025-08-22 19:05:55,238 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Hypertension artérielle
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Insuffisance cardiaque
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'adulte
2025-08-22 19:05:55,239 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'enfant et de l'adolescent
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Lymphome-Myélome de l'adulte
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Maladie de Parkinson
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Maladies inflammatoires chroniques de l'intestin (MICI)
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Médecine vasculaire
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-22 19:05:55,240 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Schizophrénie
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Sclérose en plaques
2025-08-22 19:05:55,241 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Stress post-traumatique de l’adulte
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Troubles bipolaires
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'adulte
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'enfant et de l'adolescent
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-22 19:05:55,242 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-22 19:05:55,243 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-22 19:05:55,243 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-22 19:05:55,244 [DEBUG] app.services.data_processing_service: Normalized specialties in DataFrame: ["'ablation des varices'", "'accidents vasculaires cerebraux'", "'accouchements a risques'", "'accouchements normaux'", "'adenome de la prostate'", "'amygdales et vegetations'", "'angioplastie coronaire'", "'appendicite'", "'arthrose de la main'", "'audition'", "'calculs urinaires'", '"cancer de l\'estomac et de l\'œsophage"', '"cancer de l\'ovaire"', '"cancer de l\'uterus"', "'cancer de la prostate'", "'cancer de la thyroide'", "'cancer de la vessie'", '"cancer des os de l\'enfant et de l\'adolescent"', '"cancer du colon ou de l\'intestin"', "'cancer du foie'", "'cancer du pancreas'", "'cancer du poumon'", "'cancer du rein'", "'cancer du sein'", "'cancer orl'", "'cancers de la peau'", "'cardiologie interventionnelle'", "'cataracte'", "'chirurgie cardiaque adulte'", "'chirurgie cardiaque pediatrique'", '"chirurgie de l\'epaule"', '"chirurgie de l\'obesite"', "'chirurgie de la cheville'", "'chirurgie de la cornee'", "'chirurgie dentaire et orale de l’adulte'", "'chirurgie dentaire et orale de l’enfant et de l’adolescent'", "'chirurgie des arteres'", '"chirurgie des cancers osseux de l\'adulte"', "'chirurgie des carotides'", "'chirurgie des sarcomes des tissus mous'", '"chirurgie des testicules de l\'adulte"', '"chirurgie des testicules de l\'enfant et de l\'adolescent"', "'chirurgie du canal carpien'", '"chirurgie du dos de l\'adulte"', '"chirurgie du dos de l\'enfant et de l\'adolescent"', "'chirurgie du nez et des sinus'", "'chirurgie du pied'", "'chirurgie du rectum'", "'chirurgie maxillo-faciale'", "'depression'", '"diabete de l\'adulte"', '"diabete de l\'enfant et de l\'adolescent"', "'endometriose'", '"epilepsie de l\'adulte"', '"epilepsie de l\'enfant et de l\'adolescent"', "'fibrome uterin'", "'glandes salivaires'", "'glaucome'", '"hernies de l\'abdomen"', "'hypertension arterielle'", "'infarctus du myocarde'", "'insuffisance cardiaque'", '"leucemie de l\'adulte"', '"leucemie de l\'enfant et de l\'adolescent"', "'ligaments du genou'", '"lymphome-myelome de l\'adulte"', "'maladie de parkinson'", '"maladies inflammatoires chroniques de l\'intestin (mici)"', "'medecine vasculaire'", "'pneumologie'", "'proctologie'", "'prothese de genou'", "'prothese de hanche'", "'retine'", "'schizophrenie'", "'sclerose en plaques'", "'stimulateurs cardiaques'", "'strabisme'", "'stress post-traumatique de l’adulte'", "'troubles bipolaires'", '"tumeurs du cerveau de l\'adulte"', '"tumeurs du cerveau de l\'enfant et de l\'adolescent"', "'urgences de la main'", "'vesicule biliaire'"]
2025-08-22 19:05:55,244 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 19:05:55,245 [DEBUG] app.services.data_processing_service: Normalized specialty from query: ''cancer de la vessie''
2025-08-22 19:05:55,245 [DEBUG] app.services.data_processing_service: Found 2 rows matching single specialty 'Cancer de la vessie' (normalized: 'cancer de la vessie')
2025-08-22 19:05:55,246 [DEBUG] app.services.data_processing_service: Specialties found after specialty filtering: ['Cancer de la vessie']
2025-08-22 19:05:55,246 [INFO] app.services.data_processing_service: generate_response_links called with matching_rows: <class 'pandas.core.frame.DataFrame'>
2025-08-22 19:05:55,246 [INFO] app.services.data_processing_service: Generating ranking links
2025-08-22 19:05:55,246 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-22 19:05:55,246 [DEBUG] app.services.data_processing_service: Generating links for 2 matching rows
2025-08-22 19:05:55,247 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Public
2025-08-22 19:05:55,247 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'public'
2025-08-22 19:05:55,248 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Privé
2025-08-22 19:05:55,248 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'prive'
2025-08-22 19:05:55,248 [INFO] app.services.data_processing_service: Generated ranking links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-22 19:05:55,248 [INFO] app.services.data_processing_service: load_excel_sheets called with matching_rows of length: 2
2025-08-22 19:05:55,249 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Public' for category: 'Public'
2025-08-22 19:05:55,404 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Public' loaded successfully with 40 rows
2025-08-22 19:05:55,405 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Privé' for category: 'Privé'
2025-08-22 19:05:55,551 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Privé' loaded successfully with 20 rows
2025-08-22 19:05:55,551 [DEBUG] app.services.data_processing_service: Concatenating 2 dataframes
2025-08-22 19:05:55,552 [INFO] app.services.data_processing_service: Successfully loaded 2 sheets, total rows: 60
2025-08-22 19:05:55,552 [INFO] app.services.data_processing_service: Loaded specialty DataFrame
2025-08-22 19:05:55,552 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique specialties in DataFrame: N/A
2025-08-22 19:05:55,552 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique institution types in DataFrame: ['Public' 'Privé']
2025-08-22 19:05:55,553 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame columns: Index(['Rang', 'Etablissement', 'Finess', 'ACTIVITE', 'NOTORIETE', 'DMS',
       'RATIO_AMBU', 'INDICE_LOURDEUR', 'TX_ENDOSCOPIE', 'PRADO', 'Note / 20',
       'Catégorie'],
      dtype='object')
2025-08-22 19:05:55,566 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame head:    Rang                                      Etablissement     Finess  ...  PRADO  Note / 20  Catégorie
0     1         Institut mutualiste Montsouris, Paris (75)  750150104  ...    1.0      18.63     Public
1     2                        Hôpital Foch, Suresnes (92)  920000650  ...    1.0      18.50     Public
2     3                    Hôpital Saint-Louis, Paris (75)  750100075  ...    1.0      18.27     Public
3     4      Hôpital européen Georges-Pompidou, Paris (75)  750803447  ...    1.0      18.26     Public
4     5               Hôpital Robert Schuman, Vantoux (57)  570026252  ...    1.0      18.25     Public
5     6  Clinique mutualiste de la Porte-de-l'Orient, L...  560002933  ...    1.0      18.25     Public
6     7             CHU - Hôpital Pellegrin, Bordeaux (33)  330781360  ...    1.0      18.19     Public
7     8                   Hôpital européen, Marseille (13)  130043664  ...    1.0      17.91     Public
8     9         CHU - Hôpital Lapeyronie, Montpellier (34)  340785161  ...    1.0      17.90     Public
9    10             Hôpital Paris Saint-Joseph, Paris (75)  750000523  ...    1.0      17.84     Public

[10 rows x 12 columns]
2025-08-22 19:05:55,566 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Filtering for specialty: 'Cancer de la vessie' and city: 'Paris'
2025-08-22 19:05:55,566 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Specialty match count: N/A
2025-08-22 19:05:55,566 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] City match count: N/A
2025-08-22 19:05:55,566 [INFO] app.services.pipeline_orchestrator_service: Extracting hospital locations and calculating distances
2025-08-22 19:05:55,566 [INFO] app.services.data_processing_service: extract_local_hospitals called with df: <class 'NoneType'>
2025-08-22 19:05:55,566 [INFO] app.services.data_processing_service: Merging ranking data with hospital location data
2025-08-22 19:05:55,569 [DEBUG] app.services.data_processing_service: Merged DataFrame shape (with cities): (60, 6)
2025-08-22 19:05:55,569 [INFO] app.services.data_processing_service: get_df_with_distances called
2025-08-22 19:05:55,569 [INFO] app.services.data_processing_service: Calculating distances from query city: Paris
2025-08-22 19:05:55,571 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-22 19:05:55,571 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-22 19:05:55,571 [DEBUG] geopy: Nominatim.geocode: https://nominatim.openstreetmap.org/search?q=Paris&format=json&limit=1
2025-08-22 19:05:55,573 [DEBUG] urllib3.connectionpool: Starting new HTTPS connection (1): nominatim.openstreetmap.org:443
2025-08-22 19:05:55,886 [DEBUG] urllib3.util.retry: Incremented Retry for (url='/search?q=Paris&format=json&limit=1'): Retry(total=1, connect=None, read=None, redirect=None, status=None)
2025-08-22 19:05:55,886 [WARNING] urllib3.connectionpool: Retrying (Retry(total=1, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1028)'))': /search?q=Paris&format=json&limit=1
2025-08-22 19:05:55,886 [DEBUG] urllib3.connectionpool: Starting new HTTPS connection (2): nominatim.openstreetmap.org:443
2025-08-22 19:05:55,929 [DEBUG] urllib3.util.retry: Incremented Retry for (url='/search?q=Paris&format=json&limit=1'): Retry(total=0, connect=None, read=None, redirect=None, status=None)
2025-08-22 19:05:55,929 [WARNING] urllib3.connectionpool: Retrying (Retry(total=0, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(SSLCertVerificationError(1, '[SSL: CERTIFICATE_VERIFY_FAILED] certificate verify failed: unable to get local issuer certificate (_ssl.c:1028)'))': /search?q=Paris&format=json&limit=1
2025-08-22 19:05:55,929 [DEBUG] urllib3.connectionpool: Starting new HTTPS connection (3): nominatim.openstreetmap.org:443
2025-08-22 19:05:55,974 [WARNING] app.services.data_processing_service: Geolocation failed for city: Paris
2025-08-22 19:05:55,974 [DEBUG] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned DataFrame: <class 'NoneType'>
2025-08-22 19:05:55,974 [DEBUG] app.services.pipeline_orchestrator_service: Checking if DataFrame is None
2025-08-22 19:05:55,974 [ERROR] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned None. Aborting response generation.
2025-08-22 19:05:55,974 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-22 19:05:55,974 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-22 19:11:23,901 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:11:23,901 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:11:23,901 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:11:23,901 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:11:23,901 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:11:23,903 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:11:23,903 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:11:23,903 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:11:24,045 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:11:24,045 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:11:24,045 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:11:24,049 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:11:24,049 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:11:24,255 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:11:24,255 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:11:24,255 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:11:24,256 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:11:24,256 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:11:24,256 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:11:24,328 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:11:24,328 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:11:24,329 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:11:24,330 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:11:24,330 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:11:24,330 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:11:24,331 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:11:24,331 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:11:24,332 [INFO] main: Creating FastAPI app
2025-08-22 19:11:24,333 [INFO] main: CORS middleware added
2025-08-22 19:11:24,334 [INFO] main: API router included
2025-08-22 19:20:37,166 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:20:37,166 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:20:37,166 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:20:37,166 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:20:37,166 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:20:37,167 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:20:37,167 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:20:37,167 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:20:37,302 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:20:37,302 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:20:37,302 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:20:37,305 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:20:37,305 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:20:37,463 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:20:37,463 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:20:37,463 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:20:37,464 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:20:37,464 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:20:37,464 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:20:37,539 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:20:37,539 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:20:37,540 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:20:37,542 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:20:37,542 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:20:37,542 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:20:37,542 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:20:37,542 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:20:37,544 [INFO] main: Creating FastAPI app
2025-08-22 19:20:37,544 [INFO] main: CORS middleware added
2025-08-22 19:20:37,545 [INFO] main: API router included
2025-08-22 19:20:48,737 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-22 19:20:48,737 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-22 19:20:48,737 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-22 19:20:48,737 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-22 19:20:48,738 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-22 19:20:48,745 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:48,773 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:48,773 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-22 19:20:48,811 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11c0b1010>
2025-08-22 19:20:48,811 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11b8d0440> server_hostname='api.openai.com' timeout=None
2025-08-22 19:20:48,833 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11c0611d0>
2025-08-22 19:20:48,833 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:48,834 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:48,834 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:48,834 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:48,834 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:20:49,338 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:20:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'322'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'341'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_f32b3e57adcc4045b271d33592f92184'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=SonicMwT5C83UPARrHspv8VEqWPX4h_wi0Axn.iAE.4-1755883249-1.0.1.1-u.RAJmzyDv8EHgfanile_DKT4L9WXUa2lOnycG50ph5hhvhQ0hODK.VgmBWFweqkMZzujZ_ISFrrdNwil_vpmHplGSmIv.DNLGb7eGkOPwc; path=/; expires=Fri, 22-Aug-25 17:50:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=KPZoCz7GqbMnhYqA.NAhiwc_4npL_QDIJ0IUvFyLlPU-1755883249487-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b023de3cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:20:49,340 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:20:49,341 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:20:49,345 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:20:49,345 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:20:49,345 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:20:49,346 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Fri, 22 Aug 2025 17:20:49 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '322'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '341'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_f32b3e57adcc4045b271d33592f92184'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=SonicMwT5C83UPARrHspv8VEqWPX4h_wi0Axn.iAE.4-1755883249-1.0.1.1-u.RAJmzyDv8EHgfanile_DKT4L9WXUa2lOnycG50ph5hhvhQ0hODK.VgmBWFweqkMZzujZ_ISFrrdNwil_vpmHplGSmIv.DNLGb7eGkOPwc; path=/; expires=Fri, 22-Aug-25 17:50:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=KPZoCz7GqbMnhYqA.NAhiwc_4npL_QDIJ0IUvFyLlPU-1755883249487-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '97340b023de3cc66-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-22 19:20:49,346 [DEBUG] openai._base_client: request_id: req_f32b3e57adcc4045b271d33592f92184
2025-08-22 19:20:49,354 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-22 19:20:49,354 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-22 19:20:49,357 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:49,358 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:49,358 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:49,359 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:49,359 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:49,359 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:49,359 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:20:49,944 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:20:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'358'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'398'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_1a8cd7cb9b6c40f8b99f52d82e55e64f'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b058e82cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:20:49,945 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:20:49,945 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:20:49,947 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:20:49,948 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:20:49,948 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:20:49,948 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:20:50 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '358', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '398', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_1a8cd7cb9b6c40f8b99f52d82e55e64f', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b058e82cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:20:49,948 [DEBUG] openai._base_client: request_id: req_1a8cd7cb9b6c40f8b99f52d82e55e64f
2025-08-22 19:20:49,949 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-22 19:20:49,949 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history=''
2025-08-22 19:20:49,949 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 19:20:49,949 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 19:20:49,949 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 19:20:49,949 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 19:20:50,097 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:20:50,097 [DEBUG] app.services.data_processing_service: Institution list: Centre François-Baclesse (CLCC), Hôpital-clinique Claude-Bernard, Clinique Jean Causse, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Larrey, Hôpital Nord Franche-Comté-Belfort, Clinique la Pergola, CHU - Institut cœur-poumon, Clinique Saint-François, Centre chirurgical Marie-Lannelongue, Hôpitaux Sud, Médipôle Garonne, Hôpitaux de Saint-Maurice, EPSM de la Marne, Hôpital Henri-Mondor, CMC Floréal, Hôpital privé de l’Estuaire, Clinique Ambroise-Paré, Centre Henri-Becquerel (CLCC), GCS Clinique du Ter, Clinique Tivoli-Ducos, Institut hospitalier Jacques-Cartier, Polyclinique du Maine, Hôpital d'instruction des armées Sainte-Anne, Hôpital Hôtel-Dieu, Clinique Kennedy, CHU - Hôpital de Hautepierre, CH Montfavet, Centre Hospitalier Maurice Despinoy, Clinique de la Part-Dieu, Hôpital privé du Vert-Galant, CHU - Hôpital Claude-Huriez, CHU de Martinique, CH privé du Montgardé, CHU - Hôpital Charles-Nicolle, Hôpital privé Le Bois, Polyclinique de Blois, Hôpital Louis-Mourier, Hôpital Albert Schweitzer, Groupe Hospitalier de la Rochelle, CH Basse-Terre (Guadeloupe), Polyclinique Saint-Roch, Clinique Saint-Pierre, Clinique du Grand-Large, Clinique Bizet, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Amé, CH Charles-Perrens, CH/Clinique, Clinique des Franciscaines, CHU - Hôpital Arnaud-de-Villeneuve, Centre Hospitalier Le Bon Sauveur, Clinique Chantecler, Hôpital Jean-Verdier, CH national d’ophtalmologie des Quinze-Vingts, Hôpital Raymond-Poincaré, Polyclinique Majorelle, CHU - Hôpital civil, EPSM Lille-Métropole, Clinique Bouchard, Institut Arnault-Tzanck, Clinique Esquirol-Saint-Hilaire, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Reims-Bezannes (Marne), HCL - Hôpital Femme-mère-enfant, Polyclinique du Beaujolais, Nouvelle clinique de Tours, Clinique Jean le Bon, CHU - Hôpital Trousseau, Institut Curie, Clinique Victor-Hugo, Clinique Sainte-Marie, Institut mutualiste Montsouris, Maison de santé Bagatelle, Polyclinique Aguilera, Polyclinique de Navarre, CH/clinique, EPS Barthélemy-Durand, Hôpital de la Timone (enfants), Hôpital privé du Confluent, Centre ambulatoire Kleber, Hôpital Tenon, CHU de La Réunion - Félix-Guyon, Hôpital Belle-Isle, CHU - Hôpital Clocheville, Hôpital Robert Schuman, Clinique Saint-Jean-de-Dieu, Polyclinique Médipôle Saint-Roch, Hôpital Cochin, Hôpital privé Jean-Mermoz, Hôpital Saint-Louis, Clinique Belharra, Clinique Saint-André, Centre Hospitalier Les Murets, Les Franciscaines, CHU - Hôpital Pasteur, Clinique du Lac et d’Argonay, Fondation Rothschild, Centre Hospitalier Montperrin, Hôpital privé Clairval, Clinique Saint-Léonard, Clinique Conti, Hôpital Avicenne, CHU - Centre chirurgical Emile-Gallé, Clinique du Pré, Institut de cancérologie Strasbourg Europe, Clinique de Bercy, Clinique du Val-d’Or, CMC Pierre-Cherest, Centre Hospitalier du Rouvray, Polyclinique de Bordeaux-Tondu, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Saint-Paul, CHU de Nantes, Espm de L’agglomeration Lilloise, CH Saint-Joseph-Saint-Luc, CHU Grenoble - Site Nord, Hôpitaux pédiatriques, CHR de Metz-Thionville - Hôpital de Mercy, Centre Hospitalier Henri Guerin, Clinique Delay, Hôpital d'instruction des armées Robert-Picqué, Hôpital d'instruction des armées Percy, Clinique Sainte-Clotilde, Hôpital Louis-Pradel, Polyclinique de Kerio, CHU - Hôpital Pellegrin, Clinique de l’Yvette, Polyclinique, Centre Hospitalier de Vauclaire, Clinique Saint-Hilaire, GHP Ambroise-Paré - Hartmann (92), Polyclinique de Limoges - site Chénieux, Polyclinique Urbain-V, Hôpital Saint-Joseph, Clinique Pasteur-Lanroze, Clinique Axium, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique Saint-Jean, Clinique cardiologique, CHU - Hôpital Robert-Debré, Clinique Marcel-Sembat, CHU - Maternité, CH Lyon-Sud, Clinique Lille-Sud, Polyclinique de la Baie, Hôpital privé, Centre cardiologique, GH Paul Guiraud, CHR de Metz-Thionville - Hôpital Bel-Air, Centre de chirurgie ophtalmologique, Hôpital des Massues, Clinique Mathilde, Clinique du Croisé-Laroche, Institut de cancérologie de l’Ouest, CHU - Hôpital Saint-André, Clinique de l'Alma, Institut d’hématologie et d'oncologie pédiatrique, Pôle Santé République, Hôpital privé Nord Parisien, Clinique Toulouse-Lautrec, Clinique du Cambrésis, CHU - Hôpital Pontchaillou, Clinique ophtalmologique Thiers, Centre de la main, Hopital Joseph-Ducuing, CHU de Martinique - site Mère-Enfant, Hôpital privé La Louvière, Médipôle Hôpital Privé, Centre Léon-Bérard (CLCC), CHU - Hôpital Nord, Centre médico-chirurgical et obstétrical, Clinique Saint-Vincent-de-Paul, CH intercommunal, Hôpital privé des Peupliers, Hôpital Paris Saint-Joseph, Centre Hospitalier des Pyrénées, Hôpital Trousseau, Polyclinique La Ligne bleue, Clinique Saint-Charles, EPSM de Saône-et-Loire, ASM, Clinique mutualiste Jules-Verne, Clinique Rhéna, Groupe hospitalier Nord-Essonne, Polyclinique de Keraudren, Polyclinique Francheville, Clinique mutualiste de Bonneveine, Centre Georges-François-Leclerc (CLCC), Polyclinique du Grand-Sud, CHU Réunion, CHU-Hôpital Purpan/HFE, CH privé Saint-Grégoire, Centre orthopédique médico-chirurgical, Polyclinique de Poitiers, Polyclinique Les Fleurs, Clinique Pasteur, Clinique Sainte-Anne, Hôpital privé de La Miotte, Hôpital privé Sévigné, Clinique Turin, Centre Eugène-Marquis (CLCC), Hôpital Antoine-Béclère, Hôpital Saint-Philibert (GHICL), Hôpital privé Armand-Brillard, Clinique Les Fontaines, Centre psychothérapique de Nancy, CHU - Hôpital de l’Archet, Clinique Convert, Institut Curie (CLCC), CHR, Clinique Arago, Clinique Remusat, Centre Psychothérapique, Clinique Honoré-Cave, Clinique mutualiste La Sagesse, CHU - Hôpital Gui-de-Chauliac, Clinique Claude-Bernard, Clinique Ormeau Pyrénées, Polyclinique de Reims-Bezannes, Hôpital Lariboisière, Hôpital de la Croix Rousse (HCL) / CH, Hôpitaux Nord (Croix-Rousse), CHU - Hôpital Bretonneau, Gustave-Roussy (CLCC), Hôpital privé de l’Ouest parisien, Hôpital privé Natecia, Clinique générale, Clinique Maussins-Nollet, Clinique des Cèdres, Hôpitaux civils, Polyclinique du Parc-Drevon, Clinique des Ormeaux, Clinique mutualiste catalane, GH mutualiste, Clinique de l’Europe, Hôpital Foch, Hôpital Saint-Antoine, CHU - site Nord, Centre Hospitalier Sainte-Marie, CH Esquirol, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital de la Côte de nacre, Clinique Les Eaux-Claires, Clinique du sport, Clinique du Diaconat-Roosevelt, Institut Calot, Clinique de Vitrolles (Bouches-du-Rhône), CHI, CHU de Pointe-à-Pitre, Clinique Jouvenet, CHU - Hôpital Sud, Epsan, CH Henri-Laborit, GHI, Institut universitaire de la face et du cou, Polyclinique de Courlancy, Clinique de la Plaine, Clinique du Millénaire, Centre Oscar-Lambret (CLCC), Institut Arthur-Vernes, Hôpital européen Georges-Pompidou, Clinique Charcot, Clinique Saint-Augustin, Clinique Mutualiste de Bretagne Occidentale, Clinique de la Miséricorde, GHU Paris Psychiatrie et neurosciences, Polyclinique Saint-Privat, Centre médico-chirurgical du Mans, Clinique La Croix du Sud, Hôpital Nord, Hôpital privé La Montagne Lambert, Clinique Louis-Pasteur, Institut ophtalmique, Clinique Océane, Hôpital de la Pitié-Salpêtrière, EPS Ville-Évrard, Infirmerie protestante de Lyon, Polyclinique Bordeaux-Nord-Aquitaine, Médipôle de Savoie, CHU - Hôpital de la Cavale-Blanche, Hôpital privé d’Antony, Centre Hospitalier Le Vinatier, Clinique Saint-Jean - Sud de France, Hôtel-Dieu, Institut Jean-Godinot (CLCC), GH, Clinique du Cèdre, Clinique de la Muette, Hôpital privé Arras-Les Bonnettes, Clinique du Parc-Monceau, CHU - Hôpital Dupuytren, Clinique du Pont-de-Chaume, Hôpital Bichat, CH Georges-Daumezon, Clinique du Fief-de-Grimoire, Clinique de l’Orangerie, Hôpital privé de la Casamance, Santé Atlantique, Clinique Clémentville, Clinique du Parc, Clinique mutualiste de la Porte-de-l'Orient, Hôpital de la Timone (Enfants), Clinique de l’Anjou, Hôpital privé Beauregard, Clinique Saint-George, Centre de cardiologie du Pays basque, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpital Rangueil, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de Marne-la-Vallée, Hôpital privé Drôme-Ardèche, Pôle santé Léonard-de-Vinci, Polyclinique Lyon-Nord, Hôpital Privé Nancy Lorraine, CHU Nantes - Hôpital Mère Enfant, Clinique des Orchidées, CHP de l’Europe, Hôpital de la Conception, Hôpital privé Pays-de-Savoie, Polyclinique Vauban, Clinique Paris Lilas, Centre Hospitalier Le Mas Careiron, Clinique d’Occitanie, Polyclinique Saint-François, Hôpital Corentin-Celton, Hôpital privé Paul-d’Égine, CHU - Hôpitaux de Brabois, Hôpital privé Dijon-Bourgogne, Institut du cancer de Montpellier (CLCC), CHU - Hôpital d’Estaing, Polyclinique de Limoges - site Émailleurs, Pôle santé Oréliance, CHU - Hôpital Maison-Blanche, Hôpital privé Vert-Coteau, Hôpital de la Croix-Saint-Simon, Hôpital d'instruction des armées Legouest, CHU Grenoble - Hôpital Sud, Hôpital Bicêtre, Hôpital Ambroise-Paré, Centre de cardiologie Axium-Rambot, Centre Hospitalier Gérard-Marchant, Centre Hospitalier La Chartreuse, CHU - Gabriel-Montpied, Clinique Saint-Joseph, Clinique de l’Estrée, Clinique Victor-Pauchet, Centre Clinical, Grand hôpital de l'Est-Francilien, Polyclinique du Parc, Clinique Bon-Secours, CHU - American Memorial Hospital, CMCO Côte d’Opale, Polyclinique Santa-Maria, Institut Paoli-Calmettes (CLCC), Hôpital européen, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), IUCT/Oncopole, CHU - Hôpital Haut-Lévêque, Nouvel Hôpital de Navarre, Hôpital Paul-Brousse, Hôpital d'instruction des armées Desgenettes, Clinique ambulatoire de Domont, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique de la Région-Mantaise, Clinique Rive-Gauche, Clinique du Renaison, Centre Hospitalier d'Erstein, Polyclinique de Picardie, Clinique de Villeneuve-d’Ascq, Hôpital Pierre-Wertheimer, Clinique Saint-Michel, CHU d'Amiens/Institut ophtalmologique de Picardie, Hôpital Beaujon, Hôpital privé des Côtes-d’Armor, Hôpital privé La Châtaigneraie, Nouvelle clinique Bel-Air, Euromed Cardio, Hôpital de la Timone (adultes), EPSM Morbihan, Clinique Sainte-Marie (GHICL), EPSM Etienne-Gourmelen, Pôle de Santé du Villeneuvois, Hôpital Robert-Debré, Clinique Fontvert, Polyclinique Bordeaux-Rive droite, CHU - Hôpital Saint-Eloi, Institut Bergonié (CLCC), Hôpital Lariboisière-Fernand Widal, Clinique de l'Essonne, Clinique Saint-Antoine, CHU Sud-Réunion, CHU - Hôpital Roger-Salengro, Clinique mutualiste, CH Guillaume-Régnier, CM Bénigne-Joly, Clinique Anne-Artois, Hôpital privé de l’Est lyonnais, Clinique mutualiste de l’Estuaire, Clinique Notre-Dame-de-l’Espérance, Hôpital privé de Marne Chantereine, Clinique du Tertre-Rouge, Polyclinique Côte-Basque-Sud, CHU - Hôpital Purpan, Clinique Ormeau centre, Clinique du Diaconat-Fonderie, Polyclinique Saint-Côme, CH privé Claude-Galien, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital des Diaconesses, CH Édouard-Toulouse, Clinique de la Sauvegarde, CMC de Parly-II, Institut franco-britannique Kléber, Clinique du Val-d’Ouest Vendôme, Clinique Durieux, CH privé Saint-Martin, Clinique Saint-Vincent, Clinique Trenel, Centre Hospitalier George Sand, Centre Jean-Perrin (CLCC), Polyclinique Saint Laurent, Hôpital Necker-Enfants-Malades, Hôpital Renée-Sabran, Hôpital privé Paris-Essonne, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Laveran, Clinique de l’Espérance, Clinique Rhône Durance, Polyclinique Jean-Villar, CMCO, Hôpital privé de la Seine-Saint-Denis, Clinique du Trocadéro, CHU d’Amiens, Clinique Belledonne, Clinique Beau-Soleil, Clinique Monticelli-Vélodrome, Clinique Juge, Hôpital privé de Provence, Hôpital Saint-Camille, Hôpital privé Saint-Martin, Hôpital privé de la Loire, Clinique Bretéché, Hôpital privé Cannes-Oxford, Hôpital d'instruction des armées Bégin, Clinique de l’Union, CHU - Hôpital Morvan, Centre cardiologique du Nord, Hôpital Edouard-Herriot, Clinique de l’Atlantique, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Lapeyronie, CHU - Hôpital Central, CHU - Hôpitaux mère-enfants, Clinique urologique Nantes-Atlantis, IUCT Oncopole, Clinique Saint-Nabor, Centre Hospitalier Drôme Vivarais
2025-08-22 19:20:50,098 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Centre François-Baclesse (CLCC), Hôpital-clinique Claude-Bernard, Clinique Jean Causse, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Larrey, Hôpital Nord Franche-Comté-Belfort, Clinique la Pergola, CHU - Institut cœur-poumon, Clinique Saint-François, Centre chirurgical Marie-Lannelongue, Hôpitaux Sud, Médipôle Garonne, Hôpitaux de Saint-Maurice, EPSM de la Marne, Hôpital Henri-Mondor, CMC Floréal, Hôpital privé de l’Estuaire, Clinique Ambroise-Paré, Centre Henri-Becquerel (CLCC), GCS Clinique du Ter, Clinique Tivoli-Ducos, Institut hospitalier Jacques-Cartier, Polyclinique du Maine, Hôpital d'instruction des armées Sainte-Anne, Hôpital Hôtel-Dieu, Clinique Kennedy, CHU - Hôpital de Hautepierre, CH Montfavet, Centre Hospitalier Maurice Despinoy, Clinique de la Part-Dieu, Hôpital privé du Vert-Galant, CHU - Hôpital Claude-Huriez, CHU de Martinique, CH privé du Montgardé, CHU - Hôpital Charles-Nicolle, Hôpital privé Le Bois, Polyclinique de Blois, Hôpital Louis-Mourier, Hôpital Albert Schweitzer, Groupe Hospitalier de la Rochelle, CH Basse-Terre (Guadeloupe), Polyclinique Saint-Roch, Clinique Saint-Pierre, Clinique du Grand-Large, Clinique Bizet, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Amé, CH Charles-Perrens, CH/Clinique, Clinique des Franciscaines, CHU - Hôpital Arnaud-de-Villeneuve, Centre Hospitalier Le Bon Sauveur, Clinique Chantecler, Hôpital Jean-Verdier, CH national d’ophtalmologie des Quinze-Vingts, Hôpital Raymond-Poincaré, Polyclinique Majorelle, CHU - Hôpital civil, EPSM Lille-Métropole, Clinique Bouchard, Institut Arnault-Tzanck, Clinique Esquirol-Saint-Hilaire, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Reims-Bezannes (Marne), HCL - Hôpital Femme-mère-enfant, Polyclinique du Beaujolais, Nouvelle clinique de Tours, Clinique Jean le Bon, CHU - Hôpital Trousseau, Institut Curie, Clinique Victor-Hugo, Clinique Sainte-Marie, Institut mutualiste Montsouris, Maison de santé Bagatelle, Polyclinique Aguilera, Polyclinique de Navarre, CH/clinique, EPS Barthélemy-Durand, Hôpital de la Timone (enfants), Hôpital privé du Confluent, Centre ambulatoire Kleber, Hôpital Tenon, CHU de La Réunion - Félix-Guyon, Hôpital Belle-Isle, CHU - Hôpital Clocheville, Hôpital Robert Schuman, Clinique Saint-Jean-de-Dieu, Polyclinique Médipôle Saint-Roch, Hôpital Cochin, Hôpital privé Jean-Mermoz, Hôpital Saint-Louis, Clinique Belharra, Clinique Saint-André, Centre Hospitalier Les Murets, Les Franciscaines, CHU - Hôpital Pasteur, Clinique du Lac et d’Argonay, Fondation Rothschild, Centre Hospitalier Montperrin, Hôpital privé Clairval, Clinique Saint-Léonard, Clinique Conti, Hôpital Avicenne, CHU - Centre chirurgical Emile-Gallé, Clinique du Pré, Institut de cancérologie Strasbourg Europe, Clinique de Bercy, Clinique du Val-d’Or, CMC Pierre-Cherest, Centre Hospitalier du Rouvray, Polyclinique de Bordeaux-Tondu, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Saint-Paul, CHU de Nantes, Espm de L’agglomeration Lilloise, CH Saint-Joseph-Saint-Luc, CHU Grenoble - Site Nord, Hôpitaux pédiatriques, CHR de Metz-Thionville - Hôpital de Mercy, Centre Hospitalier Henri Guerin, Clinique Delay, Hôpital d'instruction des armées Robert-Picqué, Hôpital d'instruction des armées Percy, Clinique Sainte-Clotilde, Hôpital Louis-Pradel, Polyclinique de Kerio, CHU - Hôpital Pellegrin, Clinique de l’Yvette, Polyclinique, Centre Hospitalier de Vauclaire, Clinique Saint-Hilaire, GHP Ambroise-Paré - Hartmann (92), Polyclinique de Limoges - site Chénieux, Polyclinique Urbain-V, Hôpital Saint-Joseph, Clinique Pasteur-Lanroze, Clinique Axium, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique Saint-Jean, Clinique cardiologique, CHU - Hôpital Robert-Debré, Clinique Marcel-Sembat, CHU - Maternité, CH Lyon-Sud, Clinique Lille-Sud, Polyclinique de la Baie, Hôpital privé, Centre cardiologique, GH Paul Guiraud, CHR de Metz-Thionville - Hôpital Bel-Air, Centre de chirurgie ophtalmologique, Hôpital des Massues, Clinique Mathilde, Clinique du Croisé-Laroche, Institut de cancérologie de l’Ouest, CHU - Hôpital Saint-André, Clinique de l'Alma, Institut d’hématologie et d'oncologie pédiatrique, Pôle Santé République, Hôpital privé Nord Parisien, Clinique Toulouse-Lautrec, Clinique du Cambrésis, CHU - Hôpital Pontchaillou, Clinique ophtalmologique Thiers, Centre de la main, Hopital Joseph-Ducuing, CHU de Martinique - site Mère-Enfant, Hôpital privé La Louvière, Médipôle Hôpital Privé, Centre Léon-Bérard (CLCC), CHU - Hôpital Nord, Centre médico-chirurgical et obstétrical, Clinique Saint-Vincent-de-Paul, CH intercommunal, Hôpital privé des Peupliers, Hôpital Paris Saint-Joseph, Centre Hospitalier des Pyrénées, Hôpital Trousseau, Polyclinique La Ligne bleue, Clinique Saint-Charles, EPSM de Saône-et-Loire, ASM, Clinique mutualiste Jules-Verne, Clinique Rhéna, Groupe hospitalier Nord-Essonne, Polyclinique de Keraudren, Polyclinique Francheville, Clinique mutualiste de Bonneveine, Centre Georges-François-Leclerc (CLCC), Polyclinique du Grand-Sud, CHU Réunion, CHU-Hôpital Purpan/HFE, CH privé Saint-Grégoire, Centre orthopédique médico-chirurgical, Polyclinique de Poitiers, Polyclinique Les Fleurs, Clinique Pasteur, Clinique Sainte-Anne, Hôpital privé de La Miotte, Hôpital privé Sévigné, Clinique Turin, Centre Eugène-Marquis (CLCC), Hôpital Antoine-Béclère, Hôpital Saint-Philibert (GHICL), Hôpital privé Armand-Brillard, Clinique Les Fontaines, Centre psychothérapique de Nancy, CHU - Hôpital de l’Archet, Clinique Convert, Institut Curie (CLCC), CHR, Clinique Arago, Clinique Remusat, Centre Psychothérapique, Clinique Honoré-Cave, Clinique mutualiste La Sagesse, CHU - Hôpital Gui-de-Chauliac, Clinique Claude-Bernard, Clinique Ormeau Pyrénées, Polyclinique de Reims-Bezannes, Hôpital Lariboisière, Hôpital de la Croix Rousse (HCL) / CH, Hôpitaux Nord (Croix-Rousse), CHU - Hôpital Bretonneau, Gustave-Roussy (CLCC), Hôpital privé de l’Ouest parisien, Hôpital privé Natecia, Clinique générale, Clinique Maussins-Nollet, Clinique des Cèdres, Hôpitaux civils, Polyclinique du Parc-Drevon, Clinique des Ormeaux, Clinique mutualiste catalane, GH mutualiste, Clinique de l’Europe, Hôpital Foch, Hôpital Saint-Antoine, CHU - site Nord, Centre Hospitalier Sainte-Marie, CH Esquirol, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital de la Côte de nacre, Clinique Les Eaux-Claires, Clinique du sport, Clinique du Diaconat-Roosevelt, Institut Calot, Clinique de Vitrolles (Bouches-du-Rhône), CHI, CHU de Pointe-à-Pitre, Clinique Jouvenet, CHU - Hôpital Sud, Epsan, CH Henri-Laborit, GHI, Institut universitaire de la face et du cou, Polyclinique de Courlancy, Clinique de la Plaine, Clinique du Millénaire, Centre Oscar-Lambret (CLCC), Institut Arthur-Vernes, Hôpital européen Georges-Pompidou, Clinique Charcot, Clinique Saint-Augustin, Clinique Mutualiste de Bretagne Occidentale, Clinique de la Miséricorde, GHU Paris Psychiatrie et neurosciences, Polyclinique Saint-Privat, Centre médico-chirurgical du Mans, Clinique La Croix du Sud, Hôpital Nord, Hôpital privé La Montagne Lambert, Clinique Louis-Pasteur, Institut ophtalmique, Clinique Océane, Hôpital de la Pitié-Salpêtrière, EPS Ville-Évrard, Infirmerie protestante de Lyon, Polyclinique Bordeaux-Nord-Aquitaine, Médipôle de Savoie, CHU - Hôpital de la Cavale-Blanche, Hôpital privé d’Antony, Centre Hospitalier Le Vinatier, Clinique Saint-Jean - Sud de France, Hôtel-Dieu, Institut Jean-Godinot (CLCC), GH, Clinique du Cèdre, Clinique de la Muette, Hôpital privé Arras-Les Bonnettes, Clinique du Parc-Monceau, CHU - Hôpital Dupuytren, Clinique du Pont-de-Chaume, Hôpital Bichat, CH Georges-Daumezon, Clinique du Fief-de-Grimoire, Clinique de l’Orangerie, Hôpital privé de la Casamance, Santé Atlantique, Clinique Clémentville, Clinique du Parc, Clinique mutualiste de la Porte-de-l'Orient, Hôpital de la Timone (Enfants), Clinique de l’Anjou, Hôpital privé Beauregard, Clinique Saint-George, Centre de cardiologie du Pays basque, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpital Rangueil, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de Marne-la-Vallée, Hôpital privé Drôme-Ardèche, Pôle santé Léonard-de-Vinci, Polyclinique Lyon-Nord, Hôpital Privé Nancy Lorraine, CHU Nantes - Hôpital Mère Enfant, Clinique des Orchidées, CHP de l’Europe, Hôpital de la Conception, Hôpital privé Pays-de-Savoie, Polyclinique Vauban, Clinique Paris Lilas, Centre Hospitalier Le Mas Careiron, Clinique d’Occitanie, Polyclinique Saint-François, Hôpital Corentin-Celton, Hôpital privé Paul-d’Égine, CHU - Hôpitaux de Brabois, Hôpital privé Dijon-Bourgogne, Institut du cancer de Montpellier (CLCC), CHU - Hôpital d’Estaing, Polyclinique de Limoges - site Émailleurs, Pôle santé Oréliance, CHU - Hôpital Maison-Blanche, Hôpital privé Vert-Coteau, Hôpital de la Croix-Saint-Simon, Hôpital d'instruction des armées Legouest, CHU Grenoble - Hôpital Sud, Hôpital Bicêtre, Hôpital Ambroise-Paré, Centre de cardiologie Axium-Rambot, Centre Hospitalier Gérard-Marchant, Centre Hospitalier La Chartreuse, CHU - Gabriel-Montpied, Clinique Saint-Joseph, Clinique de l’Estrée, Clinique Victor-Pauchet, Centre Clinical, Grand hôpital de l'Est-Francilien, Polyclinique du Parc, Clinique Bon-Secours, CHU - American Memorial Hospital, CMCO Côte d’Opale, Polyclinique Santa-Maria, Institut Paoli-Calmettes (CLCC), Hôpital européen, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), IUCT/Oncopole, CHU - Hôpital Haut-Lévêque, Nouvel Hôpital de Navarre, Hôpital Paul-Brousse, Hôpital d'instruction des armées Desgenettes, Clinique ambulatoire de Domont, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique de la Région-Mantaise, Clinique Rive-Gauche, Clinique du Renaison, Centre Hospitalier d'Erstein, Polyclinique de Picardie, Clinique de Villeneuve-d’Ascq, Hôpital Pierre-Wertheimer, Clinique Saint-Michel, CHU d'Amiens/Institut ophtalmologique de Picardie, Hôpital Beaujon, Hôpital privé des Côtes-d’Armor, Hôpital privé La Châtaigneraie, Nouvelle clinique Bel-Air, Euromed Cardio, Hôpital de la Timone (adultes), EPSM Morbihan, Clinique Sainte-Marie (GHICL), EPSM Etienne-Gourmelen, Pôle de Santé du Villeneuvois, Hôpital Robert-Debré, Clinique Fontvert, Polyclinique Bordeaux-Rive droite, CHU - Hôpital Saint-Eloi, Institut Bergonié (CLCC), Hôpital Lariboisière-Fernand Widal, Clinique de l'Essonne, Clinique Saint-Antoine, CHU Sud-Réunion, CHU - Hôpital Roger-Salengro, Clinique mutualiste, CH Guillaume-Régnier, CM Bénigne-Joly, Clinique Anne-Artois, Hôpital privé de l’Est lyonnais, Clinique mutualiste de l’Estuaire, Clinique Notre-Dame-de-l’Espérance, Hôpital privé de Marne Chantereine, Clinique du Tertre-Rouge, Polyclinique Côte-Basque-Sud, CHU - Hôpital Purpan, Clinique Ormeau centre, Clinique du Diaconat-Fonderie, Polyclinique Saint-Côme, CH privé Claude-Galien, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital des Diaconesses, CH Édouard-Toulouse, Clinique de la Sauvegarde, CMC de Parly-II, Institut franco-britannique Kléber, Clinique du Val-d’Ouest Vendôme, Clinique Durieux, CH privé Saint-Martin, Clinique Saint-Vincent, Clinique Trenel, Centre Hospitalier George Sand, Centre Jean-Perrin (CLCC), Polyclinique Saint Laurent, Hôpital Necker-Enfants-Malades, Hôpital Renée-Sabran, Hôpital privé Paris-Essonne, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Laveran, Clinique de l’Espérance, Clinique Rhône Durance, Polyclinique Jean-Villar, CMCO, Hôpital privé de la Seine-Saint-Denis, Clinique du Trocadéro, CHU d’Amiens, Clinique Belledonne, Clinique Beau-Soleil, Clinique Monticelli-Vélodrome, Clinique Juge, Hôpital privé de Provence, Hôpital Saint-Camille, Hôpital privé Saint-Martin, Hôpital privé de la Loire, Clinique Bretéché, Hôpital privé Cannes-Oxford, Hôpital d'instruction des armées Bégin, Clinique de l’Union, CHU - Hôpital Morvan, Centre cardiologique du Nord, Hôpital Edouard-Herriot, Clinique de l’Atlantique, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Lapeyronie, CHU - Hôpital Central, CHU - Hôpitaux mère-enfants, Clinique urologique Nantes-Atlantis, IUCT Oncopole, Clinique Saint-Nabor, Centre Hospitalier Drôme Vivarais
2025-08-22 19:20:50,099 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:20:50,101 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-22 19:20:50,101 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-22 19:20:50,104 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:50,104 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:50,105 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:50,105 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:50,105 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:50,105 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:50,105 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:20:50,664 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:20:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'339'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'364'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_6c72a8667cfc4188ac919d14b44d80a3'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b0a29ffcc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:20:50,664 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:20:50,665 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:20:50,670 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:20:50,670 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:20:50,670 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:20:50,671 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:20:50 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '339', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '364', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_6c72a8667cfc4188ac919d14b44d80a3', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b0a29ffcc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:20:50,671 [DEBUG] openai._base_client: request_id: req_6c72a8667cfc4188ac919d14b44d80a3
2025-08-22 19:20:50,671 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:50,672 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:50,672 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:20:50,672 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:50,674 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:50,675 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:50,675 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:50,675 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:50,676 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:50,676 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:50,676 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:20:51,222 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:20:51 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'356'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'381'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_2301bd612add4417a812b4c886de8def'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b0dbb0ccc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:20:51,222 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:20:51,223 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:20:51,229 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:20:51,229 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:20:51,229 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:20:51,229 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:20:51 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '356', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '381', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_2301bd612add4417a812b4c886de8def', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b0dbb0ccc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:20:51,230 [DEBUG] openai._base_client: request_id: req_2301bd612add4417a812b4c886de8def
2025-08-22 19:20:51,230 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:20:51,230 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:20:51,230 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:20:51,230 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:51,233 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:51,234 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:51,234 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:51,234 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:51,234 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:51,234 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:51,234 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:20:55,143 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:20:55 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3652'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3743'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_ccc8d698bf20497d9b331c66fc52eb7d'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b113c0fcc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:20:55,144 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:20:55,144 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:20:55,333 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:20:55,334 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:20:55,334 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:20:55,334 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:20:55 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3652', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3743', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_ccc8d698bf20497d9b331c66fc52eb7d', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b113c0fcc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:20:55,335 [DEBUG] openai._base_client: request_id: req_ccc8d698bf20497d9b331c66fc52eb7d
2025-08-22 19:20:55,335 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:20:55,336 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:20:55,336 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:20:55,336 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-22 19:20:55,336 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:55,336 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:55,336 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:20:55,336 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:55,339 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:55,340 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:55,340 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:55,340 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:55,340 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:55,340 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:55,340 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:20:55,707 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:20:55 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'174'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'198'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_b038dbba34a94ee6bc62e1fef1e9f80e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b2aeb91cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:20:55,707 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:20:55,707 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:20:55,710 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:20:55,710 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:20:55,710 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:20:55,710 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:20:55 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '174', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '198', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_b038dbba34a94ee6bc62e1fef1e9f80e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b2aeb91cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:20:55,710 [DEBUG] openai._base_client: request_id: req_b038dbba34a94ee6bc62e1fef1e9f80e
2025-08-22 19:20:55,711 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:20:55,711 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:20:55,711 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:20:55,711 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:20:55,714 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:20:55,715 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:20:55,715 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:20:55,715 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:20:55,715 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:20:55,715 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:20:55,716 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:00,201 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:00 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3141'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3179'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_eca287f855624aac8361bf4f54daff4a'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b2d3938cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:00,201 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:00,201 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:00,207 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:00,207 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:00,207 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:00,207 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:00 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3141', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3179', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_eca287f855624aac8361bf4f54daff4a', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b2d3938cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:00,207 [DEBUG] openai._base_client: request_id: req_eca287f855624aac8361bf4f54daff4a
2025-08-22 19:21:00,208 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:21:00,208 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:21:00,209 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:21:00,209 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-22 19:21:00,209 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-22 19:21:00,212 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:00,213 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:00,213 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:00,214 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:00,214 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:00,214 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:00,214 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:00,764 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:00 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'343'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'364'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_06ab8bbb6f984a12818c8a5322a43084'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b495c7acc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:00,765 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:00,765 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:00,768 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:00,768 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:00,768 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:00,768 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:00 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '343', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '364', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_06ab8bbb6f984a12818c8a5322a43084', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b495c7acc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:00,768 [DEBUG] openai._base_client: request_id: req_06ab8bbb6f984a12818c8a5322a43084
2025-08-22 19:21:00,769 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 19:21:00,769 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 19:21:00,769 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 19:21:00,772 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:00,773 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:00,773 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:00,774 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:00,774 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:00,774 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:00,774 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:01,327 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:01 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'312'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'367'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_0cb513236c3547c5a48a3e30dba2c40a'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b4cdd7dcc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:01,327 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:01,328 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:01,332 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:01,332 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:01,333 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:01,333 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:01 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '312', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '367', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_0cb513236c3547c5a48a3e30dba2c40a', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b4cdd7dcc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:01,333 [DEBUG] openai._base_client: request_id: req_0cb513236c3547c5a48a3e30dba2c40a
2025-08-22 19:21:01,334 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-22 19:21:01,335 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-22 19:21:01,335 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-22 19:21:01,335 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-22 19:21:01,335 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-22 19:21:01,335 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 19:21:01,335 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-22 19:21:01,335 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-22 19:21:01,336 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 19:21:01,336 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 19:21:01,370 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:21:01,371 [DEBUG] app.services.data_processing_service: Institution list: Centre François-Baclesse (CLCC), Hôpital-clinique Claude-Bernard, Clinique Jean Causse, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Larrey, Hôpital Nord Franche-Comté-Belfort, Clinique la Pergola, CHU - Institut cœur-poumon, Clinique Saint-François, Centre chirurgical Marie-Lannelongue, Hôpitaux Sud, Médipôle Garonne, Hôpitaux de Saint-Maurice, EPSM de la Marne, Hôpital Henri-Mondor, CMC Floréal, Hôpital privé de l’Estuaire, Clinique Ambroise-Paré, Centre Henri-Becquerel (CLCC), GCS Clinique du Ter, Clinique Tivoli-Ducos, Institut hospitalier Jacques-Cartier, Polyclinique du Maine, Hôpital d'instruction des armées Sainte-Anne, Hôpital Hôtel-Dieu, Clinique Kennedy, CHU - Hôpital de Hautepierre, CH Montfavet, Centre Hospitalier Maurice Despinoy, Clinique de la Part-Dieu, Hôpital privé du Vert-Galant, CHU - Hôpital Claude-Huriez, CHU de Martinique, CH privé du Montgardé, CHU - Hôpital Charles-Nicolle, Hôpital privé Le Bois, Polyclinique de Blois, Hôpital Louis-Mourier, Hôpital Albert Schweitzer, Groupe Hospitalier de la Rochelle, CH Basse-Terre (Guadeloupe), Polyclinique Saint-Roch, Clinique Saint-Pierre, Clinique du Grand-Large, Clinique Bizet, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Amé, CH Charles-Perrens, CH/Clinique, Clinique des Franciscaines, CHU - Hôpital Arnaud-de-Villeneuve, Centre Hospitalier Le Bon Sauveur, Clinique Chantecler, Hôpital Jean-Verdier, CH national d’ophtalmologie des Quinze-Vingts, Hôpital Raymond-Poincaré, Polyclinique Majorelle, CHU - Hôpital civil, EPSM Lille-Métropole, Clinique Bouchard, Institut Arnault-Tzanck, Clinique Esquirol-Saint-Hilaire, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Reims-Bezannes (Marne), HCL - Hôpital Femme-mère-enfant, Polyclinique du Beaujolais, Nouvelle clinique de Tours, Clinique Jean le Bon, CHU - Hôpital Trousseau, Institut Curie, Clinique Victor-Hugo, Clinique Sainte-Marie, Institut mutualiste Montsouris, Maison de santé Bagatelle, Polyclinique Aguilera, Polyclinique de Navarre, CH/clinique, EPS Barthélemy-Durand, Hôpital de la Timone (enfants), Hôpital privé du Confluent, Centre ambulatoire Kleber, Hôpital Tenon, CHU de La Réunion - Félix-Guyon, Hôpital Belle-Isle, CHU - Hôpital Clocheville, Hôpital Robert Schuman, Clinique Saint-Jean-de-Dieu, Polyclinique Médipôle Saint-Roch, Hôpital Cochin, Hôpital privé Jean-Mermoz, Hôpital Saint-Louis, Clinique Belharra, Clinique Saint-André, Centre Hospitalier Les Murets, Les Franciscaines, CHU - Hôpital Pasteur, Clinique du Lac et d’Argonay, Fondation Rothschild, Centre Hospitalier Montperrin, Hôpital privé Clairval, Clinique Saint-Léonard, Clinique Conti, Hôpital Avicenne, CHU - Centre chirurgical Emile-Gallé, Clinique du Pré, Institut de cancérologie Strasbourg Europe, Clinique de Bercy, Clinique du Val-d’Or, CMC Pierre-Cherest, Centre Hospitalier du Rouvray, Polyclinique de Bordeaux-Tondu, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Saint-Paul, CHU de Nantes, Espm de L’agglomeration Lilloise, CH Saint-Joseph-Saint-Luc, CHU Grenoble - Site Nord, Hôpitaux pédiatriques, CHR de Metz-Thionville - Hôpital de Mercy, Centre Hospitalier Henri Guerin, Clinique Delay, Hôpital d'instruction des armées Robert-Picqué, Hôpital d'instruction des armées Percy, Clinique Sainte-Clotilde, Hôpital Louis-Pradel, Polyclinique de Kerio, CHU - Hôpital Pellegrin, Clinique de l’Yvette, Polyclinique, Centre Hospitalier de Vauclaire, Clinique Saint-Hilaire, GHP Ambroise-Paré - Hartmann (92), Polyclinique de Limoges - site Chénieux, Polyclinique Urbain-V, Hôpital Saint-Joseph, Clinique Pasteur-Lanroze, Clinique Axium, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique Saint-Jean, Clinique cardiologique, CHU - Hôpital Robert-Debré, Clinique Marcel-Sembat, CHU - Maternité, CH Lyon-Sud, Clinique Lille-Sud, Polyclinique de la Baie, Hôpital privé, Centre cardiologique, GH Paul Guiraud, CHR de Metz-Thionville - Hôpital Bel-Air, Centre de chirurgie ophtalmologique, Hôpital des Massues, Clinique Mathilde, Clinique du Croisé-Laroche, Institut de cancérologie de l’Ouest, CHU - Hôpital Saint-André, Clinique de l'Alma, Institut d’hématologie et d'oncologie pédiatrique, Pôle Santé République, Hôpital privé Nord Parisien, Clinique Toulouse-Lautrec, Clinique du Cambrésis, CHU - Hôpital Pontchaillou, Clinique ophtalmologique Thiers, Centre de la main, Hopital Joseph-Ducuing, CHU de Martinique - site Mère-Enfant, Hôpital privé La Louvière, Médipôle Hôpital Privé, Centre Léon-Bérard (CLCC), CHU - Hôpital Nord, Centre médico-chirurgical et obstétrical, Clinique Saint-Vincent-de-Paul, CH intercommunal, Hôpital privé des Peupliers, Hôpital Paris Saint-Joseph, Centre Hospitalier des Pyrénées, Hôpital Trousseau, Polyclinique La Ligne bleue, Clinique Saint-Charles, EPSM de Saône-et-Loire, ASM, Clinique mutualiste Jules-Verne, Clinique Rhéna, Groupe hospitalier Nord-Essonne, Polyclinique de Keraudren, Polyclinique Francheville, Clinique mutualiste de Bonneveine, Centre Georges-François-Leclerc (CLCC), Polyclinique du Grand-Sud, CHU Réunion, CHU-Hôpital Purpan/HFE, CH privé Saint-Grégoire, Centre orthopédique médico-chirurgical, Polyclinique de Poitiers, Polyclinique Les Fleurs, Clinique Pasteur, Clinique Sainte-Anne, Hôpital privé de La Miotte, Hôpital privé Sévigné, Clinique Turin, Centre Eugène-Marquis (CLCC), Hôpital Antoine-Béclère, Hôpital Saint-Philibert (GHICL), Hôpital privé Armand-Brillard, Clinique Les Fontaines, Centre psychothérapique de Nancy, CHU - Hôpital de l’Archet, Clinique Convert, Institut Curie (CLCC), CHR, Clinique Arago, Clinique Remusat, Centre Psychothérapique, Clinique Honoré-Cave, Clinique mutualiste La Sagesse, CHU - Hôpital Gui-de-Chauliac, Clinique Claude-Bernard, Clinique Ormeau Pyrénées, Polyclinique de Reims-Bezannes, Hôpital Lariboisière, Hôpital de la Croix Rousse (HCL) / CH, Hôpitaux Nord (Croix-Rousse), CHU - Hôpital Bretonneau, Gustave-Roussy (CLCC), Hôpital privé de l’Ouest parisien, Hôpital privé Natecia, Clinique générale, Clinique Maussins-Nollet, Clinique des Cèdres, Hôpitaux civils, Polyclinique du Parc-Drevon, Clinique des Ormeaux, Clinique mutualiste catalane, GH mutualiste, Clinique de l’Europe, Hôpital Foch, Hôpital Saint-Antoine, CHU - site Nord, Centre Hospitalier Sainte-Marie, CH Esquirol, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital de la Côte de nacre, Clinique Les Eaux-Claires, Clinique du sport, Clinique du Diaconat-Roosevelt, Institut Calot, Clinique de Vitrolles (Bouches-du-Rhône), CHI, CHU de Pointe-à-Pitre, Clinique Jouvenet, CHU - Hôpital Sud, Epsan, CH Henri-Laborit, GHI, Institut universitaire de la face et du cou, Polyclinique de Courlancy, Clinique de la Plaine, Clinique du Millénaire, Centre Oscar-Lambret (CLCC), Institut Arthur-Vernes, Hôpital européen Georges-Pompidou, Clinique Charcot, Clinique Saint-Augustin, Clinique Mutualiste de Bretagne Occidentale, Clinique de la Miséricorde, GHU Paris Psychiatrie et neurosciences, Polyclinique Saint-Privat, Centre médico-chirurgical du Mans, Clinique La Croix du Sud, Hôpital Nord, Hôpital privé La Montagne Lambert, Clinique Louis-Pasteur, Institut ophtalmique, Clinique Océane, Hôpital de la Pitié-Salpêtrière, EPS Ville-Évrard, Infirmerie protestante de Lyon, Polyclinique Bordeaux-Nord-Aquitaine, Médipôle de Savoie, CHU - Hôpital de la Cavale-Blanche, Hôpital privé d’Antony, Centre Hospitalier Le Vinatier, Clinique Saint-Jean - Sud de France, Hôtel-Dieu, Institut Jean-Godinot (CLCC), GH, Clinique du Cèdre, Clinique de la Muette, Hôpital privé Arras-Les Bonnettes, Clinique du Parc-Monceau, CHU - Hôpital Dupuytren, Clinique du Pont-de-Chaume, Hôpital Bichat, CH Georges-Daumezon, Clinique du Fief-de-Grimoire, Clinique de l’Orangerie, Hôpital privé de la Casamance, Santé Atlantique, Clinique Clémentville, Clinique du Parc, Clinique mutualiste de la Porte-de-l'Orient, Hôpital de la Timone (Enfants), Clinique de l’Anjou, Hôpital privé Beauregard, Clinique Saint-George, Centre de cardiologie du Pays basque, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpital Rangueil, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de Marne-la-Vallée, Hôpital privé Drôme-Ardèche, Pôle santé Léonard-de-Vinci, Polyclinique Lyon-Nord, Hôpital Privé Nancy Lorraine, CHU Nantes - Hôpital Mère Enfant, Clinique des Orchidées, CHP de l’Europe, Hôpital de la Conception, Hôpital privé Pays-de-Savoie, Polyclinique Vauban, Clinique Paris Lilas, Centre Hospitalier Le Mas Careiron, Clinique d’Occitanie, Polyclinique Saint-François, Hôpital Corentin-Celton, Hôpital privé Paul-d’Égine, CHU - Hôpitaux de Brabois, Hôpital privé Dijon-Bourgogne, Institut du cancer de Montpellier (CLCC), CHU - Hôpital d’Estaing, Polyclinique de Limoges - site Émailleurs, Pôle santé Oréliance, CHU - Hôpital Maison-Blanche, Hôpital privé Vert-Coteau, Hôpital de la Croix-Saint-Simon, Hôpital d'instruction des armées Legouest, CHU Grenoble - Hôpital Sud, Hôpital Bicêtre, Hôpital Ambroise-Paré, Centre de cardiologie Axium-Rambot, Centre Hospitalier Gérard-Marchant, Centre Hospitalier La Chartreuse, CHU - Gabriel-Montpied, Clinique Saint-Joseph, Clinique de l’Estrée, Clinique Victor-Pauchet, Centre Clinical, Grand hôpital de l'Est-Francilien, Polyclinique du Parc, Clinique Bon-Secours, CHU - American Memorial Hospital, CMCO Côte d’Opale, Polyclinique Santa-Maria, Institut Paoli-Calmettes (CLCC), Hôpital européen, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), IUCT/Oncopole, CHU - Hôpital Haut-Lévêque, Nouvel Hôpital de Navarre, Hôpital Paul-Brousse, Hôpital d'instruction des armées Desgenettes, Clinique ambulatoire de Domont, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique de la Région-Mantaise, Clinique Rive-Gauche, Clinique du Renaison, Centre Hospitalier d'Erstein, Polyclinique de Picardie, Clinique de Villeneuve-d’Ascq, Hôpital Pierre-Wertheimer, Clinique Saint-Michel, CHU d'Amiens/Institut ophtalmologique de Picardie, Hôpital Beaujon, Hôpital privé des Côtes-d’Armor, Hôpital privé La Châtaigneraie, Nouvelle clinique Bel-Air, Euromed Cardio, Hôpital de la Timone (adultes), EPSM Morbihan, Clinique Sainte-Marie (GHICL), EPSM Etienne-Gourmelen, Pôle de Santé du Villeneuvois, Hôpital Robert-Debré, Clinique Fontvert, Polyclinique Bordeaux-Rive droite, CHU - Hôpital Saint-Eloi, Institut Bergonié (CLCC), Hôpital Lariboisière-Fernand Widal, Clinique de l'Essonne, Clinique Saint-Antoine, CHU Sud-Réunion, CHU - Hôpital Roger-Salengro, Clinique mutualiste, CH Guillaume-Régnier, CM Bénigne-Joly, Clinique Anne-Artois, Hôpital privé de l’Est lyonnais, Clinique mutualiste de l’Estuaire, Clinique Notre-Dame-de-l’Espérance, Hôpital privé de Marne Chantereine, Clinique du Tertre-Rouge, Polyclinique Côte-Basque-Sud, CHU - Hôpital Purpan, Clinique Ormeau centre, Clinique du Diaconat-Fonderie, Polyclinique Saint-Côme, CH privé Claude-Galien, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital des Diaconesses, CH Édouard-Toulouse, Clinique de la Sauvegarde, CMC de Parly-II, Institut franco-britannique Kléber, Clinique du Val-d’Ouest Vendôme, Clinique Durieux, CH privé Saint-Martin, Clinique Saint-Vincent, Clinique Trenel, Centre Hospitalier George Sand, Centre Jean-Perrin (CLCC), Polyclinique Saint Laurent, Hôpital Necker-Enfants-Malades, Hôpital Renée-Sabran, Hôpital privé Paris-Essonne, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Laveran, Clinique de l’Espérance, Clinique Rhône Durance, Polyclinique Jean-Villar, CMCO, Hôpital privé de la Seine-Saint-Denis, Clinique du Trocadéro, CHU d’Amiens, Clinique Belledonne, Clinique Beau-Soleil, Clinique Monticelli-Vélodrome, Clinique Juge, Hôpital privé de Provence, Hôpital Saint-Camille, Hôpital privé Saint-Martin, Hôpital privé de la Loire, Clinique Bretéché, Hôpital privé Cannes-Oxford, Hôpital d'instruction des armées Bégin, Clinique de l’Union, CHU - Hôpital Morvan, Centre cardiologique du Nord, Hôpital Edouard-Herriot, Clinique de l’Atlantique, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Lapeyronie, CHU - Hôpital Central, CHU - Hôpitaux mère-enfants, Clinique urologique Nantes-Atlantis, IUCT Oncopole, Clinique Saint-Nabor, Centre Hospitalier Drôme Vivarais
2025-08-22 19:21:01,372 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 19:21:01,586 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 19:21:01,586 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-22 19:21:01,586 [DEBUG] app.services.pipeline_orchestrator_service: Calling build_ranking_dataframe_with_distances
2025-08-22 19:21:01,587 [INFO] app.services.pipeline_orchestrator_service: Building ranking DataFrame with distances: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', excel_path='/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx', detected_specialty='no specialty match'
2025-08-22 19:21:01,587 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history='None'
2025-08-22 19:21:01,587 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 19:21:01,587 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 19:21:01,587 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 19:21:01,587 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 19:21:01,734 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:21:01,734 [DEBUG] app.services.data_processing_service: Institution list: Centre François-Baclesse (CLCC), Hôpital-clinique Claude-Bernard, Clinique Jean Causse, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Larrey, Hôpital Nord Franche-Comté-Belfort, Clinique la Pergola, CHU - Institut cœur-poumon, Clinique Saint-François, Centre chirurgical Marie-Lannelongue, Hôpitaux Sud, Médipôle Garonne, Hôpitaux de Saint-Maurice, EPSM de la Marne, Hôpital Henri-Mondor, CMC Floréal, Hôpital privé de l’Estuaire, Clinique Ambroise-Paré, Centre Henri-Becquerel (CLCC), GCS Clinique du Ter, Clinique Tivoli-Ducos, Institut hospitalier Jacques-Cartier, Polyclinique du Maine, Hôpital d'instruction des armées Sainte-Anne, Hôpital Hôtel-Dieu, Clinique Kennedy, CHU - Hôpital de Hautepierre, CH Montfavet, Centre Hospitalier Maurice Despinoy, Clinique de la Part-Dieu, Hôpital privé du Vert-Galant, CHU - Hôpital Claude-Huriez, CHU de Martinique, CH privé du Montgardé, CHU - Hôpital Charles-Nicolle, Hôpital privé Le Bois, Polyclinique de Blois, Hôpital Louis-Mourier, Hôpital Albert Schweitzer, Groupe Hospitalier de la Rochelle, CH Basse-Terre (Guadeloupe), Polyclinique Saint-Roch, Clinique Saint-Pierre, Clinique du Grand-Large, Clinique Bizet, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Amé, CH Charles-Perrens, CH/Clinique, Clinique des Franciscaines, CHU - Hôpital Arnaud-de-Villeneuve, Centre Hospitalier Le Bon Sauveur, Clinique Chantecler, Hôpital Jean-Verdier, CH national d’ophtalmologie des Quinze-Vingts, Hôpital Raymond-Poincaré, Polyclinique Majorelle, CHU - Hôpital civil, EPSM Lille-Métropole, Clinique Bouchard, Institut Arnault-Tzanck, Clinique Esquirol-Saint-Hilaire, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Reims-Bezannes (Marne), HCL - Hôpital Femme-mère-enfant, Polyclinique du Beaujolais, Nouvelle clinique de Tours, Clinique Jean le Bon, CHU - Hôpital Trousseau, Institut Curie, Clinique Victor-Hugo, Clinique Sainte-Marie, Institut mutualiste Montsouris, Maison de santé Bagatelle, Polyclinique Aguilera, Polyclinique de Navarre, CH/clinique, EPS Barthélemy-Durand, Hôpital de la Timone (enfants), Hôpital privé du Confluent, Centre ambulatoire Kleber, Hôpital Tenon, CHU de La Réunion - Félix-Guyon, Hôpital Belle-Isle, CHU - Hôpital Clocheville, Hôpital Robert Schuman, Clinique Saint-Jean-de-Dieu, Polyclinique Médipôle Saint-Roch, Hôpital Cochin, Hôpital privé Jean-Mermoz, Hôpital Saint-Louis, Clinique Belharra, Clinique Saint-André, Centre Hospitalier Les Murets, Les Franciscaines, CHU - Hôpital Pasteur, Clinique du Lac et d’Argonay, Fondation Rothschild, Centre Hospitalier Montperrin, Hôpital privé Clairval, Clinique Saint-Léonard, Clinique Conti, Hôpital Avicenne, CHU - Centre chirurgical Emile-Gallé, Clinique du Pré, Institut de cancérologie Strasbourg Europe, Clinique de Bercy, Clinique du Val-d’Or, CMC Pierre-Cherest, Centre Hospitalier du Rouvray, Polyclinique de Bordeaux-Tondu, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Saint-Paul, CHU de Nantes, Espm de L’agglomeration Lilloise, CH Saint-Joseph-Saint-Luc, CHU Grenoble - Site Nord, Hôpitaux pédiatriques, CHR de Metz-Thionville - Hôpital de Mercy, Centre Hospitalier Henri Guerin, Clinique Delay, Hôpital d'instruction des armées Robert-Picqué, Hôpital d'instruction des armées Percy, Clinique Sainte-Clotilde, Hôpital Louis-Pradel, Polyclinique de Kerio, CHU - Hôpital Pellegrin, Clinique de l’Yvette, Polyclinique, Centre Hospitalier de Vauclaire, Clinique Saint-Hilaire, GHP Ambroise-Paré - Hartmann (92), Polyclinique de Limoges - site Chénieux, Polyclinique Urbain-V, Hôpital Saint-Joseph, Clinique Pasteur-Lanroze, Clinique Axium, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique Saint-Jean, Clinique cardiologique, CHU - Hôpital Robert-Debré, Clinique Marcel-Sembat, CHU - Maternité, CH Lyon-Sud, Clinique Lille-Sud, Polyclinique de la Baie, Hôpital privé, Centre cardiologique, GH Paul Guiraud, CHR de Metz-Thionville - Hôpital Bel-Air, Centre de chirurgie ophtalmologique, Hôpital des Massues, Clinique Mathilde, Clinique du Croisé-Laroche, Institut de cancérologie de l’Ouest, CHU - Hôpital Saint-André, Clinique de l'Alma, Institut d’hématologie et d'oncologie pédiatrique, Pôle Santé République, Hôpital privé Nord Parisien, Clinique Toulouse-Lautrec, Clinique du Cambrésis, CHU - Hôpital Pontchaillou, Clinique ophtalmologique Thiers, Centre de la main, Hopital Joseph-Ducuing, CHU de Martinique - site Mère-Enfant, Hôpital privé La Louvière, Médipôle Hôpital Privé, Centre Léon-Bérard (CLCC), CHU - Hôpital Nord, Centre médico-chirurgical et obstétrical, Clinique Saint-Vincent-de-Paul, CH intercommunal, Hôpital privé des Peupliers, Hôpital Paris Saint-Joseph, Centre Hospitalier des Pyrénées, Hôpital Trousseau, Polyclinique La Ligne bleue, Clinique Saint-Charles, EPSM de Saône-et-Loire, ASM, Clinique mutualiste Jules-Verne, Clinique Rhéna, Groupe hospitalier Nord-Essonne, Polyclinique de Keraudren, Polyclinique Francheville, Clinique mutualiste de Bonneveine, Centre Georges-François-Leclerc (CLCC), Polyclinique du Grand-Sud, CHU Réunion, CHU-Hôpital Purpan/HFE, CH privé Saint-Grégoire, Centre orthopédique médico-chirurgical, Polyclinique de Poitiers, Polyclinique Les Fleurs, Clinique Pasteur, Clinique Sainte-Anne, Hôpital privé de La Miotte, Hôpital privé Sévigné, Clinique Turin, Centre Eugène-Marquis (CLCC), Hôpital Antoine-Béclère, Hôpital Saint-Philibert (GHICL), Hôpital privé Armand-Brillard, Clinique Les Fontaines, Centre psychothérapique de Nancy, CHU - Hôpital de l’Archet, Clinique Convert, Institut Curie (CLCC), CHR, Clinique Arago, Clinique Remusat, Centre Psychothérapique, Clinique Honoré-Cave, Clinique mutualiste La Sagesse, CHU - Hôpital Gui-de-Chauliac, Clinique Claude-Bernard, Clinique Ormeau Pyrénées, Polyclinique de Reims-Bezannes, Hôpital Lariboisière, Hôpital de la Croix Rousse (HCL) / CH, Hôpitaux Nord (Croix-Rousse), CHU - Hôpital Bretonneau, Gustave-Roussy (CLCC), Hôpital privé de l’Ouest parisien, Hôpital privé Natecia, Clinique générale, Clinique Maussins-Nollet, Clinique des Cèdres, Hôpitaux civils, Polyclinique du Parc-Drevon, Clinique des Ormeaux, Clinique mutualiste catalane, GH mutualiste, Clinique de l’Europe, Hôpital Foch, Hôpital Saint-Antoine, CHU - site Nord, Centre Hospitalier Sainte-Marie, CH Esquirol, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital de la Côte de nacre, Clinique Les Eaux-Claires, Clinique du sport, Clinique du Diaconat-Roosevelt, Institut Calot, Clinique de Vitrolles (Bouches-du-Rhône), CHI, CHU de Pointe-à-Pitre, Clinique Jouvenet, CHU - Hôpital Sud, Epsan, CH Henri-Laborit, GHI, Institut universitaire de la face et du cou, Polyclinique de Courlancy, Clinique de la Plaine, Clinique du Millénaire, Centre Oscar-Lambret (CLCC), Institut Arthur-Vernes, Hôpital européen Georges-Pompidou, Clinique Charcot, Clinique Saint-Augustin, Clinique Mutualiste de Bretagne Occidentale, Clinique de la Miséricorde, GHU Paris Psychiatrie et neurosciences, Polyclinique Saint-Privat, Centre médico-chirurgical du Mans, Clinique La Croix du Sud, Hôpital Nord, Hôpital privé La Montagne Lambert, Clinique Louis-Pasteur, Institut ophtalmique, Clinique Océane, Hôpital de la Pitié-Salpêtrière, EPS Ville-Évrard, Infirmerie protestante de Lyon, Polyclinique Bordeaux-Nord-Aquitaine, Médipôle de Savoie, CHU - Hôpital de la Cavale-Blanche, Hôpital privé d’Antony, Centre Hospitalier Le Vinatier, Clinique Saint-Jean - Sud de France, Hôtel-Dieu, Institut Jean-Godinot (CLCC), GH, Clinique du Cèdre, Clinique de la Muette, Hôpital privé Arras-Les Bonnettes, Clinique du Parc-Monceau, CHU - Hôpital Dupuytren, Clinique du Pont-de-Chaume, Hôpital Bichat, CH Georges-Daumezon, Clinique du Fief-de-Grimoire, Clinique de l’Orangerie, Hôpital privé de la Casamance, Santé Atlantique, Clinique Clémentville, Clinique du Parc, Clinique mutualiste de la Porte-de-l'Orient, Hôpital de la Timone (Enfants), Clinique de l’Anjou, Hôpital privé Beauregard, Clinique Saint-George, Centre de cardiologie du Pays basque, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpital Rangueil, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de Marne-la-Vallée, Hôpital privé Drôme-Ardèche, Pôle santé Léonard-de-Vinci, Polyclinique Lyon-Nord, Hôpital Privé Nancy Lorraine, CHU Nantes - Hôpital Mère Enfant, Clinique des Orchidées, CHP de l’Europe, Hôpital de la Conception, Hôpital privé Pays-de-Savoie, Polyclinique Vauban, Clinique Paris Lilas, Centre Hospitalier Le Mas Careiron, Clinique d’Occitanie, Polyclinique Saint-François, Hôpital Corentin-Celton, Hôpital privé Paul-d’Égine, CHU - Hôpitaux de Brabois, Hôpital privé Dijon-Bourgogne, Institut du cancer de Montpellier (CLCC), CHU - Hôpital d’Estaing, Polyclinique de Limoges - site Émailleurs, Pôle santé Oréliance, CHU - Hôpital Maison-Blanche, Hôpital privé Vert-Coteau, Hôpital de la Croix-Saint-Simon, Hôpital d'instruction des armées Legouest, CHU Grenoble - Hôpital Sud, Hôpital Bicêtre, Hôpital Ambroise-Paré, Centre de cardiologie Axium-Rambot, Centre Hospitalier Gérard-Marchant, Centre Hospitalier La Chartreuse, CHU - Gabriel-Montpied, Clinique Saint-Joseph, Clinique de l’Estrée, Clinique Victor-Pauchet, Centre Clinical, Grand hôpital de l'Est-Francilien, Polyclinique du Parc, Clinique Bon-Secours, CHU - American Memorial Hospital, CMCO Côte d’Opale, Polyclinique Santa-Maria, Institut Paoli-Calmettes (CLCC), Hôpital européen, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), IUCT/Oncopole, CHU - Hôpital Haut-Lévêque, Nouvel Hôpital de Navarre, Hôpital Paul-Brousse, Hôpital d'instruction des armées Desgenettes, Clinique ambulatoire de Domont, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique de la Région-Mantaise, Clinique Rive-Gauche, Clinique du Renaison, Centre Hospitalier d'Erstein, Polyclinique de Picardie, Clinique de Villeneuve-d’Ascq, Hôpital Pierre-Wertheimer, Clinique Saint-Michel, CHU d'Amiens/Institut ophtalmologique de Picardie, Hôpital Beaujon, Hôpital privé des Côtes-d’Armor, Hôpital privé La Châtaigneraie, Nouvelle clinique Bel-Air, Euromed Cardio, Hôpital de la Timone (adultes), EPSM Morbihan, Clinique Sainte-Marie (GHICL), EPSM Etienne-Gourmelen, Pôle de Santé du Villeneuvois, Hôpital Robert-Debré, Clinique Fontvert, Polyclinique Bordeaux-Rive droite, CHU - Hôpital Saint-Eloi, Institut Bergonié (CLCC), Hôpital Lariboisière-Fernand Widal, Clinique de l'Essonne, Clinique Saint-Antoine, CHU Sud-Réunion, CHU - Hôpital Roger-Salengro, Clinique mutualiste, CH Guillaume-Régnier, CM Bénigne-Joly, Clinique Anne-Artois, Hôpital privé de l’Est lyonnais, Clinique mutualiste de l’Estuaire, Clinique Notre-Dame-de-l’Espérance, Hôpital privé de Marne Chantereine, Clinique du Tertre-Rouge, Polyclinique Côte-Basque-Sud, CHU - Hôpital Purpan, Clinique Ormeau centre, Clinique du Diaconat-Fonderie, Polyclinique Saint-Côme, CH privé Claude-Galien, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital des Diaconesses, CH Édouard-Toulouse, Clinique de la Sauvegarde, CMC de Parly-II, Institut franco-britannique Kléber, Clinique du Val-d’Ouest Vendôme, Clinique Durieux, CH privé Saint-Martin, Clinique Saint-Vincent, Clinique Trenel, Centre Hospitalier George Sand, Centre Jean-Perrin (CLCC), Polyclinique Saint Laurent, Hôpital Necker-Enfants-Malades, Hôpital Renée-Sabran, Hôpital privé Paris-Essonne, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Laveran, Clinique de l’Espérance, Clinique Rhône Durance, Polyclinique Jean-Villar, CMCO, Hôpital privé de la Seine-Saint-Denis, Clinique du Trocadéro, CHU d’Amiens, Clinique Belledonne, Clinique Beau-Soleil, Clinique Monticelli-Vélodrome, Clinique Juge, Hôpital privé de Provence, Hôpital Saint-Camille, Hôpital privé Saint-Martin, Hôpital privé de la Loire, Clinique Bretéché, Hôpital privé Cannes-Oxford, Hôpital d'instruction des armées Bégin, Clinique de l’Union, CHU - Hôpital Morvan, Centre cardiologique du Nord, Hôpital Edouard-Herriot, Clinique de l’Atlantique, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Lapeyronie, CHU - Hôpital Central, CHU - Hôpitaux mère-enfants, Clinique urologique Nantes-Atlantis, IUCT Oncopole, Clinique Saint-Nabor, Centre Hospitalier Drôme Vivarais
2025-08-22 19:21:01,735 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Centre François-Baclesse (CLCC), Hôpital-clinique Claude-Bernard, Clinique Jean Causse, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Larrey, Hôpital Nord Franche-Comté-Belfort, Clinique la Pergola, CHU - Institut cœur-poumon, Clinique Saint-François, Centre chirurgical Marie-Lannelongue, Hôpitaux Sud, Médipôle Garonne, Hôpitaux de Saint-Maurice, EPSM de la Marne, Hôpital Henri-Mondor, CMC Floréal, Hôpital privé de l’Estuaire, Clinique Ambroise-Paré, Centre Henri-Becquerel (CLCC), GCS Clinique du Ter, Clinique Tivoli-Ducos, Institut hospitalier Jacques-Cartier, Polyclinique du Maine, Hôpital d'instruction des armées Sainte-Anne, Hôpital Hôtel-Dieu, Clinique Kennedy, CHU - Hôpital de Hautepierre, CH Montfavet, Centre Hospitalier Maurice Despinoy, Clinique de la Part-Dieu, Hôpital privé du Vert-Galant, CHU - Hôpital Claude-Huriez, CHU de Martinique, CH privé du Montgardé, CHU - Hôpital Charles-Nicolle, Hôpital privé Le Bois, Polyclinique de Blois, Hôpital Louis-Mourier, Hôpital Albert Schweitzer, Groupe Hospitalier de la Rochelle, CH Basse-Terre (Guadeloupe), Polyclinique Saint-Roch, Clinique Saint-Pierre, Clinique du Grand-Large, Clinique Bizet, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Amé, CH Charles-Perrens, CH/Clinique, Clinique des Franciscaines, CHU - Hôpital Arnaud-de-Villeneuve, Centre Hospitalier Le Bon Sauveur, Clinique Chantecler, Hôpital Jean-Verdier, CH national d’ophtalmologie des Quinze-Vingts, Hôpital Raymond-Poincaré, Polyclinique Majorelle, CHU - Hôpital civil, EPSM Lille-Métropole, Clinique Bouchard, Institut Arnault-Tzanck, Clinique Esquirol-Saint-Hilaire, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Reims-Bezannes (Marne), HCL - Hôpital Femme-mère-enfant, Polyclinique du Beaujolais, Nouvelle clinique de Tours, Clinique Jean le Bon, CHU - Hôpital Trousseau, Institut Curie, Clinique Victor-Hugo, Clinique Sainte-Marie, Institut mutualiste Montsouris, Maison de santé Bagatelle, Polyclinique Aguilera, Polyclinique de Navarre, CH/clinique, EPS Barthélemy-Durand, Hôpital de la Timone (enfants), Hôpital privé du Confluent, Centre ambulatoire Kleber, Hôpital Tenon, CHU de La Réunion - Félix-Guyon, Hôpital Belle-Isle, CHU - Hôpital Clocheville, Hôpital Robert Schuman, Clinique Saint-Jean-de-Dieu, Polyclinique Médipôle Saint-Roch, Hôpital Cochin, Hôpital privé Jean-Mermoz, Hôpital Saint-Louis, Clinique Belharra, Clinique Saint-André, Centre Hospitalier Les Murets, Les Franciscaines, CHU - Hôpital Pasteur, Clinique du Lac et d’Argonay, Fondation Rothschild, Centre Hospitalier Montperrin, Hôpital privé Clairval, Clinique Saint-Léonard, Clinique Conti, Hôpital Avicenne, CHU - Centre chirurgical Emile-Gallé, Clinique du Pré, Institut de cancérologie Strasbourg Europe, Clinique de Bercy, Clinique du Val-d’Or, CMC Pierre-Cherest, Centre Hospitalier du Rouvray, Polyclinique de Bordeaux-Tondu, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Saint-Paul, CHU de Nantes, Espm de L’agglomeration Lilloise, CH Saint-Joseph-Saint-Luc, CHU Grenoble - Site Nord, Hôpitaux pédiatriques, CHR de Metz-Thionville - Hôpital de Mercy, Centre Hospitalier Henri Guerin, Clinique Delay, Hôpital d'instruction des armées Robert-Picqué, Hôpital d'instruction des armées Percy, Clinique Sainte-Clotilde, Hôpital Louis-Pradel, Polyclinique de Kerio, CHU - Hôpital Pellegrin, Clinique de l’Yvette, Polyclinique, Centre Hospitalier de Vauclaire, Clinique Saint-Hilaire, GHP Ambroise-Paré - Hartmann (92), Polyclinique de Limoges - site Chénieux, Polyclinique Urbain-V, Hôpital Saint-Joseph, Clinique Pasteur-Lanroze, Clinique Axium, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique Saint-Jean, Clinique cardiologique, CHU - Hôpital Robert-Debré, Clinique Marcel-Sembat, CHU - Maternité, CH Lyon-Sud, Clinique Lille-Sud, Polyclinique de la Baie, Hôpital privé, Centre cardiologique, GH Paul Guiraud, CHR de Metz-Thionville - Hôpital Bel-Air, Centre de chirurgie ophtalmologique, Hôpital des Massues, Clinique Mathilde, Clinique du Croisé-Laroche, Institut de cancérologie de l’Ouest, CHU - Hôpital Saint-André, Clinique de l'Alma, Institut d’hématologie et d'oncologie pédiatrique, Pôle Santé République, Hôpital privé Nord Parisien, Clinique Toulouse-Lautrec, Clinique du Cambrésis, CHU - Hôpital Pontchaillou, Clinique ophtalmologique Thiers, Centre de la main, Hopital Joseph-Ducuing, CHU de Martinique - site Mère-Enfant, Hôpital privé La Louvière, Médipôle Hôpital Privé, Centre Léon-Bérard (CLCC), CHU - Hôpital Nord, Centre médico-chirurgical et obstétrical, Clinique Saint-Vincent-de-Paul, CH intercommunal, Hôpital privé des Peupliers, Hôpital Paris Saint-Joseph, Centre Hospitalier des Pyrénées, Hôpital Trousseau, Polyclinique La Ligne bleue, Clinique Saint-Charles, EPSM de Saône-et-Loire, ASM, Clinique mutualiste Jules-Verne, Clinique Rhéna, Groupe hospitalier Nord-Essonne, Polyclinique de Keraudren, Polyclinique Francheville, Clinique mutualiste de Bonneveine, Centre Georges-François-Leclerc (CLCC), Polyclinique du Grand-Sud, CHU Réunion, CHU-Hôpital Purpan/HFE, CH privé Saint-Grégoire, Centre orthopédique médico-chirurgical, Polyclinique de Poitiers, Polyclinique Les Fleurs, Clinique Pasteur, Clinique Sainte-Anne, Hôpital privé de La Miotte, Hôpital privé Sévigné, Clinique Turin, Centre Eugène-Marquis (CLCC), Hôpital Antoine-Béclère, Hôpital Saint-Philibert (GHICL), Hôpital privé Armand-Brillard, Clinique Les Fontaines, Centre psychothérapique de Nancy, CHU - Hôpital de l’Archet, Clinique Convert, Institut Curie (CLCC), CHR, Clinique Arago, Clinique Remusat, Centre Psychothérapique, Clinique Honoré-Cave, Clinique mutualiste La Sagesse, CHU - Hôpital Gui-de-Chauliac, Clinique Claude-Bernard, Clinique Ormeau Pyrénées, Polyclinique de Reims-Bezannes, Hôpital Lariboisière, Hôpital de la Croix Rousse (HCL) / CH, Hôpitaux Nord (Croix-Rousse), CHU - Hôpital Bretonneau, Gustave-Roussy (CLCC), Hôpital privé de l’Ouest parisien, Hôpital privé Natecia, Clinique générale, Clinique Maussins-Nollet, Clinique des Cèdres, Hôpitaux civils, Polyclinique du Parc-Drevon, Clinique des Ormeaux, Clinique mutualiste catalane, GH mutualiste, Clinique de l’Europe, Hôpital Foch, Hôpital Saint-Antoine, CHU - site Nord, Centre Hospitalier Sainte-Marie, CH Esquirol, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital de la Côte de nacre, Clinique Les Eaux-Claires, Clinique du sport, Clinique du Diaconat-Roosevelt, Institut Calot, Clinique de Vitrolles (Bouches-du-Rhône), CHI, CHU de Pointe-à-Pitre, Clinique Jouvenet, CHU - Hôpital Sud, Epsan, CH Henri-Laborit, GHI, Institut universitaire de la face et du cou, Polyclinique de Courlancy, Clinique de la Plaine, Clinique du Millénaire, Centre Oscar-Lambret (CLCC), Institut Arthur-Vernes, Hôpital européen Georges-Pompidou, Clinique Charcot, Clinique Saint-Augustin, Clinique Mutualiste de Bretagne Occidentale, Clinique de la Miséricorde, GHU Paris Psychiatrie et neurosciences, Polyclinique Saint-Privat, Centre médico-chirurgical du Mans, Clinique La Croix du Sud, Hôpital Nord, Hôpital privé La Montagne Lambert, Clinique Louis-Pasteur, Institut ophtalmique, Clinique Océane, Hôpital de la Pitié-Salpêtrière, EPS Ville-Évrard, Infirmerie protestante de Lyon, Polyclinique Bordeaux-Nord-Aquitaine, Médipôle de Savoie, CHU - Hôpital de la Cavale-Blanche, Hôpital privé d’Antony, Centre Hospitalier Le Vinatier, Clinique Saint-Jean - Sud de France, Hôtel-Dieu, Institut Jean-Godinot (CLCC), GH, Clinique du Cèdre, Clinique de la Muette, Hôpital privé Arras-Les Bonnettes, Clinique du Parc-Monceau, CHU - Hôpital Dupuytren, Clinique du Pont-de-Chaume, Hôpital Bichat, CH Georges-Daumezon, Clinique du Fief-de-Grimoire, Clinique de l’Orangerie, Hôpital privé de la Casamance, Santé Atlantique, Clinique Clémentville, Clinique du Parc, Clinique mutualiste de la Porte-de-l'Orient, Hôpital de la Timone (Enfants), Clinique de l’Anjou, Hôpital privé Beauregard, Clinique Saint-George, Centre de cardiologie du Pays basque, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpital Rangueil, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de Marne-la-Vallée, Hôpital privé Drôme-Ardèche, Pôle santé Léonard-de-Vinci, Polyclinique Lyon-Nord, Hôpital Privé Nancy Lorraine, CHU Nantes - Hôpital Mère Enfant, Clinique des Orchidées, CHP de l’Europe, Hôpital de la Conception, Hôpital privé Pays-de-Savoie, Polyclinique Vauban, Clinique Paris Lilas, Centre Hospitalier Le Mas Careiron, Clinique d’Occitanie, Polyclinique Saint-François, Hôpital Corentin-Celton, Hôpital privé Paul-d’Égine, CHU - Hôpitaux de Brabois, Hôpital privé Dijon-Bourgogne, Institut du cancer de Montpellier (CLCC), CHU - Hôpital d’Estaing, Polyclinique de Limoges - site Émailleurs, Pôle santé Oréliance, CHU - Hôpital Maison-Blanche, Hôpital privé Vert-Coteau, Hôpital de la Croix-Saint-Simon, Hôpital d'instruction des armées Legouest, CHU Grenoble - Hôpital Sud, Hôpital Bicêtre, Hôpital Ambroise-Paré, Centre de cardiologie Axium-Rambot, Centre Hospitalier Gérard-Marchant, Centre Hospitalier La Chartreuse, CHU - Gabriel-Montpied, Clinique Saint-Joseph, Clinique de l’Estrée, Clinique Victor-Pauchet, Centre Clinical, Grand hôpital de l'Est-Francilien, Polyclinique du Parc, Clinique Bon-Secours, CHU - American Memorial Hospital, CMCO Côte d’Opale, Polyclinique Santa-Maria, Institut Paoli-Calmettes (CLCC), Hôpital européen, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), IUCT/Oncopole, CHU - Hôpital Haut-Lévêque, Nouvel Hôpital de Navarre, Hôpital Paul-Brousse, Hôpital d'instruction des armées Desgenettes, Clinique ambulatoire de Domont, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique de la Région-Mantaise, Clinique Rive-Gauche, Clinique du Renaison, Centre Hospitalier d'Erstein, Polyclinique de Picardie, Clinique de Villeneuve-d’Ascq, Hôpital Pierre-Wertheimer, Clinique Saint-Michel, CHU d'Amiens/Institut ophtalmologique de Picardie, Hôpital Beaujon, Hôpital privé des Côtes-d’Armor, Hôpital privé La Châtaigneraie, Nouvelle clinique Bel-Air, Euromed Cardio, Hôpital de la Timone (adultes), EPSM Morbihan, Clinique Sainte-Marie (GHICL), EPSM Etienne-Gourmelen, Pôle de Santé du Villeneuvois, Hôpital Robert-Debré, Clinique Fontvert, Polyclinique Bordeaux-Rive droite, CHU - Hôpital Saint-Eloi, Institut Bergonié (CLCC), Hôpital Lariboisière-Fernand Widal, Clinique de l'Essonne, Clinique Saint-Antoine, CHU Sud-Réunion, CHU - Hôpital Roger-Salengro, Clinique mutualiste, CH Guillaume-Régnier, CM Bénigne-Joly, Clinique Anne-Artois, Hôpital privé de l’Est lyonnais, Clinique mutualiste de l’Estuaire, Clinique Notre-Dame-de-l’Espérance, Hôpital privé de Marne Chantereine, Clinique du Tertre-Rouge, Polyclinique Côte-Basque-Sud, CHU - Hôpital Purpan, Clinique Ormeau centre, Clinique du Diaconat-Fonderie, Polyclinique Saint-Côme, CH privé Claude-Galien, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital des Diaconesses, CH Édouard-Toulouse, Clinique de la Sauvegarde, CMC de Parly-II, Institut franco-britannique Kléber, Clinique du Val-d’Ouest Vendôme, Clinique Durieux, CH privé Saint-Martin, Clinique Saint-Vincent, Clinique Trenel, Centre Hospitalier George Sand, Centre Jean-Perrin (CLCC), Polyclinique Saint Laurent, Hôpital Necker-Enfants-Malades, Hôpital Renée-Sabran, Hôpital privé Paris-Essonne, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Laveran, Clinique de l’Espérance, Clinique Rhône Durance, Polyclinique Jean-Villar, CMCO, Hôpital privé de la Seine-Saint-Denis, Clinique du Trocadéro, CHU d’Amiens, Clinique Belledonne, Clinique Beau-Soleil, Clinique Monticelli-Vélodrome, Clinique Juge, Hôpital privé de Provence, Hôpital Saint-Camille, Hôpital privé Saint-Martin, Hôpital privé de la Loire, Clinique Bretéché, Hôpital privé Cannes-Oxford, Hôpital d'instruction des armées Bégin, Clinique de l’Union, CHU - Hôpital Morvan, Centre cardiologique du Nord, Hôpital Edouard-Herriot, Clinique de l’Atlantique, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Lapeyronie, CHU - Hôpital Central, CHU - Hôpitaux mère-enfants, Clinique urologique Nantes-Atlantis, IUCT Oncopole, Clinique Saint-Nabor, Centre Hospitalier Drôme Vivarais
2025-08-22 19:21:01,735 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:21:01,736 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-22 19:21:01,736 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-22 19:21:01,739 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:01,739 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:01,739 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:01,740 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:01,740 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:01,740 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:01,740 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:02,205 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:02 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'275'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'294'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_8f43835b7a994bc7849cd899ef42a8fe'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b52ed26cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:02,205 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:02,206 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:02,225 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:02,225 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:02,225 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:02,226 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:02 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '275', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '294', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_8f43835b7a994bc7849cd899ef42a8fe', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b52ed26cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:02,226 [DEBUG] openai._base_client: request_id: req_8f43835b7a994bc7849cd899ef42a8fe
2025-08-22 19:21:02,227 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:02,227 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:02,227 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:21:02,227 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:02,230 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:02,231 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:02,231 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:02,231 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:02,231 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:02,231 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:02,231 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:02,717 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:02 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'310'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'330'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_44a22682a15f400996794f6111695f7c'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b55fcd8cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:02,718 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:02,718 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:02,722 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:02,723 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:02,723 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:02,723 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:02 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '310', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '330', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_44a22682a15f400996794f6111695f7c', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b55fcd8cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:02,723 [DEBUG] openai._base_client: request_id: req_44a22682a15f400996794f6111695f7c
2025-08-22 19:21:02,724 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:21:02,724 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:21:02,725 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:21:02,725 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:02,727 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:02,728 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:02,728 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:02,729 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:02,729 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:02,729 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:02,729 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:06,424 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:06 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3482'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3506'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_d69e44ceee02492e9efe2f40e43becc6'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b591d46cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:06,425 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:06,425 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:06,425 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:06,425 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:06,426 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:06,426 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:06 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3482', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3506', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_d69e44ceee02492e9efe2f40e43becc6', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b591d46cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:06,426 [DEBUG] openai._base_client: request_id: req_d69e44ceee02492e9efe2f40e43becc6
2025-08-22 19:21:06,427 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:21:06,427 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:21:06,427 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:21:06,427 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-22 19:21:06,427 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:06,427 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:06,427 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 19:21:06,427 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:06,430 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:06,431 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:06,431 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:06,431 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:06,431 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:06,432 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:06,432 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:06,957 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:07 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'339'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'356'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_6dceaa91f4174e83a50429cd2a242f41'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b703ea2cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:06,957 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:06,957 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:06,967 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:06,967 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:06,967 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:06,967 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:07 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '339', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '356', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_6dceaa91f4174e83a50429cd2a242f41', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b703ea2cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:06,967 [DEBUG] openai._base_client: request_id: req_6dceaa91f4174e83a50429cd2a242f41
2025-08-22 19:21:06,968 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:21:06,968 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:21:06,968 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:21:06,968 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 19:21:06,971 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:06,972 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:06,972 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:06,972 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:06,972 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:06,972 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:06,972 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:10,740 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:10 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3574'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3597'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_9e482c7e0f564431abd831423dc736d5'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b739fa7cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:10,741 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:10,741 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:10,747 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:10,747 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:10,748 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:10,748 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:10 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3574', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3597', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_9e482c7e0f564431abd831423dc736d5', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b739fa7cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:10,748 [DEBUG] openai._base_client: request_id: req_9e482c7e0f564431abd831423dc736d5
2025-08-22 19:21:10,749 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 19:21:10,750 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 19:21:10,750 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 19:21:10,750 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-22 19:21:10,750 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-22 19:21:10,753 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:10,754 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:10,754 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:10,754 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:10,755 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:10,755 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:10,755 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:11,297 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:11 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'354'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'378'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_f69ede03dc914b4fa5a7e95de935635e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b8b399bcc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:11,297 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:11,297 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:11,300 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:11,300 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:11,300 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:11,300 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:11 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '354', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '378', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_f69ede03dc914b4fa5a7e95de935635e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b8b399bcc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:11,300 [DEBUG] openai._base_client: request_id: req_f69ede03dc914b4fa5a7e95de935635e
2025-08-22 19:21:11,301 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 19:21:11,301 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 19:21:11,301 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 19:21:11,305 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:21:11,305 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:21:11,306 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:21:11,306 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:21:11,306 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:21:11,306 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:21:11,306 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:21:11,794 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:21:11 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'309'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'326'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_d613438e91604a6f9ddffa0faa87c5b6'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97340b8eba06cc66-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:21:11,795 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:21:11,795 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:21:11,803 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:21:11,804 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:21:11,804 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:21:11,804 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:21:11 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '309', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '326', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_d613438e91604a6f9ddffa0faa87c5b6', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97340b8eba06cc66-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:21:11,804 [DEBUG] openai._base_client: request_id: req_d613438e91604a6f9ddffa0faa87c5b6
2025-08-22 19:21:11,805 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-22 19:21:11,805 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-22 19:21:11,805 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-22 19:21:11,805 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-22 19:21:11,805 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-22 19:21:11,805 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 19:21:11,805 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-22 19:21:11,806 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-22 19:21:11,806 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 19:21:11,806 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 19:21:11,840 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:21:11,841 [DEBUG] app.services.data_processing_service: Institution list: Centre François-Baclesse (CLCC), Hôpital-clinique Claude-Bernard, Clinique Jean Causse, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital Larrey, Hôpital Nord Franche-Comté-Belfort, Clinique la Pergola, CHU - Institut cœur-poumon, Clinique Saint-François, Centre chirurgical Marie-Lannelongue, Hôpitaux Sud, Médipôle Garonne, Hôpitaux de Saint-Maurice, EPSM de la Marne, Hôpital Henri-Mondor, CMC Floréal, Hôpital privé de l’Estuaire, Clinique Ambroise-Paré, Centre Henri-Becquerel (CLCC), GCS Clinique du Ter, Clinique Tivoli-Ducos, Institut hospitalier Jacques-Cartier, Polyclinique du Maine, Hôpital d'instruction des armées Sainte-Anne, Hôpital Hôtel-Dieu, Clinique Kennedy, CHU - Hôpital de Hautepierre, CH Montfavet, Centre Hospitalier Maurice Despinoy, Clinique de la Part-Dieu, Hôpital privé du Vert-Galant, CHU - Hôpital Claude-Huriez, CHU de Martinique, CH privé du Montgardé, CHU - Hôpital Charles-Nicolle, Hôpital privé Le Bois, Polyclinique de Blois, Hôpital Louis-Mourier, Hôpital Albert Schweitzer, Groupe Hospitalier de la Rochelle, CH Basse-Terre (Guadeloupe), Polyclinique Saint-Roch, Clinique Saint-Pierre, Clinique du Grand-Large, Clinique Bizet, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Amé, CH Charles-Perrens, CH/Clinique, Clinique des Franciscaines, CHU - Hôpital Arnaud-de-Villeneuve, Centre Hospitalier Le Bon Sauveur, Clinique Chantecler, Hôpital Jean-Verdier, CH national d’ophtalmologie des Quinze-Vingts, Hôpital Raymond-Poincaré, Polyclinique Majorelle, CHU - Hôpital civil, EPSM Lille-Métropole, Clinique Bouchard, Institut Arnault-Tzanck, Clinique Esquirol-Saint-Hilaire, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Reims-Bezannes (Marne), HCL - Hôpital Femme-mère-enfant, Polyclinique du Beaujolais, Nouvelle clinique de Tours, Clinique Jean le Bon, CHU - Hôpital Trousseau, Institut Curie, Clinique Victor-Hugo, Clinique Sainte-Marie, Institut mutualiste Montsouris, Maison de santé Bagatelle, Polyclinique Aguilera, Polyclinique de Navarre, CH/clinique, EPS Barthélemy-Durand, Hôpital de la Timone (enfants), Hôpital privé du Confluent, Centre ambulatoire Kleber, Hôpital Tenon, CHU de La Réunion - Félix-Guyon, Hôpital Belle-Isle, CHU - Hôpital Clocheville, Hôpital Robert Schuman, Clinique Saint-Jean-de-Dieu, Polyclinique Médipôle Saint-Roch, Hôpital Cochin, Hôpital privé Jean-Mermoz, Hôpital Saint-Louis, Clinique Belharra, Clinique Saint-André, Centre Hospitalier Les Murets, Les Franciscaines, CHU - Hôpital Pasteur, Clinique du Lac et d’Argonay, Fondation Rothschild, Centre Hospitalier Montperrin, Hôpital privé Clairval, Clinique Saint-Léonard, Clinique Conti, Hôpital Avicenne, CHU - Centre chirurgical Emile-Gallé, Clinique du Pré, Institut de cancérologie Strasbourg Europe, Clinique de Bercy, Clinique du Val-d’Or, CMC Pierre-Cherest, Centre Hospitalier du Rouvray, Polyclinique de Bordeaux-Tondu, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Saint-Paul, CHU de Nantes, Espm de L’agglomeration Lilloise, CH Saint-Joseph-Saint-Luc, CHU Grenoble - Site Nord, Hôpitaux pédiatriques, CHR de Metz-Thionville - Hôpital de Mercy, Centre Hospitalier Henri Guerin, Clinique Delay, Hôpital d'instruction des armées Robert-Picqué, Hôpital d'instruction des armées Percy, Clinique Sainte-Clotilde, Hôpital Louis-Pradel, Polyclinique de Kerio, CHU - Hôpital Pellegrin, Clinique de l’Yvette, Polyclinique, Centre Hospitalier de Vauclaire, Clinique Saint-Hilaire, GHP Ambroise-Paré - Hartmann (92), Polyclinique de Limoges - site Chénieux, Polyclinique Urbain-V, Hôpital Saint-Joseph, Clinique Pasteur-Lanroze, Clinique Axium, GH Saint-Vincent - Clinique Sainte-Barbe, Polyclinique Saint-Jean, Clinique cardiologique, CHU - Hôpital Robert-Debré, Clinique Marcel-Sembat, CHU - Maternité, CH Lyon-Sud, Clinique Lille-Sud, Polyclinique de la Baie, Hôpital privé, Centre cardiologique, GH Paul Guiraud, CHR de Metz-Thionville - Hôpital Bel-Air, Centre de chirurgie ophtalmologique, Hôpital des Massues, Clinique Mathilde, Clinique du Croisé-Laroche, Institut de cancérologie de l’Ouest, CHU - Hôpital Saint-André, Clinique de l'Alma, Institut d’hématologie et d'oncologie pédiatrique, Pôle Santé République, Hôpital privé Nord Parisien, Clinique Toulouse-Lautrec, Clinique du Cambrésis, CHU - Hôpital Pontchaillou, Clinique ophtalmologique Thiers, Centre de la main, Hopital Joseph-Ducuing, CHU de Martinique - site Mère-Enfant, Hôpital privé La Louvière, Médipôle Hôpital Privé, Centre Léon-Bérard (CLCC), CHU - Hôpital Nord, Centre médico-chirurgical et obstétrical, Clinique Saint-Vincent-de-Paul, CH intercommunal, Hôpital privé des Peupliers, Hôpital Paris Saint-Joseph, Centre Hospitalier des Pyrénées, Hôpital Trousseau, Polyclinique La Ligne bleue, Clinique Saint-Charles, EPSM de Saône-et-Loire, ASM, Clinique mutualiste Jules-Verne, Clinique Rhéna, Groupe hospitalier Nord-Essonne, Polyclinique de Keraudren, Polyclinique Francheville, Clinique mutualiste de Bonneveine, Centre Georges-François-Leclerc (CLCC), Polyclinique du Grand-Sud, CHU Réunion, CHU-Hôpital Purpan/HFE, CH privé Saint-Grégoire, Centre orthopédique médico-chirurgical, Polyclinique de Poitiers, Polyclinique Les Fleurs, Clinique Pasteur, Clinique Sainte-Anne, Hôpital privé de La Miotte, Hôpital privé Sévigné, Clinique Turin, Centre Eugène-Marquis (CLCC), Hôpital Antoine-Béclère, Hôpital Saint-Philibert (GHICL), Hôpital privé Armand-Brillard, Clinique Les Fontaines, Centre psychothérapique de Nancy, CHU - Hôpital de l’Archet, Clinique Convert, Institut Curie (CLCC), CHR, Clinique Arago, Clinique Remusat, Centre Psychothérapique, Clinique Honoré-Cave, Clinique mutualiste La Sagesse, CHU - Hôpital Gui-de-Chauliac, Clinique Claude-Bernard, Clinique Ormeau Pyrénées, Polyclinique de Reims-Bezannes, Hôpital Lariboisière, Hôpital de la Croix Rousse (HCL) / CH, Hôpitaux Nord (Croix-Rousse), CHU - Hôpital Bretonneau, Gustave-Roussy (CLCC), Hôpital privé de l’Ouest parisien, Hôpital privé Natecia, Clinique générale, Clinique Maussins-Nollet, Clinique des Cèdres, Hôpitaux civils, Polyclinique du Parc-Drevon, Clinique des Ormeaux, Clinique mutualiste catalane, GH mutualiste, Clinique de l’Europe, Hôpital Foch, Hôpital Saint-Antoine, CHU - site Nord, Centre Hospitalier Sainte-Marie, CH Esquirol, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital de la Côte de nacre, Clinique Les Eaux-Claires, Clinique du sport, Clinique du Diaconat-Roosevelt, Institut Calot, Clinique de Vitrolles (Bouches-du-Rhône), CHI, CHU de Pointe-à-Pitre, Clinique Jouvenet, CHU - Hôpital Sud, Epsan, CH Henri-Laborit, GHI, Institut universitaire de la face et du cou, Polyclinique de Courlancy, Clinique de la Plaine, Clinique du Millénaire, Centre Oscar-Lambret (CLCC), Institut Arthur-Vernes, Hôpital européen Georges-Pompidou, Clinique Charcot, Clinique Saint-Augustin, Clinique Mutualiste de Bretagne Occidentale, Clinique de la Miséricorde, GHU Paris Psychiatrie et neurosciences, Polyclinique Saint-Privat, Centre médico-chirurgical du Mans, Clinique La Croix du Sud, Hôpital Nord, Hôpital privé La Montagne Lambert, Clinique Louis-Pasteur, Institut ophtalmique, Clinique Océane, Hôpital de la Pitié-Salpêtrière, EPS Ville-Évrard, Infirmerie protestante de Lyon, Polyclinique Bordeaux-Nord-Aquitaine, Médipôle de Savoie, CHU - Hôpital de la Cavale-Blanche, Hôpital privé d’Antony, Centre Hospitalier Le Vinatier, Clinique Saint-Jean - Sud de France, Hôtel-Dieu, Institut Jean-Godinot (CLCC), GH, Clinique du Cèdre, Clinique de la Muette, Hôpital privé Arras-Les Bonnettes, Clinique du Parc-Monceau, CHU - Hôpital Dupuytren, Clinique du Pont-de-Chaume, Hôpital Bichat, CH Georges-Daumezon, Clinique du Fief-de-Grimoire, Clinique de l’Orangerie, Hôpital privé de la Casamance, Santé Atlantique, Clinique Clémentville, Clinique du Parc, Clinique mutualiste de la Porte-de-l'Orient, Hôpital de la Timone (Enfants), Clinique de l’Anjou, Hôpital privé Beauregard, Clinique Saint-George, Centre de cardiologie du Pays basque, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpital Rangueil, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de Marne-la-Vallée, Hôpital privé Drôme-Ardèche, Pôle santé Léonard-de-Vinci, Polyclinique Lyon-Nord, Hôpital Privé Nancy Lorraine, CHU Nantes - Hôpital Mère Enfant, Clinique des Orchidées, CHP de l’Europe, Hôpital de la Conception, Hôpital privé Pays-de-Savoie, Polyclinique Vauban, Clinique Paris Lilas, Centre Hospitalier Le Mas Careiron, Clinique d’Occitanie, Polyclinique Saint-François, Hôpital Corentin-Celton, Hôpital privé Paul-d’Égine, CHU - Hôpitaux de Brabois, Hôpital privé Dijon-Bourgogne, Institut du cancer de Montpellier (CLCC), CHU - Hôpital d’Estaing, Polyclinique de Limoges - site Émailleurs, Pôle santé Oréliance, CHU - Hôpital Maison-Blanche, Hôpital privé Vert-Coteau, Hôpital de la Croix-Saint-Simon, Hôpital d'instruction des armées Legouest, CHU Grenoble - Hôpital Sud, Hôpital Bicêtre, Hôpital Ambroise-Paré, Centre de cardiologie Axium-Rambot, Centre Hospitalier Gérard-Marchant, Centre Hospitalier La Chartreuse, CHU - Gabriel-Montpied, Clinique Saint-Joseph, Clinique de l’Estrée, Clinique Victor-Pauchet, Centre Clinical, Grand hôpital de l'Est-Francilien, Polyclinique du Parc, Clinique Bon-Secours, CHU - American Memorial Hospital, CMCO Côte d’Opale, Polyclinique Santa-Maria, Institut Paoli-Calmettes (CLCC), Hôpital européen, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), IUCT/Oncopole, CHU - Hôpital Haut-Lévêque, Nouvel Hôpital de Navarre, Hôpital Paul-Brousse, Hôpital d'instruction des armées Desgenettes, Clinique ambulatoire de Domont, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Polyclinique de la Région-Mantaise, Clinique Rive-Gauche, Clinique du Renaison, Centre Hospitalier d'Erstein, Polyclinique de Picardie, Clinique de Villeneuve-d’Ascq, Hôpital Pierre-Wertheimer, Clinique Saint-Michel, CHU d'Amiens/Institut ophtalmologique de Picardie, Hôpital Beaujon, Hôpital privé des Côtes-d’Armor, Hôpital privé La Châtaigneraie, Nouvelle clinique Bel-Air, Euromed Cardio, Hôpital de la Timone (adultes), EPSM Morbihan, Clinique Sainte-Marie (GHICL), EPSM Etienne-Gourmelen, Pôle de Santé du Villeneuvois, Hôpital Robert-Debré, Clinique Fontvert, Polyclinique Bordeaux-Rive droite, CHU - Hôpital Saint-Eloi, Institut Bergonié (CLCC), Hôpital Lariboisière-Fernand Widal, Clinique de l'Essonne, Clinique Saint-Antoine, CHU Sud-Réunion, CHU - Hôpital Roger-Salengro, Clinique mutualiste, CH Guillaume-Régnier, CM Bénigne-Joly, Clinique Anne-Artois, Hôpital privé de l’Est lyonnais, Clinique mutualiste de l’Estuaire, Clinique Notre-Dame-de-l’Espérance, Hôpital privé de Marne Chantereine, Clinique du Tertre-Rouge, Polyclinique Côte-Basque-Sud, CHU - Hôpital Purpan, Clinique Ormeau centre, Clinique du Diaconat-Fonderie, Polyclinique Saint-Côme, CH privé Claude-Galien, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital des Diaconesses, CH Édouard-Toulouse, Clinique de la Sauvegarde, CMC de Parly-II, Institut franco-britannique Kléber, Clinique du Val-d’Ouest Vendôme, Clinique Durieux, CH privé Saint-Martin, Clinique Saint-Vincent, Clinique Trenel, Centre Hospitalier George Sand, Centre Jean-Perrin (CLCC), Polyclinique Saint Laurent, Hôpital Necker-Enfants-Malades, Hôpital Renée-Sabran, Hôpital privé Paris-Essonne, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Laveran, Clinique de l’Espérance, Clinique Rhône Durance, Polyclinique Jean-Villar, CMCO, Hôpital privé de la Seine-Saint-Denis, Clinique du Trocadéro, CHU d’Amiens, Clinique Belledonne, Clinique Beau-Soleil, Clinique Monticelli-Vélodrome, Clinique Juge, Hôpital privé de Provence, Hôpital Saint-Camille, Hôpital privé Saint-Martin, Hôpital privé de la Loire, Clinique Bretéché, Hôpital privé Cannes-Oxford, Hôpital d'instruction des armées Bégin, Clinique de l’Union, CHU - Hôpital Morvan, Centre cardiologique du Nord, Hôpital Edouard-Herriot, Clinique de l’Atlantique, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Lapeyronie, CHU - Hôpital Central, CHU - Hôpitaux mère-enfants, Clinique urologique Nantes-Atlantis, IUCT Oncopole, Clinique Saint-Nabor, Centre Hospitalier Drôme Vivarais
2025-08-22 19:21:11,841 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 19:21:11,997 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 19:21:11,997 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-22 19:21:11,997 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-22 19:21:11,998 [INFO] app.services.data_processing_service: generate_data_response called
2025-08-22 19:21:11,998 [DEBUG] app.services.data_processing_service: Extracted values - specialty: 'Cancer de la vessie', institution_type: 'aucune correspondance', city: 'Paris'
2025-08-22 19:21:11,998 [DEBUG] app.services.data_processing_service: No institution type match found, loading by specialty only
2025-08-22 19:21:11,998 [INFO] app.services.data_processing_service: Filtering ranking by criteria: specialty='Cancer de la vessie', institution_type='None'
2025-08-22 19:21:11,998 [DEBUG] app.services.data_processing_service: Filtering ranking data - specialty: 'Cancer de la vessie', institution_type: 'None'
2025-08-22 19:21:11,998 [DEBUG] app.services.data_processing_service: Specialty type: <class 'str'>, length: 19
2025-08-22 19:21:11,998 [DEBUG] app.services.data_processing_service: Available specialties in ranking data: ['Ablation des varices' 'Accidents vasculaires cérébraux'
 'Accouchements à risques' 'Accouchements normaux'
 'Adénome de la prostate' 'Amygdales et végétations'
 'Angioplastie coronaire' 'Appendicite' 'Arthrose de la main' 'Audition'
 'Calculs urinaires' "Cancer de l'estomac et de l'œsophage"
 "Cancer de l'ovaire" "Cancer de l'utérus" 'Cancer de la prostate'
 'Cancer de la thyroïde' 'Cancer de la vessie'
 "Cancer des os de l'enfant et de l'adolescent"
 "Cancer du colon ou de l'intestin" 'Cancer du foie' 'Cancer du pancréas'
 'Cancer du poumon' 'Cancer du rein' 'Cancer du sein' 'Cancer ORL'
 'Cancers de la peau' 'Cardiologie interventionnelle' 'Cataracte'
 'Chirurgie cardiaque adulte' 'Chirurgie cardiaque pédiatrique'
 "Chirurgie de l'épaule" "Chirurgie de l'obésité"
 'Chirurgie de la cheville' 'Chirurgie de la cornée'
 'Chirurgie dentaire et orale de l’adulte'
 'Chirurgie dentaire et orale de l’enfant et de l’adolescent'
 'Chirurgie des artères' "Chirurgie des cancers osseux de l'adulte"
 'Chirurgie des carotides' 'Chirurgie des sarcomes des tissus mous'
 "Chirurgie des testicules de l'adulte"
 "Chirurgie des testicules de l'enfant et de l'adolescent"
 'Chirurgie du canal carpien' "Chirurgie du dos de l'adulte"
 "Chirurgie du dos de l'enfant et de l'adolescent"
 'Chirurgie du nez et des sinus' 'Chirurgie du pied' 'Chirurgie du rectum'
 'Chirurgie maxillo-faciale' 'Dépression' "Diabète de l'adulte"
 "Diabète de l'enfant et de l'adolescent" 'Endométriose'
 "Epilepsie de l'adulte" "Epilepsie de l'enfant et de l'adolescent"
 'Fibrome utérin' 'Glandes salivaires' 'Glaucome' "Hernies de l'abdomen"
 'Hypertension artérielle' 'Infarctus du myocarde'
 'Insuffisance cardiaque' "Leucémie de l'adulte"
 "Leucémie de l'enfant et de l'adolescent" 'Ligaments du genou'
 "Lymphome-Myélome de l'adulte" 'Maladie de Parkinson'
 "Maladies inflammatoires chroniques de l'intestin (MICI)"
 'Médecine vasculaire' 'Pneumologie' 'Proctologie' 'Prothèse de genou'
 'Prothèse de hanche' 'Rétine' 'Schizophrénie' 'Sclérose en plaques'
 'Stimulateurs cardiaques' 'Strabisme'
 'Stress post-traumatique de l’adulte' 'Troubles bipolaires'
 "Tumeurs du cerveau de l'adulte"
 "Tumeurs du cerveau de l'enfant et de l'adolescent" 'Urgences de la main'
 'Vésicule biliaire']
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Accidents vasculaires cérébraux
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements à risques
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements normaux
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-22 19:21:11,999 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'estomac et de l'œsophage
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-22 19:21:12,000 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer des os de l'enfant et de l'adolescent
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du foie
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du pancréas
2025-08-22 19:21:12,001 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cancers de la peau
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-22 19:21:12,002 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque pédiatrique
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-22 19:21:12,003 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des cancers osseux de l'adulte
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des sarcomes des tissus mous
2025-08-22 19:21:12,004 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'enfant et de l'adolescent
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du rectum
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-22 19:21:12,005 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Dépression
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'adulte
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'enfant et de l'adolescent
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'adulte
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'enfant et de l'adolescent
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-22 19:21:12,006 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Hypertension artérielle
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Insuffisance cardiaque
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'adulte
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'enfant et de l'adolescent
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-22 19:21:12,007 [DEBUG] app.services.data_processing_service: Normalizing string: Lymphome-Myélome de l'adulte
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Maladie de Parkinson
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Maladies inflammatoires chroniques de l'intestin (MICI)
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Médecine vasculaire
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-22 19:21:12,008 [DEBUG] app.services.data_processing_service: Normalizing string: Schizophrénie
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Sclérose en plaques
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Stress post-traumatique de l’adulte
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Troubles bipolaires
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'adulte
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'enfant et de l'adolescent
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-22 19:21:12,009 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-22 19:21:12,011 [DEBUG] app.services.data_processing_service: Normalized specialties in DataFrame: ["'ablation des varices'", "'accidents vasculaires cerebraux'", "'accouchements a risques'", "'accouchements normaux'", "'adenome de la prostate'", "'amygdales et vegetations'", "'angioplastie coronaire'", "'appendicite'", "'arthrose de la main'", "'audition'", "'calculs urinaires'", '"cancer de l\'estomac et de l\'œsophage"', '"cancer de l\'ovaire"', '"cancer de l\'uterus"', "'cancer de la prostate'", "'cancer de la thyroide'", "'cancer de la vessie'", '"cancer des os de l\'enfant et de l\'adolescent"', '"cancer du colon ou de l\'intestin"', "'cancer du foie'", "'cancer du pancreas'", "'cancer du poumon'", "'cancer du rein'", "'cancer du sein'", "'cancer orl'", "'cancers de la peau'", "'cardiologie interventionnelle'", "'cataracte'", "'chirurgie cardiaque adulte'", "'chirurgie cardiaque pediatrique'", '"chirurgie de l\'epaule"', '"chirurgie de l\'obesite"', "'chirurgie de la cheville'", "'chirurgie de la cornee'", "'chirurgie dentaire et orale de l’adulte'", "'chirurgie dentaire et orale de l’enfant et de l’adolescent'", "'chirurgie des arteres'", '"chirurgie des cancers osseux de l\'adulte"', "'chirurgie des carotides'", "'chirurgie des sarcomes des tissus mous'", '"chirurgie des testicules de l\'adulte"', '"chirurgie des testicules de l\'enfant et de l\'adolescent"', "'chirurgie du canal carpien'", '"chirurgie du dos de l\'adulte"', '"chirurgie du dos de l\'enfant et de l\'adolescent"', "'chirurgie du nez et des sinus'", "'chirurgie du pied'", "'chirurgie du rectum'", "'chirurgie maxillo-faciale'", "'depression'", '"diabete de l\'adulte"', '"diabete de l\'enfant et de l\'adolescent"', "'endometriose'", '"epilepsie de l\'adulte"', '"epilepsie de l\'enfant et de l\'adolescent"', "'fibrome uterin'", "'glandes salivaires'", "'glaucome'", '"hernies de l\'abdomen"', "'hypertension arterielle'", "'infarctus du myocarde'", "'insuffisance cardiaque'", '"leucemie de l\'adulte"', '"leucemie de l\'enfant et de l\'adolescent"', "'ligaments du genou'", '"lymphome-myelome de l\'adulte"', "'maladie de parkinson'", '"maladies inflammatoires chroniques de l\'intestin (mici)"', "'medecine vasculaire'", "'pneumologie'", "'proctologie'", "'prothese de genou'", "'prothese de hanche'", "'retine'", "'schizophrenie'", "'sclerose en plaques'", "'stimulateurs cardiaques'", "'strabisme'", "'stress post-traumatique de l’adulte'", "'troubles bipolaires'", '"tumeurs du cerveau de l\'adulte"', '"tumeurs du cerveau de l\'enfant et de l\'adolescent"', "'urgences de la main'", "'vesicule biliaire'"]
2025-08-22 19:21:12,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 19:21:12,012 [DEBUG] app.services.data_processing_service: Normalized specialty from query: ''cancer de la vessie''
2025-08-22 19:21:12,012 [DEBUG] app.services.data_processing_service: Found 2 rows matching single specialty 'Cancer de la vessie' (normalized: 'cancer de la vessie')
2025-08-22 19:21:12,013 [DEBUG] app.services.data_processing_service: Specialties found after specialty filtering: ['Cancer de la vessie']
2025-08-22 19:21:12,013 [INFO] app.services.data_processing_service: generate_response_links called with matching_rows: <class 'pandas.core.frame.DataFrame'>
2025-08-22 19:21:12,013 [INFO] app.services.data_processing_service: Generating ranking links
2025-08-22 19:21:12,013 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-22 19:21:12,013 [DEBUG] app.services.data_processing_service: Generating links for 2 matching rows
2025-08-22 19:21:12,013 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Public
2025-08-22 19:21:12,013 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'public'
2025-08-22 19:21:12,013 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Privé
2025-08-22 19:21:12,014 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'prive'
2025-08-22 19:21:12,014 [INFO] app.services.data_processing_service: Generated ranking links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-22 19:21:12,014 [INFO] app.services.data_processing_service: load_excel_sheets called with matching_rows of length: 2
2025-08-22 19:21:12,014 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Public' for category: 'Public'
2025-08-22 19:21:12,164 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Public' loaded successfully with 40 rows
2025-08-22 19:21:12,164 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Privé' for category: 'Privé'
2025-08-22 19:21:12,309 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Privé' loaded successfully with 20 rows
2025-08-22 19:21:12,309 [DEBUG] app.services.data_processing_service: Concatenating 2 dataframes
2025-08-22 19:21:12,310 [INFO] app.services.data_processing_service: Successfully loaded 2 sheets, total rows: 60
2025-08-22 19:21:12,310 [INFO] app.services.data_processing_service: Loaded specialty DataFrame
2025-08-22 19:21:12,310 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique specialties in DataFrame: N/A
2025-08-22 19:21:12,310 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique institution types in DataFrame: ['Public' 'Privé']
2025-08-22 19:21:12,310 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame columns: Index(['Rang', 'Etablissement', 'Finess', 'ACTIVITE', 'NOTORIETE', 'DMS',
       'RATIO_AMBU', 'INDICE_LOURDEUR', 'TX_ENDOSCOPIE', 'PRADO', 'Note / 20',
       'Catégorie'],
      dtype='object')
2025-08-22 19:21:12,324 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame head:    Rang                                      Etablissement     Finess  ...  PRADO  Note / 20  Catégorie
0     1         Institut mutualiste Montsouris, Paris (75)  750150104  ...    1.0      18.63     Public
1     2                        Hôpital Foch, Suresnes (92)  920000650  ...    1.0      18.50     Public
2     3                    Hôpital Saint-Louis, Paris (75)  750100075  ...    1.0      18.27     Public
3     4      Hôpital européen Georges-Pompidou, Paris (75)  750803447  ...    1.0      18.26     Public
4     5               Hôpital Robert Schuman, Vantoux (57)  570026252  ...    1.0      18.25     Public
5     6  Clinique mutualiste de la Porte-de-l'Orient, L...  560002933  ...    1.0      18.25     Public
6     7             CHU - Hôpital Pellegrin, Bordeaux (33)  330781360  ...    1.0      18.19     Public
7     8                   Hôpital européen, Marseille (13)  130043664  ...    1.0      17.91     Public
8     9         CHU - Hôpital Lapeyronie, Montpellier (34)  340785161  ...    1.0      17.90     Public
9    10             Hôpital Paris Saint-Joseph, Paris (75)  750000523  ...    1.0      17.84     Public

[10 rows x 12 columns]
2025-08-22 19:21:12,324 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Filtering for specialty: 'Cancer de la vessie' and city: 'Paris'
2025-08-22 19:21:12,324 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Specialty match count: N/A
2025-08-22 19:21:12,324 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] City match count: N/A
2025-08-22 19:21:12,324 [INFO] app.services.pipeline_orchestrator_service: Extracting hospital locations and calculating distances
2025-08-22 19:21:12,324 [INFO] app.services.data_processing_service: extract_local_hospitals called with df: <class 'NoneType'>
2025-08-22 19:21:12,324 [INFO] app.services.data_processing_service: Merging ranking data with hospital location data
2025-08-22 19:21:12,328 [DEBUG] app.services.data_processing_service: Merged DataFrame shape (with cities): (60, 6)
2025-08-22 19:21:12,328 [INFO] app.services.data_processing_service: get_df_with_distances called
2025-08-22 19:21:12,328 [INFO] app.services.data_processing_service: Calculating distances from query city: Paris
2025-08-22 19:21:12,366 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-22 19:21:12,366 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-22 19:21:12,366 [DEBUG] geopy: Nominatim.geocode: https://nominatim.openstreetmap.org/search?q=Paris&format=json&limit=1
2025-08-22 19:21:12,367 [DEBUG] urllib3.connectionpool: Starting new HTTPS connection (1): nominatim.openstreetmap.org:443
2025-08-22 19:21:13,348 [DEBUG] urllib3.connectionpool: https://nominatim.openstreetmap.org:443 "GET /search?q=Paris&format=json&limit=1 HTTP/1.1" 200 444
2025-08-22 19:21:13,351 [DEBUG] app.services.data_processing_service: Query city coordinates: (48.8534951, 2.3483915)
2025-08-22 19:21:13,402 [DEBUG] app.services.data_processing_service: DataFrame with distances shape after filtering: (60, 7)
2025-08-22 19:21:13,403 [DEBUG] app.services.data_processing_service: Distance column values after filtering: [397.16421568228793, 664.5671165057212, 415.42021849676877, 454.6232692587221, 628.9272762614704, 372.76695725398446, 187.64257370100052, 346.44804063177855, 204.9061679313438, 345.3834222363833, 594.4783082353262, 409.73559161431035, 498.73884900510325, 308.98876258531186, 587.6020165018895, 201.6803175167258, 281.9666122654773, 113.41737487155112, 264.6693413955004, 578.6238060003169, 16.726792716267678, 587.6020165018895, 440.6409364823054, 398.5542834873119, 498.73884900510325, 547.7564737199306, 264.6693413955004, 684.864748960447, 441.30736307891743, 382.66401151108664, 409.73559161431035, 481.9811724587299, 0.0, 4.592712151579527, 9.217278413662884, 11.453781374536742, 364.4347650853049, 0.0, 282.41401459727837, 285.7997399851394, 0.0, 0.0, 660.3147713621365, 0.0, 0.0, 660.3147713621365, 204.9061679313438, 638.1373345264166, 378.3676161619013, 380.29745819875353, 660.3147713621365, 0.0, 498.73884900510325, 687.7062403382804, 613.2211062491715, 506.307887243086, 345.3834222363833, 652.4186260952922, 588.3439902102477, 578.6238060003169]
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned DataFrame: <class 'pandas.core.frame.DataFrame'>
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Checking if DataFrame is None
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Retrieved DataFrame shape: (60, 7)
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Checking for geolocation API errors
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Getting ranking link for UI
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Checking for specialty_ranking_unavailable
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Checking if institution is mentioned
2025-08-22 19:21:13,403 [DEBUG] app.services.pipeline_orchestrator_service: Checking if city is detected
2025-08-22 19:21:13,403 [INFO] app.services.pipeline_orchestrator_service: City found, searching for results using multi-radius search
2025-08-22 19:21:13,407 [DEBUG] multi_radius_search: [multi_radius_search] Called with radii: [5, 10, 50, 100]
2025-08-22 19:21:13,407 [DEBUG] multi_radius_search: [multi_radius_search] Initial public_df shape: (3, 7)
2025-08-22 19:21:13,407 [DEBUG] multi_radius_search: [multi_radius_search] Initial private_df shape: (3, 7)
2025-08-22 19:21:13,407 [DEBUG] multi_radius_search: [multi_radius_search] Trying radius: 5
2025-08-22 19:21:13,408 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered shape: (2, 7)
2025-08-22 19:21:13,408 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered shape: (0, 7)
2025-08-22 19:21:13,414 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered head:                                  Etablissement   City   Latitude  Longitude Catégorie  Note / 20  Distance
51  Institut mutualiste Montsouris, Paris (75)  Paris  48.853495   2.348391    Public      18.63       0.0
40             Hôpital Saint-Louis, Paris (75)  Paris  48.853495   2.348391    Public      18.27       0.0
2025-08-22 19:21:13,414 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered head: Empty DataFrame
Columns: [Etablissement, City, Latitude, Longitude, Catégorie, Note / 20, Distance]
Index: []
2025-08-22 19:21:13,415 [DEBUG] multi_radius_search: [multi_radius_search] Trying radius: 10
2025-08-22 19:21:13,415 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered shape: (3, 7)
2025-08-22 19:21:13,415 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered shape: (0, 7)
2025-08-22 19:21:13,421 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered head:                                  Etablissement      City   Latitude  Longitude Catégorie  Note / 20  Distance
51  Institut mutualiste Montsouris, Paris (75)     Paris  48.853495   2.348391    Public      18.63  0.000000
34                 Hôpital Foch, Suresnes (92)  Suresnes  48.870905   2.225573    Public      18.50  9.217278
40             Hôpital Saint-Louis, Paris (75)     Paris  48.853495   2.348391    Public      18.27  0.000000
2025-08-22 19:21:13,421 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered head: Empty DataFrame
Columns: [Etablissement, City, Latitude, Longitude, Catégorie, Note / 20, Distance]
Index: []
2025-08-22 19:21:13,421 [DEBUG] multi_radius_search: [multi_radius_search] Returning results at radius 10
2025-08-22 19:21:13,422 [DEBUG] app.services.pipeline_orchestrator_service: Formatting response with specialty: base_message='Voici les meilleurs établissements (rayon utilisé : 10 km)', count=3, radius_km=10, city=Paris
2025-08-22 19:21:13,422 [DEBUG] app.services.pipeline_orchestrator_service: Normalizing specialty for display: Cancer de la vessie
2025-08-22 19:21:13,422 [INFO] app.services.pipeline_orchestrator_service: Creating response and logging for prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-22 19:21:13,422 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-22 19:21:13,423 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-22 19:21:13,423 [DEBUG] app.services.pipeline_orchestrator_service: Formatted response: Voici les meilleurs établissements (rayon utilisé : 10 km)
<br>Aucun établissement privé trouvé.<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public situé à 0 km. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public situé à 9 km. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public situé à 0 km. avec une note de 18.27 de 20

🔗 Consultez la méthodologie de palmarès hopitaux <a href="https://www.lepoint.fr/sante/la-methodologie-du-palmares-des-hopitaux-et-cliniques-du-point-2024--04-12-2024-2577146_40.php" target="_blank">ici</a>.
2025-08-22 19:21:13,423 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 2
2025-08-22 19:26:57,387 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:26:57,387 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:26:57,388 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:26:57,388 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:26:57,388 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:26:57,389 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:26:57,389 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:26:57,390 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:26:57,538 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:26:57,539 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:26:57,539 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:26:57,543 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:26:57,543 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:26:57,748 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:26:57,748 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:26:57,748 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:26:57,749 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:26:57,749 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:26:57,749 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:26:57,824 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:26:57,824 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:26:57,824 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:26:57,826 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:26:57,826 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:26:57,826 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:26:57,826 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:26:57,826 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:26:57,829 [INFO] main: Creating FastAPI app
2025-08-22 19:26:57,829 [INFO] main: CORS middleware added
2025-08-22 19:26:57,832 [INFO] main: API router included
2025-08-22 19:27:08,084 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:27:08,084 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:27:08,084 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:27:08,084 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:27:08,084 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:27:08,085 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:27:08,085 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:27:08,085 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:27:08,214 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:27:08,214 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:27:08,215 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:27:08,217 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:27:08,217 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:27:08,365 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:27:08,365 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:27:08,365 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:27:08,366 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:27:08,366 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:27:08,366 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:27:08,438 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:27:08,438 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:27:08,438 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:27:08,440 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:27:08,440 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:27:08,440 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:27:08,440 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:27:08,441 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:27:08,442 [INFO] main: Creating FastAPI app
2025-08-22 19:27:08,443 [INFO] main: CORS middleware added
2025-08-22 19:27:08,444 [INFO] main: API router included
2025-08-22 19:31:28,354 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:31:28,354 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:31:28,355 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:31:28,355 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:31:28,355 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:31:28,356 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:31:28,356 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:31:28,356 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:31:28,493 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:31:28,493 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:31:28,493 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:31:28,496 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:31:28,496 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:31:28,647 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:31:28,647 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:31:28,647 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:31:28,648 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:31:28,648 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:31:28,648 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:31:28,720 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:31:28,720 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:31:28,720 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:31:28,722 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:31:28,723 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:31:28,723 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:31:28,723 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:31:28,723 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:31:28,724 [INFO] main: Creating FastAPI app
2025-08-22 19:31:28,725 [INFO] main: CORS middleware added
2025-08-22 19:31:28,726 [INFO] main: API router included
2025-08-22 19:32:55,656 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:32:55,656 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:32:55,657 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:32:55,657 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:32:55,657 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:32:55,657 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:32:55,658 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:32:55,658 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:32:55,786 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:32:55,786 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:32:55,787 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:32:55,789 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:32:55,790 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:32:55,943 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:32:55,943 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:32:55,943 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:32:55,944 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:32:55,944 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:32:55,944 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:32:56,015 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:32:56,015 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:32:56,015 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:32:56,017 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:32:56,017 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:32:56,017 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:32:56,017 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:32:56,017 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:32:56,019 [INFO] main: Creating FastAPI app
2025-08-22 19:32:56,019 [INFO] main: CORS middleware added
2025-08-22 19:32:56,021 [INFO] main: API router included
2025-08-22 19:36:58,159 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:36:58,159 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:36:58,159 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:36:58,159 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:36:58,159 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:36:58,160 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:36:58,160 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:36:58,161 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:36:58,291 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:36:58,291 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:36:58,291 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:36:58,294 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:36:58,294 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:36:58,443 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:36:58,444 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:36:58,444 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:36:58,444 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:36:58,445 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:36:58,445 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:36:58,517 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:36:58,517 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:36:58,517 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:36:58,519 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:36:58,519 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:36:58,519 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:36:58,519 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:36:58,520 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:36:58,521 [INFO] main: Creating FastAPI app
2025-08-22 19:36:58,522 [INFO] main: CORS middleware added
2025-08-22 19:36:58,523 [INFO] main: API router included
2025-08-22 19:38:51,739 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:38:51,739 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:38:51,739 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:38:51,740 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:38:51,740 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:38:51,741 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:38:51,741 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:38:51,741 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:38:51,878 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:38:51,878 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:38:51,878 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:38:51,881 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:38:51,881 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:38:52,032 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:38:52,032 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:38:52,032 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:38:52,033 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:38:52,033 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:38:52,033 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:38:52,105 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:38:52,105 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:38:52,105 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:38:52,107 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:38:52,107 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:38:52,107 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:38:52,107 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:38:52,107 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:38:52,109 [INFO] main: Creating FastAPI app
2025-08-22 19:38:52,109 [INFO] main: CORS middleware added
2025-08-22 19:38:52,111 [INFO] main: API router included
2025-08-22 19:42:45,044 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:42:45,044 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:42:45,045 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:42:45,045 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:42:45,045 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:42:45,046 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:42:45,046 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:42:45,046 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:42:45,177 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:42:45,177 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:42:45,177 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:42:45,180 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:42:45,180 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:42:45,331 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:42:45,331 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:42:45,331 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:42:45,332 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:42:45,332 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:42:45,332 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:42:45,404 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:42:45,404 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:42:45,404 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:42:45,406 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:42:45,406 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:42:45,406 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:42:45,406 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:42:45,406 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:42:45,408 [INFO] main: Creating FastAPI app
2025-08-22 19:42:45,408 [INFO] main: CORS middleware added
2025-08-22 19:42:45,409 [INFO] main: API router included
2025-08-22 19:45:06,857 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:45:06,857 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:45:06,857 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:45:06,858 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:45:06,858 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:45:06,859 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:45:06,859 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:45:06,859 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:45:06,992 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:45:06,992 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:45:06,992 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:45:06,995 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:45:06,995 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:45:07,155 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:45:07,155 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:45:07,155 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:45:07,156 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:45:07,156 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:45:07,156 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:45:07,229 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:45:07,229 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:45:07,230 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:45:07,231 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:45:07,232 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:45:07,232 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:45:07,232 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:45:07,232 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:45:07,233 [INFO] main: Creating FastAPI app
2025-08-22 19:45:07,234 [INFO] main: CORS middleware added
2025-08-22 19:45:07,235 [INFO] main: API router included
2025-08-22 19:46:41,443 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:46:41,443 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:46:41,443 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:46:41,444 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:46:41,444 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:46:41,444 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:46:41,445 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:46:41,445 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:46:41,693 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:46:41,693 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:46:41,693 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:46:41,700 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:46:41,700 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:46:41,937 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:46:41,937 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:46:41,937 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:46:41,938 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:46:41,938 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:46:41,938 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:46:42,014 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:46:42,014 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:46:42,014 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:46:42,016 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:46:42,016 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:46:42,016 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:46:42,016 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:46:42,016 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:46:42,018 [INFO] main: Creating FastAPI app
2025-08-22 19:46:42,019 [INFO] main: CORS middleware added
2025-08-22 19:46:42,021 [INFO] main: API router included
2025-08-22 19:48:29,400 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:48:29,401 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:48:29,401 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:48:29,401 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:48:29,401 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:48:29,402 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:48:29,402 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:48:29,402 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:48:29,551 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:48:29,552 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:48:29,552 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:48:29,556 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:48:29,556 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:48:29,761 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:48:29,761 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:48:29,761 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:48:29,762 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:48:29,762 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:48:29,762 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:48:29,838 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:48:29,839 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:48:29,839 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:48:29,841 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:48:29,841 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:48:29,841 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:48:29,841 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:48:29,841 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:48:29,843 [INFO] main: Creating FastAPI app
2025-08-22 19:48:29,843 [INFO] main: CORS middleware added
2025-08-22 19:48:29,844 [INFO] main: API router included
2025-08-22 19:48:33,171 [INFO] app.api.routes: Received /ask request with prompt length: 85 chars, specialty: 
2025-08-22 19:48:33,172 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, detected_specialty: 
2025-08-22 19:48:33,172 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-22 19:48:33,172 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conversation=[], conv_history=, checks_to_run=None
2025-08-22 19:48:33,172 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-22 19:48:33,180 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:33,209 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:33,210 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-22 19:48:33,250 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x117631010>
2025-08-22 19:48:33,250 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x116db8440> server_hostname='api.openai.com' timeout=None
2025-08-22 19:48:33,269 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1175e9090>
2025-08-22 19:48:33,269 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:33,270 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:33,270 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:33,270 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:33,270 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:33,802 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'315'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'337'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998875'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_cd95c2d7719a4543b108301feb51721f'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=5y47.RZ1qEwdbFjaCuv063nnuPlIfQ1.YvclfN6Y_.w-1755884913-1.0.1.1-42dNhskcK1IpSPSgfnCFyot0BQBKODgAuaPYCNK6XryCh_UoBDRWFTschsOrpkJbOoXmshLuaIN1Q57JgFFqTkySJ3b.mp2cRBDiGD6MwkE; path=/; expires=Fri, 22-Aug-25 18:18:33 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=ESb_iey7Y7Ov_lxrqXTNFyXz6qgI58hp5JHugPX26us-1755884913924-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433a4ca6d5014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:33,804 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:33,804 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:33,804 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:33,804 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:33,804 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:33,804 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Fri, 22 Aug 2025 17:48:33 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '315'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '337'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998875'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_cd95c2d7719a4543b108301feb51721f'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=5y47.RZ1qEwdbFjaCuv063nnuPlIfQ1.YvclfN6Y_.w-1755884913-1.0.1.1-42dNhskcK1IpSPSgfnCFyot0BQBKODgAuaPYCNK6XryCh_UoBDRWFTschsOrpkJbOoXmshLuaIN1Q57JgFFqTkySJ3b.mp2cRBDiGD6MwkE; path=/; expires=Fri, 22-Aug-25 18:18:33 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=ESb_iey7Y7Ov_lxrqXTNFyXz6qgI58hp5JHugPX26us-1755884913924-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '973433a4ca6d5014-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-22 19:48:33,805 [DEBUG] openai._base_client: request_id: req_cd95c2d7719a4543b108301feb51721f
2025-08-22 19:48:33,811 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-22 19:48:33,812 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-22 19:48:33,815 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:33,816 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:33,816 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:33,816 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:33,816 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:33,817 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:33,817 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:34,399 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:34 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'347'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'423'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999166'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'5ms'), (b'x-request-id', b'req_44a6f4acc5d440a89fbeb9b0bd1c103a'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433a83b355014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:34,400 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:34,400 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:34,404 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:34,405 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:34,405 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:34,405 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:34 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '347', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '423', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999166', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '5ms', 'x-request-id': 'req_44a6f4acc5d440a89fbeb9b0bd1c103a', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433a83b355014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:34,406 [DEBUG] openai._base_client: request_id: req_44a6f4acc5d440a89fbeb9b0bd1c103a
2025-08-22 19:48:34,407 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-22 19:48:34,407 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?', detected_specialty='no specialty match', conv_history=''
2025-08-22 19:48:34,407 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 19:48:34,407 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 19:48:34,407 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 19:48:34,408 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 19:48:34,563 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:48:34,563 [DEBUG] app.services.data_processing_service: Institution list: Clinique la Pergola, Clinique de la Muette, Hôpital privé Jean-Mermoz, Clinique Ormeau centre, EPSM de Saône-et-Loire, Clinique Saint-Hilaire, EPSM Morbihan, Hôpital privé Paris-Essonne, Centre Georges-François-Leclerc (CLCC), Hôpital Hôtel-Dieu, Polyclinique du Parc, Clinique du sport, Hôpital Louis-Pradel, GCS Clinique du Ter, Centre Hospitalier Le Mas Careiron, Institut Arthur-Vernes, Hôpital Corentin-Celton, CHU - Hôpital Dupuytren, Hôpital Louis-Mourier, Centre Hospitalier Montperrin, Hôpital Privé Nancy Lorraine, Maison de santé Bagatelle, Hôpital Jean-Verdier, CHU - Hôpital Sud, Polyclinique Majorelle, Clinique Sainte-Marie (GHICL), Hôpital Beaujon, Médipôle Garonne, Institut hospitalier Jacques-Cartier, CH Henri-Laborit, Polyclinique Santa-Maria, Espm de L’agglomeration Lilloise, Clinique Lille-Sud, Clinique Juge, CHU - Hôpital Maison-Blanche, Clinique Saint-Antoine, CHU - Hôpital Purpan, EPSM Lille-Métropole, CH privé Saint-Grégoire, CH intercommunal, Hôtel-Dieu, Hôpital Nord Franche-Comté-Belfort, Hôpital privé Paul-d’Égine, Clinique Saint-André, Centre Oscar-Lambret (CLCC), Centre psychothérapique de Nancy, Centre Clinical, CH Saint-Joseph-Saint-Luc, Clinique Saint-Pierre, CH Montfavet, CHU de Nantes, Centre Hospitalier d'Erstein, Polyclinique de Bordeaux-Tondu, Hôpital de la Conception, Clinique Chantecler, Clinique Victor-Pauchet, Clinique du Cambrésis, Clinique Beau-Soleil, Polyclinique de Courlancy, Clinique Remusat, Clinique Convert, Institut ophtalmique, Hôpital privé de Provence, GHP Ambroise-Paré - Hartmann (92), CHU de Pointe-à-Pitre, Epsan, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique du Renaison, CHU - Hôpital Morvan, GHI, Groupe hospitalier Nord-Essonne, Hôpital européen Georges-Pompidou, Clinique cardiologique, Hôpital Albert Schweitzer, Polyclinique de Keraudren, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Pontchaillou, Clinique mutualiste Jules-Verne, CMC Floréal, CHU - Hôpitaux de Brabois, GHU Paris Psychiatrie et neurosciences, Clinique de Vitrolles (Bouches-du-Rhône), CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital des Massues, Centre Hospitalier Maurice Despinoy, Hôpitaux Sud, IUCT/Oncopole, Polyclinique La Ligne bleue, Hôpital Foch, CH Lyon-Sud, Hôpital Avicenne, Polyclinique Saint-François, Polyclinique Côte-Basque-Sud, GH mutualiste, Clinique Saint-Michel, Clinique mutualiste catalane, Clinique Louis-Pasteur, Centre Hospitalier Sainte-Marie, Clinique Rhône Durance, Hôpital privé de Marne Chantereine, CHU de Martinique, Les Franciscaines, IUCT Oncopole, CHU - Centre chirurgical Emile-Gallé, CHU - Hôpital Pellegrin, Polyclinique de la Région-Mantaise, Clinique de l’Union, Hôpitaux civils, EPSM de la Marne, Hôpital Edouard-Herriot, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital privé Beauregard, Nouvelle clinique de Tours, Polyclinique de Reims-Bezannes (Marne), Hôpital privé de la Casamance, Clinique mutualiste de l’Estuaire, Clinique des Cèdres, Hôpital Necker-Enfants-Malades, Institut universitaire de la face et du cou, CMCO Côte d’Opale, GH Saint-Vincent - Clinique Sainte-Barbe, CHU - Hôpital Pasteur, Gustave-Roussy (CLCC), Polyclinique du Parc-Drevon, Polyclinique du Grand-Sud, Infirmerie protestante de Lyon, Clinique Saint-Léonard, Clinique Trenel, Polyclinique Médipôle Saint-Roch, CHU d’Amiens, CH Basse-Terre (Guadeloupe), Institut Arnault-Tzanck, Clinique Saint-Paul, Polyclinique de Limoges - site Émailleurs, Hôpital Saint-Antoine, Centre de chirurgie ophtalmologique, Clinique Sainte-Marie, Hôpital privé Natecia, CHR de Metz-Thionville - Hôpital de Mercy, Centre orthopédique médico-chirurgical, Institut de cancérologie de l’Ouest, Polyclinique de Limoges - site Chénieux, Clinique mutualiste de la Porte-de-l'Orient, Hôpital-clinique Claude-Bernard, Centre ambulatoire Kleber, Hôpital européen, CHI, CHU - Hôpital d’Estaing, CHU - site Nord, Centre Léon-Bérard (CLCC), Hôpital privé de Marne-la-Vallée, Clinique des Ormeaux, Clinique mutualiste de Bonneveine, Clinique du Cèdre, CHU - Hôpital Roger-Salengro, Hôpital Paul-Brousse, Pôle de Santé du Villeneuvois, Hôpital privé de l’Estuaire, Centre de cardiologie du Pays basque, Hôpital privé Sévigné, Clinique Bon-Secours, GH Paul Guiraud, CH privé Claude-Galien, CHU - Hôpital Saint-Eloi, Hôpital de la Croix Rousse (HCL) / CH, Clinique du Pont-de-Chaume, Centre Henri-Becquerel (CLCC), Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, Centre Hospitalier Drôme Vivarais, Hôpital privé des Peupliers, CHU - Hôpital Bretonneau, CHU - Hôpital Rangueil, Clinique Tivoli-Ducos, Clinique Toulouse-Lautrec, Institut mutualiste Montsouris, Polyclinique Lyon-Nord, Clinique Saint-Charles, CHU-Hôpital Purpan/HFE, Hôpital de la Pitié-Salpêtrière, Clinique Pasteur-Lanroze, Centre Eugène-Marquis (CLCC), Hôpital de la Timone (adultes), Centre Hospitalier Les Murets, Hôpital privé Toulon Hyères-Saint-Jean, CHU - Hôpital de la Mère et de l’Enfant, Clinique du Diaconat-Fonderie, Clinique mutualiste, Institut Calot, CHU - Gabriel-Montpied, Clinique du Lac et d’Argonay, Clinique du Val-d’Or, Polyclinique Francheville, Hôpital privé Arras-Les Bonnettes, Hôpital privé des Côtes-d’Armor, Clinique Saint-Jean - Sud de France, Clinique Sainte-Anne, Hôpital privé Drôme-Ardèche, Clinique Paris Lilas, Hôpital Lariboisière, Fondation Rothschild, Hôpital privé de l’Ouest parisien, Polyclinique, Clinique Belledonne, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Polyclinique Jean-Villar, Clinique de l’Europe, Clinique Monticelli-Vélodrome, Hôpitaux Nord (Croix-Rousse), CH Édouard-Toulouse, Institut Jean-Godinot (CLCC), EPSM Etienne-Gourmelen, CH/Clinique, Clinique Rhéna, Clinique Bizet, Hôpital Ambroise-Paré, Clinique du Parc-Monceau, Clinique de Villeneuve-d’Ascq, Clinique Mathilde, Hôpital Raymond-Poincaré, Institut franco-britannique Kléber, Clinique ophtalmologique Thiers, Hôpital privé Nord Parisien, Clinique de l'Alma, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de la Baie, Clinique du Tertre-Rouge, CH privé du Montgardé, Clinique Rive-Gauche, Hôpital Bichat, Nouvel Hôpital de Navarre, CHU - Hôpitaux mère-enfants, CHU - Hôpital Claude-Huriez, CMC de Parly-II, CHU - Hôpital Haut-Lévêque, Hôpital privé de l’Est lyonnais, Clinique Les Eaux-Claires, Clinique générale, Clinique de la Plaine, Polyclinique de Picardie, CHR de Metz-Thionville - Hôpital Bel-Air, Centre cardiologique du Nord, Clinique de l’Yvette, Clinique du Grand-Large, Hôpital Henri-Mondor, Clinique Notre-Dame-de-l’Espérance, Clinique de la Miséricorde, Polyclinique du Beaujolais, Hôpital privé Cannes-Oxford, Hôpital privé Saint-Martin, Clinique du Croisé-Laroche, Polyclinique Saint-Jean, Clinique Turin, Centre Hospitalier de Vauclaire, Hôpital Saint-Camille, Clinique Kennedy, Institut Bergonié (CLCC), Clinique Conti, CHU - Hôpital Robert-Debré, Centre Hospitalier La Chartreuse, Clinique Jouvenet, Clinique Saint-Amé, Clinique Arago, Clinique du Parc, Hôpital Robert-Debré, Clinique Maussins-Nollet, Polyclinique Saint-Privat, Clinique Saint-George, CHU - Hôpital de Hautepierre, Institut de cancérologie Strasbourg Europe, CH/clinique, Hôpital Cochin, Hôpital privé du Vert-Galant, Clinique du Pré, Hôpital d'instruction des armées Percy, Clinique d’Occitanie, Centre médico-chirurgical du Mans, Centre Hospitalier Henri Guerin, Centre Hospitalier Le Vinatier, Clinique Saint-Vincent-de-Paul, Polyclinique de Navarre, Clinique ambulatoire de Domont, CHP de l’Europe, Hôpital privé du Confluent, Hôpital de la Timone (Enfants), CH Guillaume-Régnier, Clinique Anne-Artois, CHU - Hôpital Gui-de-Chauliac, Hôpital privé La Louvière, CHU - Hôpital Saint-André, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes, Clinique de la Sauvegarde, Polyclinique de Kerio, Hopital Joseph-Ducuing, Clinique de l’Espérance, Clinique des Franciscaines, Hôpital privé Pays-de-Savoie, Centre Hospitalier Gérard-Marchant, CHU Grenoble - Site Nord, Hôpital Saint-Philibert (GHICL), Hôpital des Diaconesses, CHU - Hôpital Larrey, Hôpital privé Clairval, Médipôle Hôpital Privé, Polyclinique Urbain-V, EPS Ville-Évrard, Clinique de l’Atlantique, Hôpital de la Timone (enfants), Clinique de l’Estrée, Polyclinique Bordeaux-Rive droite, Clinique La Croix du Sud, Centre Hospitalier Le Bon Sauveur, Institut Paoli-Calmettes (CLCC), Polyclinique de Poitiers, Euromed Cardio, ASM, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital de l’Archet, Clinique Jean Causse, Clinique de l’Orangerie, Clinique Ormeau Pyrénées, Clinique Saint-Joseph, Clinique Bretéché, Centre Jean-Perrin (CLCC), Centre Hospitalier des Pyrénées, Clinique du Diaconat-Roosevelt, Santé Atlantique, Hôpital Belle-Isle, Clinique Claude-Bernard, Hôpital Pierre-Wertheimer, Polyclinique Aguilera, CHU - Hôpital Clocheville, Clinique Fontvert, Hôpital de la Croix-Saint-Simon, Clinique Saint-Vincent, Pôle santé Léonard-de-Vinci, Centre médico-chirurgical et obstétrical, Institut de cancérologie de Lorraine (CLCC), CHU Réunion, Polyclinique de Blois, Hôpital privé de la Loire, CH Charles-Perrens, Pôle santé Oréliance, CM Bénigne-Joly, Clinique Bouchard, Clinique Les Fontaines, Centre de la main, Hôpital privé Dijon-Bourgogne, Hôpital Nord, Hôpital d'instruction des armées Bégin, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, CMCO, Polyclinique Saint-Roch, Hôpital Paris Saint-Joseph, CHU - Hôpital Charles-Nicolle, Clinique du Fief-de-Grimoire, CHU Nantes - Hôpital Mère Enfant, EPS Barthélemy-Durand, Hôpital Antoine-Béclère, CMC Pierre-Cherest, GH, HCL - Hôpital Femme-mère-enfant, Clinique Saint-Jean-de-Dieu, Clinique Belharra, Pôle Santé République, Hôpital Saint-Joseph, Clinique Océane, CHU - Hôpital Lapeyronie, Clinique Esquirol-Saint-Hilaire, Hôpitaux de Saint-Maurice, Centre François-Baclesse (CLCC), Clinique Honoré-Cave, Hôpital privé d’Antony, CHU - Institut cœur-poumon, Polyclinique Saint-Jean l’Ermitage, Hôpital privé de La Miotte, Clinique Sainte-Clotilde, Clinique du Millénaire, CHU - Hôpital Arnaud-de-Villeneuve, Clinique du Val-d’Ouest Vendôme, Clinique Saint-François, CHU - American Memorial Hospital, CH Georges-Daumezon, Clinique des Orchidées, CHU de Martinique - site Mère-Enfant, Clinique mutualiste La Sagesse, Institut Curie (CLCC), Clinique de l'Essonne, Hôpitaux pédiatriques, Clinique Saint-Augustin, Clinique Geoffroy-Saint-Hilaire, CHU de La Réunion - Félix-Guyon, Institut d’hématologie et d'oncologie pédiatrique, Polyclinique Saint-Côme, Clinique Saint-Nabor, Groupe Hospitalier de la Rochelle, Clinique Jean le Bon, Polyclinique Les Fleurs, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Maternité, CHU - Hôpital civil, Hôpital d'instruction des armées Sainte-Anne, Polyclinique du Maine, CHU - Hôpital de la Cavale-Blanche, CHU - Hôpital Central, CH Esquirol, Hôpital Bicêtre, Hôpital Saint-Louis, Hôpital Trousseau, Hôpital privé La Montagne Lambert, Hôpital privé de la Seine-Saint-Denis, Institut Curie, Centre Psychothérapique, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Marcel-Sembat, Clinique Clémentville, Hôpital d'instruction des armées Laveran, Clinique Charcot, CH national d’ophtalmologie des Quinze-Vingts, CHU Sud-Réunion, Clinique de la Part-Dieu, CHU - Hôpital Nord, Hôpital privé Le Bois, Hôpital d'instruction des armées Desgenettes, Clinique Victor-Hugo, Clinique Pasteur, Hôpital privé Armand-Brillard, Clinique de l’Anjou, Hôpital privé La Châtaigneraie, Centre cardiologique, Hôpital d'instruction des armées Legouest, Hôpital Tenon, Hôpital privé, Clinique Delay, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Médipôle de Savoie, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Vauban, Hôpital privé de Villeneuve-d’Ascq, Clinique Ambroise-Paré, Clinique de Bercy, Clinique du Trocadéro, Centre chirurgical Marie-Lannelongue, Hôpital privé Vert-Coteau, Clinique Durieux, CHR, CHU - Hôpital de la Côte de nacre, CHU - Hôpital Trousseau, Institut du cancer de Montpellier (CLCC), Clinique Axium, Grand hôpital de l'Est-Francilien, Nouvelle clinique Bel-Air, Centre Hospitalier George Sand, Hôpital Robert Schuman
2025-08-22 19:48:34,564 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=, institution_list=Clinique la Pergola, Clinique de la Muette, Hôpital privé Jean-Mermoz, Clinique Ormeau centre, EPSM de Saône-et-Loire, Clinique Saint-Hilaire, EPSM Morbihan, Hôpital privé Paris-Essonne, Centre Georges-François-Leclerc (CLCC), Hôpital Hôtel-Dieu, Polyclinique du Parc, Clinique du sport, Hôpital Louis-Pradel, GCS Clinique du Ter, Centre Hospitalier Le Mas Careiron, Institut Arthur-Vernes, Hôpital Corentin-Celton, CHU - Hôpital Dupuytren, Hôpital Louis-Mourier, Centre Hospitalier Montperrin, Hôpital Privé Nancy Lorraine, Maison de santé Bagatelle, Hôpital Jean-Verdier, CHU - Hôpital Sud, Polyclinique Majorelle, Clinique Sainte-Marie (GHICL), Hôpital Beaujon, Médipôle Garonne, Institut hospitalier Jacques-Cartier, CH Henri-Laborit, Polyclinique Santa-Maria, Espm de L’agglomeration Lilloise, Clinique Lille-Sud, Clinique Juge, CHU - Hôpital Maison-Blanche, Clinique Saint-Antoine, CHU - Hôpital Purpan, EPSM Lille-Métropole, CH privé Saint-Grégoire, CH intercommunal, Hôtel-Dieu, Hôpital Nord Franche-Comté-Belfort, Hôpital privé Paul-d’Égine, Clinique Saint-André, Centre Oscar-Lambret (CLCC), Centre psychothérapique de Nancy, Centre Clinical, CH Saint-Joseph-Saint-Luc, Clinique Saint-Pierre, CH Montfavet, CHU de Nantes, Centre Hospitalier d'Erstein, Polyclinique de Bordeaux-Tondu, Hôpital de la Conception, Clinique Chantecler, Clinique Victor-Pauchet, Clinique du Cambrésis, Clinique Beau-Soleil, Polyclinique de Courlancy, Clinique Remusat, Clinique Convert, Institut ophtalmique, Hôpital privé de Provence, GHP Ambroise-Paré - Hartmann (92), CHU de Pointe-à-Pitre, Epsan, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique du Renaison, CHU - Hôpital Morvan, GHI, Groupe hospitalier Nord-Essonne, Hôpital européen Georges-Pompidou, Clinique cardiologique, Hôpital Albert Schweitzer, Polyclinique de Keraudren, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Pontchaillou, Clinique mutualiste Jules-Verne, CMC Floréal, CHU - Hôpitaux de Brabois, GHU Paris Psychiatrie et neurosciences, Clinique de Vitrolles (Bouches-du-Rhône), CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital des Massues, Centre Hospitalier Maurice Despinoy, Hôpitaux Sud, IUCT/Oncopole, Polyclinique La Ligne bleue, Hôpital Foch, CH Lyon-Sud, Hôpital Avicenne, Polyclinique Saint-François, Polyclinique Côte-Basque-Sud, GH mutualiste, Clinique Saint-Michel, Clinique mutualiste catalane, Clinique Louis-Pasteur, Centre Hospitalier Sainte-Marie, Clinique Rhône Durance, Hôpital privé de Marne Chantereine, CHU de Martinique, Les Franciscaines, IUCT Oncopole, CHU - Centre chirurgical Emile-Gallé, CHU - Hôpital Pellegrin, Polyclinique de la Région-Mantaise, Clinique de l’Union, Hôpitaux civils, EPSM de la Marne, Hôpital Edouard-Herriot, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital privé Beauregard, Nouvelle clinique de Tours, Polyclinique de Reims-Bezannes (Marne), Hôpital privé de la Casamance, Clinique mutualiste de l’Estuaire, Clinique des Cèdres, Hôpital Necker-Enfants-Malades, Institut universitaire de la face et du cou, CMCO Côte d’Opale, GH Saint-Vincent - Clinique Sainte-Barbe, CHU - Hôpital Pasteur, Gustave-Roussy (CLCC), Polyclinique du Parc-Drevon, Polyclinique du Grand-Sud, Infirmerie protestante de Lyon, Clinique Saint-Léonard, Clinique Trenel, Polyclinique Médipôle Saint-Roch, CHU d’Amiens, CH Basse-Terre (Guadeloupe), Institut Arnault-Tzanck, Clinique Saint-Paul, Polyclinique de Limoges - site Émailleurs, Hôpital Saint-Antoine, Centre de chirurgie ophtalmologique, Clinique Sainte-Marie, Hôpital privé Natecia, CHR de Metz-Thionville - Hôpital de Mercy, Centre orthopédique médico-chirurgical, Institut de cancérologie de l’Ouest, Polyclinique de Limoges - site Chénieux, Clinique mutualiste de la Porte-de-l'Orient, Hôpital-clinique Claude-Bernard, Centre ambulatoire Kleber, Hôpital européen, CHI, CHU - Hôpital d’Estaing, CHU - site Nord, Centre Léon-Bérard (CLCC), Hôpital privé de Marne-la-Vallée, Clinique des Ormeaux, Clinique mutualiste de Bonneveine, Clinique du Cèdre, CHU - Hôpital Roger-Salengro, Hôpital Paul-Brousse, Pôle de Santé du Villeneuvois, Hôpital privé de l’Estuaire, Centre de cardiologie du Pays basque, Hôpital privé Sévigné, Clinique Bon-Secours, GH Paul Guiraud, CH privé Claude-Galien, CHU - Hôpital Saint-Eloi, Hôpital de la Croix Rousse (HCL) / CH, Clinique du Pont-de-Chaume, Centre Henri-Becquerel (CLCC), Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, Centre Hospitalier Drôme Vivarais, Hôpital privé des Peupliers, CHU - Hôpital Bretonneau, CHU - Hôpital Rangueil, Clinique Tivoli-Ducos, Clinique Toulouse-Lautrec, Institut mutualiste Montsouris, Polyclinique Lyon-Nord, Clinique Saint-Charles, CHU-Hôpital Purpan/HFE, Hôpital de la Pitié-Salpêtrière, Clinique Pasteur-Lanroze, Centre Eugène-Marquis (CLCC), Hôpital de la Timone (adultes), Centre Hospitalier Les Murets, Hôpital privé Toulon Hyères-Saint-Jean, CHU - Hôpital de la Mère et de l’Enfant, Clinique du Diaconat-Fonderie, Clinique mutualiste, Institut Calot, CHU - Gabriel-Montpied, Clinique du Lac et d’Argonay, Clinique du Val-d’Or, Polyclinique Francheville, Hôpital privé Arras-Les Bonnettes, Hôpital privé des Côtes-d’Armor, Clinique Saint-Jean - Sud de France, Clinique Sainte-Anne, Hôpital privé Drôme-Ardèche, Clinique Paris Lilas, Hôpital Lariboisière, Fondation Rothschild, Hôpital privé de l’Ouest parisien, Polyclinique, Clinique Belledonne, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Polyclinique Jean-Villar, Clinique de l’Europe, Clinique Monticelli-Vélodrome, Hôpitaux Nord (Croix-Rousse), CH Édouard-Toulouse, Institut Jean-Godinot (CLCC), EPSM Etienne-Gourmelen, CH/Clinique, Clinique Rhéna, Clinique Bizet, Hôpital Ambroise-Paré, Clinique du Parc-Monceau, Clinique de Villeneuve-d’Ascq, Clinique Mathilde, Hôpital Raymond-Poincaré, Institut franco-britannique Kléber, Clinique ophtalmologique Thiers, Hôpital privé Nord Parisien, Clinique de l'Alma, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de la Baie, Clinique du Tertre-Rouge, CH privé du Montgardé, Clinique Rive-Gauche, Hôpital Bichat, Nouvel Hôpital de Navarre, CHU - Hôpitaux mère-enfants, CHU - Hôpital Claude-Huriez, CMC de Parly-II, CHU - Hôpital Haut-Lévêque, Hôpital privé de l’Est lyonnais, Clinique Les Eaux-Claires, Clinique générale, Clinique de la Plaine, Polyclinique de Picardie, CHR de Metz-Thionville - Hôpital Bel-Air, Centre cardiologique du Nord, Clinique de l’Yvette, Clinique du Grand-Large, Hôpital Henri-Mondor, Clinique Notre-Dame-de-l’Espérance, Clinique de la Miséricorde, Polyclinique du Beaujolais, Hôpital privé Cannes-Oxford, Hôpital privé Saint-Martin, Clinique du Croisé-Laroche, Polyclinique Saint-Jean, Clinique Turin, Centre Hospitalier de Vauclaire, Hôpital Saint-Camille, Clinique Kennedy, Institut Bergonié (CLCC), Clinique Conti, CHU - Hôpital Robert-Debré, Centre Hospitalier La Chartreuse, Clinique Jouvenet, Clinique Saint-Amé, Clinique Arago, Clinique du Parc, Hôpital Robert-Debré, Clinique Maussins-Nollet, Polyclinique Saint-Privat, Clinique Saint-George, CHU - Hôpital de Hautepierre, Institut de cancérologie Strasbourg Europe, CH/clinique, Hôpital Cochin, Hôpital privé du Vert-Galant, Clinique du Pré, Hôpital d'instruction des armées Percy, Clinique d’Occitanie, Centre médico-chirurgical du Mans, Centre Hospitalier Henri Guerin, Centre Hospitalier Le Vinatier, Clinique Saint-Vincent-de-Paul, Polyclinique de Navarre, Clinique ambulatoire de Domont, CHP de l’Europe, Hôpital privé du Confluent, Hôpital de la Timone (Enfants), CH Guillaume-Régnier, Clinique Anne-Artois, CHU - Hôpital Gui-de-Chauliac, Hôpital privé La Louvière, CHU - Hôpital Saint-André, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes, Clinique de la Sauvegarde, Polyclinique de Kerio, Hopital Joseph-Ducuing, Clinique de l’Espérance, Clinique des Franciscaines, Hôpital privé Pays-de-Savoie, Centre Hospitalier Gérard-Marchant, CHU Grenoble - Site Nord, Hôpital Saint-Philibert (GHICL), Hôpital des Diaconesses, CHU - Hôpital Larrey, Hôpital privé Clairval, Médipôle Hôpital Privé, Polyclinique Urbain-V, EPS Ville-Évrard, Clinique de l’Atlantique, Hôpital de la Timone (enfants), Clinique de l’Estrée, Polyclinique Bordeaux-Rive droite, Clinique La Croix du Sud, Centre Hospitalier Le Bon Sauveur, Institut Paoli-Calmettes (CLCC), Polyclinique de Poitiers, Euromed Cardio, ASM, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital de l’Archet, Clinique Jean Causse, Clinique de l’Orangerie, Clinique Ormeau Pyrénées, Clinique Saint-Joseph, Clinique Bretéché, Centre Jean-Perrin (CLCC), Centre Hospitalier des Pyrénées, Clinique du Diaconat-Roosevelt, Santé Atlantique, Hôpital Belle-Isle, Clinique Claude-Bernard, Hôpital Pierre-Wertheimer, Polyclinique Aguilera, CHU - Hôpital Clocheville, Clinique Fontvert, Hôpital de la Croix-Saint-Simon, Clinique Saint-Vincent, Pôle santé Léonard-de-Vinci, Centre médico-chirurgical et obstétrical, Institut de cancérologie de Lorraine (CLCC), CHU Réunion, Polyclinique de Blois, Hôpital privé de la Loire, CH Charles-Perrens, Pôle santé Oréliance, CM Bénigne-Joly, Clinique Bouchard, Clinique Les Fontaines, Centre de la main, Hôpital privé Dijon-Bourgogne, Hôpital Nord, Hôpital d'instruction des armées Bégin, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, CMCO, Polyclinique Saint-Roch, Hôpital Paris Saint-Joseph, CHU - Hôpital Charles-Nicolle, Clinique du Fief-de-Grimoire, CHU Nantes - Hôpital Mère Enfant, EPS Barthélemy-Durand, Hôpital Antoine-Béclère, CMC Pierre-Cherest, GH, HCL - Hôpital Femme-mère-enfant, Clinique Saint-Jean-de-Dieu, Clinique Belharra, Pôle Santé République, Hôpital Saint-Joseph, Clinique Océane, CHU - Hôpital Lapeyronie, Clinique Esquirol-Saint-Hilaire, Hôpitaux de Saint-Maurice, Centre François-Baclesse (CLCC), Clinique Honoré-Cave, Hôpital privé d’Antony, CHU - Institut cœur-poumon, Polyclinique Saint-Jean l’Ermitage, Hôpital privé de La Miotte, Clinique Sainte-Clotilde, Clinique du Millénaire, CHU - Hôpital Arnaud-de-Villeneuve, Clinique du Val-d’Ouest Vendôme, Clinique Saint-François, CHU - American Memorial Hospital, CH Georges-Daumezon, Clinique des Orchidées, CHU de Martinique - site Mère-Enfant, Clinique mutualiste La Sagesse, Institut Curie (CLCC), Clinique de l'Essonne, Hôpitaux pédiatriques, Clinique Saint-Augustin, Clinique Geoffroy-Saint-Hilaire, CHU de La Réunion - Félix-Guyon, Institut d’hématologie et d'oncologie pédiatrique, Polyclinique Saint-Côme, Clinique Saint-Nabor, Groupe Hospitalier de la Rochelle, Clinique Jean le Bon, Polyclinique Les Fleurs, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Maternité, CHU - Hôpital civil, Hôpital d'instruction des armées Sainte-Anne, Polyclinique du Maine, CHU - Hôpital de la Cavale-Blanche, CHU - Hôpital Central, CH Esquirol, Hôpital Bicêtre, Hôpital Saint-Louis, Hôpital Trousseau, Hôpital privé La Montagne Lambert, Hôpital privé de la Seine-Saint-Denis, Institut Curie, Centre Psychothérapique, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Marcel-Sembat, Clinique Clémentville, Hôpital d'instruction des armées Laveran, Clinique Charcot, CH national d’ophtalmologie des Quinze-Vingts, CHU Sud-Réunion, Clinique de la Part-Dieu, CHU - Hôpital Nord, Hôpital privé Le Bois, Hôpital d'instruction des armées Desgenettes, Clinique Victor-Hugo, Clinique Pasteur, Hôpital privé Armand-Brillard, Clinique de l’Anjou, Hôpital privé La Châtaigneraie, Centre cardiologique, Hôpital d'instruction des armées Legouest, Hôpital Tenon, Hôpital privé, Clinique Delay, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Médipôle de Savoie, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Vauban, Hôpital privé de Villeneuve-d’Ascq, Clinique Ambroise-Paré, Clinique de Bercy, Clinique du Trocadéro, Centre chirurgical Marie-Lannelongue, Hôpital privé Vert-Coteau, Clinique Durieux, CHR, CHU - Hôpital de la Côte de nacre, CHU - Hôpital Trousseau, Institut du cancer de Montpellier (CLCC), Clinique Axium, Grand hôpital de l'Est-Francilien, Nouvelle clinique Bel-Air, Centre Hospitalier George Sand, Hôpital Robert Schuman
2025-08-22 19:48:34,565 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'
2025-08-22 19:48:34,565 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: multiple matches:Angioplastie coronaire,Cardiologie interventionnelle,Chirurgie cardiaque adulte,Chirurgie cardiaque pédiatrique,Infarctus du myocarde,Insuffisance cardiaque,Rythmologie
2025-08-22 19:48:34,566 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les 10 meilleurs hôpitaux publics à Bor...
2025-08-22 19:48:34,569 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:34,569 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:34,570 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:34,570 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:34,570 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:34,571 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:34,571 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:35,072 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:35 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'236'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'324'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999675'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_a539c8fa8cd149ea8eff1b1fc15ac2bf'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433ace8975014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:35,073 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:35,073 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:35,076 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:35,076 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:35,076 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:35,077 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:35 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '236', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '324', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999675', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_a539c8fa8cd149ea8eff1b1fc15ac2bf', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433ace8975014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:35,077 [DEBUG] openai._base_client: request_id: req_a539c8fa8cd149ea8eff1b1fc15ac2bf
2025-08-22 19:48:35,077 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:35,078 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:35,078 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'
2025-08-22 19:48:35,078 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:35,080 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:35,081 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:35,081 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:35,081 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:35,082 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:35,082 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:35,082 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:35,596 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:35 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'323'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'349'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999760'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_348fd51d05b0440ca260f8f07668a51a'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433b019245014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:35,596 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:35,596 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:35,601 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:35,601 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:35,601 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:35,601 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:35 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '323', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '349', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999760', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_348fd51d05b0440ca260f8f07668a51a', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433b019245014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:35,602 [DEBUG] openai._base_client: request_id: req_348fd51d05b0440ca260f8f07668a51a
2025-08-22 19:48:35,602 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:48:35,602 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:48:35,602 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:48:35,602 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:35,605 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:35,606 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:35,606 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:35,606 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:35,606 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:35,606 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:35,606 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:36,036 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:36 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'226'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'252'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999644'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_748066c03867458c9d8ca667c79a2d30'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433b36a2d5014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:36,037 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:36,037 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:36,038 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:36,038 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:36,038 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:36,038 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:36 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '226', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '252', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999644', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_748066c03867458c9d8ca667c79a2d30', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433b36a2d5014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:36,038 [DEBUG] openai._base_client: request_id: req_748066c03867458c9d8ca667c79a2d30
2025-08-22 19:48:36,039 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Bordeaux
2025-08-22 19:48:36,039 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Bordeaux
2025-08-22 19:48:36,039 [INFO] app.features.query_analysis.city.city_detection: City detected: Bordeaux
2025-08-22 19:48:36,039 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Bordeaux'
2025-08-22 19:48:36,040 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:36,040 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:36,040 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'
2025-08-22 19:48:36,040 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:36,042 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:36,043 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:36,043 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:36,043 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:36,044 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:36,044 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:36,044 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:36,519 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:36 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'305'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'319'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999760'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_7fd684cf20ff4950a1b3519a2faeffbf'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433b619995014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:36,519 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:36,520 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:36,574 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:36,574 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:36,575 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:36,575 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:36 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '305', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '319', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999760', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_7fd684cf20ff4950a1b3519a2faeffbf', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433b619995014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:36,575 [DEBUG] openai._base_client: request_id: req_7fd684cf20ff4950a1b3519a2faeffbf
2025-08-22 19:48:36,576 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 19:48:36,576 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 19:48:36,576 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 19:48:36,576 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?, conv_history=
2025-08-22 19:48:36,578 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:36,579 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:36,579 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:36,580 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:36,580 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:36,580 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:36,580 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:37,155 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:37 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'367'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'401'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999644'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_3fd38a62ea834b0398523fe1e3c18f43'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433b97a5a5014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:37,156 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:37,156 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:37,156 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:37,157 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:37,157 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:37,157 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:37 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '367', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '401', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999644', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_3fd38a62ea834b0398523fe1e3c18f43', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433b97a5a5014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:37,157 [DEBUG] openai._base_client: request_id: req_3fd38a62ea834b0398523fe1e3c18f43
2025-08-22 19:48:37,158 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Bordeaux
2025-08-22 19:48:37,158 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Bordeaux
2025-08-22 19:48:37,158 [INFO] app.features.query_analysis.city.city_detection: City detected: Bordeaux
2025-08-22 19:48:37,158 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Bordeaux', setting city_detected=True
2025-08-22 19:48:37,158 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Bordeaux', 'city_detected': True}
2025-08-22 19:48:37,161 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:37,161 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:37,161 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:37,162 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:37,162 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:37,162 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:37,162 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:37,660 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:37 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'313'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'330'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999562'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_0a9c4d5eb9164ef4a0053edd1c502f81'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433bd1bd95014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:37,660 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:37,660 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:37,667 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:37,667 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:37,667 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:37,667 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:37 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '313', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '330', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999562', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_0a9c4d5eb9164ef4a0053edd1c502f81', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433bd1bd95014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:37,667 [DEBUG] openai._base_client: request_id: req_0a9c4d5eb9164ef4a0053edd1c502f81
2025-08-22 19:48:37,668 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 19:48:37,668 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 19:48:37,668 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 19:48:37,671 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les 10 meilleurs hôpitaux publics à Bordeaux pour les maladies cardiaques?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 19:48:37,671 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 19:48:37,671 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 19:48:37,672 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 19:48:37,672 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 19:48:37,672 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 19:48:37,672 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 19:48:40,687 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 17:48:40 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'2836'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'2855'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999777'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_b07ec2b107be4b34945329a4be5deaa8'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973433c04bf85014-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 19:48:40,688 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 19:48:40,688 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 19:48:40,688 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 19:48:40,688 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 19:48:40,688 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 19:48:40,689 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 17:48:40 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '2836', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '2855', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999777', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_b07ec2b107be4b34945329a4be5deaa8', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973433c04bf85014-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 19:48:40,689 [DEBUG] openai._base_client: request_id: req_b07ec2b107be4b34945329a4be5deaa8
2025-08-22 19:48:40,689 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: public
2025-08-22 19:48:40,689 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Bordeaux', 'city_detected': True, 'institution_name': None, 'institution_type': 'Public', 'specialty': 'multiple matches:Angioplastie coronaire, Cardiologie interventionnelle, Chirurgie cardiaque adulte, Chirurgie cardiaque pédiatrique, Infarctus du myocarde, Insuffisance cardiaque, Rythmologie', 'detection_method': 'keyword', 'original_detected_specialty': 'multiple matches:Angioplastie coronaire,Cardiologie interventionnelle,Chirurgie cardiaque adulte,Chirurgie cardiaque pédiatrique,Infarctus du myocarde,Insuffisance cardiaque,Rythmologie', 'number_institutions': 10}
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='multiple matches:Angioplastie coronaire, Cardiologie interventionnelle, Chirurgie cardiaque adulte, Chirurgie cardiaque pédiatrique, Infarctus du myocarde, Insuffisance cardiaque, Rythmologie', city='Bordeaux', city_detected=True, institution_type='Public', number_institutions=10, institution_name=None, institution_mentioned=None
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'multiple matches:Angioplastie coronaire, Cardiologie interventionnelle, Chirurgie cardiaque adulte, Chirurgie cardiaque pédiatrique, Infarctus du myocarde, Insuffisance cardiaque, Rythmologie'
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Bordeaux'
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'Public'
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 10
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 19:48:40,690 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 19:48:40,724 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 19:48:40,724 [DEBUG] app.services.data_processing_service: Institution list: Clinique la Pergola, Clinique de la Muette, Hôpital privé Jean-Mermoz, Clinique Ormeau centre, EPSM de Saône-et-Loire, Clinique Saint-Hilaire, EPSM Morbihan, Hôpital privé Paris-Essonne, Centre Georges-François-Leclerc (CLCC), Hôpital Hôtel-Dieu, Polyclinique du Parc, Clinique du sport, Hôpital Louis-Pradel, GCS Clinique du Ter, Centre Hospitalier Le Mas Careiron, Institut Arthur-Vernes, Hôpital Corentin-Celton, CHU - Hôpital Dupuytren, Hôpital Louis-Mourier, Centre Hospitalier Montperrin, Hôpital Privé Nancy Lorraine, Maison de santé Bagatelle, Hôpital Jean-Verdier, CHU - Hôpital Sud, Polyclinique Majorelle, Clinique Sainte-Marie (GHICL), Hôpital Beaujon, Médipôle Garonne, Institut hospitalier Jacques-Cartier, CH Henri-Laborit, Polyclinique Santa-Maria, Espm de L’agglomeration Lilloise, Clinique Lille-Sud, Clinique Juge, CHU - Hôpital Maison-Blanche, Clinique Saint-Antoine, CHU - Hôpital Purpan, EPSM Lille-Métropole, CH privé Saint-Grégoire, CH intercommunal, Hôtel-Dieu, Hôpital Nord Franche-Comté-Belfort, Hôpital privé Paul-d’Égine, Clinique Saint-André, Centre Oscar-Lambret (CLCC), Centre psychothérapique de Nancy, Centre Clinical, CH Saint-Joseph-Saint-Luc, Clinique Saint-Pierre, CH Montfavet, CHU de Nantes, Centre Hospitalier d'Erstein, Polyclinique de Bordeaux-Tondu, Hôpital de la Conception, Clinique Chantecler, Clinique Victor-Pauchet, Clinique du Cambrésis, Clinique Beau-Soleil, Polyclinique de Courlancy, Clinique Remusat, Clinique Convert, Institut ophtalmique, Hôpital privé de Provence, GHP Ambroise-Paré - Hartmann (92), CHU de Pointe-à-Pitre, Epsan, Centre de cardiologie Axium-Rambot, Hôpital Lariboisière-Fernand Widal, Clinique du Renaison, CHU - Hôpital Morvan, GHI, Groupe hospitalier Nord-Essonne, Hôpital européen Georges-Pompidou, Clinique cardiologique, Hôpital Albert Schweitzer, Polyclinique de Keraudren, Hôpital d'instruction des armées Robert-Picqué, CHU - Hôpital Pontchaillou, Clinique mutualiste Jules-Verne, CMC Floréal, CHU - Hôpitaux de Brabois, GHU Paris Psychiatrie et neurosciences, Clinique de Vitrolles (Bouches-du-Rhône), CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital des Massues, Centre Hospitalier Maurice Despinoy, Hôpitaux Sud, IUCT/Oncopole, Polyclinique La Ligne bleue, Hôpital Foch, CH Lyon-Sud, Hôpital Avicenne, Polyclinique Saint-François, Polyclinique Côte-Basque-Sud, GH mutualiste, Clinique Saint-Michel, Clinique mutualiste catalane, Clinique Louis-Pasteur, Centre Hospitalier Sainte-Marie, Clinique Rhône Durance, Hôpital privé de Marne Chantereine, CHU de Martinique, Les Franciscaines, IUCT Oncopole, CHU - Centre chirurgical Emile-Gallé, CHU - Hôpital Pellegrin, Polyclinique de la Région-Mantaise, Clinique de l’Union, Hôpitaux civils, EPSM de la Marne, Hôpital Edouard-Herriot, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital privé Beauregard, Nouvelle clinique de Tours, Polyclinique de Reims-Bezannes (Marne), Hôpital privé de la Casamance, Clinique mutualiste de l’Estuaire, Clinique des Cèdres, Hôpital Necker-Enfants-Malades, Institut universitaire de la face et du cou, CMCO Côte d’Opale, GH Saint-Vincent - Clinique Sainte-Barbe, CHU - Hôpital Pasteur, Gustave-Roussy (CLCC), Polyclinique du Parc-Drevon, Polyclinique du Grand-Sud, Infirmerie protestante de Lyon, Clinique Saint-Léonard, Clinique Trenel, Polyclinique Médipôle Saint-Roch, CHU d’Amiens, CH Basse-Terre (Guadeloupe), Institut Arnault-Tzanck, Clinique Saint-Paul, Polyclinique de Limoges - site Émailleurs, Hôpital Saint-Antoine, Centre de chirurgie ophtalmologique, Clinique Sainte-Marie, Hôpital privé Natecia, CHR de Metz-Thionville - Hôpital de Mercy, Centre orthopédique médico-chirurgical, Institut de cancérologie de l’Ouest, Polyclinique de Limoges - site Chénieux, Clinique mutualiste de la Porte-de-l'Orient, Hôpital-clinique Claude-Bernard, Centre ambulatoire Kleber, Hôpital européen, CHI, CHU - Hôpital d’Estaing, CHU - site Nord, Centre Léon-Bérard (CLCC), Hôpital privé de Marne-la-Vallée, Clinique des Ormeaux, Clinique mutualiste de Bonneveine, Clinique du Cèdre, CHU - Hôpital Roger-Salengro, Hôpital Paul-Brousse, Pôle de Santé du Villeneuvois, Hôpital privé de l’Estuaire, Centre de cardiologie du Pays basque, Hôpital privé Sévigné, Clinique Bon-Secours, GH Paul Guiraud, CH privé Claude-Galien, CHU - Hôpital Saint-Eloi, Hôpital de la Croix Rousse (HCL) / CH, Clinique du Pont-de-Chaume, Centre Henri-Becquerel (CLCC), Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, Centre Hospitalier Drôme Vivarais, Hôpital privé des Peupliers, CHU - Hôpital Bretonneau, CHU - Hôpital Rangueil, Clinique Tivoli-Ducos, Clinique Toulouse-Lautrec, Institut mutualiste Montsouris, Polyclinique Lyon-Nord, Clinique Saint-Charles, CHU-Hôpital Purpan/HFE, Hôpital de la Pitié-Salpêtrière, Clinique Pasteur-Lanroze, Centre Eugène-Marquis (CLCC), Hôpital de la Timone (adultes), Centre Hospitalier Les Murets, Hôpital privé Toulon Hyères-Saint-Jean, CHU - Hôpital de la Mère et de l’Enfant, Clinique du Diaconat-Fonderie, Clinique mutualiste, Institut Calot, CHU - Gabriel-Montpied, Clinique du Lac et d’Argonay, Clinique du Val-d’Or, Polyclinique Francheville, Hôpital privé Arras-Les Bonnettes, Hôpital privé des Côtes-d’Armor, Clinique Saint-Jean - Sud de France, Clinique Sainte-Anne, Hôpital privé Drôme-Ardèche, Clinique Paris Lilas, Hôpital Lariboisière, Fondation Rothschild, Hôpital privé de l’Ouest parisien, Polyclinique, Clinique Belledonne, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Polyclinique Jean-Villar, Clinique de l’Europe, Clinique Monticelli-Vélodrome, Hôpitaux Nord (Croix-Rousse), CH Édouard-Toulouse, Institut Jean-Godinot (CLCC), EPSM Etienne-Gourmelen, CH/Clinique, Clinique Rhéna, Clinique Bizet, Hôpital Ambroise-Paré, Clinique du Parc-Monceau, Clinique de Villeneuve-d’Ascq, Clinique Mathilde, Hôpital Raymond-Poincaré, Institut franco-britannique Kléber, Clinique ophtalmologique Thiers, Hôpital privé Nord Parisien, Clinique de l'Alma, Clinique Mutualiste de Bretagne Occidentale, Polyclinique de la Baie, Clinique du Tertre-Rouge, CH privé du Montgardé, Clinique Rive-Gauche, Hôpital Bichat, Nouvel Hôpital de Navarre, CHU - Hôpitaux mère-enfants, CHU - Hôpital Claude-Huriez, CMC de Parly-II, CHU - Hôpital Haut-Lévêque, Hôpital privé de l’Est lyonnais, Clinique Les Eaux-Claires, Clinique générale, Clinique de la Plaine, Polyclinique de Picardie, CHR de Metz-Thionville - Hôpital Bel-Air, Centre cardiologique du Nord, Clinique de l’Yvette, Clinique du Grand-Large, Hôpital Henri-Mondor, Clinique Notre-Dame-de-l’Espérance, Clinique de la Miséricorde, Polyclinique du Beaujolais, Hôpital privé Cannes-Oxford, Hôpital privé Saint-Martin, Clinique du Croisé-Laroche, Polyclinique Saint-Jean, Clinique Turin, Centre Hospitalier de Vauclaire, Hôpital Saint-Camille, Clinique Kennedy, Institut Bergonié (CLCC), Clinique Conti, CHU - Hôpital Robert-Debré, Centre Hospitalier La Chartreuse, Clinique Jouvenet, Clinique Saint-Amé, Clinique Arago, Clinique du Parc, Hôpital Robert-Debré, Clinique Maussins-Nollet, Polyclinique Saint-Privat, Clinique Saint-George, CHU - Hôpital de Hautepierre, Institut de cancérologie Strasbourg Europe, CH/clinique, Hôpital Cochin, Hôpital privé du Vert-Galant, Clinique du Pré, Hôpital d'instruction des armées Percy, Clinique d’Occitanie, Centre médico-chirurgical du Mans, Centre Hospitalier Henri Guerin, Centre Hospitalier Le Vinatier, Clinique Saint-Vincent-de-Paul, Polyclinique de Navarre, Clinique ambulatoire de Domont, CHP de l’Europe, Hôpital privé du Confluent, Hôpital de la Timone (Enfants), CH Guillaume-Régnier, Clinique Anne-Artois, CHU - Hôpital Gui-de-Chauliac, Hôpital privé La Louvière, CHU - Hôpital Saint-André, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes, Clinique de la Sauvegarde, Polyclinique de Kerio, Hopital Joseph-Ducuing, Clinique de l’Espérance, Clinique des Franciscaines, Hôpital privé Pays-de-Savoie, Centre Hospitalier Gérard-Marchant, CHU Grenoble - Site Nord, Hôpital Saint-Philibert (GHICL), Hôpital des Diaconesses, CHU - Hôpital Larrey, Hôpital privé Clairval, Médipôle Hôpital Privé, Polyclinique Urbain-V, EPS Ville-Évrard, Clinique de l’Atlantique, Hôpital de la Timone (enfants), Clinique de l’Estrée, Polyclinique Bordeaux-Rive droite, Clinique La Croix du Sud, Centre Hospitalier Le Bon Sauveur, Institut Paoli-Calmettes (CLCC), Polyclinique de Poitiers, Euromed Cardio, ASM, Centre Antoine-Lacassagne (CLCC), CHU - Hôpital de l’Archet, Clinique Jean Causse, Clinique de l’Orangerie, Clinique Ormeau Pyrénées, Clinique Saint-Joseph, Clinique Bretéché, Centre Jean-Perrin (CLCC), Centre Hospitalier des Pyrénées, Clinique du Diaconat-Roosevelt, Santé Atlantique, Hôpital Belle-Isle, Clinique Claude-Bernard, Hôpital Pierre-Wertheimer, Polyclinique Aguilera, CHU - Hôpital Clocheville, Clinique Fontvert, Hôpital de la Croix-Saint-Simon, Clinique Saint-Vincent, Pôle santé Léonard-de-Vinci, Centre médico-chirurgical et obstétrical, Institut de cancérologie de Lorraine (CLCC), CHU Réunion, Polyclinique de Blois, Hôpital privé de la Loire, CH Charles-Perrens, Pôle santé Oréliance, CM Bénigne-Joly, Clinique Bouchard, Clinique Les Fontaines, Centre de la main, Hôpital privé Dijon-Bourgogne, Hôpital Nord, Hôpital d'instruction des armées Bégin, CH privé Saint-Martin, CHU - Hôpital Jeanne-de-Flandre, CMCO, Polyclinique Saint-Roch, Hôpital Paris Saint-Joseph, CHU - Hôpital Charles-Nicolle, Clinique du Fief-de-Grimoire, CHU Nantes - Hôpital Mère Enfant, EPS Barthélemy-Durand, Hôpital Antoine-Béclère, CMC Pierre-Cherest, GH, HCL - Hôpital Femme-mère-enfant, Clinique Saint-Jean-de-Dieu, Clinique Belharra, Pôle Santé République, Hôpital Saint-Joseph, Clinique Océane, CHU - Hôpital Lapeyronie, Clinique Esquirol-Saint-Hilaire, Hôpitaux de Saint-Maurice, Centre François-Baclesse (CLCC), Clinique Honoré-Cave, Hôpital privé d’Antony, CHU - Institut cœur-poumon, Polyclinique Saint-Jean l’Ermitage, Hôpital privé de La Miotte, Clinique Sainte-Clotilde, Clinique du Millénaire, CHU - Hôpital Arnaud-de-Villeneuve, Clinique du Val-d’Ouest Vendôme, Clinique Saint-François, CHU - American Memorial Hospital, CH Georges-Daumezon, Clinique des Orchidées, CHU de Martinique - site Mère-Enfant, Clinique mutualiste La Sagesse, Institut Curie (CLCC), Clinique de l'Essonne, Hôpitaux pédiatriques, Clinique Saint-Augustin, Clinique Geoffroy-Saint-Hilaire, CHU de La Réunion - Félix-Guyon, Institut d’hématologie et d'oncologie pédiatrique, Polyclinique Saint-Côme, Clinique Saint-Nabor, Groupe Hospitalier de la Rochelle, Clinique Jean le Bon, Polyclinique Les Fleurs, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Maternité, CHU - Hôpital civil, Hôpital d'instruction des armées Sainte-Anne, Polyclinique du Maine, CHU - Hôpital de la Cavale-Blanche, CHU - Hôpital Central, CH Esquirol, Hôpital Bicêtre, Hôpital Saint-Louis, Hôpital Trousseau, Hôpital privé La Montagne Lambert, Hôpital privé de la Seine-Saint-Denis, Institut Curie, Centre Psychothérapique, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Marcel-Sembat, Clinique Clémentville, Hôpital d'instruction des armées Laveran, Clinique Charcot, CH national d’ophtalmologie des Quinze-Vingts, CHU Sud-Réunion, Clinique de la Part-Dieu, CHU - Hôpital Nord, Hôpital privé Le Bois, Hôpital d'instruction des armées Desgenettes, Clinique Victor-Hugo, Clinique Pasteur, Hôpital privé Armand-Brillard, Clinique de l’Anjou, Hôpital privé La Châtaigneraie, Centre cardiologique, Hôpital d'instruction des armées Legouest, Hôpital Tenon, Hôpital privé, Clinique Delay, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Médipôle de Savoie, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Vauban, Hôpital privé de Villeneuve-d’Ascq, Clinique Ambroise-Paré, Clinique de Bercy, Clinique du Trocadéro, Centre chirurgical Marie-Lannelongue, Hôpital privé Vert-Coteau, Clinique Durieux, CHR, CHU - Hôpital de la Côte de nacre, CHU - Hôpital Trousseau, Institut du cancer de Montpellier (CLCC), Clinique Axium, Grand hôpital de l'Est-Francilien, Nouvelle clinique Bel-Air, Centre Hospitalier George Sand, Hôpital Robert Schuman
2025-08-22 19:48:40,725 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 19:48:40,942 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 19:48:40,942 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 19:48:40,942 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'multiple matches:Angioplastie coronaire, Cardiologie interventionnelle, Chirurgie cardiaque adulte, Chirurgie cardiaque pédiatrique, Infarctus du myocarde, Insuffisance cardiaque, Rythmologie'
2025-08-22 19:48:40,942 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Bordeaux'
2025-08-22 19:48:40,942 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 19:48:40,942 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'Public'
2025-08-22 19:48:40,943 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 19:48:40,943 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 19:48:40,943 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 10
2025-08-22 19:48:40,943 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: multiple matches:Angioplastie coronaire, Cardiologie interventionnelle, Chirurgie cardiaque adulte, Chirurgie cardiaque pédiatrique, Infarctus du myocarde, Insuffisance cardiaque, Rythmologie, city: Bordeaux, institution_type: Public, institution: None, institution_mentioned: None
2025-08-22 19:48:40,943 [INFO] app.services.pipeline_orchestrator_service: Multiple specialty matches detected (robust), returning for UI selection
2025-08-22 19:48:40,943 [DEBUG] app.services.pipeline_orchestrator_service: Returning multiple matches response: Plusieurs spécialités ont été détectées dans votre question. Merci de sélectionner une spécialité pour continuer.
- Angioplastie coronaire
- Cardiologie interventionnelle
- Chirurgie cardiaque adulte
- Chirurgie cardiaque pédiatrique
- Infarctus du myocarde
- Insuffisance cardiaque
- Rythmologie
2025-08-22 19:48:40,943 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-22 19:49:17,752 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:49:17,752 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:49:17,752 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:49:17,752 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:49:17,752 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:49:17,753 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:49:17,753 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:49:17,754 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:49:17,903 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:49:17,903 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:49:17,903 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:49:17,907 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:49:17,908 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:49:18,103 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:49:18,103 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:49:18,103 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:49:18,104 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:49:18,104 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:49:18,104 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:49:18,175 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:49:18,175 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:49:18,176 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:49:18,177 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:49:18,177 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:49:18,178 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:49:18,178 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:49:18,178 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:49:18,179 [INFO] main: Creating FastAPI app
2025-08-22 19:49:18,180 [INFO] main: CORS middleware added
2025-08-22 19:49:18,181 [INFO] main: API router included
2025-08-22 19:51:57,604 [INFO] app.api.routes: Initializing core services...
2025-08-22 19:51:57,604 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 19:51:57,604 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 19:51:57,604 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:51:57,605 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:51:57,606 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:51:57,606 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:51:57,606 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:51:57,749 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:51:57,749 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:51:57,749 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:51:57,753 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:51:57,754 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:51:57,963 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 19:51:57,963 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 19:51:57,963 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 19:51:57,963 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 19:51:57,964 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 19:51:57,964 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 19:51:58,036 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 19:51:58,036 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 19:51:58,036 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 19:51:58,038 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:51:58,038 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:51:58,038 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 19:51:58,038 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 19:51:58,038 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 19:51:58,040 [INFO] main: Creating FastAPI app
2025-08-22 19:51:58,040 [INFO] main: CORS middleware added
2025-08-22 19:51:58,041 [INFO] main: API router included
2025-08-22 20:06:26,558 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:06:26,558 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:06:26,558 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:06:26,558 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:06:26,559 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:06:26,560 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:06:26,560 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:06:26,560 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:06:26,700 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:06:26,701 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:06:26,701 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:06:26,705 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:06:26,705 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:06:26,914 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:06:26,915 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:06:26,915 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:06:26,915 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:06:26,916 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:06:26,916 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:06:26,991 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:06:26,991 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:06:26,992 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:06:26,995 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:06:26,995 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:06:26,995 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:06:26,995 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:06:26,995 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:06:26,997 [INFO] main: Creating FastAPI app
2025-08-22 20:06:26,998 [INFO] main: CORS middleware added
2025-08-22 20:06:26,999 [INFO] main: API router included
2025-08-22 20:08:24,601 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:08:24,601 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:08:24,601 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:08:24,601 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:08:24,601 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:08:24,603 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:08:24,603 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:08:24,603 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:08:24,760 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:08:24,760 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:08:24,761 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:08:24,766 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:08:24,767 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:08:24,980 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:08:24,981 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:08:24,981 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:08:24,982 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:08:24,982 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:08:24,982 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:08:25,060 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:08:25,061 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:08:25,061 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:08:25,063 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:08:25,063 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:08:25,063 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:08:25,063 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:08:25,063 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:08:25,065 [INFO] main: Creating FastAPI app
2025-08-22 20:08:25,065 [INFO] main: CORS middleware added
2025-08-22 20:08:25,066 [INFO] main: API router included
2025-08-22 20:08:27,008 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:08:27,016 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:08:27,016 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:08:27,017 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:08:27,017 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:08:27,018 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:08:27,018 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:08:27,018 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:08:27,158 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:08:27,158 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:08:27,158 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:08:27,161 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:08:27,161 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:08:27,313 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:08:27,313 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:08:27,313 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:08:27,314 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:08:27,314 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:08:27,314 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:08:27,385 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:08:27,385 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:08:27,385 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:08:27,387 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:08:27,387 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:08:27,387 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:08:27,387 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:08:27,387 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:08:27,389 [INFO] main: Creating FastAPI app
2025-08-22 20:08:27,390 [INFO] main: CORS middleware added
2025-08-22 20:08:27,391 [INFO] main: API router included
2025-08-22 20:14:05,638 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:14:05,638 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:14:05,638 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:14:05,638 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:14:05,638 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:14:05,639 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:14:05,640 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:14:05,640 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:14:05,784 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:14:05,785 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:14:05,785 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:14:05,789 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:14:05,789 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:14:05,994 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:14:05,994 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:14:05,994 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:14:05,995 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:14:05,995 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:14:05,995 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:14:06,069 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:14:06,069 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:14:06,069 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:14:06,071 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:14:06,071 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:14:06,071 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:14:06,071 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:14:06,071 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:14:06,073 [INFO] main: Creating FastAPI app
2025-08-22 20:14:06,073 [INFO] main: CORS middleware added
2025-08-22 20:14:06,075 [INFO] main: API router included
2025-08-22 20:16:10,529 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:16:10,530 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:16:10,530 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:16:10,530 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:16:10,530 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:16:10,532 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:16:10,532 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:16:10,532 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:16:10,689 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:16:10,689 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:16:10,689 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:16:10,696 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:16:10,696 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:16:10,900 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:16:10,900 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:16:10,900 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:16:10,901 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:16:10,901 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:16:10,901 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:16:10,974 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:16:10,974 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:16:10,974 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:16:10,977 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:16:10,977 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:16:10,977 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:16:10,977 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:16:10,977 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:16:10,979 [INFO] main: Creating FastAPI app
2025-08-22 20:16:10,980 [INFO] main: CORS middleware added
2025-08-22 20:16:10,982 [INFO] main: API router included
2025-08-22 20:32:04,944 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:32:04,944 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:32:04,944 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:32:04,944 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:32:04,944 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:32:04,945 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:32:04,946 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:32:04,946 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:32:05,087 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:32:05,087 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:32:05,087 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:32:05,092 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:32:05,092 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:32:05,294 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:32:05,294 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:32:05,294 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:32:05,295 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:32:05,295 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:32:05,295 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:32:05,369 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:32:05,369 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:32:05,369 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:32:05,371 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:32:05,371 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:32:05,371 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:32:05,371 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:32:05,371 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:32:05,373 [INFO] main: Creating FastAPI app
2025-08-22 20:32:05,374 [INFO] main: CORS middleware added
2025-08-22 20:32:05,375 [INFO] main: API router included
2025-08-22 20:34:05,301 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:34:05,301 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:34:05,301 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:34:05,301 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:34:05,302 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:34:05,303 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:34:05,303 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:34:05,303 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:34:05,447 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:34:05,447 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:34:05,447 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:34:05,451 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:34:05,452 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:34:05,654 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:34:05,654 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:34:05,654 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:34:05,655 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:34:05,655 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:34:05,655 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:34:05,727 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:34:05,727 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:34:05,727 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:34:05,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:34:05,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:34:05,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:34:05,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:34:05,729 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:34:05,731 [INFO] main: Creating FastAPI app
2025-08-22 20:34:05,732 [INFO] main: CORS middleware added
2025-08-22 20:34:05,733 [INFO] main: API router included
2025-08-22 20:38:59,828 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:38:59,829 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:38:59,829 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:38:59,829 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:38:59,829 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:38:59,830 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:38:59,830 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:38:59,830 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:38:59,986 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:38:59,986 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:38:59,986 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:38:59,992 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:38:59,993 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:39:00,205 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:39:00,205 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:39:00,205 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:39:00,207 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:39:00,207 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:39:00,207 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:39:00,283 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:39:00,283 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:39:00,283 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:39:00,285 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:39:00,286 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:39:00,286 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:39:00,286 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:39:00,286 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:39:00,288 [INFO] main: Creating FastAPI app
2025-08-22 20:39:00,288 [INFO] main: CORS middleware added
2025-08-22 20:39:00,290 [INFO] main: API router included
2025-08-22 20:41:13,305 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-22 20:41:13,305 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-22 20:41:13,305 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-22 20:41:13,305 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-22 20:41:13,305 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-22 20:41:13,313 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:13,341 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:13,342 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-22 20:41:13,378 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ac59010>
2025-08-22 20:41:13,379 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11a4bc710> server_hostname='api.openai.com' timeout=None
2025-08-22 20:41:13,398 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ac0d090>
2025-08-22 20:41:13,398 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:13,398 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:13,398 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:13,398 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:13,399 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:13,962 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:14 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'362'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'393'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_e6dc05de8ab949e882e741ba41df28d7'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=kTVE3oz1XCZGecn5rqG2vQOvG2RuU8oIA9stfj3AuxY-1755888074-1.0.1.1-x6V7.r8ZD_l7E8ZSdQ_di.nIE2p1hrA.t8c8goD5sWdhAzVlx6iamB21i3fpiu6s1K9j6z3oTUiBDfYk_U6OeBB7xEDdUdp14f4yXxDoJhg; path=/; expires=Fri, 22-Aug-25 19:11:14 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=JhxHPYd27B94Cv5nsoaf3Vy9EEY2avIC00VJ4BxdR3E-1755888074134-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480cbedb8fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:13,964 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:13,964 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:13,966 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:13,966 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:13,967 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:13,967 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Fri, 22 Aug 2025 18:41:14 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '362'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '393'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_e6dc05de8ab949e882e741ba41df28d7'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=kTVE3oz1XCZGecn5rqG2vQOvG2RuU8oIA9stfj3AuxY-1755888074-1.0.1.1-x6V7.r8ZD_l7E8ZSdQ_di.nIE2p1hrA.t8c8goD5sWdhAzVlx6iamB21i3fpiu6s1K9j6z3oTUiBDfYk_U6OeBB7xEDdUdp14f4yXxDoJhg; path=/; expires=Fri, 22-Aug-25 19:11:14 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=JhxHPYd27B94Cv5nsoaf3Vy9EEY2avIC00VJ4BxdR3E-1755888074134-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '973480cbedb8fb6d-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-22 20:41:13,969 [DEBUG] openai._base_client: request_id: req_e6dc05de8ab949e882e741ba41df28d7
2025-08-22 20:41:13,977 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-22 20:41:13,977 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-22 20:41:13,980 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:13,981 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:13,982 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:13,982 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:13,982 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:13,982 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:13,982 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:15,349 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:15 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'303'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1025'), (b'x-request-id', b'req_52069103768348c09bcb4bf0ab77f3d1'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480cf8ecffb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:15,350 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:15,350 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:15,350 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:15,350 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:15,350 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:15,350 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:15 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '303', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1025', 'x-request-id': 'req_52069103768348c09bcb4bf0ab77f3d1', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480cf8ecffb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:15,351 [DEBUG] openai._base_client: request_id: req_52069103768348c09bcb4bf0ab77f3d1
2025-08-22 20:41:15,351 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-22 20:41:15,351 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history=''
2025-08-22 20:41:15,351 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 20:41:15,352 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 20:41:15,352 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 20:41:15,352 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 20:41:15,506 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 20:41:15,506 [DEBUG] app.services.data_processing_service: Institution list: Clinique Rive-Gauche, Hôpital privé de Marne Chantereine, Hôpital privé Paul-d’Égine, CH Basse-Terre (Guadeloupe), Centre Hospitalier Le Bon Sauveur, Hôpital Robert Schuman, Hôpital Lariboisière, Clinique Bon-Secours, Clinique de l’Orangerie, Hôpital privé Pays-de-Savoie, Clinique de l'Essonne, Clinique Toulouse-Lautrec, Clinique Saint-Joseph, Clinique du Lac et d’Argonay, Hôpital Avicenne, Clinique de Vitrolles (Bouches-du-Rhône), Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, Clinique de l’Union, Clinique Geoffroy-Saint-Hilaire, CMCO, Clinique mutualiste, Hôpital Jean-Verdier, Clinique Saint-Léonard, Hôpital Robert-Debré, Clinique Lille-Sud, Clinique de l’Estrée, CHU - Hôpital Claude-Huriez, Hôpital d'instruction des armées Legouest, Clinique Jouvenet, Hôpital Bicêtre, CHU - Maternité, Clinique de l’Europe, CHU - Hôpital Pasteur, CH Charles-Perrens, GHU Paris Psychiatrie et neurosciences, Clinique Saint-François, Clinique du Fief-de-Grimoire, CHU - Gabriel-Montpied, Clinique Chantecler, Polyclinique Saint Laurent, Clinique Honoré-Cave, Hôpital Louis-Pradel, Hôpital Saint-Joseph, Polyclinique Côte-Basque-Sud, Clinique Saint-Antoine, Clinique La Croix du Sud, Centre de la main, Hôpital privé La Louvière, Infirmerie protestante de Lyon, Institut Calot, Centre de cardiologie Axium-Rambot, Clinique du Trocadéro, IUCT/Oncopole, CH/clinique, EPSM de Saône-et-Loire, Hôpitaux de Saint-Maurice, EPSM Lille-Métropole, Hôpital Tenon, CHU - Hôpital Larrey, Centre Léon-Bérard (CLCC), CHR de Metz-Thionville - Hôpital de Mercy, Centre Jean-Perrin (CLCC), Hôpital Nord Franche-Comté-Belfort, Institut de cancérologie de Lorraine (CLCC), Hôpital Bichat, Clinique Fontvert, Hôpital d'instruction des armées Desgenettes, Clinique Remusat, Hôpital privé des Peupliers, CHR, Clinique Saint-Charles, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital privé Le Bois, CHU - Hôpital de Hautepierre, Polyclinique Saint-Jean, CHU - Hôpital Rangueil, HCL - Hôpital Femme-mère-enfant, Polyclinique, Centre Oscar-Lambret (CLCC), Centre Eugène-Marquis (CLCC), Grand Hôpital de l'Est Francilien Marne-la-Vallée, Institut de cancérologie de l’Ouest, Clinique Juge, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Centre cardiologique du Nord, CH Esquirol, CHU - Hôpital Saint-Eloi, Clinique mutualiste de Bonneveine, Hôpital Paris Saint-Joseph, Clinique cardiologique, CHU - Hôpital d’Estaing, GCS Clinique du Ter, CHU - Hôpital Haut-Lévêque, Clinique du Tertre-Rouge, Hôpital de la Croix Rousse (HCL) / CH, Clinique Ormeau centre, Centre Hospitalier Drôme Vivarais, Clinique Convert, Institut Jean-Godinot (CLCC), CHU - Hôpital Lapeyronie, Hôpital privé Toulon Hyères-Saint-Jean, Clinique Bretéché, Centre Hospitalier Sainte-Marie, Clinique Sainte-Clotilde, Médipôle Garonne, Hôpital d'instruction des armées Laveran, Clinique de la Plaine, Hôpital Saint-Vincent-de-Paul (GHICL), IUCT Oncopole, CHU Réunion, Clinique des Ormeaux, CHP de l’Europe, Centre Hospitalier d'Erstein, CHU - American Memorial Hospital, Polyclinique de Limoges - site Chénieux, Hôpital Renée-Sabran, Polyclinique Francheville, Clinique Kennedy, Hôpital privé La Montagne Lambert, Hôpital privé Arras-Les Bonnettes, Clinique Paris Lilas, Hôpital-clinique Claude-Bernard, Clinique Saint-André, Clinique Anne-Artois, Polyclinique de Blois, CH privé Saint-Grégoire, CHU de La Réunion - Félix-Guyon, Polyclinique Urbain-V, CH privé Saint-Martin, CHU de Martinique - site Mère-Enfant, Hôpital privé Drôme-Ardèche, Polyclinique du Maine, Clinique Mathilde, Institut d’hématologie et d'oncologie pédiatrique, Clinique de l’Atlantique, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Nord, Hôpital privé de l’Est lyonnais, CH Édouard-Toulouse, Hôpital Saint-Antoine, Institut Paoli-Calmettes (CLCC), CHU - Hôpital Pellegrin, CHU - Hôpital Maison-Blanche, Clinique Jean le Bon, Médipôle Hôpital Privé, CHU - Hôpital Dupuytren, Clinique Saint-Michel, Clinique des Orchidées, Hôpital privé de la Loire, GH Paul Guiraud, Institut Bergonié (CLCC), Centre Clinical, EPSM Etienne-Gourmelen, Clinique Saint-Hilaire, Nouvel Hôpital de Navarre, CHU - Hôpital Gui-de-Chauliac, Institut franco-britannique Kléber, Polyclinique Les Fleurs, Clinique Monticelli-Vélodrome, Hôpital privé de l’Ouest parisien, Hôpital privé des Côtes-d’Armor, CH privé du Montgardé, Centre psychothérapique de Nancy, Hôpital privé d’Antony, Clinique de la Muette, Institut mutualiste Montsouris, CH Guillaume-Régnier, Clinique de l'Alma, Hôpital Foch, Clinique Saint-Augustin, Les Franciscaines, CHU - Hôpitaux mère-enfants, Clinique Marcel-Sembat, CHU Grenoble - Hôpital Sud, Hôpital Saint-Philibert (GHICL), Hôpital privé de La Miotte, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique Claude-Bernard, Clinique Rhéna, Polyclinique de Reims-Bezannes, Hôpital privé Dijon-Bourgogne, CHU - Hôpital Jeanne-de-Flandre, Hôpital Corentin-Celton, Clinique mutualiste catalane, Hôpital privé Nord Parisien, Clinique Bouchard, Hôpital privé La Châtaigneraie, EPS Barthélemy-Durand, Clinique d’Occitanie, Médipôle de Savoie, Clinique Sainte-Marie (GHICL), Polyclinique Saint-François, Hôpital d'instruction des armées Percy, CH Saint-Joseph-Saint-Luc, Hôpital privé Armand-Brillard, Institut du cancer de Montpellier (CLCC), Clinique de la Miséricorde, Clinique du Renaison, Clinique Rhône Durance, CMC de Parly-II, Clinique Delay, CHI, CHU - Hôpital Purpan, Polyclinique Jean-Villar, Fondation Rothschild, Hôpital privé Clairval, Polyclinique Majorelle, Clinique Turin, Pôle Santé République, Hôpital privé Saint-Martin, Polyclinique de la Région-Mantaise, Hôpital d'instruction des armées Bégin, Clinique Tivoli-Ducos, Hôpital privé de la Casamance, Hôpital d'instruction des armées Sainte-Anne, Hôpital des Diaconesses, Hôpital Privé Nancy Lorraine, Polyclinique Aguilera, Polyclinique de Kerio, Centre chirurgical Marie-Lannelongue, Institut Curie, CMC Floréal, Clinique des Franciscaines, Polyclinique Saint-Privat, Hôpital Cochin, CHU - site Nord, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Centre de cardiologie du Pays basque, Clinique des Cèdres, Clinique du Cèdre, Hôpital des Massues, Institut Curie (CLCC), Clinique Saint-Jean - Sud de France, Clinique du Val-d’Ouest Vendôme, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Robert-Debré, Clinique de l’Espérance, Centre Georges-François-Leclerc (CLCC), CHU - Institut cœur-poumon, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital privé, Polyclinique de Limoges - site Émailleurs, Centre Hospitalier La Chartreuse, CHU - Hôpital Roger-Salengro, Clinique urologique Nantes-Atlantis, CH Georges-Daumezon, Polyclinique Saint-Côme, Clinique du Croisé-Laroche, Hôpital Henri-Mondor, Hôpital Saint-Louis, Santé Atlantique, CHU - Hôpital Sud, CMC Pierre-Cherest, Centre François-Baclesse (CLCC), Centre orthopédique médico-chirurgical, Clinique Belledonne, Centre médico-chirurgical du Mans, Clinique la Pergola, Centre ambulatoire Kleber, Clinique Conti, Polyclinique Bordeaux-Rive droite, Pôle de Santé du Villeneuvois, Hôpital Ambroise-Paré, Clinique Saint-George, Clinique Durieux, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Hôpital Pierre-Wertheimer, Hôpital privé Sévigné, CHU - Hôpitaux de Brabois, Hôpital Louis-Mourier, Clinique de l’Yvette, Institut ophtalmique, Clinique Esquirol-Saint-Hilaire, Hôpital européen, CHU - Hôpital Trousseau, Hôpital privé Paris-Essonne, Centre Hospitalier George Sand, CHU - Hôpital de la Côte de nacre, CHU de Martinique, Centre Hospitalier Gérard-Marchant, Clinique Mutualiste de Bretagne Occidentale, Centre Hospitalier des Pyrénées, Centre Hospitalier Montperrin, Centre Hospitalier de Vauclaire, Clinique Arago, Clinique générale, Centre médico-chirurgical et obstétrical, Clinique Saint-Amé, Hôpital privé Natecia, Gustave-Roussy (CLCC), Clinique ambulatoire de Domont, Pôle santé Léonard-de-Vinci, Centre Hospitalier du Rouvray, Polyclinique Vauban, Polyclinique de Navarre, Clinique du Diaconat-Roosevelt, CHU - Hôpital de la Cavale-Blanche, CH Lyon-Sud, CHU Nantes - Hôpital Mère Enfant, Hôpital privé Vert-Coteau, Institut universitaire de la face et du cou, CHU - Hôpital Pontchaillou, Clinique Les Eaux-Claires, Hôpital Hôtel-Dieu, Clinique ophtalmologique Thiers, Clinique Beau-Soleil, Polyclinique de Bordeaux-Tondu, Centre Hospitalier Les Murets, Polyclinique du Parc-Drevon, Hôpital Edouard-Herriot, Hôpital Beaujon, Centre Henri-Becquerel (CLCC), Clinique mutualiste de la Porte-de-l'Orient, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Victor-Hugo, CM Bénigne-Joly, Hôpitaux civils, GH, Groupe hospitalier Nord-Essonne, Clinique du Diaconat-Fonderie, Clinique du Pré, Hôpital privé du Vert-Galant, Clinique Saint-Vincent, Clinique de l’Anjou, Polyclinique de Reims-Bezannes (Marne), CH Montfavet, CHU Grenoble - Site Nord, Clinique du Grand-Large, CHU - Hôpital Central, Clinique Victor-Pauchet, Clinique Bizet, Clinique mutualiste Jules-Verne, CHU - Hôpital Clocheville, CH privé Claude-Galien, Institut Arnault-Tzanck, Clinique Belharra, Hôpital de la Timone (adultes), CHU Sud-Réunion, Clinique du Millénaire, EPSM Morbihan, Hôpitaux pédiatriques, Espm de L’agglomeration Lilloise, Clinique de Bercy, Centre de chirurgie ophtalmologique, CH intercommunal, Clinique du Val-d’Or, Hôpital de la Timone (Enfants), Clinique Charcot, Hôpital Albert Schweitzer, Hopital Joseph-Ducuing, Clinique Clémentville, Hôpital européen Georges-Pompidou, Clinique Saint-Pierre, Polyclinique de Poitiers, Hôpital Antoine-Béclère, Polyclinique du Beaujolais, Hôpital privé de l’Estuaire, Polyclinique Lyon-Nord, Institut Arthur-Vernes, GHI, Hôpital Raymond-Poincaré, Polyclinique Saint-Roch, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôtel-Dieu, Hôpital privé de Villeneuve-d’Ascq, Clinique de la Part-Dieu, Centre Antoine-Lacassagne (CLCC), CH/Clinique, CHU de Nantes, Clinique mutualiste de l’Estuaire, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique Saint-Paul, CHU - Hôpital de l’Archet, Clinique Jean Causse, CHU-Hôpital Purpan/HFE, Clinique Ormeau Pyrénées, Clinique Notre-Dame-de-l’Espérance, Polyclinique Médipôle Saint-Roch, Hôpital Necker-Enfants-Malades, Clinique mutualiste La Sagesse, Euromed Cardio, Polyclinique Santa-Maria, Clinique du sport, Hôpitaux Sud, Clinique Trenel, Centre Hospitalier Le Vinatier, CHU - Hôpital Saint-André, Clinique du Pont-de-Chaume, Centre cardiologique, Hôpitaux Nord (Croix-Rousse), Nouvelle clinique Bel-Air, Groupe Hospitalier de la Rochelle, Clinique Louis-Pasteur, Hôpital Nord, Hôpital de la Pitié-Salpêtrière, Pôle santé Oréliance, Nouvelle clinique de Tours, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé Jean-Mermoz, Polyclinique La Ligne bleue, Grand hôpital de l'Est-Francilien, Clinique de la Sauvegarde, EPSM de la Marne, Hôpital privé de la Seine-Saint-Denis, Maison de santé Bagatelle, CHU - Hôpital Bretonneau, CHU - Hôpital Morvan, Clinique Saint-Nabor, CHU d’Amiens, Hôpital Paul-Brousse, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Sainte-Anne, Centre Hospitalier Henri Guerin, Clinique Sainte-Marie, EPS Ville-Évrard, Clinique Maussins-Nollet, CHU - Centre chirurgical Emile-Gallé, Hôpital de la Timone (enfants), Hôpital Belle-Isle, Hôpital privé de Provence, Clinique Les Fontaines, CH Henri-Laborit, CHU de Pointe-à-Pitre, Epsan, ASM, Clinique Ambroise-Paré, Clinique du Parc, Clinique Pasteur, Polyclinique de la Baie, Polyclinique de Keraudren, Clinique Océane, Hôpital privé Beauregard, Hôpital privé de Marne-la-Vallée, Hôpital privé Cannes-Oxford, Clinique Pasteur-Lanroze, Hôpital Trousseau, Polyclinique de Picardie, Clinique Saint-Jean-de-Dieu, CH national d’ophtalmologie des Quinze-Vingts, Clinique Axium, Clinique du Parc-Monceau, GHP Ambroise-Paré - Hartmann (92), Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Institut de cancérologie Strasbourg Europe, Hôpital Saint-Camille, GH mutualiste, CHU - Hôpital civil, Polyclinique du Grand-Sud, Clinique du Cambrésis, Hôpital Lariboisière-Fernand Widal, CMCO Côte d’Opale, Centre Hospitalier Maurice Despinoy
2025-08-22 20:41:15,507 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Clinique Rive-Gauche, Hôpital privé de Marne Chantereine, Hôpital privé Paul-d’Égine, CH Basse-Terre (Guadeloupe), Centre Hospitalier Le Bon Sauveur, Hôpital Robert Schuman, Hôpital Lariboisière, Clinique Bon-Secours, Clinique de l’Orangerie, Hôpital privé Pays-de-Savoie, Clinique de l'Essonne, Clinique Toulouse-Lautrec, Clinique Saint-Joseph, Clinique du Lac et d’Argonay, Hôpital Avicenne, Clinique de Vitrolles (Bouches-du-Rhône), Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, Clinique de l’Union, Clinique Geoffroy-Saint-Hilaire, CMCO, Clinique mutualiste, Hôpital Jean-Verdier, Clinique Saint-Léonard, Hôpital Robert-Debré, Clinique Lille-Sud, Clinique de l’Estrée, CHU - Hôpital Claude-Huriez, Hôpital d'instruction des armées Legouest, Clinique Jouvenet, Hôpital Bicêtre, CHU - Maternité, Clinique de l’Europe, CHU - Hôpital Pasteur, CH Charles-Perrens, GHU Paris Psychiatrie et neurosciences, Clinique Saint-François, Clinique du Fief-de-Grimoire, CHU - Gabriel-Montpied, Clinique Chantecler, Polyclinique Saint Laurent, Clinique Honoré-Cave, Hôpital Louis-Pradel, Hôpital Saint-Joseph, Polyclinique Côte-Basque-Sud, Clinique Saint-Antoine, Clinique La Croix du Sud, Centre de la main, Hôpital privé La Louvière, Infirmerie protestante de Lyon, Institut Calot, Centre de cardiologie Axium-Rambot, Clinique du Trocadéro, IUCT/Oncopole, CH/clinique, EPSM de Saône-et-Loire, Hôpitaux de Saint-Maurice, EPSM Lille-Métropole, Hôpital Tenon, CHU - Hôpital Larrey, Centre Léon-Bérard (CLCC), CHR de Metz-Thionville - Hôpital de Mercy, Centre Jean-Perrin (CLCC), Hôpital Nord Franche-Comté-Belfort, Institut de cancérologie de Lorraine (CLCC), Hôpital Bichat, Clinique Fontvert, Hôpital d'instruction des armées Desgenettes, Clinique Remusat, Hôpital privé des Peupliers, CHR, Clinique Saint-Charles, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital privé Le Bois, CHU - Hôpital de Hautepierre, Polyclinique Saint-Jean, CHU - Hôpital Rangueil, HCL - Hôpital Femme-mère-enfant, Polyclinique, Centre Oscar-Lambret (CLCC), Centre Eugène-Marquis (CLCC), Grand Hôpital de l'Est Francilien Marne-la-Vallée, Institut de cancérologie de l’Ouest, Clinique Juge, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Centre cardiologique du Nord, CH Esquirol, CHU - Hôpital Saint-Eloi, Clinique mutualiste de Bonneveine, Hôpital Paris Saint-Joseph, Clinique cardiologique, CHU - Hôpital d’Estaing, GCS Clinique du Ter, CHU - Hôpital Haut-Lévêque, Clinique du Tertre-Rouge, Hôpital de la Croix Rousse (HCL) / CH, Clinique Ormeau centre, Centre Hospitalier Drôme Vivarais, Clinique Convert, Institut Jean-Godinot (CLCC), CHU - Hôpital Lapeyronie, Hôpital privé Toulon Hyères-Saint-Jean, Clinique Bretéché, Centre Hospitalier Sainte-Marie, Clinique Sainte-Clotilde, Médipôle Garonne, Hôpital d'instruction des armées Laveran, Clinique de la Plaine, Hôpital Saint-Vincent-de-Paul (GHICL), IUCT Oncopole, CHU Réunion, Clinique des Ormeaux, CHP de l’Europe, Centre Hospitalier d'Erstein, CHU - American Memorial Hospital, Polyclinique de Limoges - site Chénieux, Hôpital Renée-Sabran, Polyclinique Francheville, Clinique Kennedy, Hôpital privé La Montagne Lambert, Hôpital privé Arras-Les Bonnettes, Clinique Paris Lilas, Hôpital-clinique Claude-Bernard, Clinique Saint-André, Clinique Anne-Artois, Polyclinique de Blois, CH privé Saint-Grégoire, CHU de La Réunion - Félix-Guyon, Polyclinique Urbain-V, CH privé Saint-Martin, CHU de Martinique - site Mère-Enfant, Hôpital privé Drôme-Ardèche, Polyclinique du Maine, Clinique Mathilde, Institut d’hématologie et d'oncologie pédiatrique, Clinique de l’Atlantique, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Nord, Hôpital privé de l’Est lyonnais, CH Édouard-Toulouse, Hôpital Saint-Antoine, Institut Paoli-Calmettes (CLCC), CHU - Hôpital Pellegrin, CHU - Hôpital Maison-Blanche, Clinique Jean le Bon, Médipôle Hôpital Privé, CHU - Hôpital Dupuytren, Clinique Saint-Michel, Clinique des Orchidées, Hôpital privé de la Loire, GH Paul Guiraud, Institut Bergonié (CLCC), Centre Clinical, EPSM Etienne-Gourmelen, Clinique Saint-Hilaire, Nouvel Hôpital de Navarre, CHU - Hôpital Gui-de-Chauliac, Institut franco-britannique Kléber, Polyclinique Les Fleurs, Clinique Monticelli-Vélodrome, Hôpital privé de l’Ouest parisien, Hôpital privé des Côtes-d’Armor, CH privé du Montgardé, Centre psychothérapique de Nancy, Hôpital privé d’Antony, Clinique de la Muette, Institut mutualiste Montsouris, CH Guillaume-Régnier, Clinique de l'Alma, Hôpital Foch, Clinique Saint-Augustin, Les Franciscaines, CHU - Hôpitaux mère-enfants, Clinique Marcel-Sembat, CHU Grenoble - Hôpital Sud, Hôpital Saint-Philibert (GHICL), Hôpital privé de La Miotte, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique Claude-Bernard, Clinique Rhéna, Polyclinique de Reims-Bezannes, Hôpital privé Dijon-Bourgogne, CHU - Hôpital Jeanne-de-Flandre, Hôpital Corentin-Celton, Clinique mutualiste catalane, Hôpital privé Nord Parisien, Clinique Bouchard, Hôpital privé La Châtaigneraie, EPS Barthélemy-Durand, Clinique d’Occitanie, Médipôle de Savoie, Clinique Sainte-Marie (GHICL), Polyclinique Saint-François, Hôpital d'instruction des armées Percy, CH Saint-Joseph-Saint-Luc, Hôpital privé Armand-Brillard, Institut du cancer de Montpellier (CLCC), Clinique de la Miséricorde, Clinique du Renaison, Clinique Rhône Durance, CMC de Parly-II, Clinique Delay, CHI, CHU - Hôpital Purpan, Polyclinique Jean-Villar, Fondation Rothschild, Hôpital privé Clairval, Polyclinique Majorelle, Clinique Turin, Pôle Santé République, Hôpital privé Saint-Martin, Polyclinique de la Région-Mantaise, Hôpital d'instruction des armées Bégin, Clinique Tivoli-Ducos, Hôpital privé de la Casamance, Hôpital d'instruction des armées Sainte-Anne, Hôpital des Diaconesses, Hôpital Privé Nancy Lorraine, Polyclinique Aguilera, Polyclinique de Kerio, Centre chirurgical Marie-Lannelongue, Institut Curie, CMC Floréal, Clinique des Franciscaines, Polyclinique Saint-Privat, Hôpital Cochin, CHU - site Nord, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Centre de cardiologie du Pays basque, Clinique des Cèdres, Clinique du Cèdre, Hôpital des Massues, Institut Curie (CLCC), Clinique Saint-Jean - Sud de France, Clinique du Val-d’Ouest Vendôme, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Robert-Debré, Clinique de l’Espérance, Centre Georges-François-Leclerc (CLCC), CHU - Institut cœur-poumon, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital privé, Polyclinique de Limoges - site Émailleurs, Centre Hospitalier La Chartreuse, CHU - Hôpital Roger-Salengro, Clinique urologique Nantes-Atlantis, CH Georges-Daumezon, Polyclinique Saint-Côme, Clinique du Croisé-Laroche, Hôpital Henri-Mondor, Hôpital Saint-Louis, Santé Atlantique, CHU - Hôpital Sud, CMC Pierre-Cherest, Centre François-Baclesse (CLCC), Centre orthopédique médico-chirurgical, Clinique Belledonne, Centre médico-chirurgical du Mans, Clinique la Pergola, Centre ambulatoire Kleber, Clinique Conti, Polyclinique Bordeaux-Rive droite, Pôle de Santé du Villeneuvois, Hôpital Ambroise-Paré, Clinique Saint-George, Clinique Durieux, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Hôpital Pierre-Wertheimer, Hôpital privé Sévigné, CHU - Hôpitaux de Brabois, Hôpital Louis-Mourier, Clinique de l’Yvette, Institut ophtalmique, Clinique Esquirol-Saint-Hilaire, Hôpital européen, CHU - Hôpital Trousseau, Hôpital privé Paris-Essonne, Centre Hospitalier George Sand, CHU - Hôpital de la Côte de nacre, CHU de Martinique, Centre Hospitalier Gérard-Marchant, Clinique Mutualiste de Bretagne Occidentale, Centre Hospitalier des Pyrénées, Centre Hospitalier Montperrin, Centre Hospitalier de Vauclaire, Clinique Arago, Clinique générale, Centre médico-chirurgical et obstétrical, Clinique Saint-Amé, Hôpital privé Natecia, Gustave-Roussy (CLCC), Clinique ambulatoire de Domont, Pôle santé Léonard-de-Vinci, Centre Hospitalier du Rouvray, Polyclinique Vauban, Polyclinique de Navarre, Clinique du Diaconat-Roosevelt, CHU - Hôpital de la Cavale-Blanche, CH Lyon-Sud, CHU Nantes - Hôpital Mère Enfant, Hôpital privé Vert-Coteau, Institut universitaire de la face et du cou, CHU - Hôpital Pontchaillou, Clinique Les Eaux-Claires, Hôpital Hôtel-Dieu, Clinique ophtalmologique Thiers, Clinique Beau-Soleil, Polyclinique de Bordeaux-Tondu, Centre Hospitalier Les Murets, Polyclinique du Parc-Drevon, Hôpital Edouard-Herriot, Hôpital Beaujon, Centre Henri-Becquerel (CLCC), Clinique mutualiste de la Porte-de-l'Orient, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Victor-Hugo, CM Bénigne-Joly, Hôpitaux civils, GH, Groupe hospitalier Nord-Essonne, Clinique du Diaconat-Fonderie, Clinique du Pré, Hôpital privé du Vert-Galant, Clinique Saint-Vincent, Clinique de l’Anjou, Polyclinique de Reims-Bezannes (Marne), CH Montfavet, CHU Grenoble - Site Nord, Clinique du Grand-Large, CHU - Hôpital Central, Clinique Victor-Pauchet, Clinique Bizet, Clinique mutualiste Jules-Verne, CHU - Hôpital Clocheville, CH privé Claude-Galien, Institut Arnault-Tzanck, Clinique Belharra, Hôpital de la Timone (adultes), CHU Sud-Réunion, Clinique du Millénaire, EPSM Morbihan, Hôpitaux pédiatriques, Espm de L’agglomeration Lilloise, Clinique de Bercy, Centre de chirurgie ophtalmologique, CH intercommunal, Clinique du Val-d’Or, Hôpital de la Timone (Enfants), Clinique Charcot, Hôpital Albert Schweitzer, Hopital Joseph-Ducuing, Clinique Clémentville, Hôpital européen Georges-Pompidou, Clinique Saint-Pierre, Polyclinique de Poitiers, Hôpital Antoine-Béclère, Polyclinique du Beaujolais, Hôpital privé de l’Estuaire, Polyclinique Lyon-Nord, Institut Arthur-Vernes, GHI, Hôpital Raymond-Poincaré, Polyclinique Saint-Roch, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôtel-Dieu, Hôpital privé de Villeneuve-d’Ascq, Clinique de la Part-Dieu, Centre Antoine-Lacassagne (CLCC), CH/Clinique, CHU de Nantes, Clinique mutualiste de l’Estuaire, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique Saint-Paul, CHU - Hôpital de l’Archet, Clinique Jean Causse, CHU-Hôpital Purpan/HFE, Clinique Ormeau Pyrénées, Clinique Notre-Dame-de-l’Espérance, Polyclinique Médipôle Saint-Roch, Hôpital Necker-Enfants-Malades, Clinique mutualiste La Sagesse, Euromed Cardio, Polyclinique Santa-Maria, Clinique du sport, Hôpitaux Sud, Clinique Trenel, Centre Hospitalier Le Vinatier, CHU - Hôpital Saint-André, Clinique du Pont-de-Chaume, Centre cardiologique, Hôpitaux Nord (Croix-Rousse), Nouvelle clinique Bel-Air, Groupe Hospitalier de la Rochelle, Clinique Louis-Pasteur, Hôpital Nord, Hôpital de la Pitié-Salpêtrière, Pôle santé Oréliance, Nouvelle clinique de Tours, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé Jean-Mermoz, Polyclinique La Ligne bleue, Grand hôpital de l'Est-Francilien, Clinique de la Sauvegarde, EPSM de la Marne, Hôpital privé de la Seine-Saint-Denis, Maison de santé Bagatelle, CHU - Hôpital Bretonneau, CHU - Hôpital Morvan, Clinique Saint-Nabor, CHU d’Amiens, Hôpital Paul-Brousse, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Sainte-Anne, Centre Hospitalier Henri Guerin, Clinique Sainte-Marie, EPS Ville-Évrard, Clinique Maussins-Nollet, CHU - Centre chirurgical Emile-Gallé, Hôpital de la Timone (enfants), Hôpital Belle-Isle, Hôpital privé de Provence, Clinique Les Fontaines, CH Henri-Laborit, CHU de Pointe-à-Pitre, Epsan, ASM, Clinique Ambroise-Paré, Clinique du Parc, Clinique Pasteur, Polyclinique de la Baie, Polyclinique de Keraudren, Clinique Océane, Hôpital privé Beauregard, Hôpital privé de Marne-la-Vallée, Hôpital privé Cannes-Oxford, Clinique Pasteur-Lanroze, Hôpital Trousseau, Polyclinique de Picardie, Clinique Saint-Jean-de-Dieu, CH national d’ophtalmologie des Quinze-Vingts, Clinique Axium, Clinique du Parc-Monceau, GHP Ambroise-Paré - Hartmann (92), Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Institut de cancérologie Strasbourg Europe, Hôpital Saint-Camille, GH mutualiste, CHU - Hôpital civil, Polyclinique du Grand-Sud, Clinique du Cambrésis, Hôpital Lariboisière-Fernand Widal, CMCO Côte d’Opale, Centre Hospitalier Maurice Despinoy
2025-08-22 20:41:15,508 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 20:41:15,510 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-22 20:41:15,510 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-22 20:41:15,513 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:15,514 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:15,514 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:15,514 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:15,514 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:15,514 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:15,515 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:16,215 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:16 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'473'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'529'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_0473193d488749c69f1c9eb3cf300544'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480d92bd7fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:16,215 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:16,216 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:16,216 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:16,216 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:16,216 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:16,216 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:16 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '473', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '529', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_0473193d488749c69f1c9eb3cf300544', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480d92bd7fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:16,217 [DEBUG] openai._base_client: request_id: req_0473193d488749c69f1c9eb3cf300544
2025-08-22 20:41:16,217 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:16,217 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:16,218 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 20:41:16,218 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:16,220 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:16,221 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:16,221 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:16,221 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:16,221 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:16,222 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:16,222 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:16,762 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:16 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'348'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'376'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999762'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_786f9911ffa54083a36e5d4044d68139'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480dd8f3afb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:16,763 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:16,763 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:16,771 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:16,772 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:16,772 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:16,772 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:16 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '348', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '376', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999762', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_786f9911ffa54083a36e5d4044d68139', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480dd8f3afb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:16,772 [DEBUG] openai._base_client: request_id: req_786f9911ffa54083a36e5d4044d68139
2025-08-22 20:41:16,773 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 20:41:16,773 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 20:41:16,773 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 20:41:16,773 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:16,775 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:16,776 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:16,776 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:16,776 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:16,777 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:16,777 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:16,777 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:17,321 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:17 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'346'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'376'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_a50cb4239fbb480b8d8f3a8b289efc8c'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480e10f13fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:17,322 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:17,322 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:17,322 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:17,322 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:17,322 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:17,323 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:17 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '346', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '376', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_a50cb4239fbb480b8d8f3a8b289efc8c', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480e10f13fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:17,323 [DEBUG] openai._base_client: request_id: req_a50cb4239fbb480b8d8f3a8b289efc8c
2025-08-22 20:41:17,323 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 20:41:17,323 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 20:41:17,324 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 20:41:17,324 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-22 20:41:17,324 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:17,324 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:17,324 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 20:41:17,324 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:17,327 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:17,328 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:17,328 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:17,328 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:17,328 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:17,328 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:17,328 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:19,682 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'2074'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'2160'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_bb639eb5598347869e2e94d022f3954e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480e47f32fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:19,682 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:19,682 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:19,695 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:19,695 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:19,695 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:19,696 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:19 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '2074', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '2160', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_bb639eb5598347869e2e94d022f3954e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480e47f32fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:19,696 [DEBUG] openai._base_client: request_id: req_bb639eb5598347869e2e94d022f3954e
2025-08-22 20:41:19,696 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 20:41:19,697 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 20:41:19,697 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 20:41:19,697 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:19,699 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:19,700 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:19,700 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:19,700 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:19,700 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:19,701 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:19,701 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:20,291 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:20 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'381'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'421'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_633d1daed7a34294827b384afc2a2b9c'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480f34f3efb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:20,292 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:20,292 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:20,292 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:20,292 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:20,292 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:20,292 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:20 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '381', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '421', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_633d1daed7a34294827b384afc2a2b9c', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480f34f3efb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:20,292 [DEBUG] openai._base_client: request_id: req_633d1daed7a34294827b384afc2a2b9c
2025-08-22 20:41:20,293 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 20:41:20,293 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 20:41:20,293 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 20:41:20,293 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-22 20:41:20,293 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-22 20:41:20,296 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:20,296 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:20,297 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:20,297 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:20,297 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:20,297 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:20,297 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:20,990 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'508'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'528'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_2ff66d7e91304e4c9437a6fe02dbce22'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480f70feffb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:20,991 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:20,992 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:21,000 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:21,000 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:21,000 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:21,001 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:21 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '508', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '528', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_2ff66d7e91304e4c9437a6fe02dbce22', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480f70feffb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:21,001 [DEBUG] openai._base_client: request_id: req_2ff66d7e91304e4c9437a6fe02dbce22
2025-08-22 20:41:21,001 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 20:41:21,002 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 20:41:21,002 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 20:41:21,004 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:21,005 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:21,005 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:21,006 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:21,006 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:21,006 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:21,006 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:21,490 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'297'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'320'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_f47ab6ed37354ffcbde39ec1e2d4e968'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973480fb79d0fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:21,491 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:21,491 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:21,495 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:21,495 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:21,495 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:21,495 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:21 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '297', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '320', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_f47ab6ed37354ffcbde39ec1e2d4e968', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973480fb79d0fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:21,495 [DEBUG] openai._base_client: request_id: req_f47ab6ed37354ffcbde39ec1e2d4e968
2025-08-22 20:41:21,496 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-22 20:41:21,496 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-22 20:41:21,496 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-22 20:41:21,496 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-22 20:41:21,496 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-22 20:41:21,496 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 20:41:21,496 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-22 20:41:21,496 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-22 20:41:21,497 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 20:41:21,497 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 20:41:21,529 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 20:41:21,530 [DEBUG] app.services.data_processing_service: Institution list: Clinique Rive-Gauche, Hôpital privé de Marne Chantereine, Hôpital privé Paul-d’Égine, CH Basse-Terre (Guadeloupe), Centre Hospitalier Le Bon Sauveur, Hôpital Robert Schuman, Hôpital Lariboisière, Clinique Bon-Secours, Clinique de l’Orangerie, Hôpital privé Pays-de-Savoie, Clinique de l'Essonne, Clinique Toulouse-Lautrec, Clinique Saint-Joseph, Clinique du Lac et d’Argonay, Hôpital Avicenne, Clinique de Vitrolles (Bouches-du-Rhône), Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, Clinique de l’Union, Clinique Geoffroy-Saint-Hilaire, CMCO, Clinique mutualiste, Hôpital Jean-Verdier, Clinique Saint-Léonard, Hôpital Robert-Debré, Clinique Lille-Sud, Clinique de l’Estrée, CHU - Hôpital Claude-Huriez, Hôpital d'instruction des armées Legouest, Clinique Jouvenet, Hôpital Bicêtre, CHU - Maternité, Clinique de l’Europe, CHU - Hôpital Pasteur, CH Charles-Perrens, GHU Paris Psychiatrie et neurosciences, Clinique Saint-François, Clinique du Fief-de-Grimoire, CHU - Gabriel-Montpied, Clinique Chantecler, Polyclinique Saint Laurent, Clinique Honoré-Cave, Hôpital Louis-Pradel, Hôpital Saint-Joseph, Polyclinique Côte-Basque-Sud, Clinique Saint-Antoine, Clinique La Croix du Sud, Centre de la main, Hôpital privé La Louvière, Infirmerie protestante de Lyon, Institut Calot, Centre de cardiologie Axium-Rambot, Clinique du Trocadéro, IUCT/Oncopole, CH/clinique, EPSM de Saône-et-Loire, Hôpitaux de Saint-Maurice, EPSM Lille-Métropole, Hôpital Tenon, CHU - Hôpital Larrey, Centre Léon-Bérard (CLCC), CHR de Metz-Thionville - Hôpital de Mercy, Centre Jean-Perrin (CLCC), Hôpital Nord Franche-Comté-Belfort, Institut de cancérologie de Lorraine (CLCC), Hôpital Bichat, Clinique Fontvert, Hôpital d'instruction des armées Desgenettes, Clinique Remusat, Hôpital privé des Peupliers, CHR, Clinique Saint-Charles, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital privé Le Bois, CHU - Hôpital de Hautepierre, Polyclinique Saint-Jean, CHU - Hôpital Rangueil, HCL - Hôpital Femme-mère-enfant, Polyclinique, Centre Oscar-Lambret (CLCC), Centre Eugène-Marquis (CLCC), Grand Hôpital de l'Est Francilien Marne-la-Vallée, Institut de cancérologie de l’Ouest, Clinique Juge, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Centre cardiologique du Nord, CH Esquirol, CHU - Hôpital Saint-Eloi, Clinique mutualiste de Bonneveine, Hôpital Paris Saint-Joseph, Clinique cardiologique, CHU - Hôpital d’Estaing, GCS Clinique du Ter, CHU - Hôpital Haut-Lévêque, Clinique du Tertre-Rouge, Hôpital de la Croix Rousse (HCL) / CH, Clinique Ormeau centre, Centre Hospitalier Drôme Vivarais, Clinique Convert, Institut Jean-Godinot (CLCC), CHU - Hôpital Lapeyronie, Hôpital privé Toulon Hyères-Saint-Jean, Clinique Bretéché, Centre Hospitalier Sainte-Marie, Clinique Sainte-Clotilde, Médipôle Garonne, Hôpital d'instruction des armées Laveran, Clinique de la Plaine, Hôpital Saint-Vincent-de-Paul (GHICL), IUCT Oncopole, CHU Réunion, Clinique des Ormeaux, CHP de l’Europe, Centre Hospitalier d'Erstein, CHU - American Memorial Hospital, Polyclinique de Limoges - site Chénieux, Hôpital Renée-Sabran, Polyclinique Francheville, Clinique Kennedy, Hôpital privé La Montagne Lambert, Hôpital privé Arras-Les Bonnettes, Clinique Paris Lilas, Hôpital-clinique Claude-Bernard, Clinique Saint-André, Clinique Anne-Artois, Polyclinique de Blois, CH privé Saint-Grégoire, CHU de La Réunion - Félix-Guyon, Polyclinique Urbain-V, CH privé Saint-Martin, CHU de Martinique - site Mère-Enfant, Hôpital privé Drôme-Ardèche, Polyclinique du Maine, Clinique Mathilde, Institut d’hématologie et d'oncologie pédiatrique, Clinique de l’Atlantique, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Nord, Hôpital privé de l’Est lyonnais, CH Édouard-Toulouse, Hôpital Saint-Antoine, Institut Paoli-Calmettes (CLCC), CHU - Hôpital Pellegrin, CHU - Hôpital Maison-Blanche, Clinique Jean le Bon, Médipôle Hôpital Privé, CHU - Hôpital Dupuytren, Clinique Saint-Michel, Clinique des Orchidées, Hôpital privé de la Loire, GH Paul Guiraud, Institut Bergonié (CLCC), Centre Clinical, EPSM Etienne-Gourmelen, Clinique Saint-Hilaire, Nouvel Hôpital de Navarre, CHU - Hôpital Gui-de-Chauliac, Institut franco-britannique Kléber, Polyclinique Les Fleurs, Clinique Monticelli-Vélodrome, Hôpital privé de l’Ouest parisien, Hôpital privé des Côtes-d’Armor, CH privé du Montgardé, Centre psychothérapique de Nancy, Hôpital privé d’Antony, Clinique de la Muette, Institut mutualiste Montsouris, CH Guillaume-Régnier, Clinique de l'Alma, Hôpital Foch, Clinique Saint-Augustin, Les Franciscaines, CHU - Hôpitaux mère-enfants, Clinique Marcel-Sembat, CHU Grenoble - Hôpital Sud, Hôpital Saint-Philibert (GHICL), Hôpital privé de La Miotte, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique Claude-Bernard, Clinique Rhéna, Polyclinique de Reims-Bezannes, Hôpital privé Dijon-Bourgogne, CHU - Hôpital Jeanne-de-Flandre, Hôpital Corentin-Celton, Clinique mutualiste catalane, Hôpital privé Nord Parisien, Clinique Bouchard, Hôpital privé La Châtaigneraie, EPS Barthélemy-Durand, Clinique d’Occitanie, Médipôle de Savoie, Clinique Sainte-Marie (GHICL), Polyclinique Saint-François, Hôpital d'instruction des armées Percy, CH Saint-Joseph-Saint-Luc, Hôpital privé Armand-Brillard, Institut du cancer de Montpellier (CLCC), Clinique de la Miséricorde, Clinique du Renaison, Clinique Rhône Durance, CMC de Parly-II, Clinique Delay, CHI, CHU - Hôpital Purpan, Polyclinique Jean-Villar, Fondation Rothschild, Hôpital privé Clairval, Polyclinique Majorelle, Clinique Turin, Pôle Santé République, Hôpital privé Saint-Martin, Polyclinique de la Région-Mantaise, Hôpital d'instruction des armées Bégin, Clinique Tivoli-Ducos, Hôpital privé de la Casamance, Hôpital d'instruction des armées Sainte-Anne, Hôpital des Diaconesses, Hôpital Privé Nancy Lorraine, Polyclinique Aguilera, Polyclinique de Kerio, Centre chirurgical Marie-Lannelongue, Institut Curie, CMC Floréal, Clinique des Franciscaines, Polyclinique Saint-Privat, Hôpital Cochin, CHU - site Nord, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Centre de cardiologie du Pays basque, Clinique des Cèdres, Clinique du Cèdre, Hôpital des Massues, Institut Curie (CLCC), Clinique Saint-Jean - Sud de France, Clinique du Val-d’Ouest Vendôme, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Robert-Debré, Clinique de l’Espérance, Centre Georges-François-Leclerc (CLCC), CHU - Institut cœur-poumon, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital privé, Polyclinique de Limoges - site Émailleurs, Centre Hospitalier La Chartreuse, CHU - Hôpital Roger-Salengro, Clinique urologique Nantes-Atlantis, CH Georges-Daumezon, Polyclinique Saint-Côme, Clinique du Croisé-Laroche, Hôpital Henri-Mondor, Hôpital Saint-Louis, Santé Atlantique, CHU - Hôpital Sud, CMC Pierre-Cherest, Centre François-Baclesse (CLCC), Centre orthopédique médico-chirurgical, Clinique Belledonne, Centre médico-chirurgical du Mans, Clinique la Pergola, Centre ambulatoire Kleber, Clinique Conti, Polyclinique Bordeaux-Rive droite, Pôle de Santé du Villeneuvois, Hôpital Ambroise-Paré, Clinique Saint-George, Clinique Durieux, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Hôpital Pierre-Wertheimer, Hôpital privé Sévigné, CHU - Hôpitaux de Brabois, Hôpital Louis-Mourier, Clinique de l’Yvette, Institut ophtalmique, Clinique Esquirol-Saint-Hilaire, Hôpital européen, CHU - Hôpital Trousseau, Hôpital privé Paris-Essonne, Centre Hospitalier George Sand, CHU - Hôpital de la Côte de nacre, CHU de Martinique, Centre Hospitalier Gérard-Marchant, Clinique Mutualiste de Bretagne Occidentale, Centre Hospitalier des Pyrénées, Centre Hospitalier Montperrin, Centre Hospitalier de Vauclaire, Clinique Arago, Clinique générale, Centre médico-chirurgical et obstétrical, Clinique Saint-Amé, Hôpital privé Natecia, Gustave-Roussy (CLCC), Clinique ambulatoire de Domont, Pôle santé Léonard-de-Vinci, Centre Hospitalier du Rouvray, Polyclinique Vauban, Polyclinique de Navarre, Clinique du Diaconat-Roosevelt, CHU - Hôpital de la Cavale-Blanche, CH Lyon-Sud, CHU Nantes - Hôpital Mère Enfant, Hôpital privé Vert-Coteau, Institut universitaire de la face et du cou, CHU - Hôpital Pontchaillou, Clinique Les Eaux-Claires, Hôpital Hôtel-Dieu, Clinique ophtalmologique Thiers, Clinique Beau-Soleil, Polyclinique de Bordeaux-Tondu, Centre Hospitalier Les Murets, Polyclinique du Parc-Drevon, Hôpital Edouard-Herriot, Hôpital Beaujon, Centre Henri-Becquerel (CLCC), Clinique mutualiste de la Porte-de-l'Orient, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Victor-Hugo, CM Bénigne-Joly, Hôpitaux civils, GH, Groupe hospitalier Nord-Essonne, Clinique du Diaconat-Fonderie, Clinique du Pré, Hôpital privé du Vert-Galant, Clinique Saint-Vincent, Clinique de l’Anjou, Polyclinique de Reims-Bezannes (Marne), CH Montfavet, CHU Grenoble - Site Nord, Clinique du Grand-Large, CHU - Hôpital Central, Clinique Victor-Pauchet, Clinique Bizet, Clinique mutualiste Jules-Verne, CHU - Hôpital Clocheville, CH privé Claude-Galien, Institut Arnault-Tzanck, Clinique Belharra, Hôpital de la Timone (adultes), CHU Sud-Réunion, Clinique du Millénaire, EPSM Morbihan, Hôpitaux pédiatriques, Espm de L’agglomeration Lilloise, Clinique de Bercy, Centre de chirurgie ophtalmologique, CH intercommunal, Clinique du Val-d’Or, Hôpital de la Timone (Enfants), Clinique Charcot, Hôpital Albert Schweitzer, Hopital Joseph-Ducuing, Clinique Clémentville, Hôpital européen Georges-Pompidou, Clinique Saint-Pierre, Polyclinique de Poitiers, Hôpital Antoine-Béclère, Polyclinique du Beaujolais, Hôpital privé de l’Estuaire, Polyclinique Lyon-Nord, Institut Arthur-Vernes, GHI, Hôpital Raymond-Poincaré, Polyclinique Saint-Roch, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôtel-Dieu, Hôpital privé de Villeneuve-d’Ascq, Clinique de la Part-Dieu, Centre Antoine-Lacassagne (CLCC), CH/Clinique, CHU de Nantes, Clinique mutualiste de l’Estuaire, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique Saint-Paul, CHU - Hôpital de l’Archet, Clinique Jean Causse, CHU-Hôpital Purpan/HFE, Clinique Ormeau Pyrénées, Clinique Notre-Dame-de-l’Espérance, Polyclinique Médipôle Saint-Roch, Hôpital Necker-Enfants-Malades, Clinique mutualiste La Sagesse, Euromed Cardio, Polyclinique Santa-Maria, Clinique du sport, Hôpitaux Sud, Clinique Trenel, Centre Hospitalier Le Vinatier, CHU - Hôpital Saint-André, Clinique du Pont-de-Chaume, Centre cardiologique, Hôpitaux Nord (Croix-Rousse), Nouvelle clinique Bel-Air, Groupe Hospitalier de la Rochelle, Clinique Louis-Pasteur, Hôpital Nord, Hôpital de la Pitié-Salpêtrière, Pôle santé Oréliance, Nouvelle clinique de Tours, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé Jean-Mermoz, Polyclinique La Ligne bleue, Grand hôpital de l'Est-Francilien, Clinique de la Sauvegarde, EPSM de la Marne, Hôpital privé de la Seine-Saint-Denis, Maison de santé Bagatelle, CHU - Hôpital Bretonneau, CHU - Hôpital Morvan, Clinique Saint-Nabor, CHU d’Amiens, Hôpital Paul-Brousse, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Sainte-Anne, Centre Hospitalier Henri Guerin, Clinique Sainte-Marie, EPS Ville-Évrard, Clinique Maussins-Nollet, CHU - Centre chirurgical Emile-Gallé, Hôpital de la Timone (enfants), Hôpital Belle-Isle, Hôpital privé de Provence, Clinique Les Fontaines, CH Henri-Laborit, CHU de Pointe-à-Pitre, Epsan, ASM, Clinique Ambroise-Paré, Clinique du Parc, Clinique Pasteur, Polyclinique de la Baie, Polyclinique de Keraudren, Clinique Océane, Hôpital privé Beauregard, Hôpital privé de Marne-la-Vallée, Hôpital privé Cannes-Oxford, Clinique Pasteur-Lanroze, Hôpital Trousseau, Polyclinique de Picardie, Clinique Saint-Jean-de-Dieu, CH national d’ophtalmologie des Quinze-Vingts, Clinique Axium, Clinique du Parc-Monceau, GHP Ambroise-Paré - Hartmann (92), Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Institut de cancérologie Strasbourg Europe, Hôpital Saint-Camille, GH mutualiste, CHU - Hôpital civil, Polyclinique du Grand-Sud, Clinique du Cambrésis, Hôpital Lariboisière-Fernand Widal, CMCO Côte d’Opale, Centre Hospitalier Maurice Despinoy
2025-08-22 20:41:21,530 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 20:41:21,735 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 20:41:21,735 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-22 20:41:21,735 [DEBUG] app.services.pipeline_orchestrator_service: Calling build_ranking_dataframe_with_distances
2025-08-22 20:41:21,735 [INFO] app.services.pipeline_orchestrator_service: Building ranking DataFrame with distances: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', excel_path='/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx', detected_specialty='no specialty match'
2025-08-22 20:41:21,736 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history='None'
2025-08-22 20:41:21,736 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-22 20:41:21,736 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-22 20:41:21,736 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-22 20:41:21,736 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-22 20:41:21,882 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 20:41:21,882 [DEBUG] app.services.data_processing_service: Institution list: Clinique Rive-Gauche, Hôpital privé de Marne Chantereine, Hôpital privé Paul-d’Égine, CH Basse-Terre (Guadeloupe), Centre Hospitalier Le Bon Sauveur, Hôpital Robert Schuman, Hôpital Lariboisière, Clinique Bon-Secours, Clinique de l’Orangerie, Hôpital privé Pays-de-Savoie, Clinique de l'Essonne, Clinique Toulouse-Lautrec, Clinique Saint-Joseph, Clinique du Lac et d’Argonay, Hôpital Avicenne, Clinique de Vitrolles (Bouches-du-Rhône), Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, Clinique de l’Union, Clinique Geoffroy-Saint-Hilaire, CMCO, Clinique mutualiste, Hôpital Jean-Verdier, Clinique Saint-Léonard, Hôpital Robert-Debré, Clinique Lille-Sud, Clinique de l’Estrée, CHU - Hôpital Claude-Huriez, Hôpital d'instruction des armées Legouest, Clinique Jouvenet, Hôpital Bicêtre, CHU - Maternité, Clinique de l’Europe, CHU - Hôpital Pasteur, CH Charles-Perrens, GHU Paris Psychiatrie et neurosciences, Clinique Saint-François, Clinique du Fief-de-Grimoire, CHU - Gabriel-Montpied, Clinique Chantecler, Polyclinique Saint Laurent, Clinique Honoré-Cave, Hôpital Louis-Pradel, Hôpital Saint-Joseph, Polyclinique Côte-Basque-Sud, Clinique Saint-Antoine, Clinique La Croix du Sud, Centre de la main, Hôpital privé La Louvière, Infirmerie protestante de Lyon, Institut Calot, Centre de cardiologie Axium-Rambot, Clinique du Trocadéro, IUCT/Oncopole, CH/clinique, EPSM de Saône-et-Loire, Hôpitaux de Saint-Maurice, EPSM Lille-Métropole, Hôpital Tenon, CHU - Hôpital Larrey, Centre Léon-Bérard (CLCC), CHR de Metz-Thionville - Hôpital de Mercy, Centre Jean-Perrin (CLCC), Hôpital Nord Franche-Comté-Belfort, Institut de cancérologie de Lorraine (CLCC), Hôpital Bichat, Clinique Fontvert, Hôpital d'instruction des armées Desgenettes, Clinique Remusat, Hôpital privé des Peupliers, CHR, Clinique Saint-Charles, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital privé Le Bois, CHU - Hôpital de Hautepierre, Polyclinique Saint-Jean, CHU - Hôpital Rangueil, HCL - Hôpital Femme-mère-enfant, Polyclinique, Centre Oscar-Lambret (CLCC), Centre Eugène-Marquis (CLCC), Grand Hôpital de l'Est Francilien Marne-la-Vallée, Institut de cancérologie de l’Ouest, Clinique Juge, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Centre cardiologique du Nord, CH Esquirol, CHU - Hôpital Saint-Eloi, Clinique mutualiste de Bonneveine, Hôpital Paris Saint-Joseph, Clinique cardiologique, CHU - Hôpital d’Estaing, GCS Clinique du Ter, CHU - Hôpital Haut-Lévêque, Clinique du Tertre-Rouge, Hôpital de la Croix Rousse (HCL) / CH, Clinique Ormeau centre, Centre Hospitalier Drôme Vivarais, Clinique Convert, Institut Jean-Godinot (CLCC), CHU - Hôpital Lapeyronie, Hôpital privé Toulon Hyères-Saint-Jean, Clinique Bretéché, Centre Hospitalier Sainte-Marie, Clinique Sainte-Clotilde, Médipôle Garonne, Hôpital d'instruction des armées Laveran, Clinique de la Plaine, Hôpital Saint-Vincent-de-Paul (GHICL), IUCT Oncopole, CHU Réunion, Clinique des Ormeaux, CHP de l’Europe, Centre Hospitalier d'Erstein, CHU - American Memorial Hospital, Polyclinique de Limoges - site Chénieux, Hôpital Renée-Sabran, Polyclinique Francheville, Clinique Kennedy, Hôpital privé La Montagne Lambert, Hôpital privé Arras-Les Bonnettes, Clinique Paris Lilas, Hôpital-clinique Claude-Bernard, Clinique Saint-André, Clinique Anne-Artois, Polyclinique de Blois, CH privé Saint-Grégoire, CHU de La Réunion - Félix-Guyon, Polyclinique Urbain-V, CH privé Saint-Martin, CHU de Martinique - site Mère-Enfant, Hôpital privé Drôme-Ardèche, Polyclinique du Maine, Clinique Mathilde, Institut d’hématologie et d'oncologie pédiatrique, Clinique de l’Atlantique, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Nord, Hôpital privé de l’Est lyonnais, CH Édouard-Toulouse, Hôpital Saint-Antoine, Institut Paoli-Calmettes (CLCC), CHU - Hôpital Pellegrin, CHU - Hôpital Maison-Blanche, Clinique Jean le Bon, Médipôle Hôpital Privé, CHU - Hôpital Dupuytren, Clinique Saint-Michel, Clinique des Orchidées, Hôpital privé de la Loire, GH Paul Guiraud, Institut Bergonié (CLCC), Centre Clinical, EPSM Etienne-Gourmelen, Clinique Saint-Hilaire, Nouvel Hôpital de Navarre, CHU - Hôpital Gui-de-Chauliac, Institut franco-britannique Kléber, Polyclinique Les Fleurs, Clinique Monticelli-Vélodrome, Hôpital privé de l’Ouest parisien, Hôpital privé des Côtes-d’Armor, CH privé du Montgardé, Centre psychothérapique de Nancy, Hôpital privé d’Antony, Clinique de la Muette, Institut mutualiste Montsouris, CH Guillaume-Régnier, Clinique de l'Alma, Hôpital Foch, Clinique Saint-Augustin, Les Franciscaines, CHU - Hôpitaux mère-enfants, Clinique Marcel-Sembat, CHU Grenoble - Hôpital Sud, Hôpital Saint-Philibert (GHICL), Hôpital privé de La Miotte, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique Claude-Bernard, Clinique Rhéna, Polyclinique de Reims-Bezannes, Hôpital privé Dijon-Bourgogne, CHU - Hôpital Jeanne-de-Flandre, Hôpital Corentin-Celton, Clinique mutualiste catalane, Hôpital privé Nord Parisien, Clinique Bouchard, Hôpital privé La Châtaigneraie, EPS Barthélemy-Durand, Clinique d’Occitanie, Médipôle de Savoie, Clinique Sainte-Marie (GHICL), Polyclinique Saint-François, Hôpital d'instruction des armées Percy, CH Saint-Joseph-Saint-Luc, Hôpital privé Armand-Brillard, Institut du cancer de Montpellier (CLCC), Clinique de la Miséricorde, Clinique du Renaison, Clinique Rhône Durance, CMC de Parly-II, Clinique Delay, CHI, CHU - Hôpital Purpan, Polyclinique Jean-Villar, Fondation Rothschild, Hôpital privé Clairval, Polyclinique Majorelle, Clinique Turin, Pôle Santé République, Hôpital privé Saint-Martin, Polyclinique de la Région-Mantaise, Hôpital d'instruction des armées Bégin, Clinique Tivoli-Ducos, Hôpital privé de la Casamance, Hôpital d'instruction des armées Sainte-Anne, Hôpital des Diaconesses, Hôpital Privé Nancy Lorraine, Polyclinique Aguilera, Polyclinique de Kerio, Centre chirurgical Marie-Lannelongue, Institut Curie, CMC Floréal, Clinique des Franciscaines, Polyclinique Saint-Privat, Hôpital Cochin, CHU - site Nord, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Centre de cardiologie du Pays basque, Clinique des Cèdres, Clinique du Cèdre, Hôpital des Massues, Institut Curie (CLCC), Clinique Saint-Jean - Sud de France, Clinique du Val-d’Ouest Vendôme, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Robert-Debré, Clinique de l’Espérance, Centre Georges-François-Leclerc (CLCC), CHU - Institut cœur-poumon, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital privé, Polyclinique de Limoges - site Émailleurs, Centre Hospitalier La Chartreuse, CHU - Hôpital Roger-Salengro, Clinique urologique Nantes-Atlantis, CH Georges-Daumezon, Polyclinique Saint-Côme, Clinique du Croisé-Laroche, Hôpital Henri-Mondor, Hôpital Saint-Louis, Santé Atlantique, CHU - Hôpital Sud, CMC Pierre-Cherest, Centre François-Baclesse (CLCC), Centre orthopédique médico-chirurgical, Clinique Belledonne, Centre médico-chirurgical du Mans, Clinique la Pergola, Centre ambulatoire Kleber, Clinique Conti, Polyclinique Bordeaux-Rive droite, Pôle de Santé du Villeneuvois, Hôpital Ambroise-Paré, Clinique Saint-George, Clinique Durieux, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Hôpital Pierre-Wertheimer, Hôpital privé Sévigné, CHU - Hôpitaux de Brabois, Hôpital Louis-Mourier, Clinique de l’Yvette, Institut ophtalmique, Clinique Esquirol-Saint-Hilaire, Hôpital européen, CHU - Hôpital Trousseau, Hôpital privé Paris-Essonne, Centre Hospitalier George Sand, CHU - Hôpital de la Côte de nacre, CHU de Martinique, Centre Hospitalier Gérard-Marchant, Clinique Mutualiste de Bretagne Occidentale, Centre Hospitalier des Pyrénées, Centre Hospitalier Montperrin, Centre Hospitalier de Vauclaire, Clinique Arago, Clinique générale, Centre médico-chirurgical et obstétrical, Clinique Saint-Amé, Hôpital privé Natecia, Gustave-Roussy (CLCC), Clinique ambulatoire de Domont, Pôle santé Léonard-de-Vinci, Centre Hospitalier du Rouvray, Polyclinique Vauban, Polyclinique de Navarre, Clinique du Diaconat-Roosevelt, CHU - Hôpital de la Cavale-Blanche, CH Lyon-Sud, CHU Nantes - Hôpital Mère Enfant, Hôpital privé Vert-Coteau, Institut universitaire de la face et du cou, CHU - Hôpital Pontchaillou, Clinique Les Eaux-Claires, Hôpital Hôtel-Dieu, Clinique ophtalmologique Thiers, Clinique Beau-Soleil, Polyclinique de Bordeaux-Tondu, Centre Hospitalier Les Murets, Polyclinique du Parc-Drevon, Hôpital Edouard-Herriot, Hôpital Beaujon, Centre Henri-Becquerel (CLCC), Clinique mutualiste de la Porte-de-l'Orient, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Victor-Hugo, CM Bénigne-Joly, Hôpitaux civils, GH, Groupe hospitalier Nord-Essonne, Clinique du Diaconat-Fonderie, Clinique du Pré, Hôpital privé du Vert-Galant, Clinique Saint-Vincent, Clinique de l’Anjou, Polyclinique de Reims-Bezannes (Marne), CH Montfavet, CHU Grenoble - Site Nord, Clinique du Grand-Large, CHU - Hôpital Central, Clinique Victor-Pauchet, Clinique Bizet, Clinique mutualiste Jules-Verne, CHU - Hôpital Clocheville, CH privé Claude-Galien, Institut Arnault-Tzanck, Clinique Belharra, Hôpital de la Timone (adultes), CHU Sud-Réunion, Clinique du Millénaire, EPSM Morbihan, Hôpitaux pédiatriques, Espm de L’agglomeration Lilloise, Clinique de Bercy, Centre de chirurgie ophtalmologique, CH intercommunal, Clinique du Val-d’Or, Hôpital de la Timone (Enfants), Clinique Charcot, Hôpital Albert Schweitzer, Hopital Joseph-Ducuing, Clinique Clémentville, Hôpital européen Georges-Pompidou, Clinique Saint-Pierre, Polyclinique de Poitiers, Hôpital Antoine-Béclère, Polyclinique du Beaujolais, Hôpital privé de l’Estuaire, Polyclinique Lyon-Nord, Institut Arthur-Vernes, GHI, Hôpital Raymond-Poincaré, Polyclinique Saint-Roch, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôtel-Dieu, Hôpital privé de Villeneuve-d’Ascq, Clinique de la Part-Dieu, Centre Antoine-Lacassagne (CLCC), CH/Clinique, CHU de Nantes, Clinique mutualiste de l’Estuaire, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique Saint-Paul, CHU - Hôpital de l’Archet, Clinique Jean Causse, CHU-Hôpital Purpan/HFE, Clinique Ormeau Pyrénées, Clinique Notre-Dame-de-l’Espérance, Polyclinique Médipôle Saint-Roch, Hôpital Necker-Enfants-Malades, Clinique mutualiste La Sagesse, Euromed Cardio, Polyclinique Santa-Maria, Clinique du sport, Hôpitaux Sud, Clinique Trenel, Centre Hospitalier Le Vinatier, CHU - Hôpital Saint-André, Clinique du Pont-de-Chaume, Centre cardiologique, Hôpitaux Nord (Croix-Rousse), Nouvelle clinique Bel-Air, Groupe Hospitalier de la Rochelle, Clinique Louis-Pasteur, Hôpital Nord, Hôpital de la Pitié-Salpêtrière, Pôle santé Oréliance, Nouvelle clinique de Tours, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé Jean-Mermoz, Polyclinique La Ligne bleue, Grand hôpital de l'Est-Francilien, Clinique de la Sauvegarde, EPSM de la Marne, Hôpital privé de la Seine-Saint-Denis, Maison de santé Bagatelle, CHU - Hôpital Bretonneau, CHU - Hôpital Morvan, Clinique Saint-Nabor, CHU d’Amiens, Hôpital Paul-Brousse, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Sainte-Anne, Centre Hospitalier Henri Guerin, Clinique Sainte-Marie, EPS Ville-Évrard, Clinique Maussins-Nollet, CHU - Centre chirurgical Emile-Gallé, Hôpital de la Timone (enfants), Hôpital Belle-Isle, Hôpital privé de Provence, Clinique Les Fontaines, CH Henri-Laborit, CHU de Pointe-à-Pitre, Epsan, ASM, Clinique Ambroise-Paré, Clinique du Parc, Clinique Pasteur, Polyclinique de la Baie, Polyclinique de Keraudren, Clinique Océane, Hôpital privé Beauregard, Hôpital privé de Marne-la-Vallée, Hôpital privé Cannes-Oxford, Clinique Pasteur-Lanroze, Hôpital Trousseau, Polyclinique de Picardie, Clinique Saint-Jean-de-Dieu, CH national d’ophtalmologie des Quinze-Vingts, Clinique Axium, Clinique du Parc-Monceau, GHP Ambroise-Paré - Hartmann (92), Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Institut de cancérologie Strasbourg Europe, Hôpital Saint-Camille, GH mutualiste, CHU - Hôpital civil, Polyclinique du Grand-Sud, Clinique du Cambrésis, Hôpital Lariboisière-Fernand Widal, CMCO Côte d’Opale, Centre Hospitalier Maurice Despinoy
2025-08-22 20:41:21,883 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Clinique Rive-Gauche, Hôpital privé de Marne Chantereine, Hôpital privé Paul-d’Égine, CH Basse-Terre (Guadeloupe), Centre Hospitalier Le Bon Sauveur, Hôpital Robert Schuman, Hôpital Lariboisière, Clinique Bon-Secours, Clinique de l’Orangerie, Hôpital privé Pays-de-Savoie, Clinique de l'Essonne, Clinique Toulouse-Lautrec, Clinique Saint-Joseph, Clinique du Lac et d’Argonay, Hôpital Avicenne, Clinique de Vitrolles (Bouches-du-Rhône), Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, Clinique de l’Union, Clinique Geoffroy-Saint-Hilaire, CMCO, Clinique mutualiste, Hôpital Jean-Verdier, Clinique Saint-Léonard, Hôpital Robert-Debré, Clinique Lille-Sud, Clinique de l’Estrée, CHU - Hôpital Claude-Huriez, Hôpital d'instruction des armées Legouest, Clinique Jouvenet, Hôpital Bicêtre, CHU - Maternité, Clinique de l’Europe, CHU - Hôpital Pasteur, CH Charles-Perrens, GHU Paris Psychiatrie et neurosciences, Clinique Saint-François, Clinique du Fief-de-Grimoire, CHU - Gabriel-Montpied, Clinique Chantecler, Polyclinique Saint Laurent, Clinique Honoré-Cave, Hôpital Louis-Pradel, Hôpital Saint-Joseph, Polyclinique Côte-Basque-Sud, Clinique Saint-Antoine, Clinique La Croix du Sud, Centre de la main, Hôpital privé La Louvière, Infirmerie protestante de Lyon, Institut Calot, Centre de cardiologie Axium-Rambot, Clinique du Trocadéro, IUCT/Oncopole, CH/clinique, EPSM de Saône-et-Loire, Hôpitaux de Saint-Maurice, EPSM Lille-Métropole, Hôpital Tenon, CHU - Hôpital Larrey, Centre Léon-Bérard (CLCC), CHR de Metz-Thionville - Hôpital de Mercy, Centre Jean-Perrin (CLCC), Hôpital Nord Franche-Comté-Belfort, Institut de cancérologie de Lorraine (CLCC), Hôpital Bichat, Clinique Fontvert, Hôpital d'instruction des armées Desgenettes, Clinique Remusat, Hôpital privé des Peupliers, CHR, Clinique Saint-Charles, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital privé Le Bois, CHU - Hôpital de Hautepierre, Polyclinique Saint-Jean, CHU - Hôpital Rangueil, HCL - Hôpital Femme-mère-enfant, Polyclinique, Centre Oscar-Lambret (CLCC), Centre Eugène-Marquis (CLCC), Grand Hôpital de l'Est Francilien Marne-la-Vallée, Institut de cancérologie de l’Ouest, Clinique Juge, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Centre cardiologique du Nord, CH Esquirol, CHU - Hôpital Saint-Eloi, Clinique mutualiste de Bonneveine, Hôpital Paris Saint-Joseph, Clinique cardiologique, CHU - Hôpital d’Estaing, GCS Clinique du Ter, CHU - Hôpital Haut-Lévêque, Clinique du Tertre-Rouge, Hôpital de la Croix Rousse (HCL) / CH, Clinique Ormeau centre, Centre Hospitalier Drôme Vivarais, Clinique Convert, Institut Jean-Godinot (CLCC), CHU - Hôpital Lapeyronie, Hôpital privé Toulon Hyères-Saint-Jean, Clinique Bretéché, Centre Hospitalier Sainte-Marie, Clinique Sainte-Clotilde, Médipôle Garonne, Hôpital d'instruction des armées Laveran, Clinique de la Plaine, Hôpital Saint-Vincent-de-Paul (GHICL), IUCT Oncopole, CHU Réunion, Clinique des Ormeaux, CHP de l’Europe, Centre Hospitalier d'Erstein, CHU - American Memorial Hospital, Polyclinique de Limoges - site Chénieux, Hôpital Renée-Sabran, Polyclinique Francheville, Clinique Kennedy, Hôpital privé La Montagne Lambert, Hôpital privé Arras-Les Bonnettes, Clinique Paris Lilas, Hôpital-clinique Claude-Bernard, Clinique Saint-André, Clinique Anne-Artois, Polyclinique de Blois, CH privé Saint-Grégoire, CHU de La Réunion - Félix-Guyon, Polyclinique Urbain-V, CH privé Saint-Martin, CHU de Martinique - site Mère-Enfant, Hôpital privé Drôme-Ardèche, Polyclinique du Maine, Clinique Mathilde, Institut d’hématologie et d'oncologie pédiatrique, Clinique de l’Atlantique, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Nord, Hôpital privé de l’Est lyonnais, CH Édouard-Toulouse, Hôpital Saint-Antoine, Institut Paoli-Calmettes (CLCC), CHU - Hôpital Pellegrin, CHU - Hôpital Maison-Blanche, Clinique Jean le Bon, Médipôle Hôpital Privé, CHU - Hôpital Dupuytren, Clinique Saint-Michel, Clinique des Orchidées, Hôpital privé de la Loire, GH Paul Guiraud, Institut Bergonié (CLCC), Centre Clinical, EPSM Etienne-Gourmelen, Clinique Saint-Hilaire, Nouvel Hôpital de Navarre, CHU - Hôpital Gui-de-Chauliac, Institut franco-britannique Kléber, Polyclinique Les Fleurs, Clinique Monticelli-Vélodrome, Hôpital privé de l’Ouest parisien, Hôpital privé des Côtes-d’Armor, CH privé du Montgardé, Centre psychothérapique de Nancy, Hôpital privé d’Antony, Clinique de la Muette, Institut mutualiste Montsouris, CH Guillaume-Régnier, Clinique de l'Alma, Hôpital Foch, Clinique Saint-Augustin, Les Franciscaines, CHU - Hôpitaux mère-enfants, Clinique Marcel-Sembat, CHU Grenoble - Hôpital Sud, Hôpital Saint-Philibert (GHICL), Hôpital privé de La Miotte, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique Claude-Bernard, Clinique Rhéna, Polyclinique de Reims-Bezannes, Hôpital privé Dijon-Bourgogne, CHU - Hôpital Jeanne-de-Flandre, Hôpital Corentin-Celton, Clinique mutualiste catalane, Hôpital privé Nord Parisien, Clinique Bouchard, Hôpital privé La Châtaigneraie, EPS Barthélemy-Durand, Clinique d’Occitanie, Médipôle de Savoie, Clinique Sainte-Marie (GHICL), Polyclinique Saint-François, Hôpital d'instruction des armées Percy, CH Saint-Joseph-Saint-Luc, Hôpital privé Armand-Brillard, Institut du cancer de Montpellier (CLCC), Clinique de la Miséricorde, Clinique du Renaison, Clinique Rhône Durance, CMC de Parly-II, Clinique Delay, CHI, CHU - Hôpital Purpan, Polyclinique Jean-Villar, Fondation Rothschild, Hôpital privé Clairval, Polyclinique Majorelle, Clinique Turin, Pôle Santé République, Hôpital privé Saint-Martin, Polyclinique de la Région-Mantaise, Hôpital d'instruction des armées Bégin, Clinique Tivoli-Ducos, Hôpital privé de la Casamance, Hôpital d'instruction des armées Sainte-Anne, Hôpital des Diaconesses, Hôpital Privé Nancy Lorraine, Polyclinique Aguilera, Polyclinique de Kerio, Centre chirurgical Marie-Lannelongue, Institut Curie, CMC Floréal, Clinique des Franciscaines, Polyclinique Saint-Privat, Hôpital Cochin, CHU - site Nord, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Centre de cardiologie du Pays basque, Clinique des Cèdres, Clinique du Cèdre, Hôpital des Massues, Institut Curie (CLCC), Clinique Saint-Jean - Sud de France, Clinique du Val-d’Ouest Vendôme, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Robert-Debré, Clinique de l’Espérance, Centre Georges-François-Leclerc (CLCC), CHU - Institut cœur-poumon, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital privé, Polyclinique de Limoges - site Émailleurs, Centre Hospitalier La Chartreuse, CHU - Hôpital Roger-Salengro, Clinique urologique Nantes-Atlantis, CH Georges-Daumezon, Polyclinique Saint-Côme, Clinique du Croisé-Laroche, Hôpital Henri-Mondor, Hôpital Saint-Louis, Santé Atlantique, CHU - Hôpital Sud, CMC Pierre-Cherest, Centre François-Baclesse (CLCC), Centre orthopédique médico-chirurgical, Clinique Belledonne, Centre médico-chirurgical du Mans, Clinique la Pergola, Centre ambulatoire Kleber, Clinique Conti, Polyclinique Bordeaux-Rive droite, Pôle de Santé du Villeneuvois, Hôpital Ambroise-Paré, Clinique Saint-George, Clinique Durieux, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Hôpital Pierre-Wertheimer, Hôpital privé Sévigné, CHU - Hôpitaux de Brabois, Hôpital Louis-Mourier, Clinique de l’Yvette, Institut ophtalmique, Clinique Esquirol-Saint-Hilaire, Hôpital européen, CHU - Hôpital Trousseau, Hôpital privé Paris-Essonne, Centre Hospitalier George Sand, CHU - Hôpital de la Côte de nacre, CHU de Martinique, Centre Hospitalier Gérard-Marchant, Clinique Mutualiste de Bretagne Occidentale, Centre Hospitalier des Pyrénées, Centre Hospitalier Montperrin, Centre Hospitalier de Vauclaire, Clinique Arago, Clinique générale, Centre médico-chirurgical et obstétrical, Clinique Saint-Amé, Hôpital privé Natecia, Gustave-Roussy (CLCC), Clinique ambulatoire de Domont, Pôle santé Léonard-de-Vinci, Centre Hospitalier du Rouvray, Polyclinique Vauban, Polyclinique de Navarre, Clinique du Diaconat-Roosevelt, CHU - Hôpital de la Cavale-Blanche, CH Lyon-Sud, CHU Nantes - Hôpital Mère Enfant, Hôpital privé Vert-Coteau, Institut universitaire de la face et du cou, CHU - Hôpital Pontchaillou, Clinique Les Eaux-Claires, Hôpital Hôtel-Dieu, Clinique ophtalmologique Thiers, Clinique Beau-Soleil, Polyclinique de Bordeaux-Tondu, Centre Hospitalier Les Murets, Polyclinique du Parc-Drevon, Hôpital Edouard-Herriot, Hôpital Beaujon, Centre Henri-Becquerel (CLCC), Clinique mutualiste de la Porte-de-l'Orient, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Victor-Hugo, CM Bénigne-Joly, Hôpitaux civils, GH, Groupe hospitalier Nord-Essonne, Clinique du Diaconat-Fonderie, Clinique du Pré, Hôpital privé du Vert-Galant, Clinique Saint-Vincent, Clinique de l’Anjou, Polyclinique de Reims-Bezannes (Marne), CH Montfavet, CHU Grenoble - Site Nord, Clinique du Grand-Large, CHU - Hôpital Central, Clinique Victor-Pauchet, Clinique Bizet, Clinique mutualiste Jules-Verne, CHU - Hôpital Clocheville, CH privé Claude-Galien, Institut Arnault-Tzanck, Clinique Belharra, Hôpital de la Timone (adultes), CHU Sud-Réunion, Clinique du Millénaire, EPSM Morbihan, Hôpitaux pédiatriques, Espm de L’agglomeration Lilloise, Clinique de Bercy, Centre de chirurgie ophtalmologique, CH intercommunal, Clinique du Val-d’Or, Hôpital de la Timone (Enfants), Clinique Charcot, Hôpital Albert Schweitzer, Hopital Joseph-Ducuing, Clinique Clémentville, Hôpital européen Georges-Pompidou, Clinique Saint-Pierre, Polyclinique de Poitiers, Hôpital Antoine-Béclère, Polyclinique du Beaujolais, Hôpital privé de l’Estuaire, Polyclinique Lyon-Nord, Institut Arthur-Vernes, GHI, Hôpital Raymond-Poincaré, Polyclinique Saint-Roch, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôtel-Dieu, Hôpital privé de Villeneuve-d’Ascq, Clinique de la Part-Dieu, Centre Antoine-Lacassagne (CLCC), CH/Clinique, CHU de Nantes, Clinique mutualiste de l’Estuaire, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique Saint-Paul, CHU - Hôpital de l’Archet, Clinique Jean Causse, CHU-Hôpital Purpan/HFE, Clinique Ormeau Pyrénées, Clinique Notre-Dame-de-l’Espérance, Polyclinique Médipôle Saint-Roch, Hôpital Necker-Enfants-Malades, Clinique mutualiste La Sagesse, Euromed Cardio, Polyclinique Santa-Maria, Clinique du sport, Hôpitaux Sud, Clinique Trenel, Centre Hospitalier Le Vinatier, CHU - Hôpital Saint-André, Clinique du Pont-de-Chaume, Centre cardiologique, Hôpitaux Nord (Croix-Rousse), Nouvelle clinique Bel-Air, Groupe Hospitalier de la Rochelle, Clinique Louis-Pasteur, Hôpital Nord, Hôpital de la Pitié-Salpêtrière, Pôle santé Oréliance, Nouvelle clinique de Tours, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé Jean-Mermoz, Polyclinique La Ligne bleue, Grand hôpital de l'Est-Francilien, Clinique de la Sauvegarde, EPSM de la Marne, Hôpital privé de la Seine-Saint-Denis, Maison de santé Bagatelle, CHU - Hôpital Bretonneau, CHU - Hôpital Morvan, Clinique Saint-Nabor, CHU d’Amiens, Hôpital Paul-Brousse, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Sainte-Anne, Centre Hospitalier Henri Guerin, Clinique Sainte-Marie, EPS Ville-Évrard, Clinique Maussins-Nollet, CHU - Centre chirurgical Emile-Gallé, Hôpital de la Timone (enfants), Hôpital Belle-Isle, Hôpital privé de Provence, Clinique Les Fontaines, CH Henri-Laborit, CHU de Pointe-à-Pitre, Epsan, ASM, Clinique Ambroise-Paré, Clinique du Parc, Clinique Pasteur, Polyclinique de la Baie, Polyclinique de Keraudren, Clinique Océane, Hôpital privé Beauregard, Hôpital privé de Marne-la-Vallée, Hôpital privé Cannes-Oxford, Clinique Pasteur-Lanroze, Hôpital Trousseau, Polyclinique de Picardie, Clinique Saint-Jean-de-Dieu, CH national d’ophtalmologie des Quinze-Vingts, Clinique Axium, Clinique du Parc-Monceau, GHP Ambroise-Paré - Hartmann (92), Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Institut de cancérologie Strasbourg Europe, Hôpital Saint-Camille, GH mutualiste, CHU - Hôpital civil, Polyclinique du Grand-Sud, Clinique du Cambrésis, Hôpital Lariboisière-Fernand Widal, CMCO Côte d’Opale, Centre Hospitalier Maurice Despinoy
2025-08-22 20:41:21,883 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 20:41:21,884 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-22 20:41:21,884 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-22 20:41:21,886 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:21,887 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:21,887 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:21,888 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:21,888 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:21,888 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:21,888 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:22,522 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'444'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'475'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_06806dac9dc449b5a9e71ed105c85fa1'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97348100fd52fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:22,522 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:22,523 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:22,536 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:22,537 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:22,537 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:22,537 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '444', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '475', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_06806dac9dc449b5a9e71ed105c85fa1', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97348100fd52fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:22,537 [DEBUG] openai._base_client: request_id: req_06806dac9dc449b5a9e71ed105c85fa1
2025-08-22 20:41:22,538 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:22,538 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:22,538 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 20:41:22,538 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:22,540 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:22,541 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:22,541 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:22,542 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:22,542 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:22,542 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:22,542 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:23,004 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:23 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'279'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'293'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_e5e4e714d4294faf9f109056a43c7a0d'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973481050e76fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:23,005 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:23,005 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:23,010 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:23,011 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:23,011 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:23,011 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:23 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '279', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '293', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_e5e4e714d4294faf9f109056a43c7a0d', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973481050e76fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:23,011 [DEBUG] openai._base_client: request_id: req_e5e4e714d4294faf9f109056a43c7a0d
2025-08-22 20:41:23,012 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 20:41:23,012 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 20:41:23,012 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 20:41:23,012 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:23,014 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:23,015 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:23,015 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:23,016 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:23,016 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:23,016 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:23,016 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:23,671 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:23 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'355'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'487'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_39a48383ad79402da90499f5b2c7d6a3'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973481080d8ffb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:23,672 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:23,672 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:23,674 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:23,674 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:23,674 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:23,674 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:23 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '355', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '487', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_39a48383ad79402da90499f5b2c7d6a3', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973481080d8ffb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:23,675 [DEBUG] openai._base_client: request_id: req_39a48383ad79402da90499f5b2c7d6a3
2025-08-22 20:41:23,675 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 20:41:23,676 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 20:41:23,676 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 20:41:23,676 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-22 20:41:23,676 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:23,676 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:23,676 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-22 20:41:23,676 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:23,679 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:23,679 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:23,680 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:23,680 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:23,680 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:23,680 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:23,680 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:24,165 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:24 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'248'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'325'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_f0e2685e9c0e4c8fb4afdf8475d095a3'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9734810c2f3bfb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:24,166 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:24,166 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:24,166 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:24,166 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:24,166 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:24,167 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:24 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '248', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '325', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_f0e2685e9c0e4c8fb4afdf8475d095a3', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9734810c2f3bfb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:24,167 [DEBUG] openai._base_client: request_id: req_f0e2685e9c0e4c8fb4afdf8475d095a3
2025-08-22 20:41:24,168 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-22 20:41:24,168 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-22 20:41:24,168 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-22 20:41:24,168 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-22 20:41:24,170 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:24,171 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:24,171 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:24,172 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:24,172 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:24,172 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:24,172 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:24,709 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:24 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'353'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'371'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_eba1873b51834e05bfbdd91e3bcecc45'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9734810f3ed5fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:24,710 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:24,710 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:24,715 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:24,715 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:24,715 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:24,715 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:24 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '353', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '371', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_eba1873b51834e05bfbdd91e3bcecc45', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9734810f3ed5fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:24,715 [DEBUG] openai._base_client: request_id: req_eba1873b51834e05bfbdd91e3bcecc45
2025-08-22 20:41:24,716 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-22 20:41:24,716 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-22 20:41:24,716 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-22 20:41:24,716 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-22 20:41:24,716 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-22 20:41:24,719 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:24,719 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:24,720 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:24,720 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:24,720 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:24,720 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:24,720 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:25,260 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:25 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'352'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'376'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_8904d900f6734d8e8db507cd307814e2'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97348112ae29fb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:25,260 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:25,261 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:25,261 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:25,261 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:25,261 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:25,261 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:25 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '352', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '376', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_8904d900f6734d8e8db507cd307814e2', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97348112ae29fb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:25,262 [DEBUG] openai._base_client: request_id: req_8904d900f6734d8e8db507cd307814e2
2025-08-22 20:41:25,262 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-22 20:41:25,263 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-22 20:41:25,263 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-22 20:41:25,265 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-22 20:41:25,266 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-22 20:41:25,267 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-22 20:41:25,267 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-22 20:41:25,267 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-22 20:41:25,267 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-22 20:41:25,267 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-22 20:41:25,819 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Fri, 22 Aug 2025 18:41:25 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'345'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'375'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_2b3f5703c3dc47f28707815869d7f91b'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'973481161d0cfb6d-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-22 20:41:25,820 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-22 20:41:25,820 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-22 20:41:25,826 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-22 20:41:25,826 [DEBUG] httpcore.http11: response_closed.started
2025-08-22 20:41:25,826 [DEBUG] httpcore.http11: response_closed.complete
2025-08-22 20:41:25,827 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Fri, 22 Aug 2025 18:41:25 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '345', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '375', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_2b3f5703c3dc47f28707815869d7f91b', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '973481161d0cfb6d-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-22 20:41:25,827 [DEBUG] openai._base_client: request_id: req_2b3f5703c3dc47f28707815869d7f91b
2025-08-22 20:41:25,828 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-22 20:41:25,828 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-22 20:41:25,828 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-22 20:41:25,858 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-22 20:41:25,858 [DEBUG] app.services.data_processing_service: Institution list: Clinique Rive-Gauche, Hôpital privé de Marne Chantereine, Hôpital privé Paul-d’Égine, CH Basse-Terre (Guadeloupe), Centre Hospitalier Le Bon Sauveur, Hôpital Robert Schuman, Hôpital Lariboisière, Clinique Bon-Secours, Clinique de l’Orangerie, Hôpital privé Pays-de-Savoie, Clinique de l'Essonne, Clinique Toulouse-Lautrec, Clinique Saint-Joseph, Clinique du Lac et d’Argonay, Hôpital Avicenne, Clinique de Vitrolles (Bouches-du-Rhône), Clinique de Villeneuve-d’Ascq, Hôpital d'instruction des armées Robert-Picqué, Clinique de l’Union, Clinique Geoffroy-Saint-Hilaire, CMCO, Clinique mutualiste, Hôpital Jean-Verdier, Clinique Saint-Léonard, Hôpital Robert-Debré, Clinique Lille-Sud, Clinique de l’Estrée, CHU - Hôpital Claude-Huriez, Hôpital d'instruction des armées Legouest, Clinique Jouvenet, Hôpital Bicêtre, CHU - Maternité, Clinique de l’Europe, CHU - Hôpital Pasteur, CH Charles-Perrens, GHU Paris Psychiatrie et neurosciences, Clinique Saint-François, Clinique du Fief-de-Grimoire, CHU - Gabriel-Montpied, Clinique Chantecler, Polyclinique Saint Laurent, Clinique Honoré-Cave, Hôpital Louis-Pradel, Hôpital Saint-Joseph, Polyclinique Côte-Basque-Sud, Clinique Saint-Antoine, Clinique La Croix du Sud, Centre de la main, Hôpital privé La Louvière, Infirmerie protestante de Lyon, Institut Calot, Centre de cardiologie Axium-Rambot, Clinique du Trocadéro, IUCT/Oncopole, CH/clinique, EPSM de Saône-et-Loire, Hôpitaux de Saint-Maurice, EPSM Lille-Métropole, Hôpital Tenon, CHU - Hôpital Larrey, Centre Léon-Bérard (CLCC), CHR de Metz-Thionville - Hôpital de Mercy, Centre Jean-Perrin (CLCC), Hôpital Nord Franche-Comté-Belfort, Institut de cancérologie de Lorraine (CLCC), Hôpital Bichat, Clinique Fontvert, Hôpital d'instruction des armées Desgenettes, Clinique Remusat, Hôpital privé des Peupliers, CHR, Clinique Saint-Charles, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital privé Le Bois, CHU - Hôpital de Hautepierre, Polyclinique Saint-Jean, CHU - Hôpital Rangueil, HCL - Hôpital Femme-mère-enfant, Polyclinique, Centre Oscar-Lambret (CLCC), Centre Eugène-Marquis (CLCC), Grand Hôpital de l'Est Francilien Marne-la-Vallée, Institut de cancérologie de l’Ouest, Clinique Juge, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Centre cardiologique du Nord, CH Esquirol, CHU - Hôpital Saint-Eloi, Clinique mutualiste de Bonneveine, Hôpital Paris Saint-Joseph, Clinique cardiologique, CHU - Hôpital d’Estaing, GCS Clinique du Ter, CHU - Hôpital Haut-Lévêque, Clinique du Tertre-Rouge, Hôpital de la Croix Rousse (HCL) / CH, Clinique Ormeau centre, Centre Hospitalier Drôme Vivarais, Clinique Convert, Institut Jean-Godinot (CLCC), CHU - Hôpital Lapeyronie, Hôpital privé Toulon Hyères-Saint-Jean, Clinique Bretéché, Centre Hospitalier Sainte-Marie, Clinique Sainte-Clotilde, Médipôle Garonne, Hôpital d'instruction des armées Laveran, Clinique de la Plaine, Hôpital Saint-Vincent-de-Paul (GHICL), IUCT Oncopole, CHU Réunion, Clinique des Ormeaux, CHP de l’Europe, Centre Hospitalier d'Erstein, CHU - American Memorial Hospital, Polyclinique de Limoges - site Chénieux, Hôpital Renée-Sabran, Polyclinique Francheville, Clinique Kennedy, Hôpital privé La Montagne Lambert, Hôpital privé Arras-Les Bonnettes, Clinique Paris Lilas, Hôpital-clinique Claude-Bernard, Clinique Saint-André, Clinique Anne-Artois, Polyclinique de Blois, CH privé Saint-Grégoire, CHU de La Réunion - Félix-Guyon, Polyclinique Urbain-V, CH privé Saint-Martin, CHU de Martinique - site Mère-Enfant, Hôpital privé Drôme-Ardèche, Polyclinique du Maine, Clinique Mathilde, Institut d’hématologie et d'oncologie pédiatrique, Clinique de l’Atlantique, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Nord, Hôpital privé de l’Est lyonnais, CH Édouard-Toulouse, Hôpital Saint-Antoine, Institut Paoli-Calmettes (CLCC), CHU - Hôpital Pellegrin, CHU - Hôpital Maison-Blanche, Clinique Jean le Bon, Médipôle Hôpital Privé, CHU - Hôpital Dupuytren, Clinique Saint-Michel, Clinique des Orchidées, Hôpital privé de la Loire, GH Paul Guiraud, Institut Bergonié (CLCC), Centre Clinical, EPSM Etienne-Gourmelen, Clinique Saint-Hilaire, Nouvel Hôpital de Navarre, CHU - Hôpital Gui-de-Chauliac, Institut franco-britannique Kléber, Polyclinique Les Fleurs, Clinique Monticelli-Vélodrome, Hôpital privé de l’Ouest parisien, Hôpital privé des Côtes-d’Armor, CH privé du Montgardé, Centre psychothérapique de Nancy, Hôpital privé d’Antony, Clinique de la Muette, Institut mutualiste Montsouris, CH Guillaume-Régnier, Clinique de l'Alma, Hôpital Foch, Clinique Saint-Augustin, Les Franciscaines, CHU - Hôpitaux mère-enfants, Clinique Marcel-Sembat, CHU Grenoble - Hôpital Sud, Hôpital Saint-Philibert (GHICL), Hôpital privé de La Miotte, CHR de Metz-Thionville - Hôpital Bel-Air, Clinique Claude-Bernard, Clinique Rhéna, Polyclinique de Reims-Bezannes, Hôpital privé Dijon-Bourgogne, CHU - Hôpital Jeanne-de-Flandre, Hôpital Corentin-Celton, Clinique mutualiste catalane, Hôpital privé Nord Parisien, Clinique Bouchard, Hôpital privé La Châtaigneraie, EPS Barthélemy-Durand, Clinique d’Occitanie, Médipôle de Savoie, Clinique Sainte-Marie (GHICL), Polyclinique Saint-François, Hôpital d'instruction des armées Percy, CH Saint-Joseph-Saint-Luc, Hôpital privé Armand-Brillard, Institut du cancer de Montpellier (CLCC), Clinique de la Miséricorde, Clinique du Renaison, Clinique Rhône Durance, CMC de Parly-II, Clinique Delay, CHI, CHU - Hôpital Purpan, Polyclinique Jean-Villar, Fondation Rothschild, Hôpital privé Clairval, Polyclinique Majorelle, Clinique Turin, Pôle Santé République, Hôpital privé Saint-Martin, Polyclinique de la Région-Mantaise, Hôpital d'instruction des armées Bégin, Clinique Tivoli-Ducos, Hôpital privé de la Casamance, Hôpital d'instruction des armées Sainte-Anne, Hôpital des Diaconesses, Hôpital Privé Nancy Lorraine, Polyclinique Aguilera, Polyclinique de Kerio, Centre chirurgical Marie-Lannelongue, Institut Curie, CMC Floréal, Clinique des Franciscaines, Polyclinique Saint-Privat, Hôpital Cochin, CHU - site Nord, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Centre de cardiologie du Pays basque, Clinique des Cèdres, Clinique du Cèdre, Hôpital des Massues, Institut Curie (CLCC), Clinique Saint-Jean - Sud de France, Clinique du Val-d’Ouest Vendôme, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Robert-Debré, Clinique de l’Espérance, Centre Georges-François-Leclerc (CLCC), CHU - Institut cœur-poumon, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital privé, Polyclinique de Limoges - site Émailleurs, Centre Hospitalier La Chartreuse, CHU - Hôpital Roger-Salengro, Clinique urologique Nantes-Atlantis, CH Georges-Daumezon, Polyclinique Saint-Côme, Clinique du Croisé-Laroche, Hôpital Henri-Mondor, Hôpital Saint-Louis, Santé Atlantique, CHU - Hôpital Sud, CMC Pierre-Cherest, Centre François-Baclesse (CLCC), Centre orthopédique médico-chirurgical, Clinique Belledonne, Centre médico-chirurgical du Mans, Clinique la Pergola, Centre ambulatoire Kleber, Clinique Conti, Polyclinique Bordeaux-Rive droite, Pôle de Santé du Villeneuvois, Hôpital Ambroise-Paré, Clinique Saint-George, Clinique Durieux, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Hôpital Pierre-Wertheimer, Hôpital privé Sévigné, CHU - Hôpitaux de Brabois, Hôpital Louis-Mourier, Clinique de l’Yvette, Institut ophtalmique, Clinique Esquirol-Saint-Hilaire, Hôpital européen, CHU - Hôpital Trousseau, Hôpital privé Paris-Essonne, Centre Hospitalier George Sand, CHU - Hôpital de la Côte de nacre, CHU de Martinique, Centre Hospitalier Gérard-Marchant, Clinique Mutualiste de Bretagne Occidentale, Centre Hospitalier des Pyrénées, Centre Hospitalier Montperrin, Centre Hospitalier de Vauclaire, Clinique Arago, Clinique générale, Centre médico-chirurgical et obstétrical, Clinique Saint-Amé, Hôpital privé Natecia, Gustave-Roussy (CLCC), Clinique ambulatoire de Domont, Pôle santé Léonard-de-Vinci, Centre Hospitalier du Rouvray, Polyclinique Vauban, Polyclinique de Navarre, Clinique du Diaconat-Roosevelt, CHU - Hôpital de la Cavale-Blanche, CH Lyon-Sud, CHU Nantes - Hôpital Mère Enfant, Hôpital privé Vert-Coteau, Institut universitaire de la face et du cou, CHU - Hôpital Pontchaillou, Clinique Les Eaux-Claires, Hôpital Hôtel-Dieu, Clinique ophtalmologique Thiers, Clinique Beau-Soleil, Polyclinique de Bordeaux-Tondu, Centre Hospitalier Les Murets, Polyclinique du Parc-Drevon, Hôpital Edouard-Herriot, Hôpital Beaujon, Centre Henri-Becquerel (CLCC), Clinique mutualiste de la Porte-de-l'Orient, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Victor-Hugo, CM Bénigne-Joly, Hôpitaux civils, GH, Groupe hospitalier Nord-Essonne, Clinique du Diaconat-Fonderie, Clinique du Pré, Hôpital privé du Vert-Galant, Clinique Saint-Vincent, Clinique de l’Anjou, Polyclinique de Reims-Bezannes (Marne), CH Montfavet, CHU Grenoble - Site Nord, Clinique du Grand-Large, CHU - Hôpital Central, Clinique Victor-Pauchet, Clinique Bizet, Clinique mutualiste Jules-Verne, CHU - Hôpital Clocheville, CH privé Claude-Galien, Institut Arnault-Tzanck, Clinique Belharra, Hôpital de la Timone (adultes), CHU Sud-Réunion, Clinique du Millénaire, EPSM Morbihan, Hôpitaux pédiatriques, Espm de L’agglomeration Lilloise, Clinique de Bercy, Centre de chirurgie ophtalmologique, CH intercommunal, Clinique du Val-d’Or, Hôpital de la Timone (Enfants), Clinique Charcot, Hôpital Albert Schweitzer, Hopital Joseph-Ducuing, Clinique Clémentville, Hôpital européen Georges-Pompidou, Clinique Saint-Pierre, Polyclinique de Poitiers, Hôpital Antoine-Béclère, Polyclinique du Beaujolais, Hôpital privé de l’Estuaire, Polyclinique Lyon-Nord, Institut Arthur-Vernes, GHI, Hôpital Raymond-Poincaré, Polyclinique Saint-Roch, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôtel-Dieu, Hôpital privé de Villeneuve-d’Ascq, Clinique de la Part-Dieu, Centre Antoine-Lacassagne (CLCC), CH/Clinique, CHU de Nantes, Clinique mutualiste de l’Estuaire, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique Saint-Paul, CHU - Hôpital de l’Archet, Clinique Jean Causse, CHU-Hôpital Purpan/HFE, Clinique Ormeau Pyrénées, Clinique Notre-Dame-de-l’Espérance, Polyclinique Médipôle Saint-Roch, Hôpital Necker-Enfants-Malades, Clinique mutualiste La Sagesse, Euromed Cardio, Polyclinique Santa-Maria, Clinique du sport, Hôpitaux Sud, Clinique Trenel, Centre Hospitalier Le Vinatier, CHU - Hôpital Saint-André, Clinique du Pont-de-Chaume, Centre cardiologique, Hôpitaux Nord (Croix-Rousse), Nouvelle clinique Bel-Air, Groupe Hospitalier de la Rochelle, Clinique Louis-Pasteur, Hôpital Nord, Hôpital de la Pitié-Salpêtrière, Pôle santé Oréliance, Nouvelle clinique de Tours, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé Jean-Mermoz, Polyclinique La Ligne bleue, Grand hôpital de l'Est-Francilien, Clinique de la Sauvegarde, EPSM de la Marne, Hôpital privé de la Seine-Saint-Denis, Maison de santé Bagatelle, CHU - Hôpital Bretonneau, CHU - Hôpital Morvan, Clinique Saint-Nabor, CHU d’Amiens, Hôpital Paul-Brousse, Polyclinique Bordeaux-Nord-Aquitaine, Clinique Sainte-Anne, Centre Hospitalier Henri Guerin, Clinique Sainte-Marie, EPS Ville-Évrard, Clinique Maussins-Nollet, CHU - Centre chirurgical Emile-Gallé, Hôpital de la Timone (enfants), Hôpital Belle-Isle, Hôpital privé de Provence, Clinique Les Fontaines, CH Henri-Laborit, CHU de Pointe-à-Pitre, Epsan, ASM, Clinique Ambroise-Paré, Clinique du Parc, Clinique Pasteur, Polyclinique de la Baie, Polyclinique de Keraudren, Clinique Océane, Hôpital privé Beauregard, Hôpital privé de Marne-la-Vallée, Hôpital privé Cannes-Oxford, Clinique Pasteur-Lanroze, Hôpital Trousseau, Polyclinique de Picardie, Clinique Saint-Jean-de-Dieu, CH national d’ophtalmologie des Quinze-Vingts, Clinique Axium, Clinique du Parc-Monceau, GHP Ambroise-Paré - Hartmann (92), Clinique Saint-Vincent-de-Paul, Polyclinique de Courlancy, Institut de cancérologie Strasbourg Europe, Hôpital Saint-Camille, GH mutualiste, CHU - Hôpital civil, Polyclinique du Grand-Sud, Clinique du Cambrésis, Hôpital Lariboisière-Fernand Widal, CMCO Côte d’Opale, Centre Hospitalier Maurice Despinoy
2025-08-22 20:41:25,859 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-22 20:41:26,006 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-22 20:41:26,006 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-22 20:41:26,006 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-22 20:41:26,007 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-22 20:41:26,007 [INFO] app.services.data_processing_service: generate_data_response called
2025-08-22 20:41:26,007 [DEBUG] app.services.data_processing_service: Extracted values - specialty: 'Cancer de la vessie', institution_type: 'aucune correspondance', city: 'Paris'
2025-08-22 20:41:26,007 [DEBUG] app.services.data_processing_service: No institution type match found, loading by specialty only
2025-08-22 20:41:26,007 [INFO] app.services.data_processing_service: Filtering ranking by criteria: specialty='Cancer de la vessie', institution_type='None'
2025-08-22 20:41:26,007 [DEBUG] app.services.data_processing_service: Filtering ranking data - specialty: 'Cancer de la vessie', institution_type: 'None'
2025-08-22 20:41:26,007 [DEBUG] app.services.data_processing_service: Specialty type: <class 'str'>, length: 19
2025-08-22 20:41:26,007 [DEBUG] app.services.data_processing_service: Available specialties in ranking data: ['Ablation des varices' 'Accidents vasculaires cérébraux'
 'Accouchements à risques' 'Accouchements normaux'
 'Adénome de la prostate' 'Amygdales et végétations'
 'Angioplastie coronaire' 'Appendicite' 'Arthrose de la main' 'Audition'
 'Calculs urinaires' "Cancer de l'estomac et de l'œsophage"
 "Cancer de l'ovaire" "Cancer de l'utérus" 'Cancer de la prostate'
 'Cancer de la thyroïde' 'Cancer de la vessie'
 "Cancer des os de l'enfant et de l'adolescent"
 "Cancer du colon ou de l'intestin" 'Cancer du foie' 'Cancer du pancréas'
 'Cancer du poumon' 'Cancer du rein' 'Cancer du sein' 'Cancer ORL'
 'Cancers de la peau' 'Cardiologie interventionnelle' 'Cataracte'
 'Chirurgie cardiaque adulte' 'Chirurgie cardiaque pédiatrique'
 "Chirurgie de l'épaule" "Chirurgie de l'obésité"
 'Chirurgie de la cheville' 'Chirurgie de la cornée'
 'Chirurgie dentaire et orale de l’adulte'
 'Chirurgie dentaire et orale de l’enfant et de l’adolescent'
 'Chirurgie des artères' "Chirurgie des cancers osseux de l'adulte"
 'Chirurgie des carotides' 'Chirurgie des sarcomes des tissus mous'
 "Chirurgie des testicules de l'adulte"
 "Chirurgie des testicules de l'enfant et de l'adolescent"
 'Chirurgie du canal carpien' "Chirurgie du dos de l'adulte"
 "Chirurgie du dos de l'enfant et de l'adolescent"
 'Chirurgie du nez et des sinus' 'Chirurgie du pied' 'Chirurgie du rectum'
 'Chirurgie maxillo-faciale' 'Dépression' "Diabète de l'adulte"
 "Diabète de l'enfant et de l'adolescent" 'Endométriose'
 "Epilepsie de l'adulte" "Epilepsie de l'enfant et de l'adolescent"
 'Fibrome utérin' 'Glandes salivaires' 'Glaucome' "Hernies de l'abdomen"
 'Hypertension artérielle' 'Infarctus du myocarde'
 'Insuffisance cardiaque' "Leucémie de l'adulte"
 "Leucémie de l'enfant et de l'adolescent" 'Ligaments du genou'
 "Lymphome-Myélome de l'adulte" 'Maladie de Parkinson'
 "Maladies inflammatoires chroniques de l'intestin (MICI)"
 'Médecine vasculaire' 'Pneumologie' 'Proctologie' 'Prothèse de genou'
 'Prothèse de hanche' 'Rétine' 'Schizophrénie' 'Sclérose en plaques'
 'Stimulateurs cardiaques' 'Strabisme'
 'Stress post-traumatique de l’adulte' 'Troubles bipolaires'
 "Tumeurs du cerveau de l'adulte"
 "Tumeurs du cerveau de l'enfant et de l'adolescent" 'Urgences de la main'
 'Vésicule biliaire']
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Accidents vasculaires cérébraux
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements à risques
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements normaux
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-22 20:41:26,008 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'estomac et de l'œsophage
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-22 20:41:26,009 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer des os de l'enfant et de l'adolescent
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du foie
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du pancréas
2025-08-22 20:41:26,010 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cancers de la peau
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-22 20:41:26,011 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque pédiatrique
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-22 20:41:26,012 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des cancers osseux de l'adulte
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des sarcomes des tissus mous
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-22 20:41:26,013 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'enfant et de l'adolescent
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du rectum
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Dépression
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'adulte
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'enfant et de l'adolescent
2025-08-22 20:41:26,014 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'adulte
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'enfant et de l'adolescent
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Hypertension artérielle
2025-08-22 20:41:26,015 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Insuffisance cardiaque
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'adulte
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'enfant et de l'adolescent
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Lymphome-Myélome de l'adulte
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Maladie de Parkinson
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Maladies inflammatoires chroniques de l'intestin (MICI)
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Médecine vasculaire
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-22 20:41:26,016 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Schizophrénie
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Sclérose en plaques
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-22 20:41:26,017 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Stress post-traumatique de l’adulte
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Troubles bipolaires
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'adulte
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'enfant et de l'adolescent
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-22 20:41:26,018 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-22 20:41:26,019 [DEBUG] app.services.data_processing_service: Normalized specialties in DataFrame: ["'ablation des varices'", "'accidents vasculaires cerebraux'", "'accouchements a risques'", "'accouchements normaux'", "'adenome de la prostate'", "'amygdales et vegetations'", "'angioplastie coronaire'", "'appendicite'", "'arthrose de la main'", "'audition'", "'calculs urinaires'", '"cancer de l\'estomac et de l\'œsophage"', '"cancer de l\'ovaire"', '"cancer de l\'uterus"', "'cancer de la prostate'", "'cancer de la thyroide'", "'cancer de la vessie'", '"cancer des os de l\'enfant et de l\'adolescent"', '"cancer du colon ou de l\'intestin"', "'cancer du foie'", "'cancer du pancreas'", "'cancer du poumon'", "'cancer du rein'", "'cancer du sein'", "'cancer orl'", "'cancers de la peau'", "'cardiologie interventionnelle'", "'cataracte'", "'chirurgie cardiaque adulte'", "'chirurgie cardiaque pediatrique'", '"chirurgie de l\'epaule"', '"chirurgie de l\'obesite"', "'chirurgie de la cheville'", "'chirurgie de la cornee'", "'chirurgie dentaire et orale de l’adulte'", "'chirurgie dentaire et orale de l’enfant et de l’adolescent'", "'chirurgie des arteres'", '"chirurgie des cancers osseux de l\'adulte"', "'chirurgie des carotides'", "'chirurgie des sarcomes des tissus mous'", '"chirurgie des testicules de l\'adulte"', '"chirurgie des testicules de l\'enfant et de l\'adolescent"', "'chirurgie du canal carpien'", '"chirurgie du dos de l\'adulte"', '"chirurgie du dos de l\'enfant et de l\'adolescent"', "'chirurgie du nez et des sinus'", "'chirurgie du pied'", "'chirurgie du rectum'", "'chirurgie maxillo-faciale'", "'depression'", '"diabete de l\'adulte"', '"diabete de l\'enfant et de l\'adolescent"', "'endometriose'", '"epilepsie de l\'adulte"', '"epilepsie de l\'enfant et de l\'adolescent"', "'fibrome uterin'", "'glandes salivaires'", "'glaucome'", '"hernies de l\'abdomen"', "'hypertension arterielle'", "'infarctus du myocarde'", "'insuffisance cardiaque'", '"leucemie de l\'adulte"', '"leucemie de l\'enfant et de l\'adolescent"', "'ligaments du genou'", '"lymphome-myelome de l\'adulte"', "'maladie de parkinson'", '"maladies inflammatoires chroniques de l\'intestin (mici)"', "'medecine vasculaire'", "'pneumologie'", "'proctologie'", "'prothese de genou'", "'prothese de hanche'", "'retine'", "'schizophrenie'", "'sclerose en plaques'", "'stimulateurs cardiaques'", "'strabisme'", "'stress post-traumatique de l’adulte'", "'troubles bipolaires'", '"tumeurs du cerveau de l\'adulte"', '"tumeurs du cerveau de l\'enfant et de l\'adolescent"', "'urgences de la main'", "'vesicule biliaire'"]
2025-08-22 20:41:26,019 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-22 20:41:26,020 [DEBUG] app.services.data_processing_service: Normalized specialty from query: ''cancer de la vessie''
2025-08-22 20:41:26,020 [DEBUG] app.services.data_processing_service: Found 2 rows matching single specialty 'Cancer de la vessie' (normalized: 'cancer de la vessie')
2025-08-22 20:41:26,020 [DEBUG] app.services.data_processing_service: Specialties found after specialty filtering: ['Cancer de la vessie']
2025-08-22 20:41:26,021 [INFO] app.services.data_processing_service: generate_response_links called with matching_rows: <class 'pandas.core.frame.DataFrame'>
2025-08-22 20:41:26,021 [INFO] app.services.data_processing_service: Generating ranking links
2025-08-22 20:41:26,021 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-22 20:41:26,021 [DEBUG] app.services.data_processing_service: Generating links for 2 matching rows
2025-08-22 20:41:26,021 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Public
2025-08-22 20:41:26,021 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'public'
2025-08-22 20:41:26,021 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Privé
2025-08-22 20:41:26,021 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'prive'
2025-08-22 20:41:26,022 [INFO] app.services.data_processing_service: Generated ranking links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-22 20:41:26,022 [INFO] app.services.data_processing_service: load_excel_sheets called with matching_rows of length: 2
2025-08-22 20:41:26,022 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Public' for category: 'Public'
2025-08-22 20:41:26,165 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Public' loaded successfully with 40 rows
2025-08-22 20:41:26,166 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Privé' for category: 'Privé'
2025-08-22 20:41:26,308 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Privé' loaded successfully with 20 rows
2025-08-22 20:41:26,308 [DEBUG] app.services.data_processing_service: Concatenating 2 dataframes
2025-08-22 20:41:26,309 [INFO] app.services.data_processing_service: Successfully loaded 2 sheets, total rows: 60
2025-08-22 20:41:26,309 [INFO] app.services.data_processing_service: Loaded specialty DataFrame
2025-08-22 20:41:26,309 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique specialties in DataFrame: N/A
2025-08-22 20:41:26,309 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique institution types in DataFrame: ['Public' 'Privé']
2025-08-22 20:41:26,310 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame columns: Index(['Rang', 'Etablissement', 'Finess', 'ACTIVITE', 'NOTORIETE', 'DMS',
       'RATIO_AMBU', 'INDICE_LOURDEUR', 'TX_ENDOSCOPIE', 'PRADO', 'Note / 20',
       'Catégorie'],
      dtype='object')
2025-08-22 20:41:26,322 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame head:    Rang                                      Etablissement     Finess  ...  PRADO  Note / 20  Catégorie
0     1         Institut mutualiste Montsouris, Paris (75)  750150104  ...    1.0      18.63     Public
1     2                        Hôpital Foch, Suresnes (92)  920000650  ...    1.0      18.50     Public
2     3                    Hôpital Saint-Louis, Paris (75)  750100075  ...    1.0      18.27     Public
3     4      Hôpital européen Georges-Pompidou, Paris (75)  750803447  ...    1.0      18.26     Public
4     5               Hôpital Robert Schuman, Vantoux (57)  570026252  ...    1.0      18.25     Public
5     6  Clinique mutualiste de la Porte-de-l'Orient, L...  560002933  ...    1.0      18.25     Public
6     7             CHU - Hôpital Pellegrin, Bordeaux (33)  330781360  ...    1.0      18.19     Public
7     8                   Hôpital européen, Marseille (13)  130043664  ...    1.0      17.91     Public
8     9         CHU - Hôpital Lapeyronie, Montpellier (34)  340785161  ...    1.0      17.90     Public
9    10             Hôpital Paris Saint-Joseph, Paris (75)  750000523  ...    1.0      17.84     Public

[10 rows x 12 columns]
2025-08-22 20:41:26,323 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Filtering for specialty: 'Cancer de la vessie' and city: 'Paris'
2025-08-22 20:41:26,323 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Specialty match count: N/A
2025-08-22 20:41:26,323 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] City match count: N/A
2025-08-22 20:41:26,323 [INFO] app.services.pipeline_orchestrator_service: Extracting hospital locations and calculating distances
2025-08-22 20:41:26,323 [INFO] app.services.data_processing_service: extract_local_hospitals called with df: <class 'NoneType'>
2025-08-22 20:41:26,323 [INFO] app.services.data_processing_service: Merging ranking data with hospital location data
2025-08-22 20:41:26,326 [DEBUG] app.services.data_processing_service: Merged DataFrame shape (with cities): (60, 6)
2025-08-22 20:41:26,326 [INFO] app.services.data_processing_service: get_df_with_distances called
2025-08-22 20:41:26,326 [INFO] app.services.data_processing_service: Calculating distances from query city: Paris
2025-08-22 20:41:26,363 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-22 20:41:26,363 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-22 20:41:26,363 [DEBUG] geopy: Nominatim.geocode: https://nominatim.openstreetmap.org/search?q=Paris&format=json&limit=1
2025-08-22 20:41:26,364 [DEBUG] urllib3.connectionpool: Starting new HTTPS connection (1): nominatim.openstreetmap.org:443
2025-08-22 20:41:26,908 [DEBUG] urllib3.connectionpool: https://nominatim.openstreetmap.org:443 "GET /search?q=Paris&format=json&limit=1 HTTP/1.1" 200 444
2025-08-22 20:41:26,910 [DEBUG] app.services.data_processing_service: Query city coordinates: (48.8534951, 2.3483915)
2025-08-22 20:41:26,954 [DEBUG] app.services.data_processing_service: DataFrame with distances shape after filtering: (60, 7)
2025-08-22 20:41:26,954 [DEBUG] app.services.data_processing_service: Distance column values after filtering: [397.16421568228793, 664.5671165057212, 415.42021849676877, 454.6232692587221, 628.9272762614704, 372.76695725398446, 187.64257370100052, 346.44804063177855, 204.9061679313438, 345.3834222363833, 594.4783082353262, 409.73559161431035, 498.73884900510325, 308.98876258531186, 587.6020165018895, 201.6803175167258, 281.9666122654773, 113.41737487155112, 264.6693413955004, 578.6238060003169, 16.726792716267678, 587.6020165018895, 440.6409364823054, 398.5542834873119, 498.73884900510325, 547.7564737199306, 264.6693413955004, 684.864748960447, 441.30736307891743, 382.66401151108664, 409.73559161431035, 481.9811724587299, 0.0, 4.592712151579527, 9.217278413662884, 11.453781374536742, 364.4347650853049, 0.0, 282.41401459727837, 285.7997399851394, 0.0, 0.0, 660.3147713621365, 0.0, 0.0, 660.3147713621365, 204.9061679313438, 638.1373345264166, 378.3676161619013, 380.29745819875353, 660.3147713621365, 0.0, 498.73884900510325, 687.7062403382804, 613.2211062491715, 506.307887243086, 345.3834222363833, 652.4186260952922, 588.3439902102477, 578.6238060003169]
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned DataFrame: <class 'pandas.core.frame.DataFrame'>
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Checking if DataFrame is None
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Retrieved DataFrame shape: (60, 7)
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Checking for geolocation API errors
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Getting ranking link for UI
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Checking for specialty_ranking_unavailable
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Checking if institution is mentioned
2025-08-22 20:41:26,955 [DEBUG] app.services.pipeline_orchestrator_service: Checking if city is detected
2025-08-22 20:41:26,955 [INFO] app.services.pipeline_orchestrator_service: City found, searching for results using multi-radius search
2025-08-22 20:41:26,959 [DEBUG] multi_radius_search: [multi_radius_search] Called with radii: [5, 10, 50, 100]
2025-08-22 20:41:26,959 [DEBUG] multi_radius_search: [multi_radius_search] Initial public_df shape: (3, 7)
2025-08-22 20:41:26,959 [DEBUG] multi_radius_search: [multi_radius_search] Initial private_df shape: (3, 7)
2025-08-22 20:41:26,959 [DEBUG] multi_radius_search: [multi_radius_search] Trying radius: 5
2025-08-22 20:41:26,960 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered shape: (2, 7)
2025-08-22 20:41:26,960 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered shape: (0, 7)
2025-08-22 20:41:26,965 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered head:                                  Etablissement   City   Latitude  Longitude Catégorie  Note / 20  Distance
51  Institut mutualiste Montsouris, Paris (75)  Paris  48.853495   2.348391    Public      18.63       0.0
40             Hôpital Saint-Louis, Paris (75)  Paris  48.853495   2.348391    Public      18.27       0.0
2025-08-22 20:41:26,965 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered head: Empty DataFrame
Columns: [Etablissement, City, Latitude, Longitude, Catégorie, Note / 20, Distance]
Index: []
2025-08-22 20:41:26,966 [DEBUG] multi_radius_search: [multi_radius_search] Trying radius: 10
2025-08-22 20:41:26,966 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered shape: (3, 7)
2025-08-22 20:41:26,966 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered shape: (0, 7)
2025-08-22 20:41:26,972 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered head:                                  Etablissement      City   Latitude  Longitude Catégorie  Note / 20  Distance
51  Institut mutualiste Montsouris, Paris (75)     Paris  48.853495   2.348391    Public      18.63  0.000000
34                 Hôpital Foch, Suresnes (92)  Suresnes  48.870905   2.225573    Public      18.50  9.217278
40             Hôpital Saint-Louis, Paris (75)     Paris  48.853495   2.348391    Public      18.27  0.000000
2025-08-22 20:41:26,972 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered head: Empty DataFrame
Columns: [Etablissement, City, Latitude, Longitude, Catégorie, Note / 20, Distance]
Index: []
2025-08-22 20:41:26,972 [DEBUG] multi_radius_search: [multi_radius_search] Returning results at radius 10
2025-08-22 20:41:26,973 [DEBUG] app.services.pipeline_orchestrator_service: Formatting response with specialty: base_message='Voici les meilleurs établissements (rayon utilisé : 10 km)', count=3, radius_km=10, city=Paris
2025-08-22 20:41:26,973 [DEBUG] app.services.pipeline_orchestrator_service: Normalizing specialty for display: Cancer de la vessie
2025-08-22 20:41:26,973 [INFO] app.services.pipeline_orchestrator_service: Creating response and logging for prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-22 20:41:26,973 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-22 20:41:26,974 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-22 20:41:26,974 [DEBUG] app.services.pipeline_orchestrator_service: Formatted response: Voici les meilleurs établissements (rayon utilisé : 10 km)
<br>Aucun établissement privé trouvé.<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public situé à 0 km. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public situé à 9 km. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public situé à 0 km. avec une note de 18.27 de 20

🔗 Consultez la méthodologie de palmarès hopitaux <a href="https://www.lepoint.fr/sante/la-methodologie-du-palmares-des-hopitaux-et-cliniques-du-point-2024--04-12-2024-2577146_40.php" target="_blank">ici</a>.
2025-08-22 20:41:26,974 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 2
2025-08-22 20:43:53,240 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:43:53,240 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:43:53,240 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:43:53,240 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:43:53,240 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:43:53,242 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:43:53,242 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:43:53,242 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:43:53,380 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:43:53,380 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:43:53,381 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:43:53,385 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:43:53,386 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:43:53,588 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:43:53,589 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:43:53,589 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:43:53,589 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:43:53,590 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:43:53,590 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:43:53,661 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:43:53,662 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:43:53,662 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:43:53,664 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:43:53,664 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:43:53,664 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:43:53,664 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:43:53,664 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:43:53,666 [INFO] main: Creating FastAPI app
2025-08-22 20:43:53,666 [INFO] main: CORS middleware added
2025-08-22 20:43:53,667 [INFO] main: API router included
2025-08-22 20:45:58,682 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:45:58,682 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:45:58,682 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:45:58,682 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:45:58,682 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:45:58,684 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:45:58,684 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:45:58,684 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:45:58,838 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:45:58,838 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:45:58,838 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:45:58,843 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:45:58,843 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:45:59,055 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:45:59,055 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:45:59,055 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:45:59,056 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:45:59,056 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:45:59,056 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:45:59,133 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:45:59,133 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:45:59,134 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:45:59,136 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:45:59,136 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:45:59,136 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:45:59,136 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:45:59,136 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:45:59,138 [INFO] main: Creating FastAPI app
2025-08-22 20:45:59,138 [INFO] main: CORS middleware added
2025-08-22 20:45:59,140 [INFO] main: API router included
2025-08-22 20:48:54,292 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:48:54,292 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:48:54,292 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:48:54,293 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:48:54,293 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:48:54,294 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:48:54,294 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:48:54,294 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:48:54,441 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:48:54,441 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:48:54,441 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:48:54,445 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:48:54,445 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:48:54,644 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:48:54,644 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:48:54,644 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:48:54,645 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:48:54,645 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:48:54,645 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:48:54,716 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:48:54,717 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:48:54,717 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:48:54,719 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:48:54,719 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:48:54,719 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:48:54,719 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:48:54,719 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:48:54,721 [INFO] main: Creating FastAPI app
2025-08-22 20:48:54,721 [INFO] main: CORS middleware added
2025-08-22 20:48:54,722 [INFO] main: API router included
2025-08-22 20:53:06,003 [INFO] app.api.routes: Initializing core services...
2025-08-22 20:53:06,003 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-22 20:53:06,003 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-22 20:53:06,003 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:53:06,003 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:53:06,004 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:53:06,005 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:53:06,005 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:53:06,144 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:53:06,144 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:53:06,144 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:53:06,148 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:53:06,148 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:53:06,350 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-22 20:53:06,350 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-22 20:53:06,350 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-22 20:53:06,351 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-22 20:53:06,351 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-22 20:53:06,351 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-22 20:53:06,423 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-22 20:53:06,423 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-22 20:53:06,423 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-22 20:53:06,425 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:53:06,425 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:53:06,425 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-22 20:53:06,425 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-22 20:53:06,425 [INFO] app.api.routes: Core services initialized successfully
2025-08-22 20:53:06,427 [INFO] main: Creating FastAPI app
2025-08-22 20:53:06,427 [INFO] main: CORS middleware added
2025-08-22 20:53:06,428 [INFO] main: API router included
2025-08-25 11:00:28,241 [INFO] app.api.routes: Initializing core services...
2025-08-25 11:00:28,242 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 11:00:28,242 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 11:00:28,242 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 11:00:28,242 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 11:00:28,243 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 11:00:28,244 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 11:00:28,244 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 11:00:28,391 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 11:00:28,391 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 11:00:28,391 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 11:00:28,396 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 11:00:28,396 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 11:00:28,866 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 11:00:28,866 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 11:00:28,866 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 11:00:28,867 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 11:00:28,867 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 11:00:28,867 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 11:00:28,940 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 11:00:28,941 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 11:00:28,941 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 11:00:28,943 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 11:00:28,943 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 11:00:28,943 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 11:00:28,943 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 11:00:28,943 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 11:00:28,945 [INFO] main: Creating FastAPI app
2025-08-25 11:00:28,945 [INFO] main: CORS middleware added
2025-08-25 11:00:28,946 [INFO] main: API router included
2025-08-25 11:00:59,368 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 11:00:59,369 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 11:00:59,369 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 11:00:59,369 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 11:00:59,369 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 11:00:59,377 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:00:59,407 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:00:59,407 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 11:00:59,445 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x112db9010>
2025-08-25 11:00:59,445 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1125d85f0> server_hostname='api.openai.com' timeout=None
2025-08-25 11:00:59,471 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x112d71090>
2025-08-25 11:00:59,471 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:00:59,472 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:00:59,472 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:00:59,472 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:00:59,472 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:00:59,967 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:01 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'306'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'326'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_42f3aef5047744b4b3935234fd624bdc'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=1NeXnuKVOPh4qKvTOwyt7FV6XVehrzH0n9K4R1SYA.o-1756112461-1.0.1.1-1z8K8W0UPfeg_jCccUReKWfFTfcNlKcjTmyF4cJKa_loryuJuGxAfPfL3D0dQyIvpR7d54oE_OjM3YOQA48N9_EPN8pu21ZuJB_fQjOiYJU; path=/; expires=Mon, 25-Aug-25 09:31:01 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=mKFsJ09Ni8z.cZ6EIvT9T1QkjbARW1ZBpx79UqhUPSk-1756112461921-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7040df12120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:00:59,968 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:00:59,968 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:00:59,969 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:00:59,969 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:00:59,969 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:00:59,969 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 09:01:01 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '306'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '326'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_42f3aef5047744b4b3935234fd624bdc'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=1NeXnuKVOPh4qKvTOwyt7FV6XVehrzH0n9K4R1SYA.o-1756112461-1.0.1.1-1z8K8W0UPfeg_jCccUReKWfFTfcNlKcjTmyF4cJKa_loryuJuGxAfPfL3D0dQyIvpR7d54oE_OjM3YOQA48N9_EPN8pu21ZuJB_fQjOiYJU; path=/; expires=Mon, 25-Aug-25 09:31:01 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=mKFsJ09Ni8z.cZ6EIvT9T1QkjbARW1ZBpx79UqhUPSk-1756112461921-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9749e7040df12120-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 11:00:59,969 [DEBUG] openai._base_client: request_id: req_42f3aef5047744b4b3935234fd624bdc
2025-08-25 11:00:59,977 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 11:00:59,977 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 11:00:59,980 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:00:59,981 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:00:59,982 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:00:59,982 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:00:59,982 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:00:59,982 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:00:59,982 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:00,728 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:02 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'478'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'500'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_4d2df474ff414a56a74f4f4f76f74c83'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7073f7c2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:00,728 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:00,729 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:00,737 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:00,737 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:00,737 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:00,737 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:02 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '478', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '500', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_4d2df474ff414a56a74f4f4f76f74c83', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e7073f7c2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:00,738 [DEBUG] openai._base_client: request_id: req_4d2df474ff414a56a74f4f4f76f74c83
2025-08-25 11:01:00,738 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 11:01:00,738 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history=''
2025-08-25 11:01:00,739 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-25 11:01:00,739 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-25 11:01:00,739 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-25 11:01:00,739 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-25 11:01:00,892 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-25 11:01:00,892 [DEBUG] app.services.data_processing_service: Institution list: Hôpital Lariboisière, Hôpital privé de la Casamance, Clinique Kennedy, CHU Nantes - Hôpital Mère Enfant, Nouvel Hôpital de Navarre, Hôtel-Dieu, Clinique Arago, EPS Barthélemy-Durand, Polyclinique Lyon-Nord, CHU - Hôpital de la Cavale-Blanche, Pôle santé Léonard-de-Vinci, Clinique Turin, Polyclinique Saint-Jean l’Ermitage, Clinique Les Eaux-Claires, Institut Arnault-Tzanck, CHU - Hôpital Clocheville, Clinique de la Muette, Hôpital européen, Hôpital privé Toulon Hyères-Saint-Jean, Polyclinique de Reims-Bezannes (Marne), CHU - Gabriel-Montpied, Clinique Durieux, Clinique Océane, Polyclinique de Poitiers, Hôpital privé des Côtes-d’Armor, Centre François-Baclesse (CLCC), Clinique ophtalmologique Thiers, EPSM Etienne-Gourmelen, Infirmerie protestante de Lyon, Hôpital Jean-Verdier, Clinique Fontvert, Centre de la main, Clinique Saint-Jean-de-Dieu, CHU - Hôpital Trousseau, Hôpitaux Nord (Croix-Rousse), Hôpital Saint-Louis, CHU - Hôpital Dupuytren, Clinique Belledonne, CHU - Hôpital Haut-Lévêque, CHU Grenoble - Hôpital Sud, Epsan, Clinique de la Miséricorde, Centre de cardiologie du Pays basque, Clinique Saint-Léonard, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), CH Lyon-Sud, Institut Jean-Godinot (CLCC), Clinique du Parc-Monceau, Pôle santé Oréliance, Clinique Saint-Amé, Clinique du Fief-de-Grimoire, CHU - Hôpital de Hautepierre, Hôpital privé du Confluent, CHU d’Amiens, Clinique Claude-Bernard, Hôpital de la Croix-Saint-Simon, Hôpital privé Paul-d’Égine, Hôpital Lariboisière-Fernand Widal, Hôpital privé Vert-Coteau, Hôpital privé Clairval, Polyclinique de Limoges - site Chénieux, Clinique du Val-d’Or, Clinique Sainte-Clotilde, Hôpital d'instruction des armées Sainte-Anne, CH/clinique, Clinique de l’Europe, Polyclinique Jean-Villar, CHR de Metz-Thionville - Hôpital Bel-Air, Polyclinique du Grand-Sud, Hôpital Nord, Hôpital Pierre-Wertheimer, Hôpital Ambroise-Paré, Hôpital privé de la Seine-Saint-Denis, CHU - Hôpital Bretonneau, Clinique de Vitrolles (Bouches-du-Rhône), Hôpital Louis-Mourier, Hôpital d'instruction des armées Bégin, Polyclinique de Limoges - site Émailleurs, Hôpital de la Croix Rousse (HCL) / CH, Hôpital d'instruction des armées Legouest, CHU - site Nord, Clinique Esquirol-Saint-Hilaire, CHU Sud-Réunion, Clinique Jean Causse, CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé Armand-Brillard, Clinique Sainte-Anne, Hôpital privé Dijon-Bourgogne, Polyclinique Côte-Basque-Sud, CH Guillaume-Régnier, Hôpital Albert Schweitzer, Clinique Saint-Charles, CHU - Hôpital Larrey, HCL - Hôpital Femme-mère-enfant, Clinique Maussins-Nollet, Centre ambulatoire Kleber, Polyclinique de la Région-Mantaise, EPSM de Saône-et-Loire, Polyclinique Santa-Maria, Polyclinique du Parc-Drevon, Hôpital Paul-Brousse, Clinique Juge, GH mutualiste, CH Saint-Joseph-Saint-Luc, Polyclinique Saint-Jean, Clinique Victor-Pauchet, Clinique des Orchidées, Hôpital privé Arras-Les Bonnettes, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, Clinique de l’Yvette, Clinique du Pré, CHU - Hôpital Claude-Huriez, Clinique Bouchard, Clinique de l’Estrée, Clinique Lille-Sud, Hôpital privé Pays-de-Savoie, Clinique du Croisé-Laroche, Polyclinique, Clinique Saint-Hilaire, Hôpital-clinique Claude-Bernard, CHU - Hôpital Purpan, Hôpital privé Natecia, CH Basse-Terre (Guadeloupe), Institut Paoli-Calmettes (CLCC), Clinique du Millénaire, Polyclinique Les Fleurs, Euromed Cardio, CHU de Nantes, Polyclinique Majorelle, Centre Psychothérapique, Hôpital privé La Châtaigneraie, Clinique Sainte-Marie, Centre Jean-Perrin (CLCC), CHU - Hôpital Pellegrin, Centre Hospitalier Sainte-Marie, Hopital Joseph-Ducuing, GHI, Médipôle de Savoie, Médipôle Hôpital Privé, Clinique Sainte-Marie (GHICL), Les Franciscaines, Hôpital Saint-Antoine, Clinique Convert, Clinique Tivoli-Ducos, Hôpitaux Sud, Clinique Saint-Vincent-de-Paul, Centre orthopédique médico-chirurgical, CHU de Martinique, Centre cardiologique, Clinique du Tertre-Rouge, Clinique Paris Lilas, Clinique de Bercy, CHU - Hôpital Pontchaillou, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Clinique Anne-Artois, Centre Georges-François-Leclerc (CLCC), Hôpital privé du Vert-Galant, Clinique La Croix du Sud, Centre chirurgical Marie-Lannelongue, Centre Henri-Becquerel (CLCC), Clinique Marcel-Sembat, Clinique Louis-Pasteur, Clinique cardiologique, Hôpital européen Georges-Pompidou, CMCO Côte d’Opale, GHU Paris Psychiatrie et neurosciences, Hôpital d'instruction des armées Desgenettes, Institut du cancer de Montpellier (CLCC), Hôpital Bicêtre, Médipôle Garonne, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Jean - Sud de France, Clinique Bretéché, Clinique Trenel, CH privé Claude-Galien, Clinique du Lac et d’Argonay, CM Bénigne-Joly, Clinique Saint-André, GH Paul Guiraud, Clinique du Pont-de-Chaume, Centre Hospitalier Gérard-Marchant, Clinique Notre-Dame-de-l’Espérance, Institut ophtalmique, Centre Hospitalier George Sand, Hôpital Robert-Debré, Clinique Ambroise-Paré, CHU - Hôpital de l’Archet, Clinique Saint-Pierre, Nouvelle clinique de Tours, Grand hôpital de l'Est-Francilien, Clinique du Diaconat-Roosevelt, Centre Hospitalier du Rouvray, CHU - Hôpital Saint-Eloi, CH Charles-Perrens, CHR de Metz-Thionville - Hôpital de Mercy, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Keraudren, CMC Pierre-Cherest, Centre Hospitalier d'Erstein, Hôpital Belle-Isle, Hôpital privé Drôme-Ardèche, Polyclinique Bordeaux-Rive droite, Clinique du sport, Clinique de l’Espérance, Clinique mutualiste, Clinique du Cambrésis, Polyclinique de Reims-Bezannes, Clinique Toulouse-Lautrec, Nouvelle clinique Bel-Air, Clinique Belharra, Clinique du Trocadéro, Clinique Saint-Joseph, Hôpital privé de La Miotte, Hôpital Beaujon, Clinique Jouvenet, Hôpital privé de Provence, Santé Atlantique, Polyclinique de Picardie, CHU - Hôpital d’Estaing, Clinique Rhéna, Hôpital Louis-Pradel, Clinique de l'Alma, Clinique mutualiste de l’Estuaire, Groupe hospitalier Nord-Essonne, Centre Léon-Bérard (CLCC), Centre Hospitalier Henri Guerin, Espm de L’agglomeration Lilloise, CH Esquirol, Polyclinique Saint Laurent, CHU - Hôpital Saint-André, Institut Calot, Polyclinique Aguilera, CHU - Hôpital de la Côte de nacre, Hôpitaux civils, Polyclinique La Ligne bleue, Clinique Saint-François, Hôpital Necker-Enfants-Malades, Clinique du Cèdre, Clinique de la Plaine, Hôpital Tenon, Hôpital Paris Saint-Joseph, CHU - Hôpital civil, Polyclinique Bordeaux-Nord-Aquitaine, Hôpital privé de l’Ouest parisien, Institut Bergonié (CLCC), Polyclinique de Blois, Hôpital d'instruction des armées Robert-Picqué, CH Henri-Laborit, Institut de cancérologie Strasbourg Europe, CH Montfavet, Clinique la Pergola, Clinique mutualiste Jules-Verne, Hôpital privé de Marne-la-Vallée, Hôpital des Massues, Clinique Victor-Hugo, CHP de l’Europe, Clinique des Ormeaux, Hôpital de la Timone (Enfants), Institut mutualiste Montsouris, Institut Curie, ASM, Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, CH privé du Montgardé, Hôpital Henri-Mondor, Clinique Saint-Antoine, Clinique de l’Orangerie, Hôpital d'instruction des armées Laveran, Clinique Chantecler, Hôpitaux de Saint-Maurice, Hôpital Corentin-Celton, Clinique mutualiste de Bonneveine, Clinique Jean le Bon, Clinique d’Occitanie, Clinique Pasteur-Lanroze, Clinique Saint-Nabor, CHU - Maternité, Hôpital privé de la Loire, Hôpital Nord Franche-Comté-Belfort, Centre Hospitalier Les Murets, Clinique du Parc, Hôpital Trousseau, Polyclinique Médipôle Saint-Roch, Hôpital Saint-Joseph, Clinique de la Sauvegarde, Clinique des Cèdres, Hôpital privé Beauregard, Institut de cancérologie de l’Ouest, Clinique Mathilde, EPSM Lille-Métropole, Hôpital privé Cannes-Oxford, EPS Ville-Évrard, Institut de cancérologie de Lorraine (CLCC), Hôpital Saint-Vincent-de-Paul (GHICL), Groupe Hospitalier de la Rochelle, Hôpital d'instruction des armées Percy, CHU - Hôpital Central, CHU de Pointe-à-Pitre, Hôpital Saint-Philibert (GHICL), CHU - Hôpital Sud, EPSM de la Marne, Gustave-Roussy (CLCC), Centre Hospitalier Le Vinatier, Clinique Clémentville, CH privé Saint-Grégoire, Institut d’hématologie et d'oncologie pédiatrique, Hôpital privé Paris-Essonne, CHU - Hôpitaux de Brabois, Clinique Beau-Soleil, Polyclinique de Courlancy, Centre Hospitalier Montperrin, Maison de santé Bagatelle, Polyclinique du Parc, Clinique Delay, CHU - Hôpital Morvan, Hôpital Privé Nancy Lorraine, Clinique du Renaison, CH Édouard-Toulouse, CHI, CHU - Hôpitaux mère-enfants, Hôpital Edouard-Herriot, Hôpital Saint-Camille, Polyclinique du Maine, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de l’Estuaire, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Hôpital privé Nord Parisien, Clinique Ormeau centre, Centre Hospitalier Le Bon Sauveur, Polyclinique Saint-François, Hôpital privé La Montagne Lambert, Hôpital de la Pitié-Salpêtrière, CHR, Clinique mutualiste de la Porte-de-l'Orient, CH/Clinique, Fondation Rothschild, CHU Grenoble - Site Nord, Centre Eugène-Marquis (CLCC), Clinique Remusat, Hôpital Raymond-Poincaré, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Axium, Clinique du Grand-Large, Hôpital privé Jean-Mermoz, Clinique Geoffroy-Saint-Hilaire, Hôpitaux pédiatriques, Hôpital Hôtel-Dieu, Hôpital Foch, CHU - American Memorial Hospital, Centre Hospitalier des Pyrénées, Hôpital de la Timone (adultes), Institut franco-britannique Kléber, Clinique de la Part-Dieu, CHU - Hôpital Gui-de-Chauliac, Clinique Saint-Michel, Hôpital de la Timone (enfants), Polyclinique Saint-Roch, Polyclinique de Navarre, Clinique Les Fontaines, Clinique générale, Centre Hospitalier de Vauclaire, Clinique de l’Union, CH intercommunal, Clinique Honoré-Cave, Clinique des Franciscaines, Centre Clinical, Clinique Ormeau Pyrénées, Clinique Saint-Vincent, Centre de chirurgie ophtalmologique, CHU - Centre chirurgical Emile-Gallé, Polyclinique Saint-Côme, Institut Arthur-Vernes, CHU - Hôpital Robert-Debré, Clinique Bizet, Clinique Monticelli-Vélodrome, Pôle Santé République, CHU - Hôpital Nord, CHU - Institut cœur-poumon, Polyclinique du Beaujolais, CHU de Martinique - site Mère-Enfant, Clinique Saint-George, CMC de Parly-II, Centre psychothérapique de Nancy, CHU - Hôpital Pasteur, Institut Curie (CLCC), Hôpital privé, Hôpital privé Saint-Martin, EPSM Morbihan, CHU-Hôpital Purpan/HFE, Hôpital privé de l’Est lyonnais, Clinique Conti, Pôle de Santé du Villeneuvois, Centre Hospitalier Maurice Despinoy, CH privé Saint-Martin, Hôpital Antoine-Béclère, Grand Hôpital de l'Est Francilien Marne-la-Vallée, CHU - Hôpital Roger-Salengro, Centre Hospitalier Drôme Vivarais, Clinique Pasteur, Clinique du Diaconat-Fonderie, Centre Hospitalier La Chartreuse, CHU Réunion, Centre médico-chirurgical et obstétrical, CH Georges-Daumezon, IUCT Oncopole, IUCT/Oncopole, Hôpital privé de Marne Chantereine, Clinique de l’Atlantique, Clinique Rhône Durance, Centre de cardiologie Axium-Rambot, Hôpital Robert Schuman, Centre cardiologique du Nord, Hôpital des Diaconesses, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique ambulatoire de Domont, Clinique de Villeneuve-d’Ascq, Hôpital Bichat, Hôpital privé Sévigné, Hôpital privé Le Bois, CHU - Hôpital Maison-Blanche, Clinique de l'Essonne, CMC Floréal, Hôpital privé d’Antony, Polyclinique Francheville, Clinique Saint-Augustin, Polyclinique de la Baie, CHU de La Réunion - Félix-Guyon, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital Avicenne, Clinique Saint-Paul, Polyclinique Urbain-V, Clinique mutualiste La Sagesse, Institut universitaire de la face et du cou, CHU - Hôpital Jeanne-de-Flandre, Clinique mutualiste catalane, GCS Clinique du Ter, Hôpital Cochin, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Lapeyronie, Hôpital privé La Louvière, CMCO, Clinique Rive-Gauche, Clinique de l’Anjou, Clinique Bon-Secours, Hôpital privé des Peupliers, Centre Antoine-Lacassagne (CLCC), Clinique Charcot, Centre Oscar-Lambret (CLCC), GH, Polyclinique Vauban, Polyclinique Saint-Privat, Polyclinique de Kerio, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Polyclinique de Bordeaux-Tondu
2025-08-25 11:01:00,893 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Hôpital Lariboisière, Hôpital privé de la Casamance, Clinique Kennedy, CHU Nantes - Hôpital Mère Enfant, Nouvel Hôpital de Navarre, Hôtel-Dieu, Clinique Arago, EPS Barthélemy-Durand, Polyclinique Lyon-Nord, CHU - Hôpital de la Cavale-Blanche, Pôle santé Léonard-de-Vinci, Clinique Turin, Polyclinique Saint-Jean l’Ermitage, Clinique Les Eaux-Claires, Institut Arnault-Tzanck, CHU - Hôpital Clocheville, Clinique de la Muette, Hôpital européen, Hôpital privé Toulon Hyères-Saint-Jean, Polyclinique de Reims-Bezannes (Marne), CHU - Gabriel-Montpied, Clinique Durieux, Clinique Océane, Polyclinique de Poitiers, Hôpital privé des Côtes-d’Armor, Centre François-Baclesse (CLCC), Clinique ophtalmologique Thiers, EPSM Etienne-Gourmelen, Infirmerie protestante de Lyon, Hôpital Jean-Verdier, Clinique Fontvert, Centre de la main, Clinique Saint-Jean-de-Dieu, CHU - Hôpital Trousseau, Hôpitaux Nord (Croix-Rousse), Hôpital Saint-Louis, CHU - Hôpital Dupuytren, Clinique Belledonne, CHU - Hôpital Haut-Lévêque, CHU Grenoble - Hôpital Sud, Epsan, Clinique de la Miséricorde, Centre de cardiologie du Pays basque, Clinique Saint-Léonard, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), CH Lyon-Sud, Institut Jean-Godinot (CLCC), Clinique du Parc-Monceau, Pôle santé Oréliance, Clinique Saint-Amé, Clinique du Fief-de-Grimoire, CHU - Hôpital de Hautepierre, Hôpital privé du Confluent, CHU d’Amiens, Clinique Claude-Bernard, Hôpital de la Croix-Saint-Simon, Hôpital privé Paul-d’Égine, Hôpital Lariboisière-Fernand Widal, Hôpital privé Vert-Coteau, Hôpital privé Clairval, Polyclinique de Limoges - site Chénieux, Clinique du Val-d’Or, Clinique Sainte-Clotilde, Hôpital d'instruction des armées Sainte-Anne, CH/clinique, Clinique de l’Europe, Polyclinique Jean-Villar, CHR de Metz-Thionville - Hôpital Bel-Air, Polyclinique du Grand-Sud, Hôpital Nord, Hôpital Pierre-Wertheimer, Hôpital Ambroise-Paré, Hôpital privé de la Seine-Saint-Denis, CHU - Hôpital Bretonneau, Clinique de Vitrolles (Bouches-du-Rhône), Hôpital Louis-Mourier, Hôpital d'instruction des armées Bégin, Polyclinique de Limoges - site Émailleurs, Hôpital de la Croix Rousse (HCL) / CH, Hôpital d'instruction des armées Legouest, CHU - site Nord, Clinique Esquirol-Saint-Hilaire, CHU Sud-Réunion, Clinique Jean Causse, CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé Armand-Brillard, Clinique Sainte-Anne, Hôpital privé Dijon-Bourgogne, Polyclinique Côte-Basque-Sud, CH Guillaume-Régnier, Hôpital Albert Schweitzer, Clinique Saint-Charles, CHU - Hôpital Larrey, HCL - Hôpital Femme-mère-enfant, Clinique Maussins-Nollet, Centre ambulatoire Kleber, Polyclinique de la Région-Mantaise, EPSM de Saône-et-Loire, Polyclinique Santa-Maria, Polyclinique du Parc-Drevon, Hôpital Paul-Brousse, Clinique Juge, GH mutualiste, CH Saint-Joseph-Saint-Luc, Polyclinique Saint-Jean, Clinique Victor-Pauchet, Clinique des Orchidées, Hôpital privé Arras-Les Bonnettes, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, Clinique de l’Yvette, Clinique du Pré, CHU - Hôpital Claude-Huriez, Clinique Bouchard, Clinique de l’Estrée, Clinique Lille-Sud, Hôpital privé Pays-de-Savoie, Clinique du Croisé-Laroche, Polyclinique, Clinique Saint-Hilaire, Hôpital-clinique Claude-Bernard, CHU - Hôpital Purpan, Hôpital privé Natecia, CH Basse-Terre (Guadeloupe), Institut Paoli-Calmettes (CLCC), Clinique du Millénaire, Polyclinique Les Fleurs, Euromed Cardio, CHU de Nantes, Polyclinique Majorelle, Centre Psychothérapique, Hôpital privé La Châtaigneraie, Clinique Sainte-Marie, Centre Jean-Perrin (CLCC), CHU - Hôpital Pellegrin, Centre Hospitalier Sainte-Marie, Hopital Joseph-Ducuing, GHI, Médipôle de Savoie, Médipôle Hôpital Privé, Clinique Sainte-Marie (GHICL), Les Franciscaines, Hôpital Saint-Antoine, Clinique Convert, Clinique Tivoli-Ducos, Hôpitaux Sud, Clinique Saint-Vincent-de-Paul, Centre orthopédique médico-chirurgical, CHU de Martinique, Centre cardiologique, Clinique du Tertre-Rouge, Clinique Paris Lilas, Clinique de Bercy, CHU - Hôpital Pontchaillou, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Clinique Anne-Artois, Centre Georges-François-Leclerc (CLCC), Hôpital privé du Vert-Galant, Clinique La Croix du Sud, Centre chirurgical Marie-Lannelongue, Centre Henri-Becquerel (CLCC), Clinique Marcel-Sembat, Clinique Louis-Pasteur, Clinique cardiologique, Hôpital européen Georges-Pompidou, CMCO Côte d’Opale, GHU Paris Psychiatrie et neurosciences, Hôpital d'instruction des armées Desgenettes, Institut du cancer de Montpellier (CLCC), Hôpital Bicêtre, Médipôle Garonne, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Jean - Sud de France, Clinique Bretéché, Clinique Trenel, CH privé Claude-Galien, Clinique du Lac et d’Argonay, CM Bénigne-Joly, Clinique Saint-André, GH Paul Guiraud, Clinique du Pont-de-Chaume, Centre Hospitalier Gérard-Marchant, Clinique Notre-Dame-de-l’Espérance, Institut ophtalmique, Centre Hospitalier George Sand, Hôpital Robert-Debré, Clinique Ambroise-Paré, CHU - Hôpital de l’Archet, Clinique Saint-Pierre, Nouvelle clinique de Tours, Grand hôpital de l'Est-Francilien, Clinique du Diaconat-Roosevelt, Centre Hospitalier du Rouvray, CHU - Hôpital Saint-Eloi, CH Charles-Perrens, CHR de Metz-Thionville - Hôpital de Mercy, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Keraudren, CMC Pierre-Cherest, Centre Hospitalier d'Erstein, Hôpital Belle-Isle, Hôpital privé Drôme-Ardèche, Polyclinique Bordeaux-Rive droite, Clinique du sport, Clinique de l’Espérance, Clinique mutualiste, Clinique du Cambrésis, Polyclinique de Reims-Bezannes, Clinique Toulouse-Lautrec, Nouvelle clinique Bel-Air, Clinique Belharra, Clinique du Trocadéro, Clinique Saint-Joseph, Hôpital privé de La Miotte, Hôpital Beaujon, Clinique Jouvenet, Hôpital privé de Provence, Santé Atlantique, Polyclinique de Picardie, CHU - Hôpital d’Estaing, Clinique Rhéna, Hôpital Louis-Pradel, Clinique de l'Alma, Clinique mutualiste de l’Estuaire, Groupe hospitalier Nord-Essonne, Centre Léon-Bérard (CLCC), Centre Hospitalier Henri Guerin, Espm de L’agglomeration Lilloise, CH Esquirol, Polyclinique Saint Laurent, CHU - Hôpital Saint-André, Institut Calot, Polyclinique Aguilera, CHU - Hôpital de la Côte de nacre, Hôpitaux civils, Polyclinique La Ligne bleue, Clinique Saint-François, Hôpital Necker-Enfants-Malades, Clinique du Cèdre, Clinique de la Plaine, Hôpital Tenon, Hôpital Paris Saint-Joseph, CHU - Hôpital civil, Polyclinique Bordeaux-Nord-Aquitaine, Hôpital privé de l’Ouest parisien, Institut Bergonié (CLCC), Polyclinique de Blois, Hôpital d'instruction des armées Robert-Picqué, CH Henri-Laborit, Institut de cancérologie Strasbourg Europe, CH Montfavet, Clinique la Pergola, Clinique mutualiste Jules-Verne, Hôpital privé de Marne-la-Vallée, Hôpital des Massues, Clinique Victor-Hugo, CHP de l’Europe, Clinique des Ormeaux, Hôpital de la Timone (Enfants), Institut mutualiste Montsouris, Institut Curie, ASM, Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, CH privé du Montgardé, Hôpital Henri-Mondor, Clinique Saint-Antoine, Clinique de l’Orangerie, Hôpital d'instruction des armées Laveran, Clinique Chantecler, Hôpitaux de Saint-Maurice, Hôpital Corentin-Celton, Clinique mutualiste de Bonneveine, Clinique Jean le Bon, Clinique d’Occitanie, Clinique Pasteur-Lanroze, Clinique Saint-Nabor, CHU - Maternité, Hôpital privé de la Loire, Hôpital Nord Franche-Comté-Belfort, Centre Hospitalier Les Murets, Clinique du Parc, Hôpital Trousseau, Polyclinique Médipôle Saint-Roch, Hôpital Saint-Joseph, Clinique de la Sauvegarde, Clinique des Cèdres, Hôpital privé Beauregard, Institut de cancérologie de l’Ouest, Clinique Mathilde, EPSM Lille-Métropole, Hôpital privé Cannes-Oxford, EPS Ville-Évrard, Institut de cancérologie de Lorraine (CLCC), Hôpital Saint-Vincent-de-Paul (GHICL), Groupe Hospitalier de la Rochelle, Hôpital d'instruction des armées Percy, CHU - Hôpital Central, CHU de Pointe-à-Pitre, Hôpital Saint-Philibert (GHICL), CHU - Hôpital Sud, EPSM de la Marne, Gustave-Roussy (CLCC), Centre Hospitalier Le Vinatier, Clinique Clémentville, CH privé Saint-Grégoire, Institut d’hématologie et d'oncologie pédiatrique, Hôpital privé Paris-Essonne, CHU - Hôpitaux de Brabois, Clinique Beau-Soleil, Polyclinique de Courlancy, Centre Hospitalier Montperrin, Maison de santé Bagatelle, Polyclinique du Parc, Clinique Delay, CHU - Hôpital Morvan, Hôpital Privé Nancy Lorraine, Clinique du Renaison, CH Édouard-Toulouse, CHI, CHU - Hôpitaux mère-enfants, Hôpital Edouard-Herriot, Hôpital Saint-Camille, Polyclinique du Maine, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de l’Estuaire, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Hôpital privé Nord Parisien, Clinique Ormeau centre, Centre Hospitalier Le Bon Sauveur, Polyclinique Saint-François, Hôpital privé La Montagne Lambert, Hôpital de la Pitié-Salpêtrière, CHR, Clinique mutualiste de la Porte-de-l'Orient, CH/Clinique, Fondation Rothschild, CHU Grenoble - Site Nord, Centre Eugène-Marquis (CLCC), Clinique Remusat, Hôpital Raymond-Poincaré, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Axium, Clinique du Grand-Large, Hôpital privé Jean-Mermoz, Clinique Geoffroy-Saint-Hilaire, Hôpitaux pédiatriques, Hôpital Hôtel-Dieu, Hôpital Foch, CHU - American Memorial Hospital, Centre Hospitalier des Pyrénées, Hôpital de la Timone (adultes), Institut franco-britannique Kléber, Clinique de la Part-Dieu, CHU - Hôpital Gui-de-Chauliac, Clinique Saint-Michel, Hôpital de la Timone (enfants), Polyclinique Saint-Roch, Polyclinique de Navarre, Clinique Les Fontaines, Clinique générale, Centre Hospitalier de Vauclaire, Clinique de l’Union, CH intercommunal, Clinique Honoré-Cave, Clinique des Franciscaines, Centre Clinical, Clinique Ormeau Pyrénées, Clinique Saint-Vincent, Centre de chirurgie ophtalmologique, CHU - Centre chirurgical Emile-Gallé, Polyclinique Saint-Côme, Institut Arthur-Vernes, CHU - Hôpital Robert-Debré, Clinique Bizet, Clinique Monticelli-Vélodrome, Pôle Santé République, CHU - Hôpital Nord, CHU - Institut cœur-poumon, Polyclinique du Beaujolais, CHU de Martinique - site Mère-Enfant, Clinique Saint-George, CMC de Parly-II, Centre psychothérapique de Nancy, CHU - Hôpital Pasteur, Institut Curie (CLCC), Hôpital privé, Hôpital privé Saint-Martin, EPSM Morbihan, CHU-Hôpital Purpan/HFE, Hôpital privé de l’Est lyonnais, Clinique Conti, Pôle de Santé du Villeneuvois, Centre Hospitalier Maurice Despinoy, CH privé Saint-Martin, Hôpital Antoine-Béclère, Grand Hôpital de l'Est Francilien Marne-la-Vallée, CHU - Hôpital Roger-Salengro, Centre Hospitalier Drôme Vivarais, Clinique Pasteur, Clinique du Diaconat-Fonderie, Centre Hospitalier La Chartreuse, CHU Réunion, Centre médico-chirurgical et obstétrical, CH Georges-Daumezon, IUCT Oncopole, IUCT/Oncopole, Hôpital privé de Marne Chantereine, Clinique de l’Atlantique, Clinique Rhône Durance, Centre de cardiologie Axium-Rambot, Hôpital Robert Schuman, Centre cardiologique du Nord, Hôpital des Diaconesses, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique ambulatoire de Domont, Clinique de Villeneuve-d’Ascq, Hôpital Bichat, Hôpital privé Sévigné, Hôpital privé Le Bois, CHU - Hôpital Maison-Blanche, Clinique de l'Essonne, CMC Floréal, Hôpital privé d’Antony, Polyclinique Francheville, Clinique Saint-Augustin, Polyclinique de la Baie, CHU de La Réunion - Félix-Guyon, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital Avicenne, Clinique Saint-Paul, Polyclinique Urbain-V, Clinique mutualiste La Sagesse, Institut universitaire de la face et du cou, CHU - Hôpital Jeanne-de-Flandre, Clinique mutualiste catalane, GCS Clinique du Ter, Hôpital Cochin, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Lapeyronie, Hôpital privé La Louvière, CMCO, Clinique Rive-Gauche, Clinique de l’Anjou, Clinique Bon-Secours, Hôpital privé des Peupliers, Centre Antoine-Lacassagne (CLCC), Clinique Charcot, Centre Oscar-Lambret (CLCC), GH, Polyclinique Vauban, Polyclinique Saint-Privat, Polyclinique de Kerio, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Polyclinique de Bordeaux-Tondu
2025-08-25 11:01:00,894 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-25 11:01:00,896 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-25 11:01:00,896 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-25 11:01:00,899 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:00,901 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:00,901 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:00,902 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:00,902 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:00,902 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:00,902 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:01,428 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:03 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'339'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'364'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_452af3d118b24058a55233dc4a09b702'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e70cfa182120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:01,429 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:01,429 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:01,433 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:01,433 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:01,433 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:01,433 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:03 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '339', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '364', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_452af3d118b24058a55233dc4a09b702', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e70cfa182120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:01,433 [DEBUG] openai._base_client: request_id: req_452af3d118b24058a55233dc4a09b702
2025-08-25 11:01:01,434 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:01,434 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:01,434 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-25 11:01:01,435 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:01,437 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:01,438 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:01,438 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:01,439 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:01,439 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:01,439 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:01,439 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:01,990 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:03 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'357'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'388'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_53cc61a9b4f540c1917fed7683d3aa07'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7104b942120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:01,991 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:01,991 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:01,991 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:01,991 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:01,991 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:01,991 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:03 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '357', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '388', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_53cc61a9b4f540c1917fed7683d3aa07', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e7104b942120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:01,992 [DEBUG] openai._base_client: request_id: req_53cc61a9b4f540c1917fed7683d3aa07
2025-08-25 11:01:01,992 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-25 11:01:01,992 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-25 11:01:01,992 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-25 11:01:01,992 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:01,995 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:01,996 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:01,996 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:01,996 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:01,996 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:01,996 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:01,997 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:05,669 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:07 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3479'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3504'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_5e881cd484ba418284a3996a700f7e68'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e713cd5a2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:05,670 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:05,671 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:05,672 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:05,672 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:05,672 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:05,672 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:07 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3479', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3504', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_5e881cd484ba418284a3996a700f7e68', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e713cd5a2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:05,673 [DEBUG] openai._base_client: request_id: req_5e881cd484ba418284a3996a700f7e68
2025-08-25 11:01:05,673 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-25 11:01:05,674 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-25 11:01:05,674 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-25 11:01:05,674 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-25 11:01:05,674 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:05,674 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:05,674 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-25 11:01:05,674 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:05,677 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:05,677 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:05,678 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:05,678 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:05,678 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:05,678 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:05,678 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:06,083 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:08 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'213'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'233'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_f0823d411b264790af3945cc9b8d5801'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e72ac8812120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:06,084 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:06,084 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:06,088 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:06,088 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:06,088 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:06,088 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:08 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '213', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '233', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_f0823d411b264790af3945cc9b8d5801', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e72ac8812120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:06,088 [DEBUG] openai._base_client: request_id: req_f0823d411b264790af3945cc9b8d5801
2025-08-25 11:01:06,089 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-25 11:01:06,089 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-25 11:01:06,089 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-25 11:01:06,089 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:06,092 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:06,092 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:06,093 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:06,093 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:06,093 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:06,093 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:06,093 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:09,744 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:11 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3468'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3487'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_11956a37cba740ddb3819cc679f49f51'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e72d69b32120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:09,745 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:09,745 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:09,746 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:09,746 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:09,746 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:09,746 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:11 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3468', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3487', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_11956a37cba740ddb3819cc679f49f51', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e72d69b32120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:09,746 [DEBUG] openai._base_client: request_id: req_11956a37cba740ddb3819cc679f49f51
2025-08-25 11:01:09,747 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-25 11:01:09,747 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-25 11:01:09,747 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-25 11:01:09,747 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-25 11:01:09,747 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-25 11:01:09,749 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:09,750 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:09,750 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:09,751 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:09,751 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:09,751 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:09,751 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:11,951 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:13 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1474'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'2042'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_7a516ecec0884977afa4c7a192e72e64'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7444c4c2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:11,951 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:11,951 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:11,955 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:11,955 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:11,955 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:11,955 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:13 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '1474', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '2042', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_7a516ecec0884977afa4c7a192e72e64', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e7444c4c2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:11,955 [DEBUG] openai._base_client: request_id: req_7a516ecec0884977afa4c7a192e72e64
2025-08-25 11:01:11,956 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-25 11:01:11,956 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-25 11:01:11,956 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-25 11:01:11,959 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:11,960 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:11,961 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:11,962 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:11,963 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:11,963 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:11,964 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:12,435 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:14 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'285'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'307'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_255614eef82c44049d9233f8a33e2c79'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7521b202120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:12,436 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:12,436 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:12,439 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:12,439 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:12,439 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:12,439 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:14 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '285', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '307', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_255614eef82c44049d9233f8a33e2c79', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e7521b202120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:12,440 [DEBUG] openai._base_client: request_id: req_255614eef82c44049d9233f8a33e2c79
2025-08-25 11:01:12,440 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-25 11:01:12,441 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-25 11:01:12,441 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-25 11:01:12,474 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-25 11:01:12,475 [DEBUG] app.services.data_processing_service: Institution list: Hôpital Lariboisière, Hôpital privé de la Casamance, Clinique Kennedy, CHU Nantes - Hôpital Mère Enfant, Nouvel Hôpital de Navarre, Hôtel-Dieu, Clinique Arago, EPS Barthélemy-Durand, Polyclinique Lyon-Nord, CHU - Hôpital de la Cavale-Blanche, Pôle santé Léonard-de-Vinci, Clinique Turin, Polyclinique Saint-Jean l’Ermitage, Clinique Les Eaux-Claires, Institut Arnault-Tzanck, CHU - Hôpital Clocheville, Clinique de la Muette, Hôpital européen, Hôpital privé Toulon Hyères-Saint-Jean, Polyclinique de Reims-Bezannes (Marne), CHU - Gabriel-Montpied, Clinique Durieux, Clinique Océane, Polyclinique de Poitiers, Hôpital privé des Côtes-d’Armor, Centre François-Baclesse (CLCC), Clinique ophtalmologique Thiers, EPSM Etienne-Gourmelen, Infirmerie protestante de Lyon, Hôpital Jean-Verdier, Clinique Fontvert, Centre de la main, Clinique Saint-Jean-de-Dieu, CHU - Hôpital Trousseau, Hôpitaux Nord (Croix-Rousse), Hôpital Saint-Louis, CHU - Hôpital Dupuytren, Clinique Belledonne, CHU - Hôpital Haut-Lévêque, CHU Grenoble - Hôpital Sud, Epsan, Clinique de la Miséricorde, Centre de cardiologie du Pays basque, Clinique Saint-Léonard, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), CH Lyon-Sud, Institut Jean-Godinot (CLCC), Clinique du Parc-Monceau, Pôle santé Oréliance, Clinique Saint-Amé, Clinique du Fief-de-Grimoire, CHU - Hôpital de Hautepierre, Hôpital privé du Confluent, CHU d’Amiens, Clinique Claude-Bernard, Hôpital de la Croix-Saint-Simon, Hôpital privé Paul-d’Égine, Hôpital Lariboisière-Fernand Widal, Hôpital privé Vert-Coteau, Hôpital privé Clairval, Polyclinique de Limoges - site Chénieux, Clinique du Val-d’Or, Clinique Sainte-Clotilde, Hôpital d'instruction des armées Sainte-Anne, CH/clinique, Clinique de l’Europe, Polyclinique Jean-Villar, CHR de Metz-Thionville - Hôpital Bel-Air, Polyclinique du Grand-Sud, Hôpital Nord, Hôpital Pierre-Wertheimer, Hôpital Ambroise-Paré, Hôpital privé de la Seine-Saint-Denis, CHU - Hôpital Bretonneau, Clinique de Vitrolles (Bouches-du-Rhône), Hôpital Louis-Mourier, Hôpital d'instruction des armées Bégin, Polyclinique de Limoges - site Émailleurs, Hôpital de la Croix Rousse (HCL) / CH, Hôpital d'instruction des armées Legouest, CHU - site Nord, Clinique Esquirol-Saint-Hilaire, CHU Sud-Réunion, Clinique Jean Causse, CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé Armand-Brillard, Clinique Sainte-Anne, Hôpital privé Dijon-Bourgogne, Polyclinique Côte-Basque-Sud, CH Guillaume-Régnier, Hôpital Albert Schweitzer, Clinique Saint-Charles, CHU - Hôpital Larrey, HCL - Hôpital Femme-mère-enfant, Clinique Maussins-Nollet, Centre ambulatoire Kleber, Polyclinique de la Région-Mantaise, EPSM de Saône-et-Loire, Polyclinique Santa-Maria, Polyclinique du Parc-Drevon, Hôpital Paul-Brousse, Clinique Juge, GH mutualiste, CH Saint-Joseph-Saint-Luc, Polyclinique Saint-Jean, Clinique Victor-Pauchet, Clinique des Orchidées, Hôpital privé Arras-Les Bonnettes, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, Clinique de l’Yvette, Clinique du Pré, CHU - Hôpital Claude-Huriez, Clinique Bouchard, Clinique de l’Estrée, Clinique Lille-Sud, Hôpital privé Pays-de-Savoie, Clinique du Croisé-Laroche, Polyclinique, Clinique Saint-Hilaire, Hôpital-clinique Claude-Bernard, CHU - Hôpital Purpan, Hôpital privé Natecia, CH Basse-Terre (Guadeloupe), Institut Paoli-Calmettes (CLCC), Clinique du Millénaire, Polyclinique Les Fleurs, Euromed Cardio, CHU de Nantes, Polyclinique Majorelle, Centre Psychothérapique, Hôpital privé La Châtaigneraie, Clinique Sainte-Marie, Centre Jean-Perrin (CLCC), CHU - Hôpital Pellegrin, Centre Hospitalier Sainte-Marie, Hopital Joseph-Ducuing, GHI, Médipôle de Savoie, Médipôle Hôpital Privé, Clinique Sainte-Marie (GHICL), Les Franciscaines, Hôpital Saint-Antoine, Clinique Convert, Clinique Tivoli-Ducos, Hôpitaux Sud, Clinique Saint-Vincent-de-Paul, Centre orthopédique médico-chirurgical, CHU de Martinique, Centre cardiologique, Clinique du Tertre-Rouge, Clinique Paris Lilas, Clinique de Bercy, CHU - Hôpital Pontchaillou, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Clinique Anne-Artois, Centre Georges-François-Leclerc (CLCC), Hôpital privé du Vert-Galant, Clinique La Croix du Sud, Centre chirurgical Marie-Lannelongue, Centre Henri-Becquerel (CLCC), Clinique Marcel-Sembat, Clinique Louis-Pasteur, Clinique cardiologique, Hôpital européen Georges-Pompidou, CMCO Côte d’Opale, GHU Paris Psychiatrie et neurosciences, Hôpital d'instruction des armées Desgenettes, Institut du cancer de Montpellier (CLCC), Hôpital Bicêtre, Médipôle Garonne, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Jean - Sud de France, Clinique Bretéché, Clinique Trenel, CH privé Claude-Galien, Clinique du Lac et d’Argonay, CM Bénigne-Joly, Clinique Saint-André, GH Paul Guiraud, Clinique du Pont-de-Chaume, Centre Hospitalier Gérard-Marchant, Clinique Notre-Dame-de-l’Espérance, Institut ophtalmique, Centre Hospitalier George Sand, Hôpital Robert-Debré, Clinique Ambroise-Paré, CHU - Hôpital de l’Archet, Clinique Saint-Pierre, Nouvelle clinique de Tours, Grand hôpital de l'Est-Francilien, Clinique du Diaconat-Roosevelt, Centre Hospitalier du Rouvray, CHU - Hôpital Saint-Eloi, CH Charles-Perrens, CHR de Metz-Thionville - Hôpital de Mercy, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Keraudren, CMC Pierre-Cherest, Centre Hospitalier d'Erstein, Hôpital Belle-Isle, Hôpital privé Drôme-Ardèche, Polyclinique Bordeaux-Rive droite, Clinique du sport, Clinique de l’Espérance, Clinique mutualiste, Clinique du Cambrésis, Polyclinique de Reims-Bezannes, Clinique Toulouse-Lautrec, Nouvelle clinique Bel-Air, Clinique Belharra, Clinique du Trocadéro, Clinique Saint-Joseph, Hôpital privé de La Miotte, Hôpital Beaujon, Clinique Jouvenet, Hôpital privé de Provence, Santé Atlantique, Polyclinique de Picardie, CHU - Hôpital d’Estaing, Clinique Rhéna, Hôpital Louis-Pradel, Clinique de l'Alma, Clinique mutualiste de l’Estuaire, Groupe hospitalier Nord-Essonne, Centre Léon-Bérard (CLCC), Centre Hospitalier Henri Guerin, Espm de L’agglomeration Lilloise, CH Esquirol, Polyclinique Saint Laurent, CHU - Hôpital Saint-André, Institut Calot, Polyclinique Aguilera, CHU - Hôpital de la Côte de nacre, Hôpitaux civils, Polyclinique La Ligne bleue, Clinique Saint-François, Hôpital Necker-Enfants-Malades, Clinique du Cèdre, Clinique de la Plaine, Hôpital Tenon, Hôpital Paris Saint-Joseph, CHU - Hôpital civil, Polyclinique Bordeaux-Nord-Aquitaine, Hôpital privé de l’Ouest parisien, Institut Bergonié (CLCC), Polyclinique de Blois, Hôpital d'instruction des armées Robert-Picqué, CH Henri-Laborit, Institut de cancérologie Strasbourg Europe, CH Montfavet, Clinique la Pergola, Clinique mutualiste Jules-Verne, Hôpital privé de Marne-la-Vallée, Hôpital des Massues, Clinique Victor-Hugo, CHP de l’Europe, Clinique des Ormeaux, Hôpital de la Timone (Enfants), Institut mutualiste Montsouris, Institut Curie, ASM, Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, CH privé du Montgardé, Hôpital Henri-Mondor, Clinique Saint-Antoine, Clinique de l’Orangerie, Hôpital d'instruction des armées Laveran, Clinique Chantecler, Hôpitaux de Saint-Maurice, Hôpital Corentin-Celton, Clinique mutualiste de Bonneveine, Clinique Jean le Bon, Clinique d’Occitanie, Clinique Pasteur-Lanroze, Clinique Saint-Nabor, CHU - Maternité, Hôpital privé de la Loire, Hôpital Nord Franche-Comté-Belfort, Centre Hospitalier Les Murets, Clinique du Parc, Hôpital Trousseau, Polyclinique Médipôle Saint-Roch, Hôpital Saint-Joseph, Clinique de la Sauvegarde, Clinique des Cèdres, Hôpital privé Beauregard, Institut de cancérologie de l’Ouest, Clinique Mathilde, EPSM Lille-Métropole, Hôpital privé Cannes-Oxford, EPS Ville-Évrard, Institut de cancérologie de Lorraine (CLCC), Hôpital Saint-Vincent-de-Paul (GHICL), Groupe Hospitalier de la Rochelle, Hôpital d'instruction des armées Percy, CHU - Hôpital Central, CHU de Pointe-à-Pitre, Hôpital Saint-Philibert (GHICL), CHU - Hôpital Sud, EPSM de la Marne, Gustave-Roussy (CLCC), Centre Hospitalier Le Vinatier, Clinique Clémentville, CH privé Saint-Grégoire, Institut d’hématologie et d'oncologie pédiatrique, Hôpital privé Paris-Essonne, CHU - Hôpitaux de Brabois, Clinique Beau-Soleil, Polyclinique de Courlancy, Centre Hospitalier Montperrin, Maison de santé Bagatelle, Polyclinique du Parc, Clinique Delay, CHU - Hôpital Morvan, Hôpital Privé Nancy Lorraine, Clinique du Renaison, CH Édouard-Toulouse, CHI, CHU - Hôpitaux mère-enfants, Hôpital Edouard-Herriot, Hôpital Saint-Camille, Polyclinique du Maine, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de l’Estuaire, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Hôpital privé Nord Parisien, Clinique Ormeau centre, Centre Hospitalier Le Bon Sauveur, Polyclinique Saint-François, Hôpital privé La Montagne Lambert, Hôpital de la Pitié-Salpêtrière, CHR, Clinique mutualiste de la Porte-de-l'Orient, CH/Clinique, Fondation Rothschild, CHU Grenoble - Site Nord, Centre Eugène-Marquis (CLCC), Clinique Remusat, Hôpital Raymond-Poincaré, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Axium, Clinique du Grand-Large, Hôpital privé Jean-Mermoz, Clinique Geoffroy-Saint-Hilaire, Hôpitaux pédiatriques, Hôpital Hôtel-Dieu, Hôpital Foch, CHU - American Memorial Hospital, Centre Hospitalier des Pyrénées, Hôpital de la Timone (adultes), Institut franco-britannique Kléber, Clinique de la Part-Dieu, CHU - Hôpital Gui-de-Chauliac, Clinique Saint-Michel, Hôpital de la Timone (enfants), Polyclinique Saint-Roch, Polyclinique de Navarre, Clinique Les Fontaines, Clinique générale, Centre Hospitalier de Vauclaire, Clinique de l’Union, CH intercommunal, Clinique Honoré-Cave, Clinique des Franciscaines, Centre Clinical, Clinique Ormeau Pyrénées, Clinique Saint-Vincent, Centre de chirurgie ophtalmologique, CHU - Centre chirurgical Emile-Gallé, Polyclinique Saint-Côme, Institut Arthur-Vernes, CHU - Hôpital Robert-Debré, Clinique Bizet, Clinique Monticelli-Vélodrome, Pôle Santé République, CHU - Hôpital Nord, CHU - Institut cœur-poumon, Polyclinique du Beaujolais, CHU de Martinique - site Mère-Enfant, Clinique Saint-George, CMC de Parly-II, Centre psychothérapique de Nancy, CHU - Hôpital Pasteur, Institut Curie (CLCC), Hôpital privé, Hôpital privé Saint-Martin, EPSM Morbihan, CHU-Hôpital Purpan/HFE, Hôpital privé de l’Est lyonnais, Clinique Conti, Pôle de Santé du Villeneuvois, Centre Hospitalier Maurice Despinoy, CH privé Saint-Martin, Hôpital Antoine-Béclère, Grand Hôpital de l'Est Francilien Marne-la-Vallée, CHU - Hôpital Roger-Salengro, Centre Hospitalier Drôme Vivarais, Clinique Pasteur, Clinique du Diaconat-Fonderie, Centre Hospitalier La Chartreuse, CHU Réunion, Centre médico-chirurgical et obstétrical, CH Georges-Daumezon, IUCT Oncopole, IUCT/Oncopole, Hôpital privé de Marne Chantereine, Clinique de l’Atlantique, Clinique Rhône Durance, Centre de cardiologie Axium-Rambot, Hôpital Robert Schuman, Centre cardiologique du Nord, Hôpital des Diaconesses, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique ambulatoire de Domont, Clinique de Villeneuve-d’Ascq, Hôpital Bichat, Hôpital privé Sévigné, Hôpital privé Le Bois, CHU - Hôpital Maison-Blanche, Clinique de l'Essonne, CMC Floréal, Hôpital privé d’Antony, Polyclinique Francheville, Clinique Saint-Augustin, Polyclinique de la Baie, CHU de La Réunion - Félix-Guyon, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital Avicenne, Clinique Saint-Paul, Polyclinique Urbain-V, Clinique mutualiste La Sagesse, Institut universitaire de la face et du cou, CHU - Hôpital Jeanne-de-Flandre, Clinique mutualiste catalane, GCS Clinique du Ter, Hôpital Cochin, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Lapeyronie, Hôpital privé La Louvière, CMCO, Clinique Rive-Gauche, Clinique de l’Anjou, Clinique Bon-Secours, Hôpital privé des Peupliers, Centre Antoine-Lacassagne (CLCC), Clinique Charcot, Centre Oscar-Lambret (CLCC), GH, Polyclinique Vauban, Polyclinique Saint-Privat, Polyclinique de Kerio, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Polyclinique de Bordeaux-Tondu
2025-08-25 11:01:12,475 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-25 11:01:12,685 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-25 11:01:12,686 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-25 11:01:12,686 [DEBUG] app.services.pipeline_orchestrator_service: Calling build_ranking_dataframe_with_distances
2025-08-25 11:01:12,686 [INFO] app.services.pipeline_orchestrator_service: Building ranking DataFrame with distances: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', excel_path='/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx', detected_specialty='no specialty match'
2025-08-25 11:01:12,686 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history='None'
2025-08-25 11:01:12,686 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-25 11:01:12,687 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-25 11:01:12,687 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-25 11:01:12,687 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-25 11:01:12,841 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-25 11:01:12,841 [DEBUG] app.services.data_processing_service: Institution list: Hôpital Lariboisière, Hôpital privé de la Casamance, Clinique Kennedy, CHU Nantes - Hôpital Mère Enfant, Nouvel Hôpital de Navarre, Hôtel-Dieu, Clinique Arago, EPS Barthélemy-Durand, Polyclinique Lyon-Nord, CHU - Hôpital de la Cavale-Blanche, Pôle santé Léonard-de-Vinci, Clinique Turin, Polyclinique Saint-Jean l’Ermitage, Clinique Les Eaux-Claires, Institut Arnault-Tzanck, CHU - Hôpital Clocheville, Clinique de la Muette, Hôpital européen, Hôpital privé Toulon Hyères-Saint-Jean, Polyclinique de Reims-Bezannes (Marne), CHU - Gabriel-Montpied, Clinique Durieux, Clinique Océane, Polyclinique de Poitiers, Hôpital privé des Côtes-d’Armor, Centre François-Baclesse (CLCC), Clinique ophtalmologique Thiers, EPSM Etienne-Gourmelen, Infirmerie protestante de Lyon, Hôpital Jean-Verdier, Clinique Fontvert, Centre de la main, Clinique Saint-Jean-de-Dieu, CHU - Hôpital Trousseau, Hôpitaux Nord (Croix-Rousse), Hôpital Saint-Louis, CHU - Hôpital Dupuytren, Clinique Belledonne, CHU - Hôpital Haut-Lévêque, CHU Grenoble - Hôpital Sud, Epsan, Clinique de la Miséricorde, Centre de cardiologie du Pays basque, Clinique Saint-Léonard, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), CH Lyon-Sud, Institut Jean-Godinot (CLCC), Clinique du Parc-Monceau, Pôle santé Oréliance, Clinique Saint-Amé, Clinique du Fief-de-Grimoire, CHU - Hôpital de Hautepierre, Hôpital privé du Confluent, CHU d’Amiens, Clinique Claude-Bernard, Hôpital de la Croix-Saint-Simon, Hôpital privé Paul-d’Égine, Hôpital Lariboisière-Fernand Widal, Hôpital privé Vert-Coteau, Hôpital privé Clairval, Polyclinique de Limoges - site Chénieux, Clinique du Val-d’Or, Clinique Sainte-Clotilde, Hôpital d'instruction des armées Sainte-Anne, CH/clinique, Clinique de l’Europe, Polyclinique Jean-Villar, CHR de Metz-Thionville - Hôpital Bel-Air, Polyclinique du Grand-Sud, Hôpital Nord, Hôpital Pierre-Wertheimer, Hôpital Ambroise-Paré, Hôpital privé de la Seine-Saint-Denis, CHU - Hôpital Bretonneau, Clinique de Vitrolles (Bouches-du-Rhône), Hôpital Louis-Mourier, Hôpital d'instruction des armées Bégin, Polyclinique de Limoges - site Émailleurs, Hôpital de la Croix Rousse (HCL) / CH, Hôpital d'instruction des armées Legouest, CHU - site Nord, Clinique Esquirol-Saint-Hilaire, CHU Sud-Réunion, Clinique Jean Causse, CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé Armand-Brillard, Clinique Sainte-Anne, Hôpital privé Dijon-Bourgogne, Polyclinique Côte-Basque-Sud, CH Guillaume-Régnier, Hôpital Albert Schweitzer, Clinique Saint-Charles, CHU - Hôpital Larrey, HCL - Hôpital Femme-mère-enfant, Clinique Maussins-Nollet, Centre ambulatoire Kleber, Polyclinique de la Région-Mantaise, EPSM de Saône-et-Loire, Polyclinique Santa-Maria, Polyclinique du Parc-Drevon, Hôpital Paul-Brousse, Clinique Juge, GH mutualiste, CH Saint-Joseph-Saint-Luc, Polyclinique Saint-Jean, Clinique Victor-Pauchet, Clinique des Orchidées, Hôpital privé Arras-Les Bonnettes, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, Clinique de l’Yvette, Clinique du Pré, CHU - Hôpital Claude-Huriez, Clinique Bouchard, Clinique de l’Estrée, Clinique Lille-Sud, Hôpital privé Pays-de-Savoie, Clinique du Croisé-Laroche, Polyclinique, Clinique Saint-Hilaire, Hôpital-clinique Claude-Bernard, CHU - Hôpital Purpan, Hôpital privé Natecia, CH Basse-Terre (Guadeloupe), Institut Paoli-Calmettes (CLCC), Clinique du Millénaire, Polyclinique Les Fleurs, Euromed Cardio, CHU de Nantes, Polyclinique Majorelle, Centre Psychothérapique, Hôpital privé La Châtaigneraie, Clinique Sainte-Marie, Centre Jean-Perrin (CLCC), CHU - Hôpital Pellegrin, Centre Hospitalier Sainte-Marie, Hopital Joseph-Ducuing, GHI, Médipôle de Savoie, Médipôle Hôpital Privé, Clinique Sainte-Marie (GHICL), Les Franciscaines, Hôpital Saint-Antoine, Clinique Convert, Clinique Tivoli-Ducos, Hôpitaux Sud, Clinique Saint-Vincent-de-Paul, Centre orthopédique médico-chirurgical, CHU de Martinique, Centre cardiologique, Clinique du Tertre-Rouge, Clinique Paris Lilas, Clinique de Bercy, CHU - Hôpital Pontchaillou, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Clinique Anne-Artois, Centre Georges-François-Leclerc (CLCC), Hôpital privé du Vert-Galant, Clinique La Croix du Sud, Centre chirurgical Marie-Lannelongue, Centre Henri-Becquerel (CLCC), Clinique Marcel-Sembat, Clinique Louis-Pasteur, Clinique cardiologique, Hôpital européen Georges-Pompidou, CMCO Côte d’Opale, GHU Paris Psychiatrie et neurosciences, Hôpital d'instruction des armées Desgenettes, Institut du cancer de Montpellier (CLCC), Hôpital Bicêtre, Médipôle Garonne, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Jean - Sud de France, Clinique Bretéché, Clinique Trenel, CH privé Claude-Galien, Clinique du Lac et d’Argonay, CM Bénigne-Joly, Clinique Saint-André, GH Paul Guiraud, Clinique du Pont-de-Chaume, Centre Hospitalier Gérard-Marchant, Clinique Notre-Dame-de-l’Espérance, Institut ophtalmique, Centre Hospitalier George Sand, Hôpital Robert-Debré, Clinique Ambroise-Paré, CHU - Hôpital de l’Archet, Clinique Saint-Pierre, Nouvelle clinique de Tours, Grand hôpital de l'Est-Francilien, Clinique du Diaconat-Roosevelt, Centre Hospitalier du Rouvray, CHU - Hôpital Saint-Eloi, CH Charles-Perrens, CHR de Metz-Thionville - Hôpital de Mercy, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Keraudren, CMC Pierre-Cherest, Centre Hospitalier d'Erstein, Hôpital Belle-Isle, Hôpital privé Drôme-Ardèche, Polyclinique Bordeaux-Rive droite, Clinique du sport, Clinique de l’Espérance, Clinique mutualiste, Clinique du Cambrésis, Polyclinique de Reims-Bezannes, Clinique Toulouse-Lautrec, Nouvelle clinique Bel-Air, Clinique Belharra, Clinique du Trocadéro, Clinique Saint-Joseph, Hôpital privé de La Miotte, Hôpital Beaujon, Clinique Jouvenet, Hôpital privé de Provence, Santé Atlantique, Polyclinique de Picardie, CHU - Hôpital d’Estaing, Clinique Rhéna, Hôpital Louis-Pradel, Clinique de l'Alma, Clinique mutualiste de l’Estuaire, Groupe hospitalier Nord-Essonne, Centre Léon-Bérard (CLCC), Centre Hospitalier Henri Guerin, Espm de L’agglomeration Lilloise, CH Esquirol, Polyclinique Saint Laurent, CHU - Hôpital Saint-André, Institut Calot, Polyclinique Aguilera, CHU - Hôpital de la Côte de nacre, Hôpitaux civils, Polyclinique La Ligne bleue, Clinique Saint-François, Hôpital Necker-Enfants-Malades, Clinique du Cèdre, Clinique de la Plaine, Hôpital Tenon, Hôpital Paris Saint-Joseph, CHU - Hôpital civil, Polyclinique Bordeaux-Nord-Aquitaine, Hôpital privé de l’Ouest parisien, Institut Bergonié (CLCC), Polyclinique de Blois, Hôpital d'instruction des armées Robert-Picqué, CH Henri-Laborit, Institut de cancérologie Strasbourg Europe, CH Montfavet, Clinique la Pergola, Clinique mutualiste Jules-Verne, Hôpital privé de Marne-la-Vallée, Hôpital des Massues, Clinique Victor-Hugo, CHP de l’Europe, Clinique des Ormeaux, Hôpital de la Timone (Enfants), Institut mutualiste Montsouris, Institut Curie, ASM, Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, CH privé du Montgardé, Hôpital Henri-Mondor, Clinique Saint-Antoine, Clinique de l’Orangerie, Hôpital d'instruction des armées Laveran, Clinique Chantecler, Hôpitaux de Saint-Maurice, Hôpital Corentin-Celton, Clinique mutualiste de Bonneveine, Clinique Jean le Bon, Clinique d’Occitanie, Clinique Pasteur-Lanroze, Clinique Saint-Nabor, CHU - Maternité, Hôpital privé de la Loire, Hôpital Nord Franche-Comté-Belfort, Centre Hospitalier Les Murets, Clinique du Parc, Hôpital Trousseau, Polyclinique Médipôle Saint-Roch, Hôpital Saint-Joseph, Clinique de la Sauvegarde, Clinique des Cèdres, Hôpital privé Beauregard, Institut de cancérologie de l’Ouest, Clinique Mathilde, EPSM Lille-Métropole, Hôpital privé Cannes-Oxford, EPS Ville-Évrard, Institut de cancérologie de Lorraine (CLCC), Hôpital Saint-Vincent-de-Paul (GHICL), Groupe Hospitalier de la Rochelle, Hôpital d'instruction des armées Percy, CHU - Hôpital Central, CHU de Pointe-à-Pitre, Hôpital Saint-Philibert (GHICL), CHU - Hôpital Sud, EPSM de la Marne, Gustave-Roussy (CLCC), Centre Hospitalier Le Vinatier, Clinique Clémentville, CH privé Saint-Grégoire, Institut d’hématologie et d'oncologie pédiatrique, Hôpital privé Paris-Essonne, CHU - Hôpitaux de Brabois, Clinique Beau-Soleil, Polyclinique de Courlancy, Centre Hospitalier Montperrin, Maison de santé Bagatelle, Polyclinique du Parc, Clinique Delay, CHU - Hôpital Morvan, Hôpital Privé Nancy Lorraine, Clinique du Renaison, CH Édouard-Toulouse, CHI, CHU - Hôpitaux mère-enfants, Hôpital Edouard-Herriot, Hôpital Saint-Camille, Polyclinique du Maine, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de l’Estuaire, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Hôpital privé Nord Parisien, Clinique Ormeau centre, Centre Hospitalier Le Bon Sauveur, Polyclinique Saint-François, Hôpital privé La Montagne Lambert, Hôpital de la Pitié-Salpêtrière, CHR, Clinique mutualiste de la Porte-de-l'Orient, CH/Clinique, Fondation Rothschild, CHU Grenoble - Site Nord, Centre Eugène-Marquis (CLCC), Clinique Remusat, Hôpital Raymond-Poincaré, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Axium, Clinique du Grand-Large, Hôpital privé Jean-Mermoz, Clinique Geoffroy-Saint-Hilaire, Hôpitaux pédiatriques, Hôpital Hôtel-Dieu, Hôpital Foch, CHU - American Memorial Hospital, Centre Hospitalier des Pyrénées, Hôpital de la Timone (adultes), Institut franco-britannique Kléber, Clinique de la Part-Dieu, CHU - Hôpital Gui-de-Chauliac, Clinique Saint-Michel, Hôpital de la Timone (enfants), Polyclinique Saint-Roch, Polyclinique de Navarre, Clinique Les Fontaines, Clinique générale, Centre Hospitalier de Vauclaire, Clinique de l’Union, CH intercommunal, Clinique Honoré-Cave, Clinique des Franciscaines, Centre Clinical, Clinique Ormeau Pyrénées, Clinique Saint-Vincent, Centre de chirurgie ophtalmologique, CHU - Centre chirurgical Emile-Gallé, Polyclinique Saint-Côme, Institut Arthur-Vernes, CHU - Hôpital Robert-Debré, Clinique Bizet, Clinique Monticelli-Vélodrome, Pôle Santé République, CHU - Hôpital Nord, CHU - Institut cœur-poumon, Polyclinique du Beaujolais, CHU de Martinique - site Mère-Enfant, Clinique Saint-George, CMC de Parly-II, Centre psychothérapique de Nancy, CHU - Hôpital Pasteur, Institut Curie (CLCC), Hôpital privé, Hôpital privé Saint-Martin, EPSM Morbihan, CHU-Hôpital Purpan/HFE, Hôpital privé de l’Est lyonnais, Clinique Conti, Pôle de Santé du Villeneuvois, Centre Hospitalier Maurice Despinoy, CH privé Saint-Martin, Hôpital Antoine-Béclère, Grand Hôpital de l'Est Francilien Marne-la-Vallée, CHU - Hôpital Roger-Salengro, Centre Hospitalier Drôme Vivarais, Clinique Pasteur, Clinique du Diaconat-Fonderie, Centre Hospitalier La Chartreuse, CHU Réunion, Centre médico-chirurgical et obstétrical, CH Georges-Daumezon, IUCT Oncopole, IUCT/Oncopole, Hôpital privé de Marne Chantereine, Clinique de l’Atlantique, Clinique Rhône Durance, Centre de cardiologie Axium-Rambot, Hôpital Robert Schuman, Centre cardiologique du Nord, Hôpital des Diaconesses, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique ambulatoire de Domont, Clinique de Villeneuve-d’Ascq, Hôpital Bichat, Hôpital privé Sévigné, Hôpital privé Le Bois, CHU - Hôpital Maison-Blanche, Clinique de l'Essonne, CMC Floréal, Hôpital privé d’Antony, Polyclinique Francheville, Clinique Saint-Augustin, Polyclinique de la Baie, CHU de La Réunion - Félix-Guyon, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital Avicenne, Clinique Saint-Paul, Polyclinique Urbain-V, Clinique mutualiste La Sagesse, Institut universitaire de la face et du cou, CHU - Hôpital Jeanne-de-Flandre, Clinique mutualiste catalane, GCS Clinique du Ter, Hôpital Cochin, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Lapeyronie, Hôpital privé La Louvière, CMCO, Clinique Rive-Gauche, Clinique de l’Anjou, Clinique Bon-Secours, Hôpital privé des Peupliers, Centre Antoine-Lacassagne (CLCC), Clinique Charcot, Centre Oscar-Lambret (CLCC), GH, Polyclinique Vauban, Polyclinique Saint-Privat, Polyclinique de Kerio, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Polyclinique de Bordeaux-Tondu
2025-08-25 11:01:12,842 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Hôpital Lariboisière, Hôpital privé de la Casamance, Clinique Kennedy, CHU Nantes - Hôpital Mère Enfant, Nouvel Hôpital de Navarre, Hôtel-Dieu, Clinique Arago, EPS Barthélemy-Durand, Polyclinique Lyon-Nord, CHU - Hôpital de la Cavale-Blanche, Pôle santé Léonard-de-Vinci, Clinique Turin, Polyclinique Saint-Jean l’Ermitage, Clinique Les Eaux-Claires, Institut Arnault-Tzanck, CHU - Hôpital Clocheville, Clinique de la Muette, Hôpital européen, Hôpital privé Toulon Hyères-Saint-Jean, Polyclinique de Reims-Bezannes (Marne), CHU - Gabriel-Montpied, Clinique Durieux, Clinique Océane, Polyclinique de Poitiers, Hôpital privé des Côtes-d’Armor, Centre François-Baclesse (CLCC), Clinique ophtalmologique Thiers, EPSM Etienne-Gourmelen, Infirmerie protestante de Lyon, Hôpital Jean-Verdier, Clinique Fontvert, Centre de la main, Clinique Saint-Jean-de-Dieu, CHU - Hôpital Trousseau, Hôpitaux Nord (Croix-Rousse), Hôpital Saint-Louis, CHU - Hôpital Dupuytren, Clinique Belledonne, CHU - Hôpital Haut-Lévêque, CHU Grenoble - Hôpital Sud, Epsan, Clinique de la Miséricorde, Centre de cardiologie du Pays basque, Clinique Saint-Léonard, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), CH Lyon-Sud, Institut Jean-Godinot (CLCC), Clinique du Parc-Monceau, Pôle santé Oréliance, Clinique Saint-Amé, Clinique du Fief-de-Grimoire, CHU - Hôpital de Hautepierre, Hôpital privé du Confluent, CHU d’Amiens, Clinique Claude-Bernard, Hôpital de la Croix-Saint-Simon, Hôpital privé Paul-d’Égine, Hôpital Lariboisière-Fernand Widal, Hôpital privé Vert-Coteau, Hôpital privé Clairval, Polyclinique de Limoges - site Chénieux, Clinique du Val-d’Or, Clinique Sainte-Clotilde, Hôpital d'instruction des armées Sainte-Anne, CH/clinique, Clinique de l’Europe, Polyclinique Jean-Villar, CHR de Metz-Thionville - Hôpital Bel-Air, Polyclinique du Grand-Sud, Hôpital Nord, Hôpital Pierre-Wertheimer, Hôpital Ambroise-Paré, Hôpital privé de la Seine-Saint-Denis, CHU - Hôpital Bretonneau, Clinique de Vitrolles (Bouches-du-Rhône), Hôpital Louis-Mourier, Hôpital d'instruction des armées Bégin, Polyclinique de Limoges - site Émailleurs, Hôpital de la Croix Rousse (HCL) / CH, Hôpital d'instruction des armées Legouest, CHU - site Nord, Clinique Esquirol-Saint-Hilaire, CHU Sud-Réunion, Clinique Jean Causse, CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé Armand-Brillard, Clinique Sainte-Anne, Hôpital privé Dijon-Bourgogne, Polyclinique Côte-Basque-Sud, CH Guillaume-Régnier, Hôpital Albert Schweitzer, Clinique Saint-Charles, CHU - Hôpital Larrey, HCL - Hôpital Femme-mère-enfant, Clinique Maussins-Nollet, Centre ambulatoire Kleber, Polyclinique de la Région-Mantaise, EPSM de Saône-et-Loire, Polyclinique Santa-Maria, Polyclinique du Parc-Drevon, Hôpital Paul-Brousse, Clinique Juge, GH mutualiste, CH Saint-Joseph-Saint-Luc, Polyclinique Saint-Jean, Clinique Victor-Pauchet, Clinique des Orchidées, Hôpital privé Arras-Les Bonnettes, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, Clinique de l’Yvette, Clinique du Pré, CHU - Hôpital Claude-Huriez, Clinique Bouchard, Clinique de l’Estrée, Clinique Lille-Sud, Hôpital privé Pays-de-Savoie, Clinique du Croisé-Laroche, Polyclinique, Clinique Saint-Hilaire, Hôpital-clinique Claude-Bernard, CHU - Hôpital Purpan, Hôpital privé Natecia, CH Basse-Terre (Guadeloupe), Institut Paoli-Calmettes (CLCC), Clinique du Millénaire, Polyclinique Les Fleurs, Euromed Cardio, CHU de Nantes, Polyclinique Majorelle, Centre Psychothérapique, Hôpital privé La Châtaigneraie, Clinique Sainte-Marie, Centre Jean-Perrin (CLCC), CHU - Hôpital Pellegrin, Centre Hospitalier Sainte-Marie, Hopital Joseph-Ducuing, GHI, Médipôle de Savoie, Médipôle Hôpital Privé, Clinique Sainte-Marie (GHICL), Les Franciscaines, Hôpital Saint-Antoine, Clinique Convert, Clinique Tivoli-Ducos, Hôpitaux Sud, Clinique Saint-Vincent-de-Paul, Centre orthopédique médico-chirurgical, CHU de Martinique, Centre cardiologique, Clinique du Tertre-Rouge, Clinique Paris Lilas, Clinique de Bercy, CHU - Hôpital Pontchaillou, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Clinique Anne-Artois, Centre Georges-François-Leclerc (CLCC), Hôpital privé du Vert-Galant, Clinique La Croix du Sud, Centre chirurgical Marie-Lannelongue, Centre Henri-Becquerel (CLCC), Clinique Marcel-Sembat, Clinique Louis-Pasteur, Clinique cardiologique, Hôpital européen Georges-Pompidou, CMCO Côte d’Opale, GHU Paris Psychiatrie et neurosciences, Hôpital d'instruction des armées Desgenettes, Institut du cancer de Montpellier (CLCC), Hôpital Bicêtre, Médipôle Garonne, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Jean - Sud de France, Clinique Bretéché, Clinique Trenel, CH privé Claude-Galien, Clinique du Lac et d’Argonay, CM Bénigne-Joly, Clinique Saint-André, GH Paul Guiraud, Clinique du Pont-de-Chaume, Centre Hospitalier Gérard-Marchant, Clinique Notre-Dame-de-l’Espérance, Institut ophtalmique, Centre Hospitalier George Sand, Hôpital Robert-Debré, Clinique Ambroise-Paré, CHU - Hôpital de l’Archet, Clinique Saint-Pierre, Nouvelle clinique de Tours, Grand hôpital de l'Est-Francilien, Clinique du Diaconat-Roosevelt, Centre Hospitalier du Rouvray, CHU - Hôpital Saint-Eloi, CH Charles-Perrens, CHR de Metz-Thionville - Hôpital de Mercy, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Keraudren, CMC Pierre-Cherest, Centre Hospitalier d'Erstein, Hôpital Belle-Isle, Hôpital privé Drôme-Ardèche, Polyclinique Bordeaux-Rive droite, Clinique du sport, Clinique de l’Espérance, Clinique mutualiste, Clinique du Cambrésis, Polyclinique de Reims-Bezannes, Clinique Toulouse-Lautrec, Nouvelle clinique Bel-Air, Clinique Belharra, Clinique du Trocadéro, Clinique Saint-Joseph, Hôpital privé de La Miotte, Hôpital Beaujon, Clinique Jouvenet, Hôpital privé de Provence, Santé Atlantique, Polyclinique de Picardie, CHU - Hôpital d’Estaing, Clinique Rhéna, Hôpital Louis-Pradel, Clinique de l'Alma, Clinique mutualiste de l’Estuaire, Groupe hospitalier Nord-Essonne, Centre Léon-Bérard (CLCC), Centre Hospitalier Henri Guerin, Espm de L’agglomeration Lilloise, CH Esquirol, Polyclinique Saint Laurent, CHU - Hôpital Saint-André, Institut Calot, Polyclinique Aguilera, CHU - Hôpital de la Côte de nacre, Hôpitaux civils, Polyclinique La Ligne bleue, Clinique Saint-François, Hôpital Necker-Enfants-Malades, Clinique du Cèdre, Clinique de la Plaine, Hôpital Tenon, Hôpital Paris Saint-Joseph, CHU - Hôpital civil, Polyclinique Bordeaux-Nord-Aquitaine, Hôpital privé de l’Ouest parisien, Institut Bergonié (CLCC), Polyclinique de Blois, Hôpital d'instruction des armées Robert-Picqué, CH Henri-Laborit, Institut de cancérologie Strasbourg Europe, CH Montfavet, Clinique la Pergola, Clinique mutualiste Jules-Verne, Hôpital privé de Marne-la-Vallée, Hôpital des Massues, Clinique Victor-Hugo, CHP de l’Europe, Clinique des Ormeaux, Hôpital de la Timone (Enfants), Institut mutualiste Montsouris, Institut Curie, ASM, Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, CH privé du Montgardé, Hôpital Henri-Mondor, Clinique Saint-Antoine, Clinique de l’Orangerie, Hôpital d'instruction des armées Laveran, Clinique Chantecler, Hôpitaux de Saint-Maurice, Hôpital Corentin-Celton, Clinique mutualiste de Bonneveine, Clinique Jean le Bon, Clinique d’Occitanie, Clinique Pasteur-Lanroze, Clinique Saint-Nabor, CHU - Maternité, Hôpital privé de la Loire, Hôpital Nord Franche-Comté-Belfort, Centre Hospitalier Les Murets, Clinique du Parc, Hôpital Trousseau, Polyclinique Médipôle Saint-Roch, Hôpital Saint-Joseph, Clinique de la Sauvegarde, Clinique des Cèdres, Hôpital privé Beauregard, Institut de cancérologie de l’Ouest, Clinique Mathilde, EPSM Lille-Métropole, Hôpital privé Cannes-Oxford, EPS Ville-Évrard, Institut de cancérologie de Lorraine (CLCC), Hôpital Saint-Vincent-de-Paul (GHICL), Groupe Hospitalier de la Rochelle, Hôpital d'instruction des armées Percy, CHU - Hôpital Central, CHU de Pointe-à-Pitre, Hôpital Saint-Philibert (GHICL), CHU - Hôpital Sud, EPSM de la Marne, Gustave-Roussy (CLCC), Centre Hospitalier Le Vinatier, Clinique Clémentville, CH privé Saint-Grégoire, Institut d’hématologie et d'oncologie pédiatrique, Hôpital privé Paris-Essonne, CHU - Hôpitaux de Brabois, Clinique Beau-Soleil, Polyclinique de Courlancy, Centre Hospitalier Montperrin, Maison de santé Bagatelle, Polyclinique du Parc, Clinique Delay, CHU - Hôpital Morvan, Hôpital Privé Nancy Lorraine, Clinique du Renaison, CH Édouard-Toulouse, CHI, CHU - Hôpitaux mère-enfants, Hôpital Edouard-Herriot, Hôpital Saint-Camille, Polyclinique du Maine, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de l’Estuaire, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Hôpital privé Nord Parisien, Clinique Ormeau centre, Centre Hospitalier Le Bon Sauveur, Polyclinique Saint-François, Hôpital privé La Montagne Lambert, Hôpital de la Pitié-Salpêtrière, CHR, Clinique mutualiste de la Porte-de-l'Orient, CH/Clinique, Fondation Rothschild, CHU Grenoble - Site Nord, Centre Eugène-Marquis (CLCC), Clinique Remusat, Hôpital Raymond-Poincaré, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Axium, Clinique du Grand-Large, Hôpital privé Jean-Mermoz, Clinique Geoffroy-Saint-Hilaire, Hôpitaux pédiatriques, Hôpital Hôtel-Dieu, Hôpital Foch, CHU - American Memorial Hospital, Centre Hospitalier des Pyrénées, Hôpital de la Timone (adultes), Institut franco-britannique Kléber, Clinique de la Part-Dieu, CHU - Hôpital Gui-de-Chauliac, Clinique Saint-Michel, Hôpital de la Timone (enfants), Polyclinique Saint-Roch, Polyclinique de Navarre, Clinique Les Fontaines, Clinique générale, Centre Hospitalier de Vauclaire, Clinique de l’Union, CH intercommunal, Clinique Honoré-Cave, Clinique des Franciscaines, Centre Clinical, Clinique Ormeau Pyrénées, Clinique Saint-Vincent, Centre de chirurgie ophtalmologique, CHU - Centre chirurgical Emile-Gallé, Polyclinique Saint-Côme, Institut Arthur-Vernes, CHU - Hôpital Robert-Debré, Clinique Bizet, Clinique Monticelli-Vélodrome, Pôle Santé République, CHU - Hôpital Nord, CHU - Institut cœur-poumon, Polyclinique du Beaujolais, CHU de Martinique - site Mère-Enfant, Clinique Saint-George, CMC de Parly-II, Centre psychothérapique de Nancy, CHU - Hôpital Pasteur, Institut Curie (CLCC), Hôpital privé, Hôpital privé Saint-Martin, EPSM Morbihan, CHU-Hôpital Purpan/HFE, Hôpital privé de l’Est lyonnais, Clinique Conti, Pôle de Santé du Villeneuvois, Centre Hospitalier Maurice Despinoy, CH privé Saint-Martin, Hôpital Antoine-Béclère, Grand Hôpital de l'Est Francilien Marne-la-Vallée, CHU - Hôpital Roger-Salengro, Centre Hospitalier Drôme Vivarais, Clinique Pasteur, Clinique du Diaconat-Fonderie, Centre Hospitalier La Chartreuse, CHU Réunion, Centre médico-chirurgical et obstétrical, CH Georges-Daumezon, IUCT Oncopole, IUCT/Oncopole, Hôpital privé de Marne Chantereine, Clinique de l’Atlantique, Clinique Rhône Durance, Centre de cardiologie Axium-Rambot, Hôpital Robert Schuman, Centre cardiologique du Nord, Hôpital des Diaconesses, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique ambulatoire de Domont, Clinique de Villeneuve-d’Ascq, Hôpital Bichat, Hôpital privé Sévigné, Hôpital privé Le Bois, CHU - Hôpital Maison-Blanche, Clinique de l'Essonne, CMC Floréal, Hôpital privé d’Antony, Polyclinique Francheville, Clinique Saint-Augustin, Polyclinique de la Baie, CHU de La Réunion - Félix-Guyon, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital Avicenne, Clinique Saint-Paul, Polyclinique Urbain-V, Clinique mutualiste La Sagesse, Institut universitaire de la face et du cou, CHU - Hôpital Jeanne-de-Flandre, Clinique mutualiste catalane, GCS Clinique du Ter, Hôpital Cochin, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Lapeyronie, Hôpital privé La Louvière, CMCO, Clinique Rive-Gauche, Clinique de l’Anjou, Clinique Bon-Secours, Hôpital privé des Peupliers, Centre Antoine-Lacassagne (CLCC), Clinique Charcot, Centre Oscar-Lambret (CLCC), GH, Polyclinique Vauban, Polyclinique Saint-Privat, Polyclinique de Kerio, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Polyclinique de Bordeaux-Tondu
2025-08-25 11:01:12,843 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-25 11:01:12,844 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-25 11:01:12,844 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-25 11:01:12,846 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:12,847 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:12,847 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:12,847 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:12,847 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:12,848 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:12,848 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:13,416 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:15 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'377'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'409'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_bc8b02d0ec1f4a44b2c60ceb2ad9eeb7'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7579dda2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:13,416 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:13,417 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:13,421 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:13,421 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:13,421 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:13,422 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:15 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '377', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '409', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_bc8b02d0ec1f4a44b2c60ceb2ad9eeb7', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e7579dda2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:13,422 [DEBUG] openai._base_client: request_id: req_bc8b02d0ec1f4a44b2c60ceb2ad9eeb7
2025-08-25 11:01:13,423 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:13,423 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:13,423 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-25 11:01:13,424 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:13,426 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:13,427 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:13,427 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:13,428 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:13,428 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:13,428 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:13,428 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:13,881 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:15 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'289'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'302'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_6242904456d34a20b00e4a7c5555f9a3'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e75b3f9e2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:13,882 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:13,882 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:13,885 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:13,885 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:13,885 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:13,885 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:15 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '289', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '302', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_6242904456d34a20b00e4a7c5555f9a3', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e75b3f9e2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:13,886 [DEBUG] openai._base_client: request_id: req_6242904456d34a20b00e4a7c5555f9a3
2025-08-25 11:01:13,886 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-25 11:01:13,886 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-25 11:01:13,887 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-25 11:01:13,887 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:13,889 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:13,890 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:13,890 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:13,890 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:13,891 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:13,891 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:13,891 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:17,438 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3363'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3380'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_7f901bc7cf254f0498ddc22626e51200'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e75e28e52120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:17,439 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:17,439 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:17,439 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:17,439 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:17,439 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:17,440 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:19 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3363', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3380', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_7f901bc7cf254f0498ddc22626e51200', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e75e28e52120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:17,440 [DEBUG] openai._base_client: request_id: req_7f901bc7cf254f0498ddc22626e51200
2025-08-25 11:01:17,440 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-25 11:01:17,440 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-25 11:01:17,441 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-25 11:01:17,441 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result='Paris'
2025-08-25 11:01:17,441 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:17,441 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:17,441 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-25 11:01:17,441 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:17,443 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:17,444 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:17,444 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:17,445 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:17,445 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:17,445 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:17,445 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:17,958 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'344'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'357'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_400c9e99707046789a47b054f491d5d2'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e7745bc72120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:17,958 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:17,958 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:17,964 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:17,964 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:17,964 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:17,965 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:19 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '344', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '357', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_400c9e99707046789a47b054f491d5d2', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e7745bc72120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:17,965 [DEBUG] openai._base_client: request_id: req_400c9e99707046789a47b054f491d5d2
2025-08-25 11:01:17,966 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: 3
2025-08-25 11:01:17,966 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 3
2025-08-25 11:01:17,966 [DEBUG] app.features.query_analysis.city.city_detection: City mentioned detected, extracting city name
2025-08-25 11:01:17,966 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_name called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-25 11:01:17,969 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nQuelle ville ou département est mentionné par la phrase suivante?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nSi une ville est mentionnée, réponds UNIQUEMENT avec le nom de ville.\nPar exemple: pour la phrase 'Trouve moi un hôpital à Lyon', tu me retourneras: 'Lyon'.\n\nSi un département est mentionné, réponds UNIQUEMENT avec le numéro du département.\nPar exemple: pour la phrase 'Je veux être hospitalisé dans le 92', tu me retourneras: '92'.               \n\nSi aucune localisation n'est mentionnée dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nPar exemple: pour la phrase 'Je veux un classement des meilleurs établissements en France', tu me retourneras: 'aucune correspondance'.\nPar exemple: pour la phrase 'Quelle est la meilleur clinique pour une chirurgie à la montagne', tu me retourneras: 'aucune correspondance'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 'Lyon'\n- Avec historique sur Marseille, 'Merci' → 'aucune correspondance'\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:17,970 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:17,970 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:17,970 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:17,970 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:17,971 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:17,971 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:21,606 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:23 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'3441'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'3467'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999648'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_cb8bfeca870f4e34a20ebe462f9f86ab'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e777ad692120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:21,607 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:21,607 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:21,611 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:21,612 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:21,612 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:21,612 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:23 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '3441', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '3467', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999648', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_cb8bfeca870f4e34a20ebe462f9f86ab', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e777ad692120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:21,612 [DEBUG] openai._base_client: request_id: req_cb8bfeca870f4e34a20ebe462f9f86ab
2025-08-25 11:01:21,613 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city name: Paris
2025-08-25 11:01:21,613 [DEBUG] app.features.query_analysis.city.city_detection: City name extracted: Paris
2025-08-25 11:01:21,613 [INFO] app.features.query_analysis.city.city_detection: City detected: Paris
2025-08-25 11:01:21,613 [INFO] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: Detected city 'Paris', setting city_detected=True
2025-08-25 11:01:21,613 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: city_info={'city': 'Paris', 'city_detected': True}
2025-08-25 11:01:21,616 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:21,617 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:21,618 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:21,618 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:21,618 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:21,619 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:21,619 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:22,097 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:24 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'294'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'319'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_5621a9dfbc194ff79e6e2254e634734b'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e78e6feb2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:22,097 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:22,098 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:22,103 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:22,103 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:22,103 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:22,103 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:24 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '294', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '319', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_5621a9dfbc194ff79e6e2254e634734b', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e78e6feb2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:22,104 [DEBUG] openai._base_client: request_id: req_5621a9dfbc194ff79e6e2254e634734b
2025-08-25 11:01:22,105 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-25 11:01:22,105 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-25 11:01:22,105 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-25 11:01:22,108 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 11:01:22,109 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 11:01:22,109 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 11:01:22,109 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 11:01:22,109 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 11:01:22,110 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 11:01:22,110 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 11:01:22,514 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 09:01:24 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'239'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'255'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_1d444b7d62a447deb5625c92d33a3066'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9749e791792a2120-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 11:01:22,515 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 11:01:22,515 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 11:01:22,516 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 11:01:22,516 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 11:01:22,516 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 11:01:22,517 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 09:01:24 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '239', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '255', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_1d444b7d62a447deb5625c92d33a3066', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9749e791792a2120-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 11:01:22,517 [DEBUG] openai._base_client: request_id: req_1d444b7d62a447deb5625c92d33a3066
2025-08-25 11:01:22,517 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-25 11:01:22,518 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': 'Paris', 'city_detected': True, 'institution_name': None, 'institution_type': 'aucune correspondance', 'specialty': 'Cancer de la vessie', 'detection_method': 'keyword', 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3}
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city='Paris', city_detected=True, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: 'Paris'
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: True
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-25 11:01:22,518 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-25 11:01:22,551 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-25 11:01:22,552 [DEBUG] app.services.data_processing_service: Institution list: Hôpital Lariboisière, Hôpital privé de la Casamance, Clinique Kennedy, CHU Nantes - Hôpital Mère Enfant, Nouvel Hôpital de Navarre, Hôtel-Dieu, Clinique Arago, EPS Barthélemy-Durand, Polyclinique Lyon-Nord, CHU - Hôpital de la Cavale-Blanche, Pôle santé Léonard-de-Vinci, Clinique Turin, Polyclinique Saint-Jean l’Ermitage, Clinique Les Eaux-Claires, Institut Arnault-Tzanck, CHU - Hôpital Clocheville, Clinique de la Muette, Hôpital européen, Hôpital privé Toulon Hyères-Saint-Jean, Polyclinique de Reims-Bezannes (Marne), CHU - Gabriel-Montpied, Clinique Durieux, Clinique Océane, Polyclinique de Poitiers, Hôpital privé des Côtes-d’Armor, Centre François-Baclesse (CLCC), Clinique ophtalmologique Thiers, EPSM Etienne-Gourmelen, Infirmerie protestante de Lyon, Hôpital Jean-Verdier, Clinique Fontvert, Centre de la main, Clinique Saint-Jean-de-Dieu, CHU - Hôpital Trousseau, Hôpitaux Nord (Croix-Rousse), Hôpital Saint-Louis, CHU - Hôpital Dupuytren, Clinique Belledonne, CHU - Hôpital Haut-Lévêque, CHU Grenoble - Hôpital Sud, Epsan, Clinique de la Miséricorde, Centre de cardiologie du Pays basque, Clinique Saint-Léonard, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), CH Lyon-Sud, Institut Jean-Godinot (CLCC), Clinique du Parc-Monceau, Pôle santé Oréliance, Clinique Saint-Amé, Clinique du Fief-de-Grimoire, CHU - Hôpital de Hautepierre, Hôpital privé du Confluent, CHU d’Amiens, Clinique Claude-Bernard, Hôpital de la Croix-Saint-Simon, Hôpital privé Paul-d’Égine, Hôpital Lariboisière-Fernand Widal, Hôpital privé Vert-Coteau, Hôpital privé Clairval, Polyclinique de Limoges - site Chénieux, Clinique du Val-d’Or, Clinique Sainte-Clotilde, Hôpital d'instruction des armées Sainte-Anne, CH/clinique, Clinique de l’Europe, Polyclinique Jean-Villar, CHR de Metz-Thionville - Hôpital Bel-Air, Polyclinique du Grand-Sud, Hôpital Nord, Hôpital Pierre-Wertheimer, Hôpital Ambroise-Paré, Hôpital privé de la Seine-Saint-Denis, CHU - Hôpital Bretonneau, Clinique de Vitrolles (Bouches-du-Rhône), Hôpital Louis-Mourier, Hôpital d'instruction des armées Bégin, Polyclinique de Limoges - site Émailleurs, Hôpital de la Croix Rousse (HCL) / CH, Hôpital d'instruction des armées Legouest, CHU - site Nord, Clinique Esquirol-Saint-Hilaire, CHU Sud-Réunion, Clinique Jean Causse, CH national d’ophtalmologie des Quinze-Vingts, Hôpital privé Armand-Brillard, Clinique Sainte-Anne, Hôpital privé Dijon-Bourgogne, Polyclinique Côte-Basque-Sud, CH Guillaume-Régnier, Hôpital Albert Schweitzer, Clinique Saint-Charles, CHU - Hôpital Larrey, HCL - Hôpital Femme-mère-enfant, Clinique Maussins-Nollet, Centre ambulatoire Kleber, Polyclinique de la Région-Mantaise, EPSM de Saône-et-Loire, Polyclinique Santa-Maria, Polyclinique du Parc-Drevon, Hôpital Paul-Brousse, Clinique Juge, GH mutualiste, CH Saint-Joseph-Saint-Luc, Polyclinique Saint-Jean, Clinique Victor-Pauchet, Clinique des Orchidées, Hôpital privé Arras-Les Bonnettes, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, Clinique de l’Yvette, Clinique du Pré, CHU - Hôpital Claude-Huriez, Clinique Bouchard, Clinique de l’Estrée, Clinique Lille-Sud, Hôpital privé Pays-de-Savoie, Clinique du Croisé-Laroche, Polyclinique, Clinique Saint-Hilaire, Hôpital-clinique Claude-Bernard, CHU - Hôpital Purpan, Hôpital privé Natecia, CH Basse-Terre (Guadeloupe), Institut Paoli-Calmettes (CLCC), Clinique du Millénaire, Polyclinique Les Fleurs, Euromed Cardio, CHU de Nantes, Polyclinique Majorelle, Centre Psychothérapique, Hôpital privé La Châtaigneraie, Clinique Sainte-Marie, Centre Jean-Perrin (CLCC), CHU - Hôpital Pellegrin, Centre Hospitalier Sainte-Marie, Hopital Joseph-Ducuing, GHI, Médipôle de Savoie, Médipôle Hôpital Privé, Clinique Sainte-Marie (GHICL), Les Franciscaines, Hôpital Saint-Antoine, Clinique Convert, Clinique Tivoli-Ducos, Hôpitaux Sud, Clinique Saint-Vincent-de-Paul, Centre orthopédique médico-chirurgical, CHU de Martinique, Centre cardiologique, Clinique du Tertre-Rouge, Clinique Paris Lilas, Clinique de Bercy, CHU - Hôpital Pontchaillou, CHU - Hôpital Charles-Nicolle, Institut hospitalier Jacques-Cartier, Clinique Anne-Artois, Centre Georges-François-Leclerc (CLCC), Hôpital privé du Vert-Galant, Clinique La Croix du Sud, Centre chirurgical Marie-Lannelongue, Centre Henri-Becquerel (CLCC), Clinique Marcel-Sembat, Clinique Louis-Pasteur, Clinique cardiologique, Hôpital européen Georges-Pompidou, CMCO Côte d’Opale, GHU Paris Psychiatrie et neurosciences, Hôpital d'instruction des armées Desgenettes, Institut du cancer de Montpellier (CLCC), Hôpital Bicêtre, Médipôle Garonne, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Jean - Sud de France, Clinique Bretéché, Clinique Trenel, CH privé Claude-Galien, Clinique du Lac et d’Argonay, CM Bénigne-Joly, Clinique Saint-André, GH Paul Guiraud, Clinique du Pont-de-Chaume, Centre Hospitalier Gérard-Marchant, Clinique Notre-Dame-de-l’Espérance, Institut ophtalmique, Centre Hospitalier George Sand, Hôpital Robert-Debré, Clinique Ambroise-Paré, CHU - Hôpital de l’Archet, Clinique Saint-Pierre, Nouvelle clinique de Tours, Grand hôpital de l'Est-Francilien, Clinique du Diaconat-Roosevelt, Centre Hospitalier du Rouvray, CHU - Hôpital Saint-Eloi, CH Charles-Perrens, CHR de Metz-Thionville - Hôpital de Mercy, Hôpital privé de Villeneuve-d’Ascq, Polyclinique de Keraudren, CMC Pierre-Cherest, Centre Hospitalier d'Erstein, Hôpital Belle-Isle, Hôpital privé Drôme-Ardèche, Polyclinique Bordeaux-Rive droite, Clinique du sport, Clinique de l’Espérance, Clinique mutualiste, Clinique du Cambrésis, Polyclinique de Reims-Bezannes, Clinique Toulouse-Lautrec, Nouvelle clinique Bel-Air, Clinique Belharra, Clinique du Trocadéro, Clinique Saint-Joseph, Hôpital privé de La Miotte, Hôpital Beaujon, Clinique Jouvenet, Hôpital privé de Provence, Santé Atlantique, Polyclinique de Picardie, CHU - Hôpital d’Estaing, Clinique Rhéna, Hôpital Louis-Pradel, Clinique de l'Alma, Clinique mutualiste de l’Estuaire, Groupe hospitalier Nord-Essonne, Centre Léon-Bérard (CLCC), Centre Hospitalier Henri Guerin, Espm de L’agglomeration Lilloise, CH Esquirol, Polyclinique Saint Laurent, CHU - Hôpital Saint-André, Institut Calot, Polyclinique Aguilera, CHU - Hôpital de la Côte de nacre, Hôpitaux civils, Polyclinique La Ligne bleue, Clinique Saint-François, Hôpital Necker-Enfants-Malades, Clinique du Cèdre, Clinique de la Plaine, Hôpital Tenon, Hôpital Paris Saint-Joseph, CHU - Hôpital civil, Polyclinique Bordeaux-Nord-Aquitaine, Hôpital privé de l’Ouest parisien, Institut Bergonié (CLCC), Polyclinique de Blois, Hôpital d'instruction des armées Robert-Picqué, CH Henri-Laborit, Institut de cancérologie Strasbourg Europe, CH Montfavet, Clinique la Pergola, Clinique mutualiste Jules-Verne, Hôpital privé de Marne-la-Vallée, Hôpital des Massues, Clinique Victor-Hugo, CHP de l’Europe, Clinique des Ormeaux, Hôpital de la Timone (Enfants), Institut mutualiste Montsouris, Institut Curie, ASM, Clinique urologique Nantes-Atlantis, Hôpital Renée-Sabran, CH privé du Montgardé, Hôpital Henri-Mondor, Clinique Saint-Antoine, Clinique de l’Orangerie, Hôpital d'instruction des armées Laveran, Clinique Chantecler, Hôpitaux de Saint-Maurice, Hôpital Corentin-Celton, Clinique mutualiste de Bonneveine, Clinique Jean le Bon, Clinique d’Occitanie, Clinique Pasteur-Lanroze, Clinique Saint-Nabor, CHU - Maternité, Hôpital privé de la Loire, Hôpital Nord Franche-Comté-Belfort, Centre Hospitalier Les Murets, Clinique du Parc, Hôpital Trousseau, Polyclinique Médipôle Saint-Roch, Hôpital Saint-Joseph, Clinique de la Sauvegarde, Clinique des Cèdres, Hôpital privé Beauregard, Institut de cancérologie de l’Ouest, Clinique Mathilde, EPSM Lille-Métropole, Hôpital privé Cannes-Oxford, EPS Ville-Évrard, Institut de cancérologie de Lorraine (CLCC), Hôpital Saint-Vincent-de-Paul (GHICL), Groupe Hospitalier de la Rochelle, Hôpital d'instruction des armées Percy, CHU - Hôpital Central, CHU de Pointe-à-Pitre, Hôpital Saint-Philibert (GHICL), CHU - Hôpital Sud, EPSM de la Marne, Gustave-Roussy (CLCC), Centre Hospitalier Le Vinatier, Clinique Clémentville, CH privé Saint-Grégoire, Institut d’hématologie et d'oncologie pédiatrique, Hôpital privé Paris-Essonne, CHU - Hôpitaux de Brabois, Clinique Beau-Soleil, Polyclinique de Courlancy, Centre Hospitalier Montperrin, Maison de santé Bagatelle, Polyclinique du Parc, Clinique Delay, CHU - Hôpital Morvan, Hôpital Privé Nancy Lorraine, Clinique du Renaison, CH Édouard-Toulouse, CHI, CHU - Hôpitaux mère-enfants, Hôpital Edouard-Herriot, Hôpital Saint-Camille, Polyclinique du Maine, CHU - Hôpital de la Mère et de l’Enfant, Hôpital privé de l’Estuaire, Hôpital de la Conception, Centre Hospitalier Le Mas Careiron, Hôpital privé Nord Parisien, Clinique Ormeau centre, Centre Hospitalier Le Bon Sauveur, Polyclinique Saint-François, Hôpital privé La Montagne Lambert, Hôpital de la Pitié-Salpêtrière, CHR, Clinique mutualiste de la Porte-de-l'Orient, CH/Clinique, Fondation Rothschild, CHU Grenoble - Site Nord, Centre Eugène-Marquis (CLCC), Clinique Remusat, Hôpital Raymond-Poincaré, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Axium, Clinique du Grand-Large, Hôpital privé Jean-Mermoz, Clinique Geoffroy-Saint-Hilaire, Hôpitaux pédiatriques, Hôpital Hôtel-Dieu, Hôpital Foch, CHU - American Memorial Hospital, Centre Hospitalier des Pyrénées, Hôpital de la Timone (adultes), Institut franco-britannique Kléber, Clinique de la Part-Dieu, CHU - Hôpital Gui-de-Chauliac, Clinique Saint-Michel, Hôpital de la Timone (enfants), Polyclinique Saint-Roch, Polyclinique de Navarre, Clinique Les Fontaines, Clinique générale, Centre Hospitalier de Vauclaire, Clinique de l’Union, CH intercommunal, Clinique Honoré-Cave, Clinique des Franciscaines, Centre Clinical, Clinique Ormeau Pyrénées, Clinique Saint-Vincent, Centre de chirurgie ophtalmologique, CHU - Centre chirurgical Emile-Gallé, Polyclinique Saint-Côme, Institut Arthur-Vernes, CHU - Hôpital Robert-Debré, Clinique Bizet, Clinique Monticelli-Vélodrome, Pôle Santé République, CHU - Hôpital Nord, CHU - Institut cœur-poumon, Polyclinique du Beaujolais, CHU de Martinique - site Mère-Enfant, Clinique Saint-George, CMC de Parly-II, Centre psychothérapique de Nancy, CHU - Hôpital Pasteur, Institut Curie (CLCC), Hôpital privé, Hôpital privé Saint-Martin, EPSM Morbihan, CHU-Hôpital Purpan/HFE, Hôpital privé de l’Est lyonnais, Clinique Conti, Pôle de Santé du Villeneuvois, Centre Hospitalier Maurice Despinoy, CH privé Saint-Martin, Hôpital Antoine-Béclère, Grand Hôpital de l'Est Francilien Marne-la-Vallée, CHU - Hôpital Roger-Salengro, Centre Hospitalier Drôme Vivarais, Clinique Pasteur, Clinique du Diaconat-Fonderie, Centre Hospitalier La Chartreuse, CHU Réunion, Centre médico-chirurgical et obstétrical, CH Georges-Daumezon, IUCT Oncopole, IUCT/Oncopole, Hôpital privé de Marne Chantereine, Clinique de l’Atlantique, Clinique Rhône Durance, Centre de cardiologie Axium-Rambot, Hôpital Robert Schuman, Centre cardiologique du Nord, Hôpital des Diaconesses, GH Saint-Vincent - Clinique Sainte-Barbe, Clinique ambulatoire de Domont, Clinique de Villeneuve-d’Ascq, Hôpital Bichat, Hôpital privé Sévigné, Hôpital privé Le Bois, CHU - Hôpital Maison-Blanche, Clinique de l'Essonne, CMC Floréal, Hôpital privé d’Antony, Polyclinique Francheville, Clinique Saint-Augustin, Polyclinique de la Baie, CHU de La Réunion - Félix-Guyon, CHU - Hôtel-Dieu - Hôpital mère-enfants, Hôpital Avicenne, Clinique Saint-Paul, Polyclinique Urbain-V, Clinique mutualiste La Sagesse, Institut universitaire de la face et du cou, CHU - Hôpital Jeanne-de-Flandre, Clinique mutualiste catalane, GCS Clinique du Ter, Hôpital Cochin, CHU d'Amiens/Institut ophtalmologique de Picardie, CHU - Hôpital Lapeyronie, Hôpital privé La Louvière, CMCO, Clinique Rive-Gauche, Clinique de l’Anjou, Clinique Bon-Secours, Hôpital privé des Peupliers, Centre Antoine-Lacassagne (CLCC), Clinique Charcot, Centre Oscar-Lambret (CLCC), GH, Polyclinique Vauban, Polyclinique Saint-Privat, Polyclinique de Kerio, GHP Ambroise-Paré - Hartmann (92), Centre médico-chirurgical du Mans, Polyclinique de Bordeaux-Tondu
2025-08-25 11:01:22,552 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-25 11:01:22,705 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-25 11:01:22,705 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-25 11:01:22,705 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-25 11:01:22,705 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: 'Paris'
2025-08-25 11:01:22,705 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: True
2025-08-25 11:01:22,706 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-25 11:01:22,706 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-25 11:01:22,706 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-25 11:01:22,706 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-25 11:01:22,706 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: Paris, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-25 11:01:22,706 [INFO] app.services.data_processing_service: generate_data_response called
2025-08-25 11:01:22,706 [DEBUG] app.services.data_processing_service: Extracted values - specialty: 'Cancer de la vessie', institution_type: 'aucune correspondance', city: 'Paris'
2025-08-25 11:01:22,706 [DEBUG] app.services.data_processing_service: No institution type match found, loading by specialty only
2025-08-25 11:01:22,706 [INFO] app.services.data_processing_service: Filtering ranking by criteria: specialty='Cancer de la vessie', institution_type='None'
2025-08-25 11:01:22,706 [DEBUG] app.services.data_processing_service: Filtering ranking data - specialty: 'Cancer de la vessie', institution_type: 'None'
2025-08-25 11:01:22,706 [DEBUG] app.services.data_processing_service: Specialty type: <class 'str'>, length: 19
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Available specialties in ranking data: ['Ablation des varices' 'Accidents vasculaires cérébraux'
 'Accouchements à risques' 'Accouchements normaux'
 'Adénome de la prostate' 'Amygdales et végétations'
 'Angioplastie coronaire' 'Appendicite' 'Arthrose de la main' 'Audition'
 'Calculs urinaires' "Cancer de l'estomac et de l'œsophage"
 "Cancer de l'ovaire" "Cancer de l'utérus" 'Cancer de la prostate'
 'Cancer de la thyroïde' 'Cancer de la vessie'
 "Cancer des os de l'enfant et de l'adolescent"
 "Cancer du colon ou de l'intestin" 'Cancer du foie' 'Cancer du pancréas'
 'Cancer du poumon' 'Cancer du rein' 'Cancer du sein' 'Cancer ORL'
 'Cancers de la peau' 'Cardiologie interventionnelle' 'Cataracte'
 'Chirurgie cardiaque adulte' 'Chirurgie cardiaque pédiatrique'
 "Chirurgie de l'épaule" "Chirurgie de l'obésité"
 'Chirurgie de la cheville' 'Chirurgie de la cornée'
 'Chirurgie dentaire et orale de l’adulte'
 'Chirurgie dentaire et orale de l’enfant et de l’adolescent'
 'Chirurgie des artères' "Chirurgie des cancers osseux de l'adulte"
 'Chirurgie des carotides' 'Chirurgie des sarcomes des tissus mous'
 "Chirurgie des testicules de l'adulte"
 "Chirurgie des testicules de l'enfant et de l'adolescent"
 'Chirurgie du canal carpien' "Chirurgie du dos de l'adulte"
 "Chirurgie du dos de l'enfant et de l'adolescent"
 'Chirurgie du nez et des sinus' 'Chirurgie du pied' 'Chirurgie du rectum'
 'Chirurgie maxillo-faciale' 'Dépression' "Diabète de l'adulte"
 "Diabète de l'enfant et de l'adolescent" 'Endométriose'
 "Epilepsie de l'adulte" "Epilepsie de l'enfant et de l'adolescent"
 'Fibrome utérin' 'Glandes salivaires' 'Glaucome' "Hernies de l'abdomen"
 'Hypertension artérielle' 'Infarctus du myocarde'
 'Insuffisance cardiaque' "Leucémie de l'adulte"
 "Leucémie de l'enfant et de l'adolescent" 'Ligaments du genou'
 "Lymphome-Myélome de l'adulte" 'Maladie de Parkinson'
 "Maladies inflammatoires chroniques de l'intestin (MICI)"
 'Médecine vasculaire' 'Pneumologie' 'Proctologie' 'Prothèse de genou'
 'Prothèse de hanche' 'Rétine' 'Schizophrénie' 'Sclérose en plaques'
 'Stimulateurs cardiaques' 'Strabisme'
 'Stress post-traumatique de l’adulte' 'Troubles bipolaires'
 "Tumeurs du cerveau de l'adulte"
 "Tumeurs du cerveau de l'enfant et de l'adolescent" 'Urgences de la main'
 'Vésicule biliaire']
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Normalizing string: Accidents vasculaires cérébraux
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements à risques
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements normaux
2025-08-25 11:01:22,708 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-25 11:01:22,709 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'estomac et de l'œsophage
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer des os de l'enfant et de l'adolescent
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-25 11:01:22,710 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du foie
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du pancréas
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cancers de la peau
2025-08-25 11:01:22,711 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque pédiatrique
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-25 11:01:22,712 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-25 11:01:22,713 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des cancers osseux de l'adulte
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des sarcomes des tissus mous
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-25 11:01:22,714 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'enfant et de l'adolescent
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du rectum
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Dépression
2025-08-25 11:01:22,715 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'adulte
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'enfant et de l'adolescent
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'adulte
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'enfant et de l'adolescent
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-25 11:01:22,716 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Hypertension artérielle
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Insuffisance cardiaque
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'adulte
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'enfant et de l'adolescent
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-25 11:01:22,717 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Lymphome-Myélome de l'adulte
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Maladie de Parkinson
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Maladies inflammatoires chroniques de l'intestin (MICI)
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Médecine vasculaire
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-25 11:01:22,718 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Schizophrénie
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Sclérose en plaques
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Stress post-traumatique de l’adulte
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Troubles bipolaires
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'adulte
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'enfant et de l'adolescent
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-25 11:01:22,719 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-25 11:01:22,720 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-25 11:01:22,720 [DEBUG] app.services.data_processing_service: Normalized specialties in DataFrame: ["'ablation des varices'", "'accidents vasculaires cerebraux'", "'accouchements a risques'", "'accouchements normaux'", "'adenome de la prostate'", "'amygdales et vegetations'", "'angioplastie coronaire'", "'appendicite'", "'arthrose de la main'", "'audition'", "'calculs urinaires'", '"cancer de l\'estomac et de l\'œsophage"', '"cancer de l\'ovaire"', '"cancer de l\'uterus"', "'cancer de la prostate'", "'cancer de la thyroide'", "'cancer de la vessie'", '"cancer des os de l\'enfant et de l\'adolescent"', '"cancer du colon ou de l\'intestin"', "'cancer du foie'", "'cancer du pancreas'", "'cancer du poumon'", "'cancer du rein'", "'cancer du sein'", "'cancer orl'", "'cancers de la peau'", "'cardiologie interventionnelle'", "'cataracte'", "'chirurgie cardiaque adulte'", "'chirurgie cardiaque pediatrique'", '"chirurgie de l\'epaule"', '"chirurgie de l\'obesite"', "'chirurgie de la cheville'", "'chirurgie de la cornee'", "'chirurgie dentaire et orale de l’adulte'", "'chirurgie dentaire et orale de l’enfant et de l’adolescent'", "'chirurgie des arteres'", '"chirurgie des cancers osseux de l\'adulte"', "'chirurgie des carotides'", "'chirurgie des sarcomes des tissus mous'", '"chirurgie des testicules de l\'adulte"', '"chirurgie des testicules de l\'enfant et de l\'adolescent"', "'chirurgie du canal carpien'", '"chirurgie du dos de l\'adulte"', '"chirurgie du dos de l\'enfant et de l\'adolescent"', "'chirurgie du nez et des sinus'", "'chirurgie du pied'", "'chirurgie du rectum'", "'chirurgie maxillo-faciale'", "'depression'", '"diabete de l\'adulte"', '"diabete de l\'enfant et de l\'adolescent"', "'endometriose'", '"epilepsie de l\'adulte"', '"epilepsie de l\'enfant et de l\'adolescent"', "'fibrome uterin'", "'glandes salivaires'", "'glaucome'", '"hernies de l\'abdomen"', "'hypertension arterielle'", "'infarctus du myocarde'", "'insuffisance cardiaque'", '"leucemie de l\'adulte"', '"leucemie de l\'enfant et de l\'adolescent"', "'ligaments du genou'", '"lymphome-myelome de l\'adulte"', "'maladie de parkinson'", '"maladies inflammatoires chroniques de l\'intestin (mici)"', "'medecine vasculaire'", "'pneumologie'", "'proctologie'", "'prothese de genou'", "'prothese de hanche'", "'retine'", "'schizophrenie'", "'sclerose en plaques'", "'stimulateurs cardiaques'", "'strabisme'", "'stress post-traumatique de l’adulte'", "'troubles bipolaires'", '"tumeurs du cerveau de l\'adulte"', '"tumeurs du cerveau de l\'enfant et de l\'adolescent"', "'urgences de la main'", "'vesicule biliaire'"]
2025-08-25 11:01:22,721 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-25 11:01:22,721 [DEBUG] app.services.data_processing_service: Normalized specialty from query: ''cancer de la vessie''
2025-08-25 11:01:22,722 [DEBUG] app.services.data_processing_service: Found 2 rows matching single specialty 'Cancer de la vessie' (normalized: 'cancer de la vessie')
2025-08-25 11:01:22,723 [DEBUG] app.services.data_processing_service: Specialties found after specialty filtering: ['Cancer de la vessie']
2025-08-25 11:01:22,723 [INFO] app.services.data_processing_service: generate_response_links called with matching_rows: <class 'pandas.core.frame.DataFrame'>
2025-08-25 11:01:22,723 [INFO] app.services.data_processing_service: Generating ranking links
2025-08-25 11:01:22,723 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-25 11:01:22,723 [DEBUG] app.services.data_processing_service: Generating links for 2 matching rows
2025-08-25 11:01:22,723 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Public
2025-08-25 11:01:22,723 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'public'
2025-08-25 11:01:22,724 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Privé
2025-08-25 11:01:22,724 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'prive'
2025-08-25 11:01:22,724 [INFO] app.services.data_processing_service: Generated ranking links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-25 11:01:22,724 [INFO] app.services.data_processing_service: load_excel_sheets called with matching_rows of length: 2
2025-08-25 11:01:22,724 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Public' for category: 'Public'
2025-08-25 11:01:22,888 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Public' loaded successfully with 40 rows
2025-08-25 11:01:22,888 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Privé' for category: 'Privé'
2025-08-25 11:01:23,041 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Privé' loaded successfully with 20 rows
2025-08-25 11:01:23,041 [DEBUG] app.services.data_processing_service: Concatenating 2 dataframes
2025-08-25 11:01:23,042 [INFO] app.services.data_processing_service: Successfully loaded 2 sheets, total rows: 60
2025-08-25 11:01:23,042 [INFO] app.services.data_processing_service: Loaded specialty DataFrame
2025-08-25 11:01:23,042 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique specialties in DataFrame: N/A
2025-08-25 11:01:23,042 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique institution types in DataFrame: ['Public' 'Privé']
2025-08-25 11:01:23,042 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame columns: Index(['Rang', 'Etablissement', 'Finess', 'ACTIVITE', 'NOTORIETE', 'DMS',
       'RATIO_AMBU', 'INDICE_LOURDEUR', 'TX_ENDOSCOPIE', 'PRADO', 'Note / 20',
       'Catégorie'],
      dtype='object')
2025-08-25 11:01:23,055 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame head:    Rang                                      Etablissement     Finess  ACTIVITE  ...  TX_ENDOSCOPIE  PRADO  Note / 20  Catégorie
0     1         Institut mutualiste Montsouris, Paris (75)  750150104       254  ...          91.73    1.0      18.63     Public
1     2                        Hôpital Foch, Suresnes (92)  920000650       373  ...          79.89    1.0      18.50     Public
2     3                    Hôpital Saint-Louis, Paris (75)  750100075       310  ...          93.87    1.0      18.27     Public
3     4      Hôpital européen Georges-Pompidou, Paris (75)  750803447       273  ...          90.11    1.0      18.26     Public
4     5               Hôpital Robert Schuman, Vantoux (57)  570026252       263  ...          96.96    1.0      18.25     Public
5     6  Clinique mutualiste de la Porte-de-l'Orient, L...  560002933       249  ...          94.78    1.0      18.25     Public
6     7             CHU - Hôpital Pellegrin, Bordeaux (33)  330781360       220  ...          85.00    1.0      18.19     Public
7     8                   Hôpital européen, Marseille (13)  130043664       266  ...          90.98    1.0      17.91     Public
8     9         CHU - Hôpital Lapeyronie, Montpellier (34)  340785161       219  ...          87.21    1.0      17.90     Public
9    10             Hôpital Paris Saint-Joseph, Paris (75)  750000523       255  ...          92.55    1.0      17.84     Public

[10 rows x 12 columns]
2025-08-25 11:01:23,056 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Filtering for specialty: 'Cancer de la vessie' and city: 'Paris'
2025-08-25 11:01:23,056 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Specialty match count: N/A
2025-08-25 11:01:23,056 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] City match count: N/A
2025-08-25 11:01:23,056 [INFO] app.services.pipeline_orchestrator_service: Extracting hospital locations and calculating distances
2025-08-25 11:01:23,056 [INFO] app.services.data_processing_service: extract_local_hospitals called with df: <class 'NoneType'>
2025-08-25 11:01:23,056 [INFO] app.services.data_processing_service: Merging ranking data with hospital location data
2025-08-25 11:01:23,059 [DEBUG] app.services.data_processing_service: Merged DataFrame shape (with cities): (60, 6)
2025-08-25 11:01:23,060 [INFO] app.services.data_processing_service: get_df_with_distances called
2025-08-25 11:01:23,060 [INFO] app.services.data_processing_service: Calculating distances from query city: Paris
2025-08-25 11:01:23,098 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-25 11:01:23,098 [DEBUG] urllib3.util.retry: Converted retries value: 2 -> Retry(total=2, connect=None, read=None, redirect=None, status=None)
2025-08-25 11:01:23,098 [DEBUG] geopy: Nominatim.geocode: https://nominatim.openstreetmap.org/search?q=Paris&format=json&limit=1
2025-08-25 11:01:23,099 [DEBUG] urllib3.connectionpool: Starting new HTTPS connection (1): nominatim.openstreetmap.org:443
2025-08-25 11:01:23,585 [DEBUG] urllib3.connectionpool: https://nominatim.openstreetmap.org:443 "GET /search?q=Paris&format=json&limit=1 HTTP/1.1" 200 444
2025-08-25 11:01:23,587 [DEBUG] app.services.data_processing_service: Query city coordinates: (48.8534951, 2.3483915)
2025-08-25 11:01:23,633 [DEBUG] app.services.data_processing_service: DataFrame with distances shape after filtering: (60, 7)
2025-08-25 11:01:23,633 [DEBUG] app.services.data_processing_service: Distance column values after filtering: [397.16421568228793, 664.5671165057212, 415.42021849676877, 454.6232692587221, 628.9272762614704, 372.76695725398446, 187.64257370100052, 346.44804063177855, 204.9061679313438, 345.3834222363833, 594.4783082353262, 409.73559161431035, 498.73884900510325, 308.98876258531186, 587.6020165018895, 201.6803175167258, 281.9666122654773, 113.41737487155112, 264.6693413955004, 578.6238060003169, 16.726792716267678, 587.6020165018895, 440.6409364823054, 398.5542834873119, 498.73884900510325, 547.7564737199306, 264.6693413955004, 684.864748960447, 441.30736307891743, 382.66401151108664, 409.73559161431035, 481.9811724587299, 0.0, 4.592712151579527, 9.217278413662884, 11.453781374536742, 364.4347650853049, 0.0, 282.41401459727837, 285.7997399851394, 0.0, 0.0, 660.3147713621365, 0.0, 0.0, 660.3147713621365, 204.9061679313438, 638.1373345264166, 378.3676161619013, 380.29745819875353, 660.3147713621365, 0.0, 498.73884900510325, 687.7062403382804, 613.2211062491715, 506.307887243086, 345.3834222363833, 652.4186260952922, 588.3439902102477, 578.6238060003169]
2025-08-25 11:01:23,633 [DEBUG] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned DataFrame: <class 'pandas.core.frame.DataFrame'>
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Checking if DataFrame is None
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Retrieved DataFrame shape: (60, 7)
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Checking for geolocation API errors
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Getting ranking link for UI
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Checking for specialty_ranking_unavailable
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Checking if institution is mentioned
2025-08-25 11:01:23,634 [DEBUG] app.services.pipeline_orchestrator_service: Checking if city is detected
2025-08-25 11:01:23,634 [INFO] app.services.pipeline_orchestrator_service: City found, searching for results using multi-radius search
2025-08-25 11:01:23,637 [DEBUG] multi_radius_search: [multi_radius_search] Called with radii: [5, 10, 50, 100]
2025-08-25 11:01:23,637 [DEBUG] multi_radius_search: [multi_radius_search] Initial public_df shape: (3, 7)
2025-08-25 11:01:23,638 [DEBUG] multi_radius_search: [multi_radius_search] Initial private_df shape: (3, 7)
2025-08-25 11:01:23,638 [DEBUG] multi_radius_search: [multi_radius_search] Trying radius: 5
2025-08-25 11:01:23,638 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered shape: (2, 7)
2025-08-25 11:01:23,638 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered shape: (0, 7)
2025-08-25 11:01:23,644 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered head:                                  Etablissement   City   Latitude  Longitude Catégorie  Note / 20  Distance
51  Institut mutualiste Montsouris, Paris (75)  Paris  48.853495   2.348391    Public      18.63       0.0
40             Hôpital Saint-Louis, Paris (75)  Paris  48.853495   2.348391    Public      18.27       0.0
2025-08-25 11:01:23,645 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered head: Empty DataFrame
Columns: [Etablissement, City, Latitude, Longitude, Catégorie, Note / 20, Distance]
Index: []
2025-08-25 11:01:23,645 [DEBUG] multi_radius_search: [multi_radius_search] Trying radius: 10
2025-08-25 11:01:23,645 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered shape: (3, 7)
2025-08-25 11:01:23,645 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered shape: (0, 7)
2025-08-25 11:01:23,651 [DEBUG] multi_radius_search: [multi_radius_search] pub_filtered head:                                  Etablissement      City   Latitude  Longitude Catégorie  Note / 20  Distance
51  Institut mutualiste Montsouris, Paris (75)     Paris  48.853495   2.348391    Public      18.63  0.000000
34                 Hôpital Foch, Suresnes (92)  Suresnes  48.870905   2.225573    Public      18.50  9.217278
40             Hôpital Saint-Louis, Paris (75)     Paris  48.853495   2.348391    Public      18.27  0.000000
2025-08-25 11:01:23,652 [DEBUG] multi_radius_search: [multi_radius_search] priv_filtered head: Empty DataFrame
Columns: [Etablissement, City, Latitude, Longitude, Catégorie, Note / 20, Distance]
Index: []
2025-08-25 11:01:23,652 [DEBUG] multi_radius_search: [multi_radius_search] Returning results at radius 10
2025-08-25 11:01:23,652 [DEBUG] app.services.pipeline_orchestrator_service: Formatting response with specialty: base_message='Voici les meilleurs établissements (rayon utilisé : 10 km)', count=3, radius_km=10, city=Paris
2025-08-25 11:01:23,652 [DEBUG] app.services.pipeline_orchestrator_service: Normalizing specialty for display: Cancer de la vessie
2025-08-25 11:01:23,652 [INFO] app.services.pipeline_orchestrator_service: Creating response and logging for prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 11:01:23,652 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 11:01:23,654 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 11:01:23,654 [DEBUG] app.services.pipeline_orchestrator_service: Formatted response: Voici les meilleurs établissements (rayon utilisé : 10 km)
<br>Aucun établissement privé trouvé.<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public situé à 0 km. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public situé à 9 km. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public situé à 0 km. avec une note de 18.27 de 20

🔗 Consultez la méthodologie de palmarès hopitaux <a href="https://www.lepoint.fr/sante/la-methodologie-du-palmares-des-hopitaux-et-cliniques-du-point-2024--04-12-2024-2577146_40.php" target="_blank">ici</a>.
2025-08-25 11:01:23,654 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 2
