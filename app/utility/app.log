2025-08-25 19:09:25,592 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:09:25,592 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:09:25,592 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:09:25,592 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:09:25,592 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:09:25,595 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:09:25,595 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:09:25,595 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:09:25,846 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:09:25,847 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:09:25,847 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:09:25,859 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:09:25,859 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:09:26,085 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:09:26,085 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:09:26,085 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:09:26,086 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:09:26,086 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:09:26,086 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:09:26,170 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:09:26,170 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:09:26,170 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:09:26,172 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:09:26,172 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:09:26,172 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:09:26,172 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:09:26,172 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:09:26,174 [INFO] main: Creating FastAPI app
2025-08-25 19:09:26,174 [INFO] main: CORS middleware added
2025-08-25 19:09:26,176 [INFO] main: API router included
2025-08-25 19:09:41,982 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:09:41,982 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:09:41,982 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:09:41,982 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:09:41,983 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:09:41,993 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:09:42,021 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:09:42,022 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:09:42,059 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11d63cec0>
2025-08-25 19:09:42,059 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11cee0950> server_hostname='api.openai.com' timeout=None
2025-08-25 19:09:42,100 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11d5f1310>
2025-08-25 19:09:42,100 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:09:42,890 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:09:47 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'350'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'440'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_86d87c57553b4c81923d8548497a008a'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=er3OCuUwBqHSm6FMnr96m36rUs0zWsdhCklhlQ3gA.E-1756141787-1.0.1.1-5xdkatepmXYn7tP0qdkO.4ILrhLf12oObm27Gfqu1Np25R3X7Hic5TBpGg.9KddGfP8TbH2YwzoesxwaPCVOWGo8Tuwabs2hGSENV9i5tfo; path=/; expires=Mon, 25-Aug-25 17:39:47 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=SwCP2GqAAXGRjXeYC01_VfmtZr._uFBBQqfxNqVDmJg-1756141787183-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cb2f50cf411bd-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:09:42,892 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:09:42,892 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:09:42,898 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:09:42,898 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:09:42,898 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:09:42,899 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:09:47 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '350'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '440'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_86d87c57553b4c81923d8548497a008a'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=er3OCuUwBqHSm6FMnr96m36rUs0zWsdhCklhlQ3gA.E-1756141787-1.0.1.1-5xdkatepmXYn7tP0qdkO.4ILrhLf12oObm27Gfqu1Np25R3X7Hic5TBpGg.9KddGfP8TbH2YwzoesxwaPCVOWGo8Tuwabs2hGSENV9i5tfo; path=/; expires=Mon, 25-Aug-25 17:39:47 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=SwCP2GqAAXGRjXeYC01_VfmtZr._uFBBQqfxNqVDmJg-1756141787183-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cb2f50cf411bd-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:09:42,899 [DEBUG] openai._base_client: request_id: req_86d87c57553b4c81923d8548497a008a
2025-08-25 19:09:42,908 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:09:42,908 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:09:42,909 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:09:42,909 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:09:42,910 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:09:42,911 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 19:11:34,273 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:11:34,273 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:11:34,273 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:11:34,273 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:11:34,273 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:11:34,275 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:11:34,275 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:11:34,275 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:11:34,444 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:11:34,444 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:11:34,446 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:11:34,449 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:11:34,449 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:11:34,664 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:11:34,665 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:11:34,665 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:11:34,665 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:11:34,666 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:11:34,666 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:11:34,746 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:11:34,746 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:11:34,746 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:11:34,748 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:11:34,748 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:11:34,748 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:11:34,748 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:11:34,748 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:11:34,750 [INFO] main: Creating FastAPI app
2025-08-25 19:11:34,750 [INFO] main: CORS middleware added
2025-08-25 19:11:34,751 [INFO] main: API router included
2025-08-25 19:12:24,647 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:12:24,647 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:12:24,647 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:12:24,648 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:12:24,648 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:12:24,649 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:12:24,649 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:12:24,649 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:12:24,806 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:12:24,806 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:12:24,806 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:12:24,810 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:12:24,810 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:12:25,011 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:12:25,011 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:12:25,011 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:12:25,012 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:12:25,012 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:12:25,012 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:12:25,091 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:12:25,091 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:12:25,091 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:12:25,093 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:12:25,093 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:12:25,093 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:12:25,093 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:12:25,093 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:12:25,095 [INFO] main: Creating FastAPI app
2025-08-25 19:12:25,095 [INFO] main: CORS middleware added
2025-08-25 19:12:25,096 [INFO] main: API router included
2025-08-25 19:12:28,019 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:12:28,019 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:12:28,019 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:12:28,019 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:12:28,019 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:12:28,027 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:12:28,057 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:12:28,058 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:12:28,096 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11b900c20>
2025-08-25 19:12:28,096 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11b16ca70> server_hostname='api.openai.com' timeout=None
2025-08-25 19:12:28,116 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11b8ad310>
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:12:28,863 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:12:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'316'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'399'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_1497848f1d514fe1b665d1fa5858eaa1'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=LqJwa1B6ocdedW4BzF9_2fImrXBwkBmSZIWH3mZBGRM-1756141953-1.0.1.1-j652tG2XG9MVITzAgQzI2EEmDdiLno.TxwkOo22JP88V0.m43Y2UBSiAtIrt7gIQMXUlQzSycOuy6Ye5TYzEMiTPA1xtqbosUdhgpaPWpJk; path=/; expires=Mon, 25-Aug-25 17:42:33 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=7EihmUxG1Ncyx7xuByNmDB1J9tA5GMMEEUArZfuuqd8-1756141953169-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cb702be45defa-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:12:28,864 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:12:28,864 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:12:28,866 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:12:28,866 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:12:28,866 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:12:28,866 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:12:33 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '316'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '399'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_1497848f1d514fe1b665d1fa5858eaa1'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=LqJwa1B6ocdedW4BzF9_2fImrXBwkBmSZIWH3mZBGRM-1756141953-1.0.1.1-j652tG2XG9MVITzAgQzI2EEmDdiLno.TxwkOo22JP88V0.m43Y2UBSiAtIrt7gIQMXUlQzSycOuy6Ye5TYzEMiTPA1xtqbosUdhgpaPWpJk; path=/; expires=Mon, 25-Aug-25 17:42:33 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=7EihmUxG1Ncyx7xuByNmDB1J9tA5GMMEEUArZfuuqd8-1756141953169-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cb702be45defa-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:12:28,867 [DEBUG] openai._base_client: request_id: req_1497848f1d514fe1b665d1fa5858eaa1
2025-08-25 19:12:28,873 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:12:28,873 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:12:28,876 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:12:28,877 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:12:29,548 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:12:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'365'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'511'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_65556ba281c74a2caf30e2de31d1819e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cb7077ae7defa-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:12:29,549 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:12:29,549 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:12:29,553 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:12:29,553 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:12:29,553 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:12:29,553 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:12:33 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '365', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '511', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_65556ba281c74a2caf30e2de31d1819e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cb7077ae7defa-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:12:29,554 [DEBUG] openai._base_client: request_id: req_65556ba281c74a2caf30e2de31d1819e
2025-08-25 19:12:29,554 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:12:29,554 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:12:29,555 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:12:29,556 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:12:29,556 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:12:29,556 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 19:16:10,334 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:16:10,334 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:16:10,334 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:16:10,334 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:10,334 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:10,335 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:10,335 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:10,336 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:10,494 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:10,495 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:10,495 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:10,499 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:10,499 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:10,697 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:16:10,697 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:10,697 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:10,698 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:10,698 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:10,698 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:10,773 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:10,774 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:10,774 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:10,776 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:10,776 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:10,776 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:10,776 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:10,776 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:16:10,778 [INFO] main: Creating FastAPI app
2025-08-25 19:16:10,778 [INFO] main: CORS middleware added
2025-08-25 19:16:10,779 [INFO] main: API router included
2025-08-25 19:16:17,364 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:16:17,364 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:16:17,364 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:16:17,364 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:17,364 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:17,365 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:17,365 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:17,366 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:17,522 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:17,522 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:17,522 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:17,525 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:17,525 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:17,784 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:16:17,784 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:17,784 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:17,785 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:17,785 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:17,785 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:17,869 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:17,869 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:17,869 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:17,871 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:17,871 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:17,871 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:17,871 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:17,872 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:16:17,873 [INFO] main: Creating FastAPI app
2025-08-25 19:16:17,874 [INFO] main: CORS middleware added
2025-08-25 19:16:17,875 [INFO] main: API router included
2025-08-25 19:17:45,586 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:17:45,586 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:17:45,586 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:17:45,586 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:17:45,586 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:17:45,588 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:17:45,588 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:17:45,588 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:17:45,753 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:17:45,753 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:17:45,753 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:17:45,757 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:17:45,757 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:17:45,980 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:17:45,980 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:17:45,980 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:17:45,981 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:17:45,981 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:17:45,981 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:17:46,060 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:17:46,061 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:17:46,061 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:17:46,063 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:17:46,063 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:17:46,063 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:17:46,063 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:17:46,063 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:17:46,064 [INFO] main: Creating FastAPI app
2025-08-25 19:17:46,065 [INFO] main: CORS middleware added
2025-08-25 19:17:46,066 [INFO] main: API router included
2025-08-25 19:19:18,318 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:19:18,319 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:19:18,319 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:19:18,319 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:18,319 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:18,320 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:18,320 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:18,320 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:18,499 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:18,499 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:18,499 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:18,504 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:18,504 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:18,715 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:19:18,715 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:18,715 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:18,716 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:18,716 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:18,716 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:18,792 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:18,792 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:18,792 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:18,794 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:18,794 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:18,794 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:18,794 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:18,794 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:19:18,796 [INFO] main: Creating FastAPI app
2025-08-25 19:19:18,796 [INFO] main: CORS middleware added
2025-08-25 19:19:18,797 [INFO] main: API router included
2025-08-25 19:19:34,930 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:19:34,930 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:19:34,930 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:19:34,930 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:34,930 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:34,931 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:34,931 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:34,931 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:35,084 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:35,084 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:35,084 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:35,088 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:35,088 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:35,266 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:19:35,267 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:35,267 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:35,267 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:35,268 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:35,268 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:35,349 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:35,349 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:35,350 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:35,351 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:35,352 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:35,352 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:35,352 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:35,352 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:19:35,353 [INFO] main: Creating FastAPI app
2025-08-25 19:19:35,354 [INFO] main: CORS middleware added
2025-08-25 19:19:35,355 [INFO] main: API router included
2025-08-25 19:19:44,643 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:19:44,643 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:19:44,643 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:19:44,643 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:19:44,644 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:19:44,651 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:19:44,679 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:19:44,680 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:19:44,726 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11eaf8d70>
2025-08-25 19:19:44,726 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11e274a70> server_hostname='api.openai.com' timeout=None
2025-08-25 19:19:44,752 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11eab11d0>
2025-08-25 19:19:44,752 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:19:44,752 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:19:44,752 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:19:44,753 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:19:44,753 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:19:45,613 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:19:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'307'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'519'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_d340fd0aa83e43d5af89f885c60e35b8'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=dnszx.WItjkekikSkMI1l6KwHuYlNtX0yMpDzsMUy30-1756142389-1.0.1.1-nhcR3RxkLpchPBXWOZeSAKpC_IfcfGYWZfDnwI1W6ExW4eHOwJ40ck_4Kya6bUxEHqfWLRGJqy2AidDuHDMYSLUPht9yF6bjgACm8VWeK6Y; path=/; expires=Mon, 25-Aug-25 17:49:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=pjF32KC8rny5IM5dqcO5B7AIWLLnpiRi62yJEVpeMrc-1756142389953-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc1abf96fed4f-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:19:45,614 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:19:45,614 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:19:45,616 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:19:45,616 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:19:45,616 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:19:45,616 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:19:49 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '307'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '519'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_d340fd0aa83e43d5af89f885c60e35b8'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=dnszx.WItjkekikSkMI1l6KwHuYlNtX0yMpDzsMUy30-1756142389-1.0.1.1-nhcR3RxkLpchPBXWOZeSAKpC_IfcfGYWZfDnwI1W6ExW4eHOwJ40ck_4Kya6bUxEHqfWLRGJqy2AidDuHDMYSLUPht9yF6bjgACm8VWeK6Y; path=/; expires=Mon, 25-Aug-25 17:49:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=pjF32KC8rny5IM5dqcO5B7AIWLLnpiRi62yJEVpeMrc-1756142389953-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cc1abf96fed4f-MXP'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:19:45,616 [DEBUG] openai._base_client: request_id: req_d340fd0aa83e43d5af89f885c60e35b8
2025-08-25 19:19:45,623 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:19:45,623 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:19:45,626 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:19:45,627 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:19:45,627 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:19:46,174 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:19:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'350'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'371'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_71f9045523a14d278384beedd5cfa0b9'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc1b16f9aed4f-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:19:46,174 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:19:46,174 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:19:46,180 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:19:46,180 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:19:46,180 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:19:46,181 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:19:50 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '350', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '371', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_71f9045523a14d278384beedd5cfa0b9', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cc1b16f9aed4f-MXP', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:19:46,181 [DEBUG] openai._base_client: request_id: req_71f9045523a14d278384beedd5cfa0b9
2025-08-25 19:19:46,182 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:19:46,182 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:19:46,183 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:19:46,183 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:19:46,183 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:20:33,032 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:20:33,033 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:20:33,033 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:20:33,033 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:20:33,033 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:20:33,034 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:20:33,034 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:20:33,034 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:20:33,182 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:20:33,182 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:20:33,183 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:20:33,187 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:20:33,187 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:20:33,389 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:20:33,389 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:20:33,389 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:20:33,390 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:20:33,390 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:20:33,390 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:20:33,465 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:20:33,466 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:20:33,466 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:20:33,468 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:20:33,468 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:20:33,468 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:20:33,468 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:20:33,468 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:20:33,470 [INFO] main: Creating FastAPI app
2025-08-25 19:20:33,470 [INFO] main: CORS middleware added
2025-08-25 19:20:33,472 [INFO] main: API router included
2025-08-25 19:20:33,479 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:20:33,479 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:20:33,479 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:20:33,479 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:20:33,480 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:20:33,487 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:20:33,522 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:20:33,523 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:20:33,539 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ef90c20>
2025-08-25 19:20:33,539 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11e7a09e0> server_hostname='api.openai.com' timeout=None
2025-08-25 19:20:33,562 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ef491d0>
2025-08-25 19:20:33,562 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:20:33,562 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:20:33,562 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:20:33,563 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:20:33,563 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:20:34,768 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:20:39 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'753'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'884'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_544cfc8864444857b86a9b58f2acc431'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=uF8xpDG3NmgDvFutDfRSxQ1HahDLc930w5eZUtMGNqc-1756142439-1.0.1.1-hNTG_9TJHo6QxoG4lyMGgQxosXthYXnEVgrZG68Y7a0Duk7jOM9pkqJqu21N_QG5UQISTcU8zVAQ7d6QDj4UrwWCyOzHA7hDLH_x99K1uxw; path=/; expires=Mon, 25-Aug-25 17:50:39 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=u0VCiO1KHLYnKJbrrP8kYEaNBFVfEteP0P_6qc90DZM-1756142439114-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc2dd09e21856-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:20:34,769 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:20:34,769 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:20:34,808 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:20:34,809 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:20:34,809 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:20:34,809 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:20:39 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '753'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '884'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_544cfc8864444857b86a9b58f2acc431'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=uF8xpDG3NmgDvFutDfRSxQ1HahDLc930w5eZUtMGNqc-1756142439-1.0.1.1-hNTG_9TJHo6QxoG4lyMGgQxosXthYXnEVgrZG68Y7a0Duk7jOM9pkqJqu21N_QG5UQISTcU8zVAQ7d6QDj4UrwWCyOzHA7hDLH_x99K1uxw; path=/; expires=Mon, 25-Aug-25 17:50:39 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=u0VCiO1KHLYnKJbrrP8kYEaNBFVfEteP0P_6qc90DZM-1756142439114-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cc2dd09e21856-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:20:34,810 [DEBUG] openai._base_client: request_id: req_544cfc8864444857b86a9b58f2acc431
2025-08-25 19:20:34,819 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:20:34,819 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:20:34,822 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:20:34,823 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:20:35,333 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:20:39 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'299'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'338'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_8f747dfbcfdf442ebc1acc4f00388fd6'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc2e4edb31856-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:20:35,333 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:20:35,334 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:20:35,339 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:20:35,339 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:20:35,339 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:20:35,340 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:20:39 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '299', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '338', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_8f747dfbcfdf442ebc1acc4f00388fd6', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cc2e4edb31856-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:20:35,340 [DEBUG] openai._base_client: request_id: req_8f747dfbcfdf442ebc1acc4f00388fd6
2025-08-25 19:20:35,341 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:20:35,341 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:20:35,343 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:20:35,343 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:20:35,343 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:20:35,343 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 19:21:58,615 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:21:58,615 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:21:58,615 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:21:58,616 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:21:58,616 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:21:58,617 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:21:58,617 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:21:58,617 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:21:58,779 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:21:58,779 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:21:58,780 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:21:58,784 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:21:58,784 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:21:58,995 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:21:58,995 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:21:58,995 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:21:58,996 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:21:58,996 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:21:58,996 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:21:59,073 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:21:59,073 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:21:59,073 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:21:59,075 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:21:59,075 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:21:59,075 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:21:59,075 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:21:59,075 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:21:59,077 [INFO] main: Creating FastAPI app
2025-08-25 19:21:59,077 [INFO] main: CORS middleware added
2025-08-25 19:21:59,078 [INFO] main: API router included
2025-08-25 19:57:58,713 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:57:58,713 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:57:58,713 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:57:58,713 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:57:58,713 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:57:58,715 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:57:58,715 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:57:58,715 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:57:58,873 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:57:58,874 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:57:58,874 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:57:58,880 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:57:58,880 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:57:59,106 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:57:59,107 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:57:59,107 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:57:59,109 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:57:59,109 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:57:59,109 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:57:59,191 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:57:59,191 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:57:59,192 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:57:59,194 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:57:59,194 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:57:59,194 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:57:59,194 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:57:59,194 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:57:59,196 [INFO] main: Creating FastAPI app
2025-08-25 19:57:59,196 [INFO] main: CORS middleware added
2025-08-25 19:57:59,198 [INFO] main: API router included
2025-08-25 19:58:12,683 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:58:12,694 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:58:12,694 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:58:12,694 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:58:12,694 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:58:12,702 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:58:12,746 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:58:12,746 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:58:12,783 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11af04c20>
2025-08-25 19:58:12,783 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11a7ac9e0> server_hostname='api.openai.com' timeout=None
2025-08-25 19:58:12,805 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11aeb5310>
2025-08-25 19:58:12,805 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:58:14,971 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:58:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'329'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'397'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_a4e15cd0b40b496c98b500d66c3ebb19'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=McuhbbYpv0tJvhx8d7G9z21XtBKAZnOKk2LcH2OJ0e0-1756144699-1.0.1.1-UI37GH6e28SzGrepJyZzte89E6F2S4lTyvGb1IZM1cvqWdl05p.UHstP8yOnw_4ZrV.ak4AAQihk.exvUE_BXPbebNXNd4BzSGRtuBBqIa8; path=/; expires=Mon, 25-Aug-25 18:28:19 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=f6KhXA5g2zdKzfHJEnC1l60Dp4KrsxId3qqPE3O.Nu0-1756144699503-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfa067997e1a0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:58:14,972 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:58:14,973 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:58:14,974 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:58:14,974 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:58:14,975 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:58:14,975 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:58:19 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '329'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '397'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_a4e15cd0b40b496c98b500d66c3ebb19'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=McuhbbYpv0tJvhx8d7G9z21XtBKAZnOKk2LcH2OJ0e0-1756144699-1.0.1.1-UI37GH6e28SzGrepJyZzte89E6F2S4lTyvGb1IZM1cvqWdl05p.UHstP8yOnw_4ZrV.ak4AAQihk.exvUE_BXPbebNXNd4BzSGRtuBBqIa8; path=/; expires=Mon, 25-Aug-25 18:28:19 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=f6KhXA5g2zdKzfHJEnC1l60Dp4KrsxId3qqPE3O.Nu0-1756144699503-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cfa067997e1a0-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:58:14,975 [DEBUG] openai._base_client: request_id: req_a4e15cd0b40b496c98b500d66c3ebb19
2025-08-25 19:58:14,982 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:58:14,982 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 19:58:14,983 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:58:14,987 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:58:14,987 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:58:14,988 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:58:14,988 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:58:14,988 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:58:14,989 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:58:14,989 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:58:15,555 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:58:20 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'312'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'407'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999168'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_28bb9a656102477a93a0c47d402a4314'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfa141b5ee1a0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:58:15,555 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:58:15,555 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:58:15,557 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:58:15,557 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:58:15,557 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:58:15,557 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:58:20 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '312', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '407', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999168', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_28bb9a656102477a93a0c47d402a4314', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cfa141b5ee1a0-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:58:15,557 [DEBUG] openai._base_client: request_id: req_28bb9a656102477a93a0c47d402a4314
2025-08-25 19:58:15,558 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:58:15,558 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 19:58:15,559 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:58:15,560 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:58:15,560 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:58:15,560 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:58:15,561 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:00:06,776 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:00:06,776 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:00:06,776 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:00:06,776 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:06,776 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:06,777 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:06,777 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:06,777 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:06,948 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:06,948 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:06,948 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:06,952 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:06,952 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:07,159 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:00:07,159 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:07,159 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:07,160 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:07,160 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:07,160 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:07,235 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:07,235 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:07,235 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:07,237 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:07,237 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:07,237 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:07,237 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:07,237 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:00:07,239 [INFO] main: Creating FastAPI app
2025-08-25 20:00:07,240 [INFO] main: CORS middleware added
2025-08-25 20:00:07,241 [INFO] main: API router included
2025-08-25 20:00:54,507 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:00:54,507 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:00:54,507 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:00:54,507 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:54,508 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:54,508 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:54,509 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:54,509 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:54,667 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:54,668 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:54,668 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:54,671 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:54,671 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:54,912 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:00:54,912 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:54,912 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:54,913 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:54,913 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:54,913 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:54,998 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:54,999 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:54,999 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:55,002 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:55,002 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:55,003 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:55,003 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:55,003 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:00:55,005 [INFO] main: Creating FastAPI app
2025-08-25 20:00:55,006 [INFO] main: CORS middleware added
2025-08-25 20:00:55,007 [INFO] main: API router included
2025-08-25 20:00:57,357 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:00:57,358 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:00:57,358 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:00:57,358 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:00:57,358 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:00:57,366 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:00:57,391 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:00:57,392 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:00:57,430 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11512cc20>
2025-08-25 20:00:57,430 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1149989e0> server_hostname='api.openai.com' timeout=None
2025-08-25 20:00:57,449 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1150dd310>
2025-08-25 20:00:57,449 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:00:57,449 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:00:57,450 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:00:57,450 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:00:57,450 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:00:58,133 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:01:02 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'406'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'496'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_603317768ed94b629941148e3f17553a'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=KaLvXE9vq0kjDqGJFy_1swSqfP3Ta7BLT1bcBNzfozg-1756144862-1.0.1.1-ByIkWP6pDyH8hJSdp.dwjmq83niVgwos6SuzRR83H5y9g3iB0an1VhQfjJGw9ggn73k0B9T3IgvKfEORdQDszwQErfhOq9usVjC0.wn8pvc; path=/; expires=Mon, 25-Aug-25 18:31:02 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=hRKHxHRmGgzuqzvZ9RceCJnMQNaw9ENVkxWgzW5HP20-1756144862678-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfe0b8e76e1f0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:00:58,134 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:00:58,135 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:00:58,144 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:00:58,144 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:00:58,145 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:00:58,145 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:01:02 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '406'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '496'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_603317768ed94b629941148e3f17553a'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=KaLvXE9vq0kjDqGJFy_1swSqfP3Ta7BLT1bcBNzfozg-1756144862-1.0.1.1-ByIkWP6pDyH8hJSdp.dwjmq83niVgwos6SuzRR83H5y9g3iB0an1VhQfjJGw9ggn73k0B9T3IgvKfEORdQDszwQErfhOq9usVjC0.wn8pvc; path=/; expires=Mon, 25-Aug-25 18:31:02 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=hRKHxHRmGgzuqzvZ9RceCJnMQNaw9ENVkxWgzW5HP20-1756144862678-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cfe0b8e76e1f0-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:00:58,145 [DEBUG] openai._base_client: request_id: req_603317768ed94b629941148e3f17553a
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': None, 'token_usage': None}
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:00:58,157 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:00:58,158 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:00:58,158 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:00:58,158 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:00:58,159 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:00:58,159 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:00:58,159 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:00:58,749 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:01:03 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'383'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'423'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_8a5ff6a688cc4225b76048fc7a69ff65'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfe0ff9a9e1f0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:00:58,750 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:00:58,750 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:00:58,750 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:00:58,751 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:00:58,751 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:00:58,751 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:01:03 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '383', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '423', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_8a5ff6a688cc4225b76048fc7a69ff65', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cfe0ff9a9e1f0-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:00:58,751 [DEBUG] openai._base_client: request_id: req_8a5ff6a688cc4225b76048fc7a69ff65
2025-08-25 20:00:58,752 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:00:58,752 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:00:58,752 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': None, 'token_usage': None}
2025-08-25 20:00:58,752 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:00:58,753 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:00:58,753 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:00:58,753 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:00:58,753 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:04:29,602 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:04:29,602 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:04:29,602 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:04:29,602 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:04:29,602 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:04:29,604 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:04:29,604 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:04:29,604 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:04:29,776 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:04:29,776 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:04:29,776 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:04:29,781 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:04:29,781 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:04:30,006 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:04:30,006 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:04:30,006 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:04:30,007 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:04:30,007 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:04:30,007 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:04:30,084 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:04:30,084 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:04:30,085 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:04:30,086 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:04:30,087 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:04:30,087 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:04:30,087 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:04:30,087 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:04:30,090 [INFO] main: Creating FastAPI app
2025-08-25 20:04:30,090 [INFO] main: CORS middleware added
2025-08-25 20:04:30,092 [INFO] main: API router included
2025-08-25 20:06:53,170 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:06:53,170 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:06:53,170 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:06:53,171 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:06:53,171 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:06:53,179 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:06:53,205 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:06:53,206 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:06:53,250 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cbf0d70>
2025-08-25 20:06:53,250 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11c498950> server_hostname='api.openai.com' timeout=None
2025-08-25 20:06:53,276 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cb9d310>
2025-08-25 20:06:53,276 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:06:53,276 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:06:53,277 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:06:53,277 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:06:53,277 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:06:53,861 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:06:58 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'325'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'404'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_f0e1548479044f5b81d8ec3c2271748b'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=g9KUvVwmg95_5l2eDPZ4bFD96ebiAST7DtMXL_1xIfM-1756145218-1.0.1.1-Q1z4FRaUQSys5gOauQTlf5qI6iLS9egcmKv1OQ4HbDs7vcFU1nDFmqCuzQb8jDXIXt0YLHm9GhDmloRA5rA2L.EfhULa1cTHAUyEHlrDp5w; path=/; expires=Mon, 25-Aug-25 18:36:58 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=Qn2IWPrLn3tmI7ixjgXjf9YdZv4xJUROl2E2k_uMjYs-1756145218429-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d06bbae04eddc-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:06:53,863 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:06:53,864 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:06:58 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '325'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '404'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_f0e1548479044f5b81d8ec3c2271748b'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=g9KUvVwmg95_5l2eDPZ4bFD96ebiAST7DtMXL_1xIfM-1756145218-1.0.1.1-Q1z4FRaUQSys5gOauQTlf5qI6iLS9egcmKv1OQ4HbDs7vcFU1nDFmqCuzQb8jDXIXt0YLHm9GhDmloRA5rA2L.EfhULa1cTHAUyEHlrDp5w; path=/; expires=Mon, 25-Aug-25 18:36:58 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=Qn2IWPrLn3tmI7ixjgXjf9YdZv4xJUROl2E2k_uMjYs-1756145218429-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d06bbae04eddc-MXP'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:06:53,864 [DEBUG] openai._base_client: request_id: req_f0e1548479044f5b81d8ec3c2271748b
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:06:53,875 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:06:53,876 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:06:53,876 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:06:53,876 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:06:53,876 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:06:53,877 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:06:53,877 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:06:55,122 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:06:59 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'406'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'862'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_ff701492415a457f820bab9c9b942f90'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d06bf6903eddc-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:06:55,123 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:06:55,123 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:06:55,127 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:06:55,127 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:06:55,127 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:06:55,127 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:06:59 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '406', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '862', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_ff701492415a457f820bab9c9b942f90', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d06bf6903eddc-MXP', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:06:55,127 [DEBUG] openai._base_client: request_id: req_ff701492415a457f820bab9c9b942f90
2025-08-25 20:06:55,128 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:06:55,128 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:06:55,128 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:06:55,128 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:06:55,129 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:06:55,130 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:06:55,130 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:06:55,130 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:09:59,760 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:09:59,761 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:09:59,761 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:09:59,761 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:09:59,761 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:09:59,762 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:09:59,762 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:09:59,762 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:09:59,926 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:09:59,926 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:09:59,927 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:09:59,931 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:09:59,931 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:10:00,134 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:10:00,134 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:10:00,134 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:10:00,135 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:10:00,135 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:10:00,135 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:10:00,212 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:10:00,213 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:10:00,213 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:10:00,215 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:10:00,215 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:10:00,215 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:10:00,215 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:10:00,215 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:10:00,217 [INFO] main: Creating FastAPI app
2025-08-25 20:10:00,218 [INFO] main: CORS middleware added
2025-08-25 20:10:00,219 [INFO] main: API router included
2025-08-25 20:16:59,817 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:16:59,817 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:16:59,817 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:16:59,817 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:16:59,817 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:16:59,818 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:16:59,818 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:16:59,818 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:16:59,979 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:16:59,979 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:16:59,979 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:16:59,983 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:16:59,984 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:17:00,181 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:17:00,181 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:17:00,182 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:17:00,182 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:17:00,182 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:17:00,182 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:17:00,257 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:17:00,257 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:17:00,258 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:17:00,259 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:17:00,260 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:17:00,260 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:17:00,260 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:17:00,260 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:17:00,262 [INFO] main: Creating FastAPI app
2025-08-25 20:17:00,262 [INFO] main: CORS middleware added
2025-08-25 20:17:00,263 [INFO] main: API router included
2025-08-25 20:17:25,093 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:17:25,094 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:17:25,094 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:17:25,094 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:17:25,094 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:17:25,102 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:17:25,132 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:17:25,133 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:17:25,172 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cdb8ec0>
2025-08-25 20:17:25,172 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11c5c4a70> server_hostname='api.openai.com' timeout=None
2025-08-25 20:17:25,193 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cd651d0>
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:17:25,195 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:17:26,436 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:17:31 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'396'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'499'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_bbc0d9e139a644b5873700940beeb828'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=hgVok5Ka7nA0ZdLifYUqzZZLMovb2w6c5hpsO165dcA-1756145851-1.0.1.1-SL4Z5Al8H4v17RkoM25C14jrbnxpHYJ62WqihAVACQtz1pqvyImlkJKRLRz4GVRaeAiXg62W4_BYoeUPy_JOtP6PuT8DkIUVasLWEMxl8CU; path=/; expires=Mon, 25-Aug-25 18:47:31 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=YKjPILS_FUFTYZrMUN9aKmXptFwuJvoFMVC_.szR8AE-1756145851061-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d16297f9670ea-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:17:26,437 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:17:26,438 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:17:26,444 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:17:26,444 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:17:26,444 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:17:26,444 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:17:31 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '396'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '499'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_bbc0d9e139a644b5873700940beeb828'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=hgVok5Ka7nA0ZdLifYUqzZZLMovb2w6c5hpsO165dcA-1756145851-1.0.1.1-SL4Z5Al8H4v17RkoM25C14jrbnxpHYJ62WqihAVACQtz1pqvyImlkJKRLRz4GVRaeAiXg62W4_BYoeUPy_JOtP6PuT8DkIUVasLWEMxl8CU; path=/; expires=Mon, 25-Aug-25 18:47:31 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=YKjPILS_FUFTYZrMUN9aKmXptFwuJvoFMVC_.szR8AE-1756145851061-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d16297f9670ea-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:17:26,445 [DEBUG] openai._base_client: request_id: req_bbc0d9e139a644b5873700940beeb828
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:17:26,456 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:17:26,457 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:17:26,457 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:17:26,457 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:17:26,458 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:17:26,458 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:17:26,458 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:17:27,278 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:17:31 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'370'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'398'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_f2b7dbde908340a19af9fd6e58c78268'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d16315bce70ea-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:17:27,279 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:17:27,279 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:17:27,286 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:17:27,287 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:17:27,287 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:17:27,287 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:17:31 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '370', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '398', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_f2b7dbde908340a19af9fd6e58c78268', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d16315bce70ea-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:17:27,288 [DEBUG] openai._base_client: request_id: req_f2b7dbde908340a19af9fd6e58c78268
2025-08-25 20:17:27,289 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:17:27,289 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:17:27,289 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:17:27,289 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:17:27,290 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:17:27,290 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:17:27,291 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:17:27,291 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:20:02,595 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:20:02,596 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:20:02,596 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:20:02,596 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:20:02,596 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:20:02,598 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:20:02,598 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:20:02,598 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:20:02,756 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:20:02,756 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:20:02,756 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:20:02,761 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:20:02,761 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:20:02,972 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:20:02,972 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:20:02,972 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:20:02,973 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:20:02,973 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:20:02,973 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:20:03,050 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:20:03,051 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:20:03,051 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:20:03,053 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:20:03,054 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:20:03,054 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:20:03,054 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:20:03,054 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:20:03,056 [INFO] main: Creating FastAPI app
2025-08-25 20:20:03,056 [INFO] main: CORS middleware added
2025-08-25 20:20:03,057 [INFO] main: API router included
2025-08-25 20:22:25,618 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:22:25,618 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:22:25,619 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:22:25,619 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:22:25,619 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:22:25,620 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:22:25,620 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:22:25,620 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:22:25,772 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:22:25,772 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:22:25,772 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:22:25,777 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:22:25,777 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:22:26,047 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:22:26,047 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:22:26,047 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:22:26,048 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:22:26,048 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:22:26,048 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:22:26,133 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:22:26,133 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:22:26,133 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:22:26,135 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:22:26,135 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:22:26,135 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:22:26,135 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:22:26,135 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:22:26,137 [INFO] main: Creating FastAPI app
2025-08-25 20:22:26,139 [INFO] main: CORS middleware added
2025-08-25 20:22:26,141 [INFO] main: API router included
2025-08-25 20:25:43,632 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:25:43,632 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:25:43,632 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:25:43,632 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:25:43,632 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:25:43,633 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:25:43,634 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:25:43,634 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:25:43,792 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:25:43,793 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:25:43,793 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:25:43,796 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:25:43,797 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:25:44,237 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:25:44,237 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:25:44,237 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:25:44,239 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:25:44,239 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:25:44,239 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:25:44,320 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:25:44,320 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:25:44,321 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:25:44,324 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:25:44,324 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:25:44,325 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:25:44,325 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:25:44,325 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:25:44,326 [INFO] main: Creating FastAPI app
2025-08-25 20:25:44,327 [INFO] main: CORS middleware added
2025-08-25 20:25:44,329 [INFO] main: API router included
2025-08-25 20:26:47,798 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:26:47,799 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:26:47,799 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:26:47,799 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:26:47,799 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:26:47,800 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:26:47,800 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:26:47,800 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:26:47,957 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:26:47,957 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:26:47,958 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:26:47,961 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:26:47,961 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:26:48,123 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:26:48,123 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:26:48,123 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:26:48,124 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:26:48,124 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:26:48,124 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:26:48,202 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:26:48,202 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:26:48,203 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:26:48,204 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:26:48,205 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:26:48,205 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:26:48,205 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:26:48,205 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:26:48,206 [INFO] main: Creating FastAPI app
2025-08-25 20:26:48,207 [INFO] main: CORS middleware added
2025-08-25 20:26:48,208 [INFO] main: API router included
2025-08-25 20:29:36,460 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:29:36,460 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:29:36,460 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:29:36,460 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:29:36,460 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:29:36,462 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:29:36,462 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:29:36,462 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:29:36,610 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:29:36,610 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:29:36,610 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:29:36,614 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:29:36,614 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:29:36,835 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:29:36,835 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:29:36,835 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:29:36,836 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:29:36,836 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:29:36,836 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:29:36,919 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:29:36,919 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:29:36,919 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:29:36,921 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:29:36,922 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:29:36,922 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:29:36,922 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:29:36,922 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:29:36,924 [INFO] main: Creating FastAPI app
2025-08-25 20:29:36,924 [INFO] main: CORS middleware added
2025-08-25 20:29:36,925 [INFO] main: API router included
2025-08-25 20:30:15,784 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:30:15,784 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:30:15,784 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:30:15,784 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:30:15,784 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:30:15,792 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:30:15,819 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:30:15,820 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:30:15,862 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x118504d70>
2025-08-25 20:30:15,862 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x117d94a70> server_hostname='api.openai.com' timeout=None
2025-08-25 20:30:15,882 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1184b51d0>
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:30:15,883 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:30:16,452 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:30:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'331'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'408'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_3960a411a4914a2385e019174587f7a2'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=ljvV_3k7dqLjYXWmE.4g3h4SQM0vhwMN2VWH9C7NVg4-1756146621-1.0.1.1-LgDKkIlAzIKEyS6wxQpTsA_6LGogH53OXo9IcIxR04dNBgVD.wiEHo.wIrP7L2X6_smIzY4kxhcMNY6kVhw6_y2SL_NaSLvh.qDs2KGjNUY; path=/; expires=Mon, 25-Aug-25 19:00:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=IPVuwF6T_ymKItzLPRWA2mcuQG7H1q6FSHrkL_bRFu4-1756146621141-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d28faaf94e161-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:30:16,453 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:30:16,453 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:30:16,457 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:30:16,457 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:30:16,457 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:30:16,457 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:30:21 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '331'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '408'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_3960a411a4914a2385e019174587f7a2'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=ljvV_3k7dqLjYXWmE.4g3h4SQM0vhwMN2VWH9C7NVg4-1756146621-1.0.1.1-LgDKkIlAzIKEyS6wxQpTsA_6LGogH53OXo9IcIxR04dNBgVD.wiEHo.wIrP7L2X6_smIzY4kxhcMNY6kVhw6_y2SL_NaSLvh.qDs2KGjNUY; path=/; expires=Mon, 25-Aug-25 19:00:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=IPVuwF6T_ymKItzLPRWA2mcuQG7H1q6FSHrkL_bRFu4-1756146621141-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d28faaf94e161-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:30:16,458 [DEBUG] openai._base_client: request_id: req_3960a411a4914a2385e019174587f7a2
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:30:16,468 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:30:16,469 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:30:17,707 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:30:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'847'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1076'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_cdec87272ee14ad98746b29d2e236e58'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d28fe5f7ce161-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:30:17,708 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:30:17,708 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:30:17,715 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:30:17,715 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:30:17,715 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:30:17,715 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:30:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '847', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1076', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_cdec87272ee14ad98746b29d2e236e58', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d28fe5f7ce161-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:30:17,716 [DEBUG] openai._base_client: request_id: req_cdec87272ee14ad98746b29d2e236e58
2025-08-25 20:30:17,716 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:30:17,716 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:30:17,717 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:30:17,717 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:30:17,717 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:30:17,717 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:30:17,718 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:30:17,718 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:01:03,540 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:01:03,541 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:01:03,541 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:01:03,541 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:01:03,541 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:01:03,543 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:01:03,543 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:01:03,543 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:01:03,710 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:01:03,711 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:01:03,711 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:01:03,715 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:01:03,715 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:01:03,923 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:01:03,923 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:01:03,924 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:01:03,924 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:01:03,924 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:01:03,925 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:01:04,004 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:01:04,004 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:01:04,004 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:01:04,006 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:01:04,006 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:01:04,006 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:01:04,006 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:01:04,006 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:01:04,008 [INFO] main: Creating FastAPI app
2025-08-25 21:01:04,008 [INFO] main: CORS middleware added
2025-08-25 21:01:04,009 [INFO] main: API router included
2025-08-25 21:04:26,646 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:04:26,647 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:04:26,647 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:04:26,647 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:26,647 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:26,648 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:26,648 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:26,648 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:26,795 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:26,795 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:26,796 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:26,800 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:26,800 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:27,006 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:04:27,006 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:27,006 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:27,007 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:27,007 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:27,008 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:27,085 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:27,085 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:27,086 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:27,087 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:27,088 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:27,088 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:27,088 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:27,088 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:04:27,089 [INFO] main: Creating FastAPI app
2025-08-25 21:04:27,090 [INFO] main: CORS middleware added
2025-08-25 21:04:27,091 [INFO] main: API router included
2025-08-25 21:04:36,676 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:04:36,676 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:04:36,676 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:04:36,676 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:36,676 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:36,677 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:36,677 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:36,677 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:36,811 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:36,811 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:36,811 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:36,814 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:36,814 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:36,998 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:04:36,998 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:36,998 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:36,999 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:36,999 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:36,999 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:37,083 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:37,083 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:37,084 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:37,085 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:37,085 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:37,086 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:37,086 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:37,086 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:04:37,087 [INFO] main: Creating FastAPI app
2025-08-25 21:04:37,088 [INFO] main: CORS middleware added
2025-08-25 21:04:37,089 [INFO] main: API router included
2025-08-25 21:10:56,347 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:10:56,347 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:10:56,347 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:10:56,347 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:10:56,348 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:10:56,349 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:10:56,349 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:10:56,349 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:10:56,502 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:10:56,502 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:10:56,502 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:10:56,507 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:10:56,507 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:10:56,724 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:10:56,724 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:10:56,724 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:10:56,725 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:10:56,725 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:10:56,725 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:10:56,803 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:10:56,803 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:10:56,803 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:10:56,805 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:10:56,805 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:10:56,805 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:10:56,805 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:10:56,805 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:10:56,807 [INFO] main: Creating FastAPI app
2025-08-25 21:10:56,807 [INFO] main: CORS middleware added
2025-08-25 21:10:56,809 [INFO] main: API router included
2025-08-25 21:13:10,941 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:13:10,941 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:13:10,941 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:13:10,941 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:13:10,941 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:13:10,943 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:13:10,943 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:13:10,943 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:13:11,095 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:13:11,095 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:13:11,095 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:13:11,100 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:13:11,100 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:13:11,299 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:13:11,299 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:13:11,299 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:13:11,300 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:13:11,300 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:13:11,300 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:13:11,376 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:13:11,376 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:13:11,376 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:13:11,378 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:13:11,378 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:13:11,378 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:13:11,378 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:13:11,378 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:13:11,380 [INFO] main: Creating FastAPI app
2025-08-25 21:13:11,380 [INFO] main: CORS middleware added
2025-08-25 21:13:11,382 [INFO] main: API router included
2025-08-25 21:14:07,650 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:14:07,650 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:14:07,650 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:14:07,650 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:07,650 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:07,652 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:07,652 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:07,652 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:07,858 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:07,858 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:07,859 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:07,863 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:07,864 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:08,093 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:14:08,093 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:08,093 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:08,094 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:08,094 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:08,094 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:08,171 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:08,171 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:08,171 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:08,173 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:08,173 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:08,173 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:08,174 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:08,174 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:14:08,175 [INFO] main: Creating FastAPI app
2025-08-25 21:14:08,176 [INFO] main: CORS middleware added
2025-08-25 21:14:08,177 [INFO] main: API router included
2025-08-25 21:14:12,222 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:14:12,222 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:14:12,222 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:14:12,222 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:12,222 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:12,223 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:12,223 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:12,223 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:12,364 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:12,364 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:12,365 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:12,367 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:12,367 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:12,523 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:14:12,524 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:12,524 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:12,525 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:12,525 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:12,525 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:12,605 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:12,606 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:12,606 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:12,608 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:12,608 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:12,608 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:12,608 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:12,608 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:14:12,610 [INFO] main: Creating FastAPI app
2025-08-25 21:14:12,610 [INFO] main: CORS middleware added
2025-08-25 21:14:12,612 [INFO] main: API router included
2025-08-25 21:15:00,042 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:00,042 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:00,042 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:00,042 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:00,042 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:00,043 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:00,043 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:00,043 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:00,195 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:00,195 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:00,196 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:00,199 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:00,199 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:00,366 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:00,366 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:00,366 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:00,367 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:00,367 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:00,367 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:00,448 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:00,448 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:00,448 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:00,450 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:00,450 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:00,450 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:00,450 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:00,450 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:00,453 [INFO] main: Creating FastAPI app
2025-08-25 21:15:00,454 [INFO] main: CORS middleware added
2025-08-25 21:15:00,456 [INFO] main: API router included
2025-08-25 21:15:02,427 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:02,428 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:02,428 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:02,428 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:02,428 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:02,429 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:02,429 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:02,429 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:02,626 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:02,626 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:02,626 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:02,629 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:02,629 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:02,779 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:02,779 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:02,779 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:02,780 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:02,780 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:02,780 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:02,854 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:02,854 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:02,854 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:02,856 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:02,856 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:02,856 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:02,856 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:02,856 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:02,858 [INFO] main: Creating FastAPI app
2025-08-25 21:15:02,858 [INFO] main: CORS middleware added
2025-08-25 21:15:02,860 [INFO] main: API router included
2025-08-25 21:15:08,332 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:08,332 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:08,332 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:08,332 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:08,333 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:08,333 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:08,334 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:08,334 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:08,477 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:08,478 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:08,478 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:08,481 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:08,481 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:08,650 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:08,650 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:08,650 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:08,651 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:08,651 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:08,651 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:08,726 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:08,727 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:08,727 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:08,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:08,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:08,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:08,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:08,729 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:08,731 [INFO] main: Creating FastAPI app
2025-08-25 21:15:08,731 [INFO] main: CORS middleware added
2025-08-25 21:15:08,732 [INFO] main: API router included
2025-08-25 21:15:22,691 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:22,691 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:22,691 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:22,692 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:22,692 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:22,693 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:22,693 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:22,693 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:22,851 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:22,851 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:22,851 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:22,854 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:22,854 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:23,013 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:23,014 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:23,014 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:23,015 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:23,015 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:23,015 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:23,092 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:23,092 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:23,092 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:23,094 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:23,095 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:23,095 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:23,095 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:23,095 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:23,097 [INFO] main: Creating FastAPI app
2025-08-25 21:15:23,098 [INFO] main: CORS middleware added
2025-08-25 21:15:23,100 [INFO] main: API router included
2025-08-25 21:16:14,569 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:14,569 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:14,570 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:14,570 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:14,570 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:14,571 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:14,571 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:14,571 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:14,879 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:14,879 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:14,879 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:14,886 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:14,886 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:15,128 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:15,128 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:15,128 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:15,129 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:15,129 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:15,129 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:15,214 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:15,229 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:15,229 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:15,231 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:15,231 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:15,232 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:15,232 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:15,232 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:15,235 [INFO] main: Creating FastAPI app
2025-08-25 21:16:15,235 [INFO] main: CORS middleware added
2025-08-25 21:16:15,237 [INFO] main: API router included
2025-08-25 21:16:17,279 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:17,279 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:17,279 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:17,279 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:17,279 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:17,280 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:17,280 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:17,280 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:17,416 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:17,416 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:17,416 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:17,419 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:17,419 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:17,575 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:17,575 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:17,575 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:17,576 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:17,576 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:17,576 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:17,656 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:17,656 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:17,656 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:17,658 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:17,658 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:17,658 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:17,658 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:17,658 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:17,660 [INFO] main: Creating FastAPI app
2025-08-25 21:16:17,660 [INFO] main: CORS middleware added
2025-08-25 21:16:17,662 [INFO] main: API router included
2025-08-25 21:16:23,655 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:23,655 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:23,655 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:23,655 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:23,656 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:23,656 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:23,657 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:23,657 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:23,791 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:23,792 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:23,792 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:23,795 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:23,795 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:23,950 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:23,950 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:23,950 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:23,951 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:23,951 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:23,951 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:24,028 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:24,028 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:24,028 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:24,030 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:24,030 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:24,030 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:24,030 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:24,030 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:24,032 [INFO] main: Creating FastAPI app
2025-08-25 21:16:24,032 [INFO] main: CORS middleware added
2025-08-25 21:16:24,033 [INFO] main: API router included
2025-08-25 21:16:29,261 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:29,261 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:29,261 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:29,261 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:29,261 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:29,262 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:29,262 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:29,262 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:29,409 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:29,410 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:29,410 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:29,413 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:29,413 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:29,566 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:29,566 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:29,566 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:29,567 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:29,567 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:29,567 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:29,642 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:29,643 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:29,643 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:29,645 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:29,645 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:29,645 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:29,645 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:29,645 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:29,647 [INFO] main: Creating FastAPI app
2025-08-25 21:16:29,647 [INFO] main: CORS middleware added
2025-08-25 21:16:29,648 [INFO] main: API router included
2025-08-25 21:16:33,189 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:33,189 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:33,189 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:33,189 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:33,189 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:33,190 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:33,190 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:33,190 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:33,345 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:33,346 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:33,346 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:33,349 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:33,349 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:33,503 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:33,503 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:33,503 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:33,504 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:33,504 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:33,504 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:33,582 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:33,582 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:33,582 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:33,584 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:33,584 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:33,584 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:33,584 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:33,584 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:33,586 [INFO] main: Creating FastAPI app
2025-08-25 21:16:33,586 [INFO] main: CORS middleware added
2025-08-25 21:16:33,588 [INFO] main: API router included
2025-08-25 21:16:39,583 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:39,584 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:39,584 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:39,584 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:39,584 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:39,585 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:39,585 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:39,585 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:39,726 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:39,726 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:39,726 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:39,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:39,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:39,888 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:39,888 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:39,888 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:39,889 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:39,889 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:39,889 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:39,974 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:39,974 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:39,974 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:39,976 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:39,976 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:39,976 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:39,976 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:39,977 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:39,978 [INFO] main: Creating FastAPI app
2025-08-25 21:16:39,979 [INFO] main: CORS middleware added
2025-08-25 21:16:39,980 [INFO] main: API router included
2025-08-25 21:16:55,060 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:16:55,060 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:16:55,060 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:16:55,060 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:16:55,060 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:16:55,065 [ERROR] app.utility.llm_helpers: LLM invocation failed in sanity_check_medical_pertinence: Completions.create() got an unexpected keyword argument 'return_usage'
2025-08-25 21:16:55,066 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:16:55,066 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:16:55,066 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:16:55,067 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:16:55,067 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:18:33,450 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:18:33,451 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:18:33,451 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:18:33,451 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:18:33,451 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:18:33,452 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:18:33,452 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:18:33,453 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:18:33,599 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:18:33,599 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:18:33,599 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:18:33,603 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:18:33,604 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:18:33,837 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:18:33,837 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:18:33,837 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:18:33,838 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:18:33,838 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:18:33,838 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:18:33,918 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:18:33,918 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:18:33,918 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:18:33,920 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:18:33,920 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:18:33,920 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:18:33,920 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:18:33,920 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:18:33,922 [INFO] main: Creating FastAPI app
2025-08-25 21:18:33,923 [INFO] main: CORS middleware added
2025-08-25 21:18:33,924 [INFO] main: API router included
2025-08-25 21:18:42,001 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:18:42,001 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:18:42,002 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:18:42,002 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:18:42,002 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:18:42,007 [ERROR] app.utility.llm_helpers: LLM invocation failed in sanity_check_medical_pertinence: Completions.create() got an unexpected keyword argument 'return_usage'
2025-08-25 21:18:42,007 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:18:42,008 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:18:42,008 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:18:42,008 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:18:42,008 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:24:54,712 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:24:54,712 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:24:54,712 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:24:54,712 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:24:54,713 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:24:54,714 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:24:54,714 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:24:54,714 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:24:54,868 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:24:54,868 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:24:54,868 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:24:54,879 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:24:54,880 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:24:55,094 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:24:55,094 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:24:55,094 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:24:55,095 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:24:55,095 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:24:55,095 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:24:55,173 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:24:55,173 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:24:55,173 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:24:55,175 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:24:55,175 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:24:55,175 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:24:55,175 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:24:55,175 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:24:55,177 [INFO] main: Creating FastAPI app
2025-08-25 21:24:55,177 [INFO] main: CORS middleware added
2025-08-25 21:24:55,178 [INFO] main: API router included
2025-08-25 21:25:02,847 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:25:02,847 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:25:02,847 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:25:02,847 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:25:02,848 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:25:02,854 [ERROR] app.utility.llm_helpers: LLM invocation failed in sanity_check_medical_pertinence: Completions.create() got an unexpected keyword argument 'return_usage'
2025-08-25 21:25:02,854 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:25:02,855 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:25:02,855 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:25:02,855 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:25:02,857 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:27:00,774 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:27:00,774 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:27:00,774 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:27:00,774 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:27:00,774 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:27:00,775 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:27:00,776 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:27:00,776 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:27:00,950 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:27:00,950 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:27:00,950 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:27:00,954 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:27:00,955 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:27:01,189 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:27:01,189 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:27:01,189 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:27:01,190 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:27:01,190 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:27:01,190 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:27:01,273 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:27:01,273 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:27:01,273 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:27:01,275 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:27:01,275 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:27:01,275 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:27:01,275 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:27:01,276 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:27:01,277 [INFO] main: Creating FastAPI app
2025-08-25 21:27:01,278 [INFO] main: CORS middleware added
2025-08-25 21:27:01,280 [INFO] main: API router included
2025-08-25 21:28:14,263 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:28:14,263 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:28:14,263 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:28:14,263 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:28:14,263 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:28:14,265 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:28:14,265 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:28:14,265 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:28:14,419 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:28:14,419 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:28:14,419 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:28:14,423 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:28:14,423 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:28:14,684 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:28:14,684 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:28:14,684 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:28:14,685 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:28:14,685 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:28:14,685 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:28:14,767 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:28:14,768 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:28:14,769 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:28:14,771 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:28:14,771 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:28:14,771 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:28:14,771 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:28:14,771 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:28:14,773 [INFO] main: Creating FastAPI app
2025-08-25 21:28:14,774 [INFO] main: CORS middleware added
2025-08-25 21:28:14,775 [INFO] main: API router included
2025-08-25 21:28:43,436 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:28:43,436 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:28:43,436 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:28:43,436 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:28:43,436 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:28:43,446 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 21:28:43,475 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 21:28:43,475 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 21:28:43,511 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x112178ec0>
2025-08-25 21:28:43,511 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1118d0c20> server_hostname='api.openai.com' timeout=None
2025-08-25 21:28:43,545 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11212d590>
2025-08-25 21:28:43,545 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 21:28:44,465 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 19:28:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'356'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'462'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_cbd43c2471c64a4a821e750f9045991e'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=LbrHI4uHPgVyG3Z5FFMNFQobskxerr22zpfzkGdMIMw-1756150129-1.0.1.1-B5YiOux2R_ltD1CIp1LTK8HmFaWC0aw1iQjXQHJ3U538ommxCyq2lYsJkxcB9LextX7Lv02n6P1VGj_TT5mEXtc2v8o0pmwk.YdGhN0m5PA; path=/; expires=Mon, 25-Aug-25 19:58:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=lgtONf0ak1aILamS2PL2jSSixxaVNJ3lOV5MUSFZbAk-1756150129443-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d7e9f5b45e1f9-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 21:28:44,466 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 21:28:44,466 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 21:28:44,467 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 21:28:44,467 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 21:28:44,467 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 21:28:44,467 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 19:28:49 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '356'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '462'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_cbd43c2471c64a4a821e750f9045991e'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=LbrHI4uHPgVyG3Z5FFMNFQobskxerr22zpfzkGdMIMw-1756150129-1.0.1.1-B5YiOux2R_ltD1CIp1LTK8HmFaWC0aw1iQjXQHJ3U538ommxCyq2lYsJkxcB9LextX7Lv02n6P1VGj_TT5mEXtc2v8o0pmwk.YdGhN0m5PA; path=/; expires=Mon, 25-Aug-25 19:58:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=lgtONf0ak1aILamS2PL2jSSixxaVNJ3lOV5MUSFZbAk-1756150129443-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d7e9f5b45e1f9-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 21:28:44,467 [DEBUG] openai._base_client: request_id: req_cbd43c2471c64a4a821e750f9045991e
2025-08-25 21:28:44,476 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 21:28:44,476 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 21:28:44,476 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:28:44,477 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:28:44,477 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:28:44,477 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:28:44,478 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:37:45,423 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:37:45,423 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:37:45,423 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:37:45,423 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:37:45,423 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:37:45,425 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:37:45,425 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:37:45,425 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:37:45,583 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:37:45,583 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:37:45,584 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:37:45,589 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:37:45,589 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:37:45,794 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:37:45,794 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:37:45,794 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:37:45,795 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:37:45,795 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:37:45,795 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:37:45,867 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:37:45,867 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:37:45,867 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:37:45,869 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:37:45,869 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:37:45,869 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:37:45,869 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:37:45,869 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:37:45,871 [INFO] main: Creating FastAPI app
2025-08-25 21:37:45,871 [INFO] main: CORS middleware added
2025-08-25 21:37:45,872 [INFO] main: API router included
2025-08-25 21:39:58,609 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:39:58,609 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:39:58,609 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:39:58,609 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:39:58,609 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:39:58,611 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:39:58,611 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:39:58,611 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:39:58,781 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:39:58,781 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:39:58,781 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:39:58,785 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:39:58,785 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:39:59,021 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:39:59,021 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:39:59,021 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:39:59,022 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:39:59,022 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:39:59,022 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:39:59,102 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:39:59,102 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:39:59,102 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:39:59,104 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:39:59,104 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:39:59,105 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:39:59,105 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:39:59,105 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:39:59,107 [INFO] main: Creating FastAPI app
2025-08-25 21:39:59,108 [INFO] main: CORS middleware added
2025-08-25 21:39:59,109 [INFO] main: API router included
2025-08-25 21:40:20,948 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:40:20,948 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:40:20,948 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:40:20,948 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:40:20,949 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:40:20,950 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:40:20,950 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:40:20,950 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:40:21,120 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:40:21,120 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:40:21,120 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:40:21,124 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:40:21,124 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:40:21,348 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:40:21,348 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:40:21,348 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:40:21,349 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:40:21,349 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:40:21,349 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:40:21,424 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:40:21,424 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:40:21,424 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:40:21,426 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:40:21,426 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:40:21,426 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:40:21,426 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:40:21,426 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:40:21,428 [INFO] main: Creating FastAPI app
2025-08-25 21:40:21,429 [INFO] main: CORS middleware added
2025-08-25 21:40:21,430 [INFO] main: API router included
2025-08-25 21:40:31,204 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:40:31,204 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:40:31,204 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:40:31,204 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:40:31,204 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:40:31,212 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 21:40:31,239 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 21:40:31,239 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 21:40:31,279 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116e50ec0>
2025-08-25 21:40:31,279 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1166dccb0> server_hostname='api.openai.com' timeout=None
2025-08-25 21:40:31,298 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116e05590>
2025-08-25 21:40:31,298 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 21:40:31,976 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 19:40:37 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'280'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'374'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_19d8d44ed683439899c7346dadece34b'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=mCJ3EGo5sCyvbviLRNHgxn6WRCNWummYPUxKC2HIuWI-1756150837-1.0.1.1-y183w8fcQDOEzwtg48l_t5SZScc._ids8St57yz43JheUoeUlf7dmiFZ493.xLRwiBJMJcktD57VW6MiTM4o7anIRnKpUiN0xKS3fVnsfvg; path=/; expires=Mon, 25-Aug-25 20:10:37 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=UNJyuAjbNePmj6rU6tPUgHu10O1UBge52a9Xgjpuxzc-1756150837012-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d8fe72c0eb93b-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 21:40:31,978 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 21:40:31,978 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 21:40:31,979 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 21:40:31,979 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 21:40:31,979 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 21:40:31,979 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 19:40:37 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '280'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '374'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_19d8d44ed683439899c7346dadece34b'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=mCJ3EGo5sCyvbviLRNHgxn6WRCNWummYPUxKC2HIuWI-1756150837-1.0.1.1-y183w8fcQDOEzwtg48l_t5SZScc._ids8St57yz43JheUoeUlf7dmiFZ493.xLRwiBJMJcktD57VW6MiTM4o7anIRnKpUiN0xKS3fVnsfvg; path=/; expires=Mon, 25-Aug-25 20:10:37 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=UNJyuAjbNePmj6rU6tPUgHu10O1UBge52a9Xgjpuxzc-1756150837012-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d8fe72c0eb93b-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 21:40:31,980 [DEBUG] openai._base_client: request_id: req_19d8d44ed683439899c7346dadece34b
2025-08-25 21:40:31,987 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 21:40:31,987 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 21:40:31,988 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:40:31,988 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:40:31,989 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:40:31,989 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:40:31,989 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:41:43,964 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:41:43,964 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:41:43,964 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:41:43,964 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:41:43,964 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:41:43,967 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 21:41:43,968 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 21:41:43,969 [DEBUG] httpcore.connection: close.started
2025-08-25 21:41:43,969 [DEBUG] httpcore.connection: close.complete
2025-08-25 21:41:43,970 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 21:41:43,992 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116e079d0>
2025-08-25 21:41:43,992 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1166dccb0> server_hostname='api.openai.com' timeout=None
2025-08-25 21:41:44,019 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116dae3f0>
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 21:41:44,020 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 21:41:44,673 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 19:41:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'469'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'486'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_079c6e598ee247c1b638653095d922cf'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d91adc8c6edb4-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 21:41:44,673 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 21:41:44,674 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 21:41:44,676 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 21:41:44,676 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 21:41:44,676 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 21:41:44,677 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 19:41:49 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '469', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '486', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9998878', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '6ms', 'x-request-id': 'req_079c6e598ee247c1b638653095d922cf', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d91adc8c6edb4-MXP', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 21:41:44,677 [DEBUG] openai._base_client: request_id: req_079c6e598ee247c1b638653095d922cf
2025-08-25 21:41:44,678 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 21:41:44,678 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 21:41:44,678 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:41:44,679 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:41:44,679 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:41:44,679 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:41:44,679 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:56:07,775 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:56:07,776 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:56:07,776 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:56:07,776 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:56:07,776 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:56:07,778 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:56:07,779 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:56:07,779 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:56:07,975 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:56:07,975 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:56:07,975 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:56:07,980 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:56:07,980 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:56:08,207 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:56:08,207 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:56:08,207 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:56:08,208 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:56:08,208 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:56:08,208 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:56:08,284 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:56:08,284 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:56:08,285 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:56:08,287 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:56:08,287 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:56:08,287 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:56:08,287 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:56:08,287 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:56:08,289 [INFO] main: Creating FastAPI app
2025-08-25 21:56:08,290 [INFO] main: CORS middleware added
2025-08-25 21:56:08,291 [INFO] main: API router included
2025-08-25 22:30:44,270 [INFO] app.api.routes: Initializing core services...
2025-08-25 22:30:44,271 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 22:30:44,271 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 22:30:44,271 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 22:30:44,271 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 22:30:44,272 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 22:30:44,272 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 22:30:44,273 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:03:20,647 [INFO] app.api.routes: Initializing core services...
2025-08-26 11:03:20,647 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 11:03:20,647 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 11:03:20,647 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:03:20,647 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:03:20,648 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:03:20,649 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:03:20,649 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:07:35,147 [INFO] app.api.routes: Initializing core services...
2025-08-26 11:07:35,147 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 11:07:35,148 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 11:07:35,148 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:07:35,148 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:07:35,149 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:07:35,149 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:07:35,149 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:07:35,543 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:07:35,543 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:07:35,543 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:07:35,554 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:07:35,554 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:07:35,970 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 11:07:35,970 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:07:35,970 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:07:35,971 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:07:35,971 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:07:35,971 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:07:36,046 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:07:36,046 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:07:36,046 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:07:36,048 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:07:36,048 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:07:36,048 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:07:36,048 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:07:36,048 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 11:07:36,050 [INFO] main: Creating FastAPI app
2025-08-26 11:07:36,050 [INFO] main: CORS middleware added
2025-08-26 11:07:36,051 [INFO] main: API router included
2025-08-26 11:08:57,933 [INFO] app.api.routes: Initializing core services...
2025-08-26 11:08:57,933 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 11:08:57,933 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 11:08:57,933 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:08:57,933 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:08:57,934 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:08:57,935 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:08:57,935 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:08:58,319 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:08:58,319 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:08:58,319 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:08:58,323 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:08:58,323 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:08:58,535 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 11:08:58,535 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:08:58,535 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:08:58,536 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:08:58,536 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:08:58,536 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:08:58,610 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:08:58,610 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:08:58,610 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:08:58,612 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:08:58,612 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:08:58,612 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:08:58,612 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:08:58,612 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 11:08:58,614 [INFO] main: Creating FastAPI app
2025-08-26 11:08:58,614 [INFO] main: CORS middleware added
2025-08-26 11:08:58,615 [INFO] main: API router included
2025-08-26 11:14:12,977 [INFO] app.api.routes: Initializing core services...
2025-08-26 11:14:12,977 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 11:14:12,977 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 11:14:12,977 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:14:12,977 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:14:12,979 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:14:12,979 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:14:12,979 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:14:13,356 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:14:13,356 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:14:13,356 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:14:13,367 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:14:13,367 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:14:13,586 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 11:14:13,586 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:14:13,586 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:14:13,587 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:14:13,587 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:14:13,587 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:14:13,662 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:14:13,662 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:14:13,662 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:14:13,664 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:14:13,664 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:14:13,664 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:14:13,664 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:14:13,664 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 11:14:13,666 [INFO] main: Creating FastAPI app
2025-08-26 11:14:13,667 [INFO] main: CORS middleware added
2025-08-26 11:14:13,668 [INFO] main: API router included
2025-08-26 11:14:18,968 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-26 11:14:18,968 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-26 11:14:18,969 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 11:14:18,969 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-26 11:14:18,969 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 11:14:18,973 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-32b0642d-9a87-44a4-b2d4-b9f6319abedd', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 11:14:19,005 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 11:14:19,005 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 11:14:19,041 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1199c9550>
2025-08-26 11:14:19,041 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x118db8680> server_hostname='api.openai.com' timeout=None
2025-08-26 11:14:19,072 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1199842d0>
2025-08-26 11:14:19,072 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 11:14:19,072 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 11:14:19,072 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 11:14:19,073 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 11:14:19,073 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 11:14:19,741 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 09:14:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'440'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'505'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_2ea364f837b6482994f7b12ff81b4050'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=sczrUJ7u0aMVpYWtgTNHqtknZPvmQxYZBmf_TbOVwtA-1756199661-1.0.1.1-wwLpqd3RfWr6cQCkiLKMWPTlR0j7heQqozpT.6MBduVu6RqUJR81zzXVoX9moMR3POWBbVTkSNkkK4fgPGyTK25hMmaflX42un4wF_umkPY; path=/; expires=Tue, 26-Aug-25 09:44:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=C78iJrKdLUa_KMpQeN5Yxy4fELT3ZklmjOlH6_R1jjw-1756199661867-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'975237ea9b1ef4f6-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 11:14:19,742 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 11:14:19,742 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 11:14:19,746 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 11:14:19,746 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 11:14:19,746 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 11:14:19,747 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 09:14:21 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '440'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '505'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_2ea364f837b6482994f7b12ff81b4050'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=sczrUJ7u0aMVpYWtgTNHqtknZPvmQxYZBmf_TbOVwtA-1756199661-1.0.1.1-wwLpqd3RfWr6cQCkiLKMWPTlR0j7heQqozpT.6MBduVu6RqUJR81zzXVoX9moMR3POWBbVTkSNkkK4fgPGyTK25hMmaflX42un4wF_umkPY; path=/; expires=Tue, 26-Aug-25 09:44:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=C78iJrKdLUa_KMpQeN5Yxy4fELT3ZklmjOlH6_R1jjw-1756199661867-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '975237ea9b1ef4f6-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 11:14:19,747 [DEBUG] openai._base_client: request_id: req_2ea364f837b6482994f7b12ff81b4050
2025-08-26 11:14:19,758 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 11:14:19,758 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 11:14:19,758 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 11:14:19,758 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 11:14:19,760 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 11:14:19,760 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 11:14:19,760 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 11:14:19,762 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 11:58:58,744 [INFO] app.api.routes: Initializing core services...
2025-08-26 11:58:58,744 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 11:58:58,744 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 11:58:58,744 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:58:58,744 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:58:58,746 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:58:58,746 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:58:58,746 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:58:59,150 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:58:59,150 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:58:59,150 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:58:59,154 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:58:59,154 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:58:59,377 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 11:58:59,377 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:58:59,378 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:58:59,378 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:58:59,378 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:58:59,378 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:58:59,456 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:58:59,456 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:58:59,456 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:58:59,458 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:58:59,458 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:58:59,458 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:58:59,458 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:58:59,458 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 11:58:59,460 [INFO] main: Creating FastAPI app
2025-08-26 11:58:59,460 [INFO] main: CORS middleware added
2025-08-26 11:58:59,462 [INFO] main: API router included
2025-08-26 11:59:11,735 [INFO] app.api.routes: Initializing core services...
2025-08-26 11:59:11,735 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 11:59:11,735 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 11:59:11,735 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:59:11,735 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:59:11,736 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:59:11,736 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:59:11,736 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:59:12,099 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:59:12,099 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:59:12,099 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:59:12,102 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:59:12,103 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:59:12,316 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 11:59:12,316 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 11:59:12,316 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 11:59:12,317 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 11:59:12,317 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 11:59:12,317 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 11:59:12,397 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 11:59:12,397 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 11:59:12,398 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 11:59:12,400 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:59:12,400 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:59:12,400 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 11:59:12,400 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 11:59:12,400 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 11:59:12,402 [INFO] main: Creating FastAPI app
2025-08-26 11:59:12,402 [INFO] main: CORS middleware added
2025-08-26 11:59:12,403 [INFO] main: API router included
2025-08-26 11:59:15,871 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-26 11:59:15,872 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-26 11:59:15,872 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 11:59:15,872 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-26 11:59:15,872 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 11:59:15,875 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-ca77f99b-a79c-430a-90f4-71a78867a8c4', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 11:59:15,902 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 11:59:15,903 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 11:59:15,940 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11a57d550>
2025-08-26 11:59:15,940 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1198b0680> server_hostname='api.openai.com' timeout=None
2025-08-26 11:59:15,961 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11a54c2d0>
2025-08-26 11:59:15,961 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 11:59:15,961 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 11:59:15,961 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 11:59:15,962 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 11:59:15,962 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 11:59:16,534 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 09:59:18 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'348'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'412'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_7aefbd6824944964b228debae653a8b7'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=yv0Nx3moWK.kru1ggFtiuV13H4exj4p0HCTr40bU9SQ-1756202358-1.0.1.1-bSuIqOhqgAWFh9K8R2i0ypkoHq_VBGQnK19N8.cNQSYLE4gcodlr.qh0tulRmQv8o6WZ3UZ51kP8JO4_gsmbw0XqNX9RPeoeIACqV3jqTrc; path=/; expires=Tue, 26-Aug-25 10:29:18 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=U6SIdEVQtWdt7Xc_4FH8XXoOZ54JkSQMgwQW6vqiFkI-1756202358886-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'975279c3880112b4-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 11:59:16,535 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 11:59:16,536 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 11:59:16,539 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 11:59:16,539 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 11:59:16,540 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 11:59:16,540 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 09:59:18 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '348'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '412'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_7aefbd6824944964b228debae653a8b7'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=yv0Nx3moWK.kru1ggFtiuV13H4exj4p0HCTr40bU9SQ-1756202358-1.0.1.1-bSuIqOhqgAWFh9K8R2i0ypkoHq_VBGQnK19N8.cNQSYLE4gcodlr.qh0tulRmQv8o6WZ3UZ51kP8JO4_gsmbw0XqNX9RPeoeIACqV3jqTrc; path=/; expires=Tue, 26-Aug-25 10:29:18 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=U6SIdEVQtWdt7Xc_4FH8XXoOZ54JkSQMgwQW6vqiFkI-1756202358886-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '975279c3880112b4-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 11:59:16,540 [DEBUG] openai._base_client: request_id: req_7aefbd6824944964b228debae653a8b7
2025-08-26 11:59:16,549 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 11:59:16,549 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 11:59:16,549 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 11:59:16,549 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 11:59:16,550 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 11:59:16,551 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 11:59:16,551 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 11:59:16,551 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 12:13:12,195 [INFO] app.api.routes: Initializing core services...
2025-08-26 12:13:12,195 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 12:13:12,195 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 12:13:12,196 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 12:13:12,196 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 12:13:12,197 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 12:13:12,198 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 12:13:12,198 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 12:13:12,626 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 12:13:12,626 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 12:13:12,626 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 12:13:12,629 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 12:13:12,630 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 12:13:12,853 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 12:13:12,853 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 12:13:12,853 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 12:13:12,854 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 12:13:12,854 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 12:13:12,854 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 12:13:12,927 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 12:13:12,927 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 12:13:12,928 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 12:13:12,929 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 12:13:12,930 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 12:13:12,930 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 12:13:12,930 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 12:13:12,930 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 12:13:12,931 [INFO] main: Creating FastAPI app
2025-08-26 12:13:12,932 [INFO] main: CORS middleware added
2025-08-26 12:13:12,933 [INFO] main: API router included
2025-08-26 12:34:02,608 [INFO] app.api.routes: Initializing core services...
2025-08-26 12:34:02,608 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 12:34:02,608 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 12:34:02,608 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 12:34:02,608 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 12:34:02,610 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 12:34:02,610 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 12:34:02,610 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 12:34:02,984 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 12:34:02,985 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 12:34:02,985 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 12:34:02,988 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 12:34:02,989 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 12:34:03,194 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 12:34:03,195 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 12:34:03,195 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 12:34:03,196 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 12:34:03,196 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 12:34:03,196 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 12:34:03,272 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 12:34:03,272 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 12:34:03,272 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 12:34:03,274 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 12:34:03,274 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 12:34:03,274 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 12:34:03,274 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 12:34:03,274 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 12:34:03,276 [INFO] main: Creating FastAPI app
2025-08-26 12:34:03,276 [INFO] main: CORS middleware added
2025-08-26 12:34:03,277 [INFO] main: API router included
2025-08-26 12:38:26,658 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-26 12:38:26,659 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-26 12:38:26,659 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 12:38:26,659 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-26 12:38:26,659 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 12:38:26,662 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-aadc7457-ccbd-4216-b078-635fee372946', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 12:38:26,692 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 12:38:26,692 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 12:38:26,731 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x111c15550>
2025-08-26 12:38:26,731 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x110eb4680> server_hostname='api.openai.com' timeout=None
2025-08-26 12:38:26,754 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x111bac2d0>
2025-08-26 12:38:26,754 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 12:38:26,754 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 12:38:26,754 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 12:38:26,755 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 12:38:26,755 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 12:38:29,605 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 10:38:32 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1268'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1360'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_e8a8dc0bd6c54c4c9ad3ad15ade4d1d9'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=YwKPOBtuVwCsL._6.1qNLk9sT.ouAIDb_0OKMw6l56s-1756204712-1.0.1.1-qKJubbrH.wI7i4ZYnEU_HI8Y97GCP7mKyI5MwKGLWPlX5116UBtjAWjdnvn88gk4b6Uz2sfEqUfy_pwN.CJdgOxcP6m_gIruYw3sQCJ_94I; path=/; expires=Tue, 26-Aug-25 11:08:32 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=A8YDSmfsHHRA.DmNda37oTcp0L72qDabnKq_IUnOxrU-1756204712159-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9752b3294890e220-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 12:38:29,606 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 12:38:29,607 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 12:38:29,615 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 12:38:29,615 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 12:38:29,616 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 12:38:29,616 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 10:38:32 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '1268'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '1360'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_e8a8dc0bd6c54c4c9ad3ad15ade4d1d9'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=YwKPOBtuVwCsL._6.1qNLk9sT.ouAIDb_0OKMw6l56s-1756204712-1.0.1.1-qKJubbrH.wI7i4ZYnEU_HI8Y97GCP7mKyI5MwKGLWPlX5116UBtjAWjdnvn88gk4b6Uz2sfEqUfy_pwN.CJdgOxcP6m_gIruYw3sQCJ_94I; path=/; expires=Tue, 26-Aug-25 11:08:32 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=A8YDSmfsHHRA.DmNda37oTcp0L72qDabnKq_IUnOxrU-1756204712159-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9752b3294890e220-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 12:38:29,616 [DEBUG] openai._base_client: request_id: req_e8a8dc0bd6c54c4c9ad3ad15ade4d1d9
2025-08-26 12:38:29,625 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 12:38:29,625 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 12:38:29,625 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 12:38:29,625 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 12:38:29,627 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 12:38:29,627 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 12:38:29,627 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 12:38:29,627 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 13:44:28,952 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-26 13:44:28,953 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-26 13:44:28,953 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 13:44:28,953 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-26 13:44:28,954 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 13:44:28,960 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-2728cbf0-0993-452b-b8c3-42e84061beca', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 13:44:28,963 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 13:44:28,964 [DEBUG] httpcore.connection: close.started
2025-08-26 13:44:28,965 [DEBUG] httpcore.connection: close.complete
2025-08-26 13:44:28,965 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 13:44:28,999 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x111c1a0d0>
2025-08-26 13:44:29,000 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x110eb4680> server_hostname='api.openai.com' timeout=None
2025-08-26 13:44:29,021 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x111bc5a70>
2025-08-26 13:44:29,021 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 13:44:29,021 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 13:44:29,021 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 13:44:29,022 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 13:44:29,022 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 13:44:29,880 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 11:44:32 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'343'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'426'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_6172acc97d7c4e859dc316487966ab4c'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=wS4P_sb5xdnUU3wiZqOceYeh_MDJV64QqZEx29mNsZE-1756208672-1.0.1.1-4H4kH6VEIKJxWcb9Vim8grzKS39xecwyIqFUGBvSQWYhuRkHNCRQrxomroZOI4QlS8Ha3JvGpZzNC7lBRiFIAKZ4x9rr8axRLYP0HjMMCwY; path=/; expires=Tue, 26-Aug-25 12:14:32 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'975313e78dfcdc31-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 13:44:29,881 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 13:44:29,882 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 13:44:29,882 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 13:44:29,882 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 13:44:29,882 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 13:44:29,882 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 11:44:32 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '343', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '426', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9998878', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '6ms', 'x-request-id': 'req_6172acc97d7c4e859dc316487966ab4c', 'cf-cache-status': 'DYNAMIC', 'set-cookie': '__cf_bm=wS4P_sb5xdnUU3wiZqOceYeh_MDJV64QqZEx29mNsZE-1756208672-1.0.1.1-4H4kH6VEIKJxWcb9Vim8grzKS39xecwyIqFUGBvSQWYhuRkHNCRQrxomroZOI4QlS8Ha3JvGpZzNC7lBRiFIAKZ4x9rr8axRLYP0HjMMCwY; path=/; expires=Tue, 26-Aug-25 12:14:32 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '975313e78dfcdc31-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 13:44:29,883 [DEBUG] openai._base_client: request_id: req_6172acc97d7c4e859dc316487966ab4c
2025-08-26 13:44:29,885 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 13:44:29,885 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 13:44:29,885 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 13:44:29,885 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 13:44:29,887 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 13:44:29,887 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 13:44:29,887 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 13:44:29,887 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 13:57:19,424 [INFO] app.api.routes: Initializing core services...
2025-08-26 13:57:19,424 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 13:57:19,424 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 13:57:19,424 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 13:57:19,424 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 13:57:19,426 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 13:57:19,426 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 13:57:19,426 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 13:57:19,802 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 13:57:19,802 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 13:57:19,802 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 13:57:19,807 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 13:57:19,807 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 13:57:20,018 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 13:57:20,018 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 13:57:20,018 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 13:57:20,019 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 13:57:20,019 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 13:57:20,019 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 13:57:20,094 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 13:57:20,094 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 13:57:20,094 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 13:57:20,096 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 13:57:20,096 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 13:57:20,096 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 13:57:20,096 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 13:57:20,097 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 13:57:20,098 [INFO] main: Creating FastAPI app
2025-08-26 13:57:20,099 [INFO] main: CORS middleware added
2025-08-26 13:57:20,100 [INFO] main: API router included
2025-08-26 14:04:38,367 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:04:38,368 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:04:38,368 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:04:38,368 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:04:38,368 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:04:38,370 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:04:38,370 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:04:38,370 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:04:38,766 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:04:38,766 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:04:38,766 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:04:38,770 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:04:38,770 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:04:38,973 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:04:38,973 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:04:38,973 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:04:38,974 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:04:38,974 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:04:38,974 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:04:39,051 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:04:39,051 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:04:39,052 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:04:39,053 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:04:39,054 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:04:39,054 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:04:39,054 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:04:39,054 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:04:39,056 [INFO] main: Creating FastAPI app
2025-08-26 14:04:39,057 [INFO] main: CORS middleware added
2025-08-26 14:04:39,058 [INFO] main: API router included
2025-08-26 14:04:43,155 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-26 14:04:43,155 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-26 14:04:43,155 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 14:04:43,155 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-26 14:04:43,155 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 14:04:43,158 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-a1a5e32a-75a5-441f-aa03-13a27bb4c1e2', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 14:04:43,186 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 14:04:43,187 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 14:04:43,223 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1208dd6a0>
2025-08-26 14:04:43,223 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11fd78680> server_hostname='api.openai.com' timeout=None
2025-08-26 14:04:43,243 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1208ac2d0>
2025-08-26 14:04:43,243 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 14:04:43,243 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 14:04:43,243 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 14:04:43,244 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 14:04:43,244 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 14:04:43,879 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 12:04:46 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'284'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'353'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_b691b6359e58422c8376dec86a272c82'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=GxJMOcMLuF2.5VCXrTpz0yokC6QM64u6CLN63MdAdp0-1756209886-1.0.1.1-4AX3wgbnLR8yKkrtzAWlzoW2jufiOJJziGJ14JM6wLK.5tZZdIV3p8Dnii.8lKcbbTdjpB_719mKCR7j2gM3ASVxBD6G5GayuJqw_7emWJk; path=/; expires=Tue, 26-Aug-25 12:34:46 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=Hy1Ub_4NTNFGkNShoABb0wCaIMuUcGgF7rNDfdub6sM-1756209886872-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9753318d1b3ae1ac-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 14:04:43,880 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 14:04:43,881 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 14:04:43,883 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 14:04:43,883 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 14:04:43,883 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 14:04:43,883 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 12:04:46 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '284'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '353'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_b691b6359e58422c8376dec86a272c82'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=GxJMOcMLuF2.5VCXrTpz0yokC6QM64u6CLN63MdAdp0-1756209886-1.0.1.1-4AX3wgbnLR8yKkrtzAWlzoW2jufiOJJziGJ14JM6wLK.5tZZdIV3p8Dnii.8lKcbbTdjpB_719mKCR7j2gM3ASVxBD6G5GayuJqw_7emWJk; path=/; expires=Tue, 26-Aug-25 12:34:46 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=Hy1Ub_4NTNFGkNShoABb0wCaIMuUcGgF7rNDfdub6sM-1756209886872-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9753318d1b3ae1ac-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 14:04:43,884 [DEBUG] openai._base_client: request_id: req_b691b6359e58422c8376dec86a272c82
2025-08-26 14:04:43,893 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 14:04:43,893 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 14:04:43,893 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 14:04:43,893 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 14:04:43,895 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 14:04:43,895 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 14:04:43,895 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 14:04:43,895 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 14:11:05,426 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:11:05,426 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:11:05,427 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:11:05,427 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:11:05,427 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:11:05,428 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:11:05,429 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:11:05,429 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:11:05,789 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:11:05,789 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:11:05,789 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:11:05,793 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:11:05,793 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:11:06,016 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:11:06,017 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:11:06,017 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:11:06,018 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:11:06,018 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:11:06,018 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:11:06,094 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:11:06,094 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:11:06,094 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:11:06,096 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:11:06,096 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:11:06,096 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:11:06,096 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:11:06,096 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:11:06,098 [INFO] main: Creating FastAPI app
2025-08-26 14:11:06,098 [INFO] main: CORS middleware added
2025-08-26 14:11:06,099 [INFO] main: API router included
2025-08-26 14:23:00,329 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:23:00,330 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:23:00,330 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:23:00,330 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:23:00,330 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:23:00,334 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:23:00,335 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:23:00,335 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:23:00,715 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:23:00,715 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:23:00,715 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:23:00,719 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:23:00,719 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:23:00,926 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:23:00,926 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:23:00,926 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:23:00,927 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:23:00,927 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:23:00,927 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:23:01,004 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:23:01,004 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:23:01,005 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:23:01,006 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:23:01,006 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:23:01,007 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:23:01,007 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:23:01,007 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:23:01,008 [INFO] main: Creating FastAPI app
2025-08-26 14:23:01,009 [INFO] main: CORS middleware added
2025-08-26 14:23:01,010 [INFO] main: API router included
2025-08-26 14:23:27,978 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:23:27,979 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:23:27,979 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:23:27,979 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:23:27,979 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:23:27,980 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:23:27,980 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:23:27,981 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:23:28,350 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:23:28,351 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:23:28,351 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:23:28,354 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:23:28,355 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:23:28,550 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:23:28,550 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:23:28,550 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:23:28,551 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:23:28,551 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:23:28,551 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:23:28,624 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:23:28,624 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:23:28,625 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:23:28,626 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:23:28,627 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:23:28,627 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:23:28,627 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:23:28,627 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:23:28,629 [INFO] main: Creating FastAPI app
2025-08-26 14:23:28,629 [INFO] main: CORS middleware added
2025-08-26 14:23:28,630 [INFO] main: API router included
2025-08-26 14:25:24,387 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:25:24,387 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:25:24,387 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:25:24,387 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:25:24,388 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:25:24,389 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:25:24,389 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:25:24,389 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:25:25,092 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:25:25,092 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:25:25,094 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:25:25,099 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:25:25,100 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:25:25,442 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:25:25,442 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:25:25,442 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:25:25,444 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:25:25,444 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:25:25,444 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:25:25,540 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:25:25,540 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:25:25,541 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:25:25,543 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:25:25,544 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:25:25,544 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:25:25,544 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:25:25,544 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:25:25,546 [INFO] main: Creating FastAPI app
2025-08-26 14:25:25,547 [INFO] main: CORS middleware added
2025-08-26 14:25:25,549 [INFO] main: API router included
2025-08-26 14:28:08,990 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:28:08,991 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:28:08,991 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:28:08,991 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:28:08,991 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:28:08,993 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:28:08,993 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:28:08,993 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:28:09,381 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:28:09,381 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:28:09,382 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:28:09,385 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:28:09,385 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:28:09,587 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:28:09,588 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:28:09,588 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:28:09,589 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:28:09,589 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:28:09,589 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:28:09,661 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:28:09,661 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:28:09,661 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:28:09,663 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:28:09,663 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:28:09,663 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:28:09,663 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:28:09,663 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:28:09,665 [INFO] main: Creating FastAPI app
2025-08-26 14:28:09,665 [INFO] main: CORS middleware added
2025-08-26 14:28:09,667 [INFO] main: API router included
2025-08-26 14:28:29,417 [INFO] app.api.routes: Initializing core services...
2025-08-26 14:28:29,418 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 14:28:29,418 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 14:28:29,418 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:28:29,418 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:28:29,419 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:28:29,419 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:28:29,419 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:28:29,771 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:28:29,772 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:28:29,772 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:28:29,775 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:28:29,775 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:28:29,964 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 14:28:29,964 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 14:28:29,964 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 14:28:29,965 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 14:28:29,965 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 14:28:29,965 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 14:28:30,035 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 14:28:30,035 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 14:28:30,035 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 14:28:30,037 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:28:30,037 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:28:30,037 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 14:28:30,037 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 14:28:30,037 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 14:28:30,039 [INFO] main: Creating FastAPI app
2025-08-26 14:28:30,039 [INFO] main: CORS middleware added
2025-08-26 14:28:30,041 [INFO] main: API router included
2025-08-26 14:28:30,343 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars
2025-08-26 14:28:30,343 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: None
2025-08-26 14:28:30,344 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 14:28:30,344 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=['conversation_limit', 'message_length', 'message_pertinence']
2025-08-26 14:28:30,344 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 14:28:30,347 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-95c714cf-4998-4573-a8e5-0b08cf4aa313', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 14:28:30,376 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 14:28:30,376 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 14:28:30,417 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x117a5d6a0>
2025-08-26 14:28:30,417 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x116d947a0> server_hostname='api.openai.com' timeout=None
2025-08-26 14:28:30,441 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x117a1c2d0>
2025-08-26 14:28:30,441 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 14:28:30,442 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 14:28:30,442 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 14:28:30,442 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 14:28:30,442 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 14:28:31,962 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 12:28:35 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'1092'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1166'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_e33d2d49db0c498bb2facde94a6ac5fe'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=_p2wZA07iFXPLY4e0sPnf3CDKc2A3Nmx_OxRzpCCixE-1756211315-1.0.1.1-cnC_nHt86HDDHVCWLQWPOK7qM48wJeorag0W466nWklvZEYs591dzfcELuPMdfazAAKFqo8KsVYiufFWcT8ziOxYkqsOi4_cREdjsDqqJR4; path=/; expires=Tue, 26-Aug-25 12:58:35 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=8wq4HfMrGTCechMwIL9GDltahht2HyD6ryIy_yBrgG8-1756211315075-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97535465ddbde1f8-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 14:28:31,963 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 14:28:31,963 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 14:28:31,966 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 14:28:31,966 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 14:28:31,966 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 14:28:31,966 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 12:28:35 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '1092'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '1166'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_e33d2d49db0c498bb2facde94a6ac5fe'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=_p2wZA07iFXPLY4e0sPnf3CDKc2A3Nmx_OxRzpCCixE-1756211315-1.0.1.1-cnC_nHt86HDDHVCWLQWPOK7qM48wJeorag0W466nWklvZEYs591dzfcELuPMdfazAAKFqo8KsVYiufFWcT8ziOxYkqsOi4_cREdjsDqqJR4; path=/; expires=Tue, 26-Aug-25 12:58:35 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=8wq4HfMrGTCechMwIL9GDltahht2HyD6ryIy_yBrgG8-1756211315075-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '97535465ddbde1f8-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 14:28:31,966 [DEBUG] openai._base_client: request_id: req_e33d2d49db0c498bb2facde94a6ac5fe
2025-08-26 14:28:31,975 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 14:28:31,976 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 14:28:31,976 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 14:28:31,976 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 14:28:31,977 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 14:28:31,977 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 14:28:31,977 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 14:28:31,978 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 15:41:06,040 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars
2025-08-26 15:41:06,041 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: None
2025-08-26 15:41:06,041 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 15:41:06,041 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=['conversation_limit', 'message_length', 'message_pertinence']
2025-08-26 15:41:06,041 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 15:41:06,044 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-173a7cca-817a-4e96-8b30-b5946175e398', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 15:41:06,045 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 15:41:06,046 [DEBUG] httpcore.connection: close.started
2025-08-26 15:41:06,046 [DEBUG] httpcore.connection: close.complete
2025-08-26 15:41:06,046 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 15:41:06,072 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x117a69e50>
2025-08-26 15:41:06,072 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x116d947a0> server_hostname='api.openai.com' timeout=None
2025-08-26 15:41:06,095 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x117a45ba0>
2025-08-26 15:41:06,095 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 15:41:06,095 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 15:41:06,095 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 15:41:06,095 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 15:41:06,096 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 15:41:06,945 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 13:41:10 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'366'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'459'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_999fe73228a341a0a5dd8722193a9841'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=qzvheEEEct9nu4DME2GkLGG2Ola0TU0OnifH0bwskAE-1756215670-1.0.1.1-9p1MHqbxqtdLubC9pbG2ehuUO2MNFA6hyWej5rcrzh_K5fGitvgQ8Ueq3cbR7kzxE9iOUwpLouhlNXTmk8sBacUxNrQT6iJTQHqIhv6HLws; path=/; expires=Tue, 26-Aug-25 14:11:10 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9753bebefcc473bb-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 15:41:06,946 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 15:41:06,946 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 15:41:06,949 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 15:41:06,949 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 15:41:06,949 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 15:41:06,949 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 13:41:10 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '366', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '459', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9998878', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '6ms', 'x-request-id': 'req_999fe73228a341a0a5dd8722193a9841', 'cf-cache-status': 'DYNAMIC', 'set-cookie': '__cf_bm=qzvheEEEct9nu4DME2GkLGG2Ola0TU0OnifH0bwskAE-1756215670-1.0.1.1-9p1MHqbxqtdLubC9pbG2ehuUO2MNFA6hyWej5rcrzh_K5fGitvgQ8Ueq3cbR7kzxE9iOUwpLouhlNXTmk8sBacUxNrQT6iJTQHqIhv6HLws; path=/; expires=Tue, 26-Aug-25 14:11:10 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9753bebefcc473bb-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 15:41:06,949 [DEBUG] openai._base_client: request_id: req_999fe73228a341a0a5dd8722193a9841
2025-08-26 15:41:06,951 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 15:41:06,951 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 15:41:06,951 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 15:41:06,951 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 15:41:06,953 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 15:41:06,953 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 15:41:06,953 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 15:41:06,953 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 15:49:27,703 [INFO] app.api.routes: Initializing core services...
2025-08-26 15:49:27,703 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 15:49:27,703 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 15:49:27,703 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:49:27,704 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:49:27,705 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:49:27,705 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:49:27,705 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:49:28,087 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:49:28,087 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:49:28,087 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:49:28,091 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:49:28,091 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:49:28,296 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 15:49:28,296 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:49:28,296 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:49:28,297 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:49:28,297 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:49:28,297 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:49:28,371 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:49:28,371 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:49:28,372 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:49:28,373 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:49:28,374 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:49:28,374 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:49:28,374 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:49:28,374 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 15:49:28,376 [INFO] main: Creating FastAPI app
2025-08-26 15:49:28,376 [INFO] main: CORS middleware added
2025-08-26 15:49:28,377 [INFO] main: API router included
2025-08-26 15:50:44,248 [INFO] app.api.routes: Initializing core services...
2025-08-26 15:50:44,248 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 15:50:44,248 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 15:50:44,248 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:50:44,249 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:50:44,250 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:50:44,250 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:50:44,250 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:50:44,646 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:50:44,646 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:50:44,646 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:50:44,650 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:50:44,650 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:50:44,863 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 15:50:44,863 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:50:44,864 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:50:44,864 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:50:44,864 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:50:44,865 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:50:44,944 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:50:44,944 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:50:44,944 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:50:44,946 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:50:44,946 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:50:44,946 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:50:44,946 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:50:44,946 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 15:50:44,948 [INFO] main: Creating FastAPI app
2025-08-26 15:50:44,948 [INFO] main: CORS middleware added
2025-08-26 15:50:44,950 [INFO] main: API router included
2025-08-26 15:52:18,286 [INFO] app.api.routes: Initializing core services...
2025-08-26 15:52:18,287 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 15:52:18,287 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 15:52:18,287 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:52:18,287 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:52:18,289 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:52:18,289 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:52:18,289 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:52:18,719 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:52:18,721 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:52:18,722 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:52:18,726 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:52:18,726 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:52:18,960 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 15:52:18,960 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:52:18,960 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:52:18,961 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:52:18,961 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:52:18,961 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:52:19,044 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:52:19,044 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:52:19,044 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:52:19,046 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:52:19,046 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:52:19,046 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:52:19,046 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:52:19,047 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 15:52:19,048 [INFO] main: Creating FastAPI app
2025-08-26 15:52:19,049 [INFO] main: CORS middleware added
2025-08-26 15:52:19,050 [INFO] main: API router included
2025-08-26 15:54:48,221 [INFO] app.api.routes: Initializing core services...
2025-08-26 15:54:48,221 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 15:54:48,221 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 15:54:48,221 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:54:48,221 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:54:48,223 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:54:48,223 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:54:48,223 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:54:48,602 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:54:48,602 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:54:48,602 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:54:48,606 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:54:48,606 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:54:48,825 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 15:54:48,826 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:54:48,826 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:54:48,826 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:54:48,827 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:54:48,827 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:54:48,900 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:54:48,900 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:54:48,900 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:54:48,902 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:54:48,902 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:54:48,902 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:54:48,902 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:54:48,902 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 15:54:48,904 [INFO] main: Creating FastAPI app
2025-08-26 15:54:48,904 [INFO] main: CORS middleware added
2025-08-26 15:54:48,905 [INFO] main: API router included
2025-08-26 15:58:34,150 [INFO] app.api.routes: Initializing core services...
2025-08-26 15:58:34,150 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 15:58:34,150 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 15:58:34,150 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:58:34,150 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:58:34,152 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:58:34,152 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:58:34,152 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:58:34,519 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:58:34,519 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:58:34,519 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:58:34,523 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:58:34,523 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:58:34,743 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 15:58:34,743 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 15:58:34,743 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 15:58:34,744 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 15:58:34,744 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 15:58:34,744 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 15:58:34,818 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 15:58:34,818 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 15:58:34,818 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 15:58:34,820 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:58:34,820 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:58:34,820 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 15:58:34,820 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 15:58:34,821 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 15:58:34,822 [INFO] main: Creating FastAPI app
2025-08-26 15:58:34,823 [INFO] main: CORS middleware added
2025-08-26 15:58:34,824 [INFO] main: API router included
2025-08-26 16:06:32,742 [INFO] app.api.routes: Initializing core services...
2025-08-26 16:06:32,743 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 16:06:32,743 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 16:06:32,743 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:06:32,743 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:06:32,744 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:06:32,744 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:06:32,744 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:06:33,119 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:06:33,119 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:06:33,120 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:06:33,123 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:06:33,123 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:06:33,418 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 16:06:33,418 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:06:33,418 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:06:33,420 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:06:33,420 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:06:33,421 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:06:33,515 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:06:33,515 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:06:33,516 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:06:33,518 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:06:33,518 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:06:33,518 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:06:33,518 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:06:33,518 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 16:06:33,521 [INFO] main: Creating FastAPI app
2025-08-26 16:06:33,521 [INFO] main: CORS middleware added
2025-08-26 16:06:33,522 [INFO] main: API router included
2025-08-26 16:06:40,447 [INFO] app.api.routes: Initializing core services...
2025-08-26 16:06:40,447 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 16:06:40,447 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 16:06:40,447 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:06:40,448 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:06:40,448 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:06:40,449 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:06:40,449 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:06:40,795 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:06:40,795 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:06:40,795 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:06:40,798 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:06:40,799 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:06:40,974 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 16:06:40,974 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:06:40,974 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:06:40,975 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:06:40,975 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:06:40,975 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:06:41,061 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:06:41,062 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:06:41,062 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:06:41,064 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:06:41,064 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:06:41,064 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:06:41,064 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:06:41,064 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 16:06:41,067 [INFO] main: Creating FastAPI app
2025-08-26 16:06:41,067 [INFO] main: CORS middleware added
2025-08-26 16:06:41,069 [INFO] main: API router included
2025-08-26 16:13:32,640 [INFO] app.api.routes: Initializing core services...
2025-08-26 16:13:32,640 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 16:13:32,641 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 16:13:32,641 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:13:32,641 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:13:32,642 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:13:32,642 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:13:32,642 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:13:33,021 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:13:33,022 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:13:33,022 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:13:33,025 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:13:33,025 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:13:33,255 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 16:13:33,255 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:13:33,255 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:13:33,256 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:13:33,257 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:13:33,257 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:13:33,334 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:13:33,334 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:13:33,334 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:13:33,336 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:13:33,336 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:13:33,336 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:13:33,336 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:13:33,336 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 16:13:33,338 [INFO] main: Creating FastAPI app
2025-08-26 16:13:33,339 [INFO] main: CORS middleware added
2025-08-26 16:13:33,340 [INFO] main: API router included
2025-08-26 16:34:36,611 [INFO] app.api.routes: Initializing core services...
2025-08-26 16:34:36,611 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 16:34:36,611 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 16:34:36,611 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:34:36,611 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:34:36,612 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:34:36,612 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:34:36,612 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:34:36,978 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:34:36,978 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:34:36,978 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:34:36,981 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:34:36,982 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:34:37,199 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 16:34:37,200 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:34:37,200 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:34:37,201 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:34:37,201 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:34:37,201 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:34:37,275 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:34:37,276 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:34:37,276 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:34:37,278 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:34:37,278 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:34:37,278 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:34:37,278 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:34:37,278 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 16:34:37,280 [INFO] main: Creating FastAPI app
2025-08-26 16:34:37,280 [INFO] main: CORS middleware added
2025-08-26 16:34:37,281 [INFO] main: API router included
2025-08-26 16:34:48,027 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars
2025-08-26 16:34:48,027 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: None
2025-08-26 16:34:48,027 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 16:34:48,027 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=['conversation_limit', 'message_length', 'message_pertinence']
2025-08-26 16:34:48,027 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 16:34:48,030 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-2041778e-0e83-4049-9a8d-9b9ffd8cc03d', 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 16:34:48,057 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 16:34:48,058 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 16:34:48,086 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x12025d550>
2025-08-26 16:34:48,086 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11f594710> server_hostname='api.openai.com' timeout=None
2025-08-26 16:34:48,106 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1202342d0>
2025-08-26 16:34:48,106 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 16:34:48,107 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 16:34:48,107 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 16:34:48,107 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 16:34:48,107 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 16:34:48,755 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 14:34:52 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'300'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'388'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_63391541c62d4a0084d9b788cf024f46'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=bilsZ5b.8VzSp1Py8trS23k.p6Alz5d8wrnOeHvHVoI-1756218892-1.0.1.1-l6QYWu7KNlVDyg_A0wgi3DXr3t_wy0Nu1GMUlhxrXn3JYE9omaOgh0KTIVTWjbblmCmVDYw90rBTCsqzawTrc6fR30U0yftQjRhQSebMDR8; path=/; expires=Tue, 26-Aug-25 15:04:52 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=rot0JW9yeJ3F0JARCjvca6lQKtb17sUmPjz0j.PDi5s-1756218892512-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97540d6a3d4ce1f1-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 16:34:48,756 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 16:34:48,757 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 16:34:48,757 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 16:34:48,757 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 16:34:48,757 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 16:34:48,757 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 14:34:52 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '300'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '388'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_63391541c62d4a0084d9b788cf024f46'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=bilsZ5b.8VzSp1Py8trS23k.p6Alz5d8wrnOeHvHVoI-1756218892-1.0.1.1-l6QYWu7KNlVDyg_A0wgi3DXr3t_wy0Nu1GMUlhxrXn3JYE9omaOgh0KTIVTWjbblmCmVDYw90rBTCsqzawTrc6fR30U0yftQjRhQSebMDR8; path=/; expires=Tue, 26-Aug-25 15:04:52 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=rot0JW9yeJ3F0JARCjvca6lQKtb17sUmPjz0j.PDi5s-1756218892512-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '97540d6a3d4ce1f1-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 16:34:48,758 [DEBUG] openai._base_client: request_id: req_63391541c62d4a0084d9b788cf024f46
2025-08-26 16:34:48,768 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 16:34:48,768 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 16:34:48,768 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 16:34:48,768 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-26 16:34:48,769 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-26 16:34:48,770 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-26 16:34:48,770 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-26 16:34:48,770 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-26 16:40:43,136 [INFO] app.api.routes: Initializing core services...
2025-08-26 16:40:43,136 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 16:40:43,136 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 16:40:43,136 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:40:43,136 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:40:43,138 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:40:43,138 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:40:43,138 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:40:43,514 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:40:43,514 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:40:43,514 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:40:43,519 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:40:43,519 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:40:43,738 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 16:40:43,738 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 16:40:43,738 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 16:40:43,739 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 16:40:43,739 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 16:40:43,739 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 16:40:43,813 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 16:40:43,813 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 16:40:43,814 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 16:40:43,815 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:40:43,815 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:40:43,816 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 16:40:43,816 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 16:40:43,816 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 16:40:43,817 [INFO] main: Creating FastAPI app
2025-08-26 16:40:43,818 [INFO] main: CORS middleware added
2025-08-26 16:40:43,819 [INFO] main: API router included
2025-08-26 17:09:09,016 [INFO] app.api.routes: Initializing core services...
2025-08-26 17:09:09,016 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 17:09:09,016 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 17:09:09,017 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:09:09,017 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:09:09,018 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:09:09,019 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:09:09,019 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:09:09,387 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:09:09,387 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:09:09,387 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:09:09,391 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:09:09,391 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:09:09,626 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 17:09:09,627 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:09:09,627 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:09:09,628 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:09:09,628 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:09:09,628 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:09:09,707 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:09:09,707 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:09:09,707 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:09:09,710 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:09:09,710 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:09:09,711 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:09:09,711 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:09:09,711 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 17:09:09,713 [INFO] main: Creating FastAPI app
2025-08-26 17:09:09,714 [INFO] main: CORS middleware added
2025-08-26 17:09:09,715 [INFO] main: API router included
2025-08-26 17:10:39,439 [INFO] app.api.routes: Initializing core services...
2025-08-26 17:10:39,439 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 17:10:39,439 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 17:10:39,439 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:10:39,439 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:10:39,440 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:10:39,441 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:10:39,441 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:10:39,850 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:10:39,851 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:10:39,851 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:10:39,858 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:10:39,859 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:10:40,117 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 17:10:40,117 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:10:40,118 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:10:40,118 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:10:40,119 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:10:40,119 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:10:40,207 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:10:40,207 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:10:40,207 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:10:40,209 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:10:40,210 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:10:40,210 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:10:40,210 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:10:40,211 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 17:10:40,214 [INFO] main: Creating FastAPI app
2025-08-26 17:10:40,214 [INFO] main: CORS middleware added
2025-08-26 17:10:40,216 [INFO] main: API router included
2025-08-26 17:11:00,490 [INFO] app.api.routes: Initializing core services...
2025-08-26 17:11:00,490 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 17:11:00,490 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 17:11:00,490 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:11:00,490 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:11:00,491 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:11:00,491 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:11:00,491 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:11:00,778 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:11:00,778 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:11:00,779 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:11:00,782 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:11:00,782 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:11:01,018 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 17:11:01,018 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:11:01,018 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:11:01,019 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:11:01,019 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:11:01,019 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:11:01,096 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:11:01,096 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:11:01,096 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:11:01,098 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:11:01,098 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:11:01,098 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:11:01,098 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:11:01,098 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 17:11:01,100 [INFO] main: Creating FastAPI app
2025-08-26 17:11:01,100 [INFO] main: CORS middleware added
2025-08-26 17:11:01,102 [INFO] main: API router included
2025-08-26 17:32:40,035 [INFO] app.api.routes: Initializing core services...
2025-08-26 17:32:40,035 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 17:32:40,035 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 17:32:40,035 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:32:40,035 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:32:40,036 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:32:40,037 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:32:40,037 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:32:40,419 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:32:40,419 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:32:40,420 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:32:40,423 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:32:40,423 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:32:40,626 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 17:32:40,626 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 17:32:40,626 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 17:32:40,627 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 17:32:40,627 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 17:32:40,627 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 17:32:40,699 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 17:32:40,699 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 17:32:40,699 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 17:32:40,701 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:32:40,701 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:32:40,701 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 17:32:40,702 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 17:32:40,702 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 17:32:40,703 [INFO] main: Creating FastAPI app
2025-08-26 17:32:40,704 [INFO] main: CORS middleware added
2025-08-26 17:32:40,705 [INFO] main: API router included
2025-08-26 18:11:17,316 [INFO] app.api.routes: Initializing core services...
2025-08-26 18:11:17,316 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 18:11:17,317 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 18:11:17,317 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 18:11:17,317 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 18:11:17,318 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 18:11:17,318 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 18:11:17,318 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 18:11:17,417 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 18:11:17,417 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 18:11:17,417 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 18:11:17,427 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:11:17,427 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:11:17,644 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 18:11:17,644 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 18:11:17,644 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 18:11:17,645 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 18:11:17,645 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 18:11:17,645 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 18:11:17,718 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 18:11:17,718 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 18:11:17,718 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 18:11:17,720 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:11:17,720 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:11:17,720 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:11:17,720 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:11:17,720 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 18:11:17,722 [INFO] main: Creating FastAPI app
2025-08-26 18:11:17,722 [INFO] main: CORS middleware added
2025-08-26 18:11:17,723 [INFO] main: API router included
2025-08-26 18:11:21,209 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars
2025-08-26 18:11:21,209 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: None
2025-08-26 18:11:21,209 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 18:11:21,209 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=['conversation_limit', 'message_length', 'message_pertinence']
2025-08-26 18:11:21,209 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 18:11:21,215 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:21,243 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:21,243 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 18:11:21,279 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x110bf6120>
2025-08-26 18:11:21,280 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x110407c80> server_hostname='api.openai.com' timeout=None
2025-08-26 18:11:21,300 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x110c48190>
2025-08-26 18:11:21,300 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:21,301 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:21,301 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:21,301 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:21,301 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:21,787 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:26 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'294'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'312'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_355f4b23e9d044d1b7e8ec516e7ea63c'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=GQ6BXHr_zmoB5XDgrq2HGO.XkuECDdtwVqQGSK0xjz0-1756224686-1.0.1.1-6aN.NJBmEBrg3ws2X0HbAd70stSJSs2rC_Xi1IHOoXaCVJsyh.8AnsyXqO0RRBnYQvRrQZRbfZGF3p4cefBWrTmBc.sRtUuPdiZCnBGds3U; path=/; expires=Tue, 26-Aug-25 16:41:26 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=EU5AXIGpIH8EsTFfsQCm9pYN2VqxBkHv.Lo0lFhyGwE-1756224686035-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549adcc8f5704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:21,788 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:21,788 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:21,793 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:21,793 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:21,793 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:21,793 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 16:11:26 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '294'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '312'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_355f4b23e9d044d1b7e8ec516e7ea63c'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=GQ6BXHr_zmoB5XDgrq2HGO.XkuECDdtwVqQGSK0xjz0-1756224686-1.0.1.1-6aN.NJBmEBrg3ws2X0HbAd70stSJSs2rC_Xi1IHOoXaCVJsyh.8AnsyXqO0RRBnYQvRrQZRbfZGF3p4cefBWrTmBc.sRtUuPdiZCnBGds3U; path=/; expires=Tue, 26-Aug-25 16:41:26 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=EU5AXIGpIH8EsTFfsQCm9pYN2VqxBkHv.Lo0lFhyGwE-1756224686035-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '97549adcc8f5704e-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 18:11:21,794 [DEBUG] openai._base_client: request_id: req_355f4b23e9d044d1b7e8ec516e7ea63c
2025-08-26 18:11:21,802 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 18:11:21,803 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 18:11:21,803 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 18:11:21,803 [DEBUG] app.features.sanity_checks.message_pertinence_check: medical_pertinence_result: {'result': 1, 'cost': 0.00016739999999999998, 'token_usage': 1113}
2025-08-26 18:11:21,803 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-26 18:11:21,806 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:21,807 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:21,808 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:21,808 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:21,808 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:21,808 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:21,808 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:22,428 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:26 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'369'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'449'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_6fa56871e34541fca80dce6dbd9aac79'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549adffb02704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:22,429 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:22,429 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:22,434 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:22,435 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:22,435 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:22,435 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:26 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '369', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '449', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_6fa56871e34541fca80dce6dbd9aac79', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549adffb02704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:22,435 [DEBUG] openai._base_client: request_id: req_6fa56871e34541fca80dce6dbd9aac79
2025-08-26 18:11:22,436 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_chatbot_pertinence' successful: {'prompt_tokens': 810, 'completion_tokens': 1, 'total_tokens': 811}, cost=0.00012209999999999999
2025-08-26 18:11:22,436 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-26 18:11:22,436 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-26 18:11:22,436 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: Sanity check results: {'conversation_limit': {'passed': True}, 'message_length': {'passed': True}, 'message_pertinence': {'passed': True, 'cost': 0.00028949999999999994, 'token_usage': 1924}, 'passed': True, 'total_cost': 0.00028949999999999994, 'total_token_usage': 1924}
2025-08-26 18:11:22,436 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history=''
2025-08-26 18:11:22,437 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-26 18:11:22,437 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-26 18:11:22,437 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-26 18:11:22,437 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-26 18:11:22,600 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:11:22,601 [DEBUG] app.services.data_processing_service: Institution list: Hôpitaux civils, Hôpital privé Armand-Brillard, Hôpital privé de Marne-la-Vallée, CHU - Hôpital Rangueil, Clinique Saint-Hilaire, Clinique Chantecler, Clinique de la Muette, Clinique du Cambrésis, Institut Curie (CLCC), Centre cardiologique du Nord, Polyclinique de Blois, Centre ambulatoire Kleber, Clinique Saint-George, CH privé Saint-Grégoire, CHU - Hôpital Saint-André, Clinique Fontvert, Institut Calot, Polyclinique Majorelle, CHU - Hôpital de la Cavale-Blanche, Clinique Kennedy, CHU - Hôpital Pellegrin, CHU de Nantes, Polyclinique Urbain-V, Clinique Sainte-Anne, Fondation Rothschild, Médipôle Garonne, CHU - Hôpital de la Mère et de l’Enfant, Hôpital Privé Nancy Lorraine, GH Saint-Vincent - Clinique Sainte-Barbe, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Hôpital privé d’Antony, Polyclinique Médipôle Saint-Roch, GHP Ambroise-Paré - Hartmann (92), Clinique du Pont-de-Chaume, Clinique des Ormeaux, Clinique Bretéché, Hôpital privé des Côtes-d’Armor, CHU-Hôpital Purpan/HFE, Clinique Delay, Institut de cancérologie Strasbourg Europe, Hôpital privé La Châtaigneraie, Polyclinique du Maine, Hôpital privé Dijon-Bourgogne, Clinique de la Sauvegarde, CH privé Saint-Martin, Polyclinique Aguilera, Hôpital Ambroise-Paré, CHU - Hôpital Central, Clinique de l’Anjou, Polyclinique Jean-Villar, Polyclinique du Parc-Drevon, Clinique Toulouse-Lautrec, Clinique Durieux, Gustave-Roussy (CLCC), Clinique d’Occitanie, Clinique Anne-Artois, Centre Hospitalier Gérard-Marchant, CHU - Hôpital Morvan, Hôpital privé Clairval, Clinique cardiologique, CHU - Hôpital Charles-Nicolle, CHU - Hôpital Robert-Debré, Groupe Hospitalier de la Rochelle, Polyclinique Saint-Jean, Clinique la Pergola, CHR de Metz-Thionville - Hôpital Bel-Air, Hôpital d'instruction des armées Sainte-Anne, Espm de L’agglomeration Lilloise, Polyclinique de Bordeaux-Tondu, Clinique Saint-Léonard, Hôpital Robert Schuman, Clinique Rhône Durance, Clinique Juge, Polyclinique Côte-Basque-Sud, CHU d'Amiens/Institut ophtalmologique de Picardie, CH national d’ophtalmologie des Quinze-Vingts, Centre Jean-Perrin (CLCC), Centre Hospitalier Les Murets, Polyclinique, Clinique Victor-Pauchet, Médipôle de Savoie, Hôpital Renée-Sabran, Clinique Maussins-Nollet, Clinique mutualiste de Bonneveine, Clinique Saint-Joseph, Institut ophtalmique, Hôpital privé Arras-Les Bonnettes, CHU Nantes - Hôpital Mère Enfant, Hôpital Foch, Hôpital privé Paul-d’Égine, Centre Hospitalier George Sand, Hôpital privé de La Miotte, Clinique Conti, CHU - Hôpitaux mère-enfants, Clinique Notre-Dame-de-l’Espérance, Clinique du Tertre-Rouge, Clinique Louis-Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Saint-Nabor, Clinique générale, Clinique de l’Espérance, CH Montfavet, CHU - Hôpital Claude-Huriez, Centre de cardiologie du Pays basque, Centre Hospitalier Drôme Vivarais, Hôpital Robert-Debré, EPSM de la Marne, Hôpital d'instruction des armées Bégin, Hôpital Nord Franche-Comté-Belfort, CHU - Hôpital civil, Clinique de Bercy, Clinique Sainte-Marie, Clinique Ambroise-Paré, CH Georges-Daumezon, Clinique Saint-Jean - Sud de France, Hôpital Avicenne, Santé Atlantique, CHU - Hôpital Saint-Eloi, Hôpital privé de Villeneuve-d’Ascq, CHP de l’Europe, Hôpital de la Croix Rousse (HCL) / CH, Polyclinique de Picardie, Clinique du Parc-Monceau, Clinique Saint-Charles, Polyclinique La Ligne bleue, Centre Oscar-Lambret (CLCC), Polyclinique Lyon-Nord, Clinique Rive-Gauche, Polyclinique Vauban, Euromed Cardio, CHU - Hôpital de Hautepierre, Clinique Rhéna, Clinique de Vitrolles (Bouches-du-Rhône), Institut Arthur-Vernes, Institut de cancérologie de l’Ouest, Clinique Belledonne, Hôpital privé Cannes-Oxford, Pôle de Santé du Villeneuvois, CHU - Hôpital Sud, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Les Fleurs, Clinique du Val-d’Or, CHU - Institut cœur-poumon, Centre Clinical, Clinique Belharra, Clinique Pasteur-Lanroze, Institut Arnault-Tzanck, Centre Hospitalier Le Mas Careiron, Clinique des Franciscaines, Hôpital privé de la Seine-Saint-Denis, Hôpital Paris Saint-Joseph, Clinique du Parc, Hôpital privé La Louvière, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Clinique de l’Orangerie, IUCT/Oncopole, Hôpital d'instruction des armées Legouest, CH Saint-Joseph-Saint-Luc, Hôpital privé Pays-de-Savoie, Institut universitaire de la face et du cou, Centre cardiologique, Hôpital privé de l’Ouest parisien, ASM, Polyclinique du Grand-Sud, Clinique ophtalmologique Thiers, Clinique Mutualiste de Bretagne Occidentale, Hôpital privé La Montagne Lambert, Clinique du Trocadéro, Hôpital Hôtel-Dieu, Hôpital de la Timone (Enfants), Institut Paoli-Calmettes (CLCC), Centre Hospitalier Henri Guerin, CHU de Martinique, EPSM Lille-Métropole, Hôpital des Massues, CH/clinique, CM Bénigne-Joly, Hôpital Bichat, Polyclinique Santa-Maria, GHI, CHU - Gabriel-Montpied, Polyclinique Saint-Côme, Clinique Saint-Amé, CHU - Hôpital d’Estaing, CHU Réunion, Clinique de Villeneuve-d’Ascq, Hôpital Louis-Mourier, Centre François-Baclesse (CLCC), Clinique Saint-Vincent, Centre de cardiologie Axium-Rambot, CMC de Parly-II, Hôpital Albert Schweitzer, CHR de Metz-Thionville - Hôpital de Mercy, Polyclinique de Poitiers, CMC Pierre-Cherest, CHU - site Nord, Polyclinique de Courlancy, Hôpitaux Sud, Clinique de la Plaine, Centre Georges-François-Leclerc (CLCC), Clinique de la Part-Dieu, Nouvel Hôpital de Navarre, Clinique du Renaison, Polyclinique de Limoges - site Émailleurs, Hôpital Necker-Enfants-Malades, Institut Curie, Hôpital Henri-Mondor, Hôpital privé de l’Estuaire, Hôpital d'instruction des armées Laveran, CHU - Hôpital Maison-Blanche, Centre de chirurgie ophtalmologique, Clinique Saint-François, Clinique ambulatoire de Domont, CH intercommunal, Hôpital Cochin, Institut mutualiste Montsouris, CMCO Côte d’Opale, Hôpital Pierre-Wertheimer, Hôpital de la Pitié-Salpêtrière, Polyclinique Saint-François, CHU - Hôpital Larrey, EPSM Etienne-Gourmelen, Hôpital privé de la Loire, Clinique urologique Nantes-Atlantis, Grand hôpital de l'Est-Francilien, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Augustin, Clinique Clémentville, Hôpital privé des Peupliers, GH, Hôpitaux pédiatriques, Clinique Saint-André, CHU - Hôpital Trousseau, Clinique de l'Alma, Centre Hospitalier Montperrin, Hôpital privé Nord Parisien, Clinique du Croisé-Laroche, Clinique de l’Atlantique, Les Franciscaines, EPSM Morbihan, Institut du cancer de Montpellier (CLCC), Hôpital de la Timone (adultes), Hôpital privé de Provence, Clinique mutualiste catalane, Clinique du Diaconat-Fonderie, Clinique Axium, CHI, CHU - Hôpital Purpan, Hôpital d'instruction des armées Robert-Picqué, Clinique mutualiste, IUCT Oncopole, Clinique du sport, Centre Hospitalier La Chartreuse, Infirmerie protestante de Lyon, Polyclinique de Navarre, CHU - Hôpital Clocheville, CHU - Hôpital Haut-Lévêque, Centre de la main, Epsan, Clinique Saint-Antoine, Clinique Bizet, Clinique Bouchard, Hôpital privé Drôme-Ardèche, Hôpital Saint-Joseph, CHU de Martinique - site Mère-Enfant, EPS Ville-Évrard, Clinique du Lac et d’Argonay, Hôpital privé du Vert-Galant, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital Belle-Isle, Clinique du Grand-Large, CH Henri-Laborit, GH Paul Guiraud, Hôpital privé Beauregard, Clinique Bon-Secours, Clinique Océane, Centre Antoine-Lacassagne (CLCC), Polyclinique de Kerio, Médipôle Hôpital Privé, Hôpitaux de Saint-Maurice, Pôle santé Léonard-de-Vinci, Clinique Sainte-Clotilde, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpitaux de Brabois, Clinique Monticelli-Vélodrome, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Hôpital privé de la Casamance, CHU - Hôpital de la Côte de nacre, Clinique mutualiste de la Porte-de-l'Orient, Clinique Ormeau Pyrénées, Clinique du Diaconat-Roosevelt, Clinique Jouvenet, CHU - Hôpital Nord, GHU Paris Psychiatrie et neurosciences, GH mutualiste, Clinique Jean le Bon, Centre Léon-Bérard (CLCC), Clinique Remusat, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Pontchaillou, Centre Hospitalier de Vauclaire, Clinique Claude-Bernard, CHU de La Réunion - Félix-Guyon, Hôpital Paul-Brousse, Hôpital Lariboisière-Fernand Widal, Polyclinique de Keraudren, CH Guillaume-Régnier, Hôpital Tenon, CHU Grenoble - Site Nord, CHU - Hôpital de l’Archet, Centre Eugène-Marquis (CLCC), Centre Hospitalier Maurice Despinoy, Clinique Victor-Hugo, Hôpital Louis-Pradel, Clinique de l'Essonne, Hôpital européen, Hôpital Lariboisière, Hôpital privé Jean-Mermoz, Clinique de l’Europe, Polyclinique Francheville, Institut Jean-Godinot (CLCC), Polyclinique du Beaujolais, Hôpital privé Paris-Essonne, Polyclinique Bordeaux-Rive droite, Hôpital des Diaconesses, Clinique Saint-Michel, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Paul, Polyclinique de la Région-Mantaise, Centre Hospitalier Le Vinatier, Hôpital privé de l’Est lyonnais, Hôpital Saint-Antoine, Clinique du Cèdre, Hôpital privé Toulon Hyères-Saint-Jean, Maison de santé Bagatelle, CHU - Centre chirurgical Emile-Gallé, Clinique Les Eaux-Claires, Clinique Honoré-Cave, Clinique Charcot, CHU d’Amiens, CMCO, EPSM de Saône-et-Loire, Clinique Saint-Pierre, CHU - Hôpital Pasteur, Hopital Joseph-Ducuing, Hôpital-clinique Claude-Bernard, Clinique de la Miséricorde, Hôpital Nord, Hôpital privé Saint-Martin, Groupe hospitalier Nord-Essonne, Centre médico-chirurgical et obstétrical, Clinique Les Fontaines, CHU - Hôpital Roger-Salengro, Hôpital Jean-Verdier, CMC Floréal, Clinique Turin, Clinique Convert, Clinique de l’Estrée, Clinique des Orchidées, Hôpital Bicêtre, Polyclinique de Reims-Bezannes, Hôpital Antoine-Béclère, Centre orthopédique médico-chirurgical, Clinique Tivoli-Ducos, Hôtel-Dieu, Clinique Beau-Soleil, Clinique du Fief-de-Grimoire, Hôpital Saint-Camille, Clinique Ormeau centre, Hôpital privé Le Bois, Clinique Pasteur, Clinique Lille-Sud, Clinique Arago, CHU - Hôpital Dupuytren, Hôpital de la Croix-Saint-Simon, Clinique mutualiste Jules-Verne, Clinique Paris Lilas, CHR, CH Basse-Terre (Guadeloupe), Hôpital privé Natecia, Polyclinique Saint-Jean l’Ermitage, Institut Bergonié (CLCC), Polyclinique de Limoges - site Chénieux, CHU Sud-Réunion, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique de l’Yvette, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Desgenettes, Hôpital de la Timone (enfants), Pôle santé Oréliance, CHU - Hôpital Bretonneau, Clinique Marcel-Sembat, Clinique Sainte-Marie (GHICL), Centre Hospitalier Sainte-Marie, Clinique du Pré, Institut hospitalier Jacques-Cartier, Hôpital Saint-Louis, Hôpital privé Sévigné, Clinique Trenel, CH privé du Montgardé, Clinique des Cèdres, Clinique mutualiste de l’Estuaire, Clinique Jean Causse, CHU - Hôpital Gui-de-Chauliac, Clinique du Millénaire, CH privé Claude-Galien, EPS Barthélemy-Durand, CHU - American Memorial Hospital, Centre médico-chirurgical du Mans, Hôpital européen Georges-Pompidou, HCL - Hôpital Femme-mère-enfant, CH Esquirol, Hôpital privé, Clinique Saint-Jean-de-Dieu, CHU - Maternité, Hôpitaux Nord (Croix-Rousse), Institut franco-britannique Kléber, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Saint-Vincent-de-Paul, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes (Marne), Hôpital Corentin-Celton, Hôpital privé Vert-Coteau, Centre Henri-Becquerel (CLCC), Hôpital d'instruction des armées Percy, Clinique Mathilde, GCS Clinique du Ter, CHU - Hôpital Arnaud-de-Villeneuve, Hôpital Trousseau, Nouvelle clinique de Tours, CH Édouard-Toulouse, Hôpital privé de Marne Chantereine, Clinique Esquirol-Saint-Hilaire, Polyclinique Saint-Roch, Clinique de l’Union, Hôpital de la Conception, Hôpital Edouard-Herriot, Centre Hospitalier des Pyrénées, Centre psychothérapique de Nancy, Clinique mutualiste La Sagesse, Clinique La Croix du Sud, Hôpital Saint-Philibert (GHICL), CH/Clinique, Centre Psychothérapique, Centre Hospitalier d'Erstein, Nouvelle clinique Bel-Air, CHU - Hôpital Lapeyronie, CH Charles-Perrens, CHU de Pointe-à-Pitre, Pôle Santé République, Hôpital Beaujon, Polyclinique de la Baie, Institut d’hématologie et d'oncologie pédiatrique
2025-08-26 18:11:22,601 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Hôpitaux civils, Hôpital privé Armand-Brillard, Hôpital privé de Marne-la-Vallée, CHU - Hôpital Rangueil, Clinique Saint-Hilaire, Clinique Chantecler, Clinique de la Muette, Clinique du Cambrésis, Institut Curie (CLCC), Centre cardiologique du Nord, Polyclinique de Blois, Centre ambulatoire Kleber, Clinique Saint-George, CH privé Saint-Grégoire, CHU - Hôpital Saint-André, Clinique Fontvert, Institut Calot, Polyclinique Majorelle, CHU - Hôpital de la Cavale-Blanche, Clinique Kennedy, CHU - Hôpital Pellegrin, CHU de Nantes, Polyclinique Urbain-V, Clinique Sainte-Anne, Fondation Rothschild, Médipôle Garonne, CHU - Hôpital de la Mère et de l’Enfant, Hôpital Privé Nancy Lorraine, GH Saint-Vincent - Clinique Sainte-Barbe, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Hôpital privé d’Antony, Polyclinique Médipôle Saint-Roch, GHP Ambroise-Paré - Hartmann (92), Clinique du Pont-de-Chaume, Clinique des Ormeaux, Clinique Bretéché, Hôpital privé des Côtes-d’Armor, CHU-Hôpital Purpan/HFE, Clinique Delay, Institut de cancérologie Strasbourg Europe, Hôpital privé La Châtaigneraie, Polyclinique du Maine, Hôpital privé Dijon-Bourgogne, Clinique de la Sauvegarde, CH privé Saint-Martin, Polyclinique Aguilera, Hôpital Ambroise-Paré, CHU - Hôpital Central, Clinique de l’Anjou, Polyclinique Jean-Villar, Polyclinique du Parc-Drevon, Clinique Toulouse-Lautrec, Clinique Durieux, Gustave-Roussy (CLCC), Clinique d’Occitanie, Clinique Anne-Artois, Centre Hospitalier Gérard-Marchant, CHU - Hôpital Morvan, Hôpital privé Clairval, Clinique cardiologique, CHU - Hôpital Charles-Nicolle, CHU - Hôpital Robert-Debré, Groupe Hospitalier de la Rochelle, Polyclinique Saint-Jean, Clinique la Pergola, CHR de Metz-Thionville - Hôpital Bel-Air, Hôpital d'instruction des armées Sainte-Anne, Espm de L’agglomeration Lilloise, Polyclinique de Bordeaux-Tondu, Clinique Saint-Léonard, Hôpital Robert Schuman, Clinique Rhône Durance, Clinique Juge, Polyclinique Côte-Basque-Sud, CHU d'Amiens/Institut ophtalmologique de Picardie, CH national d’ophtalmologie des Quinze-Vingts, Centre Jean-Perrin (CLCC), Centre Hospitalier Les Murets, Polyclinique, Clinique Victor-Pauchet, Médipôle de Savoie, Hôpital Renée-Sabran, Clinique Maussins-Nollet, Clinique mutualiste de Bonneveine, Clinique Saint-Joseph, Institut ophtalmique, Hôpital privé Arras-Les Bonnettes, CHU Nantes - Hôpital Mère Enfant, Hôpital Foch, Hôpital privé Paul-d’Égine, Centre Hospitalier George Sand, Hôpital privé de La Miotte, Clinique Conti, CHU - Hôpitaux mère-enfants, Clinique Notre-Dame-de-l’Espérance, Clinique du Tertre-Rouge, Clinique Louis-Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Saint-Nabor, Clinique générale, Clinique de l’Espérance, CH Montfavet, CHU - Hôpital Claude-Huriez, Centre de cardiologie du Pays basque, Centre Hospitalier Drôme Vivarais, Hôpital Robert-Debré, EPSM de la Marne, Hôpital d'instruction des armées Bégin, Hôpital Nord Franche-Comté-Belfort, CHU - Hôpital civil, Clinique de Bercy, Clinique Sainte-Marie, Clinique Ambroise-Paré, CH Georges-Daumezon, Clinique Saint-Jean - Sud de France, Hôpital Avicenne, Santé Atlantique, CHU - Hôpital Saint-Eloi, Hôpital privé de Villeneuve-d’Ascq, CHP de l’Europe, Hôpital de la Croix Rousse (HCL) / CH, Polyclinique de Picardie, Clinique du Parc-Monceau, Clinique Saint-Charles, Polyclinique La Ligne bleue, Centre Oscar-Lambret (CLCC), Polyclinique Lyon-Nord, Clinique Rive-Gauche, Polyclinique Vauban, Euromed Cardio, CHU - Hôpital de Hautepierre, Clinique Rhéna, Clinique de Vitrolles (Bouches-du-Rhône), Institut Arthur-Vernes, Institut de cancérologie de l’Ouest, Clinique Belledonne, Hôpital privé Cannes-Oxford, Pôle de Santé du Villeneuvois, CHU - Hôpital Sud, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Les Fleurs, Clinique du Val-d’Or, CHU - Institut cœur-poumon, Centre Clinical, Clinique Belharra, Clinique Pasteur-Lanroze, Institut Arnault-Tzanck, Centre Hospitalier Le Mas Careiron, Clinique des Franciscaines, Hôpital privé de la Seine-Saint-Denis, Hôpital Paris Saint-Joseph, Clinique du Parc, Hôpital privé La Louvière, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Clinique de l’Orangerie, IUCT/Oncopole, Hôpital d'instruction des armées Legouest, CH Saint-Joseph-Saint-Luc, Hôpital privé Pays-de-Savoie, Institut universitaire de la face et du cou, Centre cardiologique, Hôpital privé de l’Ouest parisien, ASM, Polyclinique du Grand-Sud, Clinique ophtalmologique Thiers, Clinique Mutualiste de Bretagne Occidentale, Hôpital privé La Montagne Lambert, Clinique du Trocadéro, Hôpital Hôtel-Dieu, Hôpital de la Timone (Enfants), Institut Paoli-Calmettes (CLCC), Centre Hospitalier Henri Guerin, CHU de Martinique, EPSM Lille-Métropole, Hôpital des Massues, CH/clinique, CM Bénigne-Joly, Hôpital Bichat, Polyclinique Santa-Maria, GHI, CHU - Gabriel-Montpied, Polyclinique Saint-Côme, Clinique Saint-Amé, CHU - Hôpital d’Estaing, CHU Réunion, Clinique de Villeneuve-d’Ascq, Hôpital Louis-Mourier, Centre François-Baclesse (CLCC), Clinique Saint-Vincent, Centre de cardiologie Axium-Rambot, CMC de Parly-II, Hôpital Albert Schweitzer, CHR de Metz-Thionville - Hôpital de Mercy, Polyclinique de Poitiers, CMC Pierre-Cherest, CHU - site Nord, Polyclinique de Courlancy, Hôpitaux Sud, Clinique de la Plaine, Centre Georges-François-Leclerc (CLCC), Clinique de la Part-Dieu, Nouvel Hôpital de Navarre, Clinique du Renaison, Polyclinique de Limoges - site Émailleurs, Hôpital Necker-Enfants-Malades, Institut Curie, Hôpital Henri-Mondor, Hôpital privé de l’Estuaire, Hôpital d'instruction des armées Laveran, CHU - Hôpital Maison-Blanche, Centre de chirurgie ophtalmologique, Clinique Saint-François, Clinique ambulatoire de Domont, CH intercommunal, Hôpital Cochin, Institut mutualiste Montsouris, CMCO Côte d’Opale, Hôpital Pierre-Wertheimer, Hôpital de la Pitié-Salpêtrière, Polyclinique Saint-François, CHU - Hôpital Larrey, EPSM Etienne-Gourmelen, Hôpital privé de la Loire, Clinique urologique Nantes-Atlantis, Grand hôpital de l'Est-Francilien, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Augustin, Clinique Clémentville, Hôpital privé des Peupliers, GH, Hôpitaux pédiatriques, Clinique Saint-André, CHU - Hôpital Trousseau, Clinique de l'Alma, Centre Hospitalier Montperrin, Hôpital privé Nord Parisien, Clinique du Croisé-Laroche, Clinique de l’Atlantique, Les Franciscaines, EPSM Morbihan, Institut du cancer de Montpellier (CLCC), Hôpital de la Timone (adultes), Hôpital privé de Provence, Clinique mutualiste catalane, Clinique du Diaconat-Fonderie, Clinique Axium, CHI, CHU - Hôpital Purpan, Hôpital d'instruction des armées Robert-Picqué, Clinique mutualiste, IUCT Oncopole, Clinique du sport, Centre Hospitalier La Chartreuse, Infirmerie protestante de Lyon, Polyclinique de Navarre, CHU - Hôpital Clocheville, CHU - Hôpital Haut-Lévêque, Centre de la main, Epsan, Clinique Saint-Antoine, Clinique Bizet, Clinique Bouchard, Hôpital privé Drôme-Ardèche, Hôpital Saint-Joseph, CHU de Martinique - site Mère-Enfant, EPS Ville-Évrard, Clinique du Lac et d’Argonay, Hôpital privé du Vert-Galant, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital Belle-Isle, Clinique du Grand-Large, CH Henri-Laborit, GH Paul Guiraud, Hôpital privé Beauregard, Clinique Bon-Secours, Clinique Océane, Centre Antoine-Lacassagne (CLCC), Polyclinique de Kerio, Médipôle Hôpital Privé, Hôpitaux de Saint-Maurice, Pôle santé Léonard-de-Vinci, Clinique Sainte-Clotilde, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpitaux de Brabois, Clinique Monticelli-Vélodrome, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Hôpital privé de la Casamance, CHU - Hôpital de la Côte de nacre, Clinique mutualiste de la Porte-de-l'Orient, Clinique Ormeau Pyrénées, Clinique du Diaconat-Roosevelt, Clinique Jouvenet, CHU - Hôpital Nord, GHU Paris Psychiatrie et neurosciences, GH mutualiste, Clinique Jean le Bon, Centre Léon-Bérard (CLCC), Clinique Remusat, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Pontchaillou, Centre Hospitalier de Vauclaire, Clinique Claude-Bernard, CHU de La Réunion - Félix-Guyon, Hôpital Paul-Brousse, Hôpital Lariboisière-Fernand Widal, Polyclinique de Keraudren, CH Guillaume-Régnier, Hôpital Tenon, CHU Grenoble - Site Nord, CHU - Hôpital de l’Archet, Centre Eugène-Marquis (CLCC), Centre Hospitalier Maurice Despinoy, Clinique Victor-Hugo, Hôpital Louis-Pradel, Clinique de l'Essonne, Hôpital européen, Hôpital Lariboisière, Hôpital privé Jean-Mermoz, Clinique de l’Europe, Polyclinique Francheville, Institut Jean-Godinot (CLCC), Polyclinique du Beaujolais, Hôpital privé Paris-Essonne, Polyclinique Bordeaux-Rive droite, Hôpital des Diaconesses, Clinique Saint-Michel, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Paul, Polyclinique de la Région-Mantaise, Centre Hospitalier Le Vinatier, Hôpital privé de l’Est lyonnais, Hôpital Saint-Antoine, Clinique du Cèdre, Hôpital privé Toulon Hyères-Saint-Jean, Maison de santé Bagatelle, CHU - Centre chirurgical Emile-Gallé, Clinique Les Eaux-Claires, Clinique Honoré-Cave, Clinique Charcot, CHU d’Amiens, CMCO, EPSM de Saône-et-Loire, Clinique Saint-Pierre, CHU - Hôpital Pasteur, Hopital Joseph-Ducuing, Hôpital-clinique Claude-Bernard, Clinique de la Miséricorde, Hôpital Nord, Hôpital privé Saint-Martin, Groupe hospitalier Nord-Essonne, Centre médico-chirurgical et obstétrical, Clinique Les Fontaines, CHU - Hôpital Roger-Salengro, Hôpital Jean-Verdier, CMC Floréal, Clinique Turin, Clinique Convert, Clinique de l’Estrée, Clinique des Orchidées, Hôpital Bicêtre, Polyclinique de Reims-Bezannes, Hôpital Antoine-Béclère, Centre orthopédique médico-chirurgical, Clinique Tivoli-Ducos, Hôtel-Dieu, Clinique Beau-Soleil, Clinique du Fief-de-Grimoire, Hôpital Saint-Camille, Clinique Ormeau centre, Hôpital privé Le Bois, Clinique Pasteur, Clinique Lille-Sud, Clinique Arago, CHU - Hôpital Dupuytren, Hôpital de la Croix-Saint-Simon, Clinique mutualiste Jules-Verne, Clinique Paris Lilas, CHR, CH Basse-Terre (Guadeloupe), Hôpital privé Natecia, Polyclinique Saint-Jean l’Ermitage, Institut Bergonié (CLCC), Polyclinique de Limoges - site Chénieux, CHU Sud-Réunion, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique de l’Yvette, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Desgenettes, Hôpital de la Timone (enfants), Pôle santé Oréliance, CHU - Hôpital Bretonneau, Clinique Marcel-Sembat, Clinique Sainte-Marie (GHICL), Centre Hospitalier Sainte-Marie, Clinique du Pré, Institut hospitalier Jacques-Cartier, Hôpital Saint-Louis, Hôpital privé Sévigné, Clinique Trenel, CH privé du Montgardé, Clinique des Cèdres, Clinique mutualiste de l’Estuaire, Clinique Jean Causse, CHU - Hôpital Gui-de-Chauliac, Clinique du Millénaire, CH privé Claude-Galien, EPS Barthélemy-Durand, CHU - American Memorial Hospital, Centre médico-chirurgical du Mans, Hôpital européen Georges-Pompidou, HCL - Hôpital Femme-mère-enfant, CH Esquirol, Hôpital privé, Clinique Saint-Jean-de-Dieu, CHU - Maternité, Hôpitaux Nord (Croix-Rousse), Institut franco-britannique Kléber, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Saint-Vincent-de-Paul, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes (Marne), Hôpital Corentin-Celton, Hôpital privé Vert-Coteau, Centre Henri-Becquerel (CLCC), Hôpital d'instruction des armées Percy, Clinique Mathilde, GCS Clinique du Ter, CHU - Hôpital Arnaud-de-Villeneuve, Hôpital Trousseau, Nouvelle clinique de Tours, CH Édouard-Toulouse, Hôpital privé de Marne Chantereine, Clinique Esquirol-Saint-Hilaire, Polyclinique Saint-Roch, Clinique de l’Union, Hôpital de la Conception, Hôpital Edouard-Herriot, Centre Hospitalier des Pyrénées, Centre psychothérapique de Nancy, Clinique mutualiste La Sagesse, Clinique La Croix du Sud, Hôpital Saint-Philibert (GHICL), CH/Clinique, Centre Psychothérapique, Centre Hospitalier d'Erstein, Nouvelle clinique Bel-Air, CHU - Hôpital Lapeyronie, CH Charles-Perrens, CHU de Pointe-à-Pitre, Pôle Santé République, Hôpital Beaujon, Polyclinique de la Baie, Institut d’hématologie et d'oncologie pédiatrique
2025-08-26 18:11:22,602 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:11:22,605 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-26 18:11:22,605 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-26 18:11:22,608 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:22,609 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:22,609 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:22,609 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:22,609 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:22,609 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:22,609 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:23,198 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:27 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'397'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'431'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_e32fcd9f36674d5298387acd48c7d884'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549ae4f9e4704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:23,198 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:23,198 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:23,209 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:23,209 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:23,209 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:23,209 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:27 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '397', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '431', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_e32fcd9f36674d5298387acd48c7d884', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549ae4f9e4704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:23,209 [DEBUG] openai._base_client: request_id: req_e32fcd9f36674d5298387acd48c7d884
2025-08-26 18:11:23,210 [DEBUG] app.utility.llm_helpers: LLM call 'detect_number_institutions' successful: {'prompt_tokens': 310, 'completion_tokens': 1, 'total_tokens': 311}, cost=4.71e-05
2025-08-26 18:11:23,210 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:23,210 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:23,210 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:11:23,210 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:23,213 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:23,213 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:23,214 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:23,214 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:23,214 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:23,214 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:23,214 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:23,716 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:27 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'319'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'339'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_e444e27baf824b6fb37540f577db3d93'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549ae8bbd2704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:23,716 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:23,716 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:23,721 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:23,721 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:23,721 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:23,722 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:27 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '319', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '339', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_e444e27baf824b6fb37540f577db3d93', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549ae8bbd2704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:23,722 [DEBUG] openai._base_client: request_id: req_e444e27baf824b6fb37540f577db3d93
2025-08-26 18:11:23,723 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:11:23,723 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:23,723 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:23,723 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:11:23,723 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:11:23,723 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result={'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:11:23,723 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:23,723 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:23,723 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:11:23,723 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:23,726 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:23,726 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:23,727 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:23,727 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:23,727 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:23,727 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:23,727 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:24,191 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:28 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'267'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'286'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_c6a2991d398e4533b5fc866910612816'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549aebfbfb704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:24,192 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:24,192 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:24,192 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:24,192 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:24,192 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:24,193 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:28 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '267', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '286', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_c6a2991d398e4533b5fc866910612816', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549aebfbfb704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:24,193 [DEBUG] openai._base_client: request_id: req_c6a2991d398e4533b5fc866910612816
2025-08-26 18:11:24,193 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:11:24,193 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:24,194 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:24,194 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:11:24,194 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:11:24,194 [ERROR] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: Unexpected exception: 'float' object has no attribute 'get'
2025-08-26 18:11:24,196 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:24,197 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:24,197 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:24,197 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:24,197 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:24,198 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:24,198 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:24,870 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:29 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'464'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'491'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_204083b8417341328d8a4e9efdc7b233'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549aeeec3e704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:24,870 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:24,870 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:24,883 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:24,883 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:24,883 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:24,883 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:29 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '464', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '491', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_204083b8417341328d8a4e9efdc7b233', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549aeeec3e704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:24,883 [DEBUG] openai._base_client: request_id: req_204083b8417341328d8a4e9efdc7b233
2025-08-26 18:11:24,884 [DEBUG] app.utility.llm_helpers: LLM call 'detect_specific_institution' successful: {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, cost=6.375e-05
2025-08-26 18:11:24,884 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Raw LLM response for specific institution detection: {'content': 'aucune correspondance', 'token_usage': {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, 'cost': 6.375e-05}
2025-08-26 18:11:24,884 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-26 18:11:24,885 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-26 18:11:24,885 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-26 18:11:24,887 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:24,888 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:24,888 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:24,889 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:24,889 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:24,889 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:24,889 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:25,462 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:29 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'381'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'405'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_9e0f97d401f84dc7ba730df1b53a9b63'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549af33fe7704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:25,462 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:25,463 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:25,470 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:25,471 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:25,471 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:25,471 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:29 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '381', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '405', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_9e0f97d401f84dc7ba730df1b53a9b63', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549af33fe7704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:25,471 [DEBUG] openai._base_client: request_id: req_9e0f97d401f84dc7ba730df1b53a9b63
2025-08-26 18:11:25,472 [DEBUG] app.utility.llm_helpers: LLM call 'detect_public_private_preference' successful: {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, cost=3.27e-05
2025-08-26 18:11:25,472 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-26 18:11:25,472 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: consolidated results={'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:11:25,472 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:11:25,472 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city=None, city_detected=False, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-26 18:11:25,472 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-26 18:11:25,472 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: None
2025-08-26 18:11:25,472 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: False
2025-08-26 18:11:25,472 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-26 18:11:25,472 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-26 18:11:25,473 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-26 18:11:25,473 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-26 18:11:25,502 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:11:25,503 [DEBUG] app.services.data_processing_service: Institution list: Hôpitaux civils, Hôpital privé Armand-Brillard, Hôpital privé de Marne-la-Vallée, CHU - Hôpital Rangueil, Clinique Saint-Hilaire, Clinique Chantecler, Clinique de la Muette, Clinique du Cambrésis, Institut Curie (CLCC), Centre cardiologique du Nord, Polyclinique de Blois, Centre ambulatoire Kleber, Clinique Saint-George, CH privé Saint-Grégoire, CHU - Hôpital Saint-André, Clinique Fontvert, Institut Calot, Polyclinique Majorelle, CHU - Hôpital de la Cavale-Blanche, Clinique Kennedy, CHU - Hôpital Pellegrin, CHU de Nantes, Polyclinique Urbain-V, Clinique Sainte-Anne, Fondation Rothschild, Médipôle Garonne, CHU - Hôpital de la Mère et de l’Enfant, Hôpital Privé Nancy Lorraine, GH Saint-Vincent - Clinique Sainte-Barbe, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Hôpital privé d’Antony, Polyclinique Médipôle Saint-Roch, GHP Ambroise-Paré - Hartmann (92), Clinique du Pont-de-Chaume, Clinique des Ormeaux, Clinique Bretéché, Hôpital privé des Côtes-d’Armor, CHU-Hôpital Purpan/HFE, Clinique Delay, Institut de cancérologie Strasbourg Europe, Hôpital privé La Châtaigneraie, Polyclinique du Maine, Hôpital privé Dijon-Bourgogne, Clinique de la Sauvegarde, CH privé Saint-Martin, Polyclinique Aguilera, Hôpital Ambroise-Paré, CHU - Hôpital Central, Clinique de l’Anjou, Polyclinique Jean-Villar, Polyclinique du Parc-Drevon, Clinique Toulouse-Lautrec, Clinique Durieux, Gustave-Roussy (CLCC), Clinique d’Occitanie, Clinique Anne-Artois, Centre Hospitalier Gérard-Marchant, CHU - Hôpital Morvan, Hôpital privé Clairval, Clinique cardiologique, CHU - Hôpital Charles-Nicolle, CHU - Hôpital Robert-Debré, Groupe Hospitalier de la Rochelle, Polyclinique Saint-Jean, Clinique la Pergola, CHR de Metz-Thionville - Hôpital Bel-Air, Hôpital d'instruction des armées Sainte-Anne, Espm de L’agglomeration Lilloise, Polyclinique de Bordeaux-Tondu, Clinique Saint-Léonard, Hôpital Robert Schuman, Clinique Rhône Durance, Clinique Juge, Polyclinique Côte-Basque-Sud, CHU d'Amiens/Institut ophtalmologique de Picardie, CH national d’ophtalmologie des Quinze-Vingts, Centre Jean-Perrin (CLCC), Centre Hospitalier Les Murets, Polyclinique, Clinique Victor-Pauchet, Médipôle de Savoie, Hôpital Renée-Sabran, Clinique Maussins-Nollet, Clinique mutualiste de Bonneveine, Clinique Saint-Joseph, Institut ophtalmique, Hôpital privé Arras-Les Bonnettes, CHU Nantes - Hôpital Mère Enfant, Hôpital Foch, Hôpital privé Paul-d’Égine, Centre Hospitalier George Sand, Hôpital privé de La Miotte, Clinique Conti, CHU - Hôpitaux mère-enfants, Clinique Notre-Dame-de-l’Espérance, Clinique du Tertre-Rouge, Clinique Louis-Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Saint-Nabor, Clinique générale, Clinique de l’Espérance, CH Montfavet, CHU - Hôpital Claude-Huriez, Centre de cardiologie du Pays basque, Centre Hospitalier Drôme Vivarais, Hôpital Robert-Debré, EPSM de la Marne, Hôpital d'instruction des armées Bégin, Hôpital Nord Franche-Comté-Belfort, CHU - Hôpital civil, Clinique de Bercy, Clinique Sainte-Marie, Clinique Ambroise-Paré, CH Georges-Daumezon, Clinique Saint-Jean - Sud de France, Hôpital Avicenne, Santé Atlantique, CHU - Hôpital Saint-Eloi, Hôpital privé de Villeneuve-d’Ascq, CHP de l’Europe, Hôpital de la Croix Rousse (HCL) / CH, Polyclinique de Picardie, Clinique du Parc-Monceau, Clinique Saint-Charles, Polyclinique La Ligne bleue, Centre Oscar-Lambret (CLCC), Polyclinique Lyon-Nord, Clinique Rive-Gauche, Polyclinique Vauban, Euromed Cardio, CHU - Hôpital de Hautepierre, Clinique Rhéna, Clinique de Vitrolles (Bouches-du-Rhône), Institut Arthur-Vernes, Institut de cancérologie de l’Ouest, Clinique Belledonne, Hôpital privé Cannes-Oxford, Pôle de Santé du Villeneuvois, CHU - Hôpital Sud, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Les Fleurs, Clinique du Val-d’Or, CHU - Institut cœur-poumon, Centre Clinical, Clinique Belharra, Clinique Pasteur-Lanroze, Institut Arnault-Tzanck, Centre Hospitalier Le Mas Careiron, Clinique des Franciscaines, Hôpital privé de la Seine-Saint-Denis, Hôpital Paris Saint-Joseph, Clinique du Parc, Hôpital privé La Louvière, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Clinique de l’Orangerie, IUCT/Oncopole, Hôpital d'instruction des armées Legouest, CH Saint-Joseph-Saint-Luc, Hôpital privé Pays-de-Savoie, Institut universitaire de la face et du cou, Centre cardiologique, Hôpital privé de l’Ouest parisien, ASM, Polyclinique du Grand-Sud, Clinique ophtalmologique Thiers, Clinique Mutualiste de Bretagne Occidentale, Hôpital privé La Montagne Lambert, Clinique du Trocadéro, Hôpital Hôtel-Dieu, Hôpital de la Timone (Enfants), Institut Paoli-Calmettes (CLCC), Centre Hospitalier Henri Guerin, CHU de Martinique, EPSM Lille-Métropole, Hôpital des Massues, CH/clinique, CM Bénigne-Joly, Hôpital Bichat, Polyclinique Santa-Maria, GHI, CHU - Gabriel-Montpied, Polyclinique Saint-Côme, Clinique Saint-Amé, CHU - Hôpital d’Estaing, CHU Réunion, Clinique de Villeneuve-d’Ascq, Hôpital Louis-Mourier, Centre François-Baclesse (CLCC), Clinique Saint-Vincent, Centre de cardiologie Axium-Rambot, CMC de Parly-II, Hôpital Albert Schweitzer, CHR de Metz-Thionville - Hôpital de Mercy, Polyclinique de Poitiers, CMC Pierre-Cherest, CHU - site Nord, Polyclinique de Courlancy, Hôpitaux Sud, Clinique de la Plaine, Centre Georges-François-Leclerc (CLCC), Clinique de la Part-Dieu, Nouvel Hôpital de Navarre, Clinique du Renaison, Polyclinique de Limoges - site Émailleurs, Hôpital Necker-Enfants-Malades, Institut Curie, Hôpital Henri-Mondor, Hôpital privé de l’Estuaire, Hôpital d'instruction des armées Laveran, CHU - Hôpital Maison-Blanche, Centre de chirurgie ophtalmologique, Clinique Saint-François, Clinique ambulatoire de Domont, CH intercommunal, Hôpital Cochin, Institut mutualiste Montsouris, CMCO Côte d’Opale, Hôpital Pierre-Wertheimer, Hôpital de la Pitié-Salpêtrière, Polyclinique Saint-François, CHU - Hôpital Larrey, EPSM Etienne-Gourmelen, Hôpital privé de la Loire, Clinique urologique Nantes-Atlantis, Grand hôpital de l'Est-Francilien, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Augustin, Clinique Clémentville, Hôpital privé des Peupliers, GH, Hôpitaux pédiatriques, Clinique Saint-André, CHU - Hôpital Trousseau, Clinique de l'Alma, Centre Hospitalier Montperrin, Hôpital privé Nord Parisien, Clinique du Croisé-Laroche, Clinique de l’Atlantique, Les Franciscaines, EPSM Morbihan, Institut du cancer de Montpellier (CLCC), Hôpital de la Timone (adultes), Hôpital privé de Provence, Clinique mutualiste catalane, Clinique du Diaconat-Fonderie, Clinique Axium, CHI, CHU - Hôpital Purpan, Hôpital d'instruction des armées Robert-Picqué, Clinique mutualiste, IUCT Oncopole, Clinique du sport, Centre Hospitalier La Chartreuse, Infirmerie protestante de Lyon, Polyclinique de Navarre, CHU - Hôpital Clocheville, CHU - Hôpital Haut-Lévêque, Centre de la main, Epsan, Clinique Saint-Antoine, Clinique Bizet, Clinique Bouchard, Hôpital privé Drôme-Ardèche, Hôpital Saint-Joseph, CHU de Martinique - site Mère-Enfant, EPS Ville-Évrard, Clinique du Lac et d’Argonay, Hôpital privé du Vert-Galant, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital Belle-Isle, Clinique du Grand-Large, CH Henri-Laborit, GH Paul Guiraud, Hôpital privé Beauregard, Clinique Bon-Secours, Clinique Océane, Centre Antoine-Lacassagne (CLCC), Polyclinique de Kerio, Médipôle Hôpital Privé, Hôpitaux de Saint-Maurice, Pôle santé Léonard-de-Vinci, Clinique Sainte-Clotilde, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpitaux de Brabois, Clinique Monticelli-Vélodrome, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Hôpital privé de la Casamance, CHU - Hôpital de la Côte de nacre, Clinique mutualiste de la Porte-de-l'Orient, Clinique Ormeau Pyrénées, Clinique du Diaconat-Roosevelt, Clinique Jouvenet, CHU - Hôpital Nord, GHU Paris Psychiatrie et neurosciences, GH mutualiste, Clinique Jean le Bon, Centre Léon-Bérard (CLCC), Clinique Remusat, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Pontchaillou, Centre Hospitalier de Vauclaire, Clinique Claude-Bernard, CHU de La Réunion - Félix-Guyon, Hôpital Paul-Brousse, Hôpital Lariboisière-Fernand Widal, Polyclinique de Keraudren, CH Guillaume-Régnier, Hôpital Tenon, CHU Grenoble - Site Nord, CHU - Hôpital de l’Archet, Centre Eugène-Marquis (CLCC), Centre Hospitalier Maurice Despinoy, Clinique Victor-Hugo, Hôpital Louis-Pradel, Clinique de l'Essonne, Hôpital européen, Hôpital Lariboisière, Hôpital privé Jean-Mermoz, Clinique de l’Europe, Polyclinique Francheville, Institut Jean-Godinot (CLCC), Polyclinique du Beaujolais, Hôpital privé Paris-Essonne, Polyclinique Bordeaux-Rive droite, Hôpital des Diaconesses, Clinique Saint-Michel, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Paul, Polyclinique de la Région-Mantaise, Centre Hospitalier Le Vinatier, Hôpital privé de l’Est lyonnais, Hôpital Saint-Antoine, Clinique du Cèdre, Hôpital privé Toulon Hyères-Saint-Jean, Maison de santé Bagatelle, CHU - Centre chirurgical Emile-Gallé, Clinique Les Eaux-Claires, Clinique Honoré-Cave, Clinique Charcot, CHU d’Amiens, CMCO, EPSM de Saône-et-Loire, Clinique Saint-Pierre, CHU - Hôpital Pasteur, Hopital Joseph-Ducuing, Hôpital-clinique Claude-Bernard, Clinique de la Miséricorde, Hôpital Nord, Hôpital privé Saint-Martin, Groupe hospitalier Nord-Essonne, Centre médico-chirurgical et obstétrical, Clinique Les Fontaines, CHU - Hôpital Roger-Salengro, Hôpital Jean-Verdier, CMC Floréal, Clinique Turin, Clinique Convert, Clinique de l’Estrée, Clinique des Orchidées, Hôpital Bicêtre, Polyclinique de Reims-Bezannes, Hôpital Antoine-Béclère, Centre orthopédique médico-chirurgical, Clinique Tivoli-Ducos, Hôtel-Dieu, Clinique Beau-Soleil, Clinique du Fief-de-Grimoire, Hôpital Saint-Camille, Clinique Ormeau centre, Hôpital privé Le Bois, Clinique Pasteur, Clinique Lille-Sud, Clinique Arago, CHU - Hôpital Dupuytren, Hôpital de la Croix-Saint-Simon, Clinique mutualiste Jules-Verne, Clinique Paris Lilas, CHR, CH Basse-Terre (Guadeloupe), Hôpital privé Natecia, Polyclinique Saint-Jean l’Ermitage, Institut Bergonié (CLCC), Polyclinique de Limoges - site Chénieux, CHU Sud-Réunion, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique de l’Yvette, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Desgenettes, Hôpital de la Timone (enfants), Pôle santé Oréliance, CHU - Hôpital Bretonneau, Clinique Marcel-Sembat, Clinique Sainte-Marie (GHICL), Centre Hospitalier Sainte-Marie, Clinique du Pré, Institut hospitalier Jacques-Cartier, Hôpital Saint-Louis, Hôpital privé Sévigné, Clinique Trenel, CH privé du Montgardé, Clinique des Cèdres, Clinique mutualiste de l’Estuaire, Clinique Jean Causse, CHU - Hôpital Gui-de-Chauliac, Clinique du Millénaire, CH privé Claude-Galien, EPS Barthélemy-Durand, CHU - American Memorial Hospital, Centre médico-chirurgical du Mans, Hôpital européen Georges-Pompidou, HCL - Hôpital Femme-mère-enfant, CH Esquirol, Hôpital privé, Clinique Saint-Jean-de-Dieu, CHU - Maternité, Hôpitaux Nord (Croix-Rousse), Institut franco-britannique Kléber, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Saint-Vincent-de-Paul, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes (Marne), Hôpital Corentin-Celton, Hôpital privé Vert-Coteau, Centre Henri-Becquerel (CLCC), Hôpital d'instruction des armées Percy, Clinique Mathilde, GCS Clinique du Ter, CHU - Hôpital Arnaud-de-Villeneuve, Hôpital Trousseau, Nouvelle clinique de Tours, CH Édouard-Toulouse, Hôpital privé de Marne Chantereine, Clinique Esquirol-Saint-Hilaire, Polyclinique Saint-Roch, Clinique de l’Union, Hôpital de la Conception, Hôpital Edouard-Herriot, Centre Hospitalier des Pyrénées, Centre psychothérapique de Nancy, Clinique mutualiste La Sagesse, Clinique La Croix du Sud, Hôpital Saint-Philibert (GHICL), CH/Clinique, Centre Psychothérapique, Centre Hospitalier d'Erstein, Nouvelle clinique Bel-Air, CHU - Hôpital Lapeyronie, CH Charles-Perrens, CHU de Pointe-à-Pitre, Pôle Santé République, Hôpital Beaujon, Polyclinique de la Baie, Institut d’hématologie et d'oncologie pédiatrique
2025-08-26 18:11:25,504 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-26 18:11:25,717 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-26 18:11:25,717 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: None
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: False
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: None, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-26 18:11:25,717 [DEBUG] app.services.pipeline_orchestrator_service: Calling build_ranking_dataframe_with_distances
2025-08-26 18:11:25,718 [INFO] app.services.pipeline_orchestrator_service: Building ranking DataFrame with distances: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', excel_path='/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx', detected_specialty='no specialty match'
2025-08-26 18:11:25,718 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history='None'
2025-08-26 18:11:25,718 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-26 18:11:25,718 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-26 18:11:25,718 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-26 18:11:25,718 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-26 18:11:25,862 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:11:25,863 [DEBUG] app.services.data_processing_service: Institution list: Hôpitaux civils, Hôpital privé Armand-Brillard, Hôpital privé de Marne-la-Vallée, CHU - Hôpital Rangueil, Clinique Saint-Hilaire, Clinique Chantecler, Clinique de la Muette, Clinique du Cambrésis, Institut Curie (CLCC), Centre cardiologique du Nord, Polyclinique de Blois, Centre ambulatoire Kleber, Clinique Saint-George, CH privé Saint-Grégoire, CHU - Hôpital Saint-André, Clinique Fontvert, Institut Calot, Polyclinique Majorelle, CHU - Hôpital de la Cavale-Blanche, Clinique Kennedy, CHU - Hôpital Pellegrin, CHU de Nantes, Polyclinique Urbain-V, Clinique Sainte-Anne, Fondation Rothschild, Médipôle Garonne, CHU - Hôpital de la Mère et de l’Enfant, Hôpital Privé Nancy Lorraine, GH Saint-Vincent - Clinique Sainte-Barbe, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Hôpital privé d’Antony, Polyclinique Médipôle Saint-Roch, GHP Ambroise-Paré - Hartmann (92), Clinique du Pont-de-Chaume, Clinique des Ormeaux, Clinique Bretéché, Hôpital privé des Côtes-d’Armor, CHU-Hôpital Purpan/HFE, Clinique Delay, Institut de cancérologie Strasbourg Europe, Hôpital privé La Châtaigneraie, Polyclinique du Maine, Hôpital privé Dijon-Bourgogne, Clinique de la Sauvegarde, CH privé Saint-Martin, Polyclinique Aguilera, Hôpital Ambroise-Paré, CHU - Hôpital Central, Clinique de l’Anjou, Polyclinique Jean-Villar, Polyclinique du Parc-Drevon, Clinique Toulouse-Lautrec, Clinique Durieux, Gustave-Roussy (CLCC), Clinique d’Occitanie, Clinique Anne-Artois, Centre Hospitalier Gérard-Marchant, CHU - Hôpital Morvan, Hôpital privé Clairval, Clinique cardiologique, CHU - Hôpital Charles-Nicolle, CHU - Hôpital Robert-Debré, Groupe Hospitalier de la Rochelle, Polyclinique Saint-Jean, Clinique la Pergola, CHR de Metz-Thionville - Hôpital Bel-Air, Hôpital d'instruction des armées Sainte-Anne, Espm de L’agglomeration Lilloise, Polyclinique de Bordeaux-Tondu, Clinique Saint-Léonard, Hôpital Robert Schuman, Clinique Rhône Durance, Clinique Juge, Polyclinique Côte-Basque-Sud, CHU d'Amiens/Institut ophtalmologique de Picardie, CH national d’ophtalmologie des Quinze-Vingts, Centre Jean-Perrin (CLCC), Centre Hospitalier Les Murets, Polyclinique, Clinique Victor-Pauchet, Médipôle de Savoie, Hôpital Renée-Sabran, Clinique Maussins-Nollet, Clinique mutualiste de Bonneveine, Clinique Saint-Joseph, Institut ophtalmique, Hôpital privé Arras-Les Bonnettes, CHU Nantes - Hôpital Mère Enfant, Hôpital Foch, Hôpital privé Paul-d’Égine, Centre Hospitalier George Sand, Hôpital privé de La Miotte, Clinique Conti, CHU - Hôpitaux mère-enfants, Clinique Notre-Dame-de-l’Espérance, Clinique du Tertre-Rouge, Clinique Louis-Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Saint-Nabor, Clinique générale, Clinique de l’Espérance, CH Montfavet, CHU - Hôpital Claude-Huriez, Centre de cardiologie du Pays basque, Centre Hospitalier Drôme Vivarais, Hôpital Robert-Debré, EPSM de la Marne, Hôpital d'instruction des armées Bégin, Hôpital Nord Franche-Comté-Belfort, CHU - Hôpital civil, Clinique de Bercy, Clinique Sainte-Marie, Clinique Ambroise-Paré, CH Georges-Daumezon, Clinique Saint-Jean - Sud de France, Hôpital Avicenne, Santé Atlantique, CHU - Hôpital Saint-Eloi, Hôpital privé de Villeneuve-d’Ascq, CHP de l’Europe, Hôpital de la Croix Rousse (HCL) / CH, Polyclinique de Picardie, Clinique du Parc-Monceau, Clinique Saint-Charles, Polyclinique La Ligne bleue, Centre Oscar-Lambret (CLCC), Polyclinique Lyon-Nord, Clinique Rive-Gauche, Polyclinique Vauban, Euromed Cardio, CHU - Hôpital de Hautepierre, Clinique Rhéna, Clinique de Vitrolles (Bouches-du-Rhône), Institut Arthur-Vernes, Institut de cancérologie de l’Ouest, Clinique Belledonne, Hôpital privé Cannes-Oxford, Pôle de Santé du Villeneuvois, CHU - Hôpital Sud, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Les Fleurs, Clinique du Val-d’Or, CHU - Institut cœur-poumon, Centre Clinical, Clinique Belharra, Clinique Pasteur-Lanroze, Institut Arnault-Tzanck, Centre Hospitalier Le Mas Careiron, Clinique des Franciscaines, Hôpital privé de la Seine-Saint-Denis, Hôpital Paris Saint-Joseph, Clinique du Parc, Hôpital privé La Louvière, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Clinique de l’Orangerie, IUCT/Oncopole, Hôpital d'instruction des armées Legouest, CH Saint-Joseph-Saint-Luc, Hôpital privé Pays-de-Savoie, Institut universitaire de la face et du cou, Centre cardiologique, Hôpital privé de l’Ouest parisien, ASM, Polyclinique du Grand-Sud, Clinique ophtalmologique Thiers, Clinique Mutualiste de Bretagne Occidentale, Hôpital privé La Montagne Lambert, Clinique du Trocadéro, Hôpital Hôtel-Dieu, Hôpital de la Timone (Enfants), Institut Paoli-Calmettes (CLCC), Centre Hospitalier Henri Guerin, CHU de Martinique, EPSM Lille-Métropole, Hôpital des Massues, CH/clinique, CM Bénigne-Joly, Hôpital Bichat, Polyclinique Santa-Maria, GHI, CHU - Gabriel-Montpied, Polyclinique Saint-Côme, Clinique Saint-Amé, CHU - Hôpital d’Estaing, CHU Réunion, Clinique de Villeneuve-d’Ascq, Hôpital Louis-Mourier, Centre François-Baclesse (CLCC), Clinique Saint-Vincent, Centre de cardiologie Axium-Rambot, CMC de Parly-II, Hôpital Albert Schweitzer, CHR de Metz-Thionville - Hôpital de Mercy, Polyclinique de Poitiers, CMC Pierre-Cherest, CHU - site Nord, Polyclinique de Courlancy, Hôpitaux Sud, Clinique de la Plaine, Centre Georges-François-Leclerc (CLCC), Clinique de la Part-Dieu, Nouvel Hôpital de Navarre, Clinique du Renaison, Polyclinique de Limoges - site Émailleurs, Hôpital Necker-Enfants-Malades, Institut Curie, Hôpital Henri-Mondor, Hôpital privé de l’Estuaire, Hôpital d'instruction des armées Laveran, CHU - Hôpital Maison-Blanche, Centre de chirurgie ophtalmologique, Clinique Saint-François, Clinique ambulatoire de Domont, CH intercommunal, Hôpital Cochin, Institut mutualiste Montsouris, CMCO Côte d’Opale, Hôpital Pierre-Wertheimer, Hôpital de la Pitié-Salpêtrière, Polyclinique Saint-François, CHU - Hôpital Larrey, EPSM Etienne-Gourmelen, Hôpital privé de la Loire, Clinique urologique Nantes-Atlantis, Grand hôpital de l'Est-Francilien, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Augustin, Clinique Clémentville, Hôpital privé des Peupliers, GH, Hôpitaux pédiatriques, Clinique Saint-André, CHU - Hôpital Trousseau, Clinique de l'Alma, Centre Hospitalier Montperrin, Hôpital privé Nord Parisien, Clinique du Croisé-Laroche, Clinique de l’Atlantique, Les Franciscaines, EPSM Morbihan, Institut du cancer de Montpellier (CLCC), Hôpital de la Timone (adultes), Hôpital privé de Provence, Clinique mutualiste catalane, Clinique du Diaconat-Fonderie, Clinique Axium, CHI, CHU - Hôpital Purpan, Hôpital d'instruction des armées Robert-Picqué, Clinique mutualiste, IUCT Oncopole, Clinique du sport, Centre Hospitalier La Chartreuse, Infirmerie protestante de Lyon, Polyclinique de Navarre, CHU - Hôpital Clocheville, CHU - Hôpital Haut-Lévêque, Centre de la main, Epsan, Clinique Saint-Antoine, Clinique Bizet, Clinique Bouchard, Hôpital privé Drôme-Ardèche, Hôpital Saint-Joseph, CHU de Martinique - site Mère-Enfant, EPS Ville-Évrard, Clinique du Lac et d’Argonay, Hôpital privé du Vert-Galant, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital Belle-Isle, Clinique du Grand-Large, CH Henri-Laborit, GH Paul Guiraud, Hôpital privé Beauregard, Clinique Bon-Secours, Clinique Océane, Centre Antoine-Lacassagne (CLCC), Polyclinique de Kerio, Médipôle Hôpital Privé, Hôpitaux de Saint-Maurice, Pôle santé Léonard-de-Vinci, Clinique Sainte-Clotilde, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpitaux de Brabois, Clinique Monticelli-Vélodrome, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Hôpital privé de la Casamance, CHU - Hôpital de la Côte de nacre, Clinique mutualiste de la Porte-de-l'Orient, Clinique Ormeau Pyrénées, Clinique du Diaconat-Roosevelt, Clinique Jouvenet, CHU - Hôpital Nord, GHU Paris Psychiatrie et neurosciences, GH mutualiste, Clinique Jean le Bon, Centre Léon-Bérard (CLCC), Clinique Remusat, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Pontchaillou, Centre Hospitalier de Vauclaire, Clinique Claude-Bernard, CHU de La Réunion - Félix-Guyon, Hôpital Paul-Brousse, Hôpital Lariboisière-Fernand Widal, Polyclinique de Keraudren, CH Guillaume-Régnier, Hôpital Tenon, CHU Grenoble - Site Nord, CHU - Hôpital de l’Archet, Centre Eugène-Marquis (CLCC), Centre Hospitalier Maurice Despinoy, Clinique Victor-Hugo, Hôpital Louis-Pradel, Clinique de l'Essonne, Hôpital européen, Hôpital Lariboisière, Hôpital privé Jean-Mermoz, Clinique de l’Europe, Polyclinique Francheville, Institut Jean-Godinot (CLCC), Polyclinique du Beaujolais, Hôpital privé Paris-Essonne, Polyclinique Bordeaux-Rive droite, Hôpital des Diaconesses, Clinique Saint-Michel, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Paul, Polyclinique de la Région-Mantaise, Centre Hospitalier Le Vinatier, Hôpital privé de l’Est lyonnais, Hôpital Saint-Antoine, Clinique du Cèdre, Hôpital privé Toulon Hyères-Saint-Jean, Maison de santé Bagatelle, CHU - Centre chirurgical Emile-Gallé, Clinique Les Eaux-Claires, Clinique Honoré-Cave, Clinique Charcot, CHU d’Amiens, CMCO, EPSM de Saône-et-Loire, Clinique Saint-Pierre, CHU - Hôpital Pasteur, Hopital Joseph-Ducuing, Hôpital-clinique Claude-Bernard, Clinique de la Miséricorde, Hôpital Nord, Hôpital privé Saint-Martin, Groupe hospitalier Nord-Essonne, Centre médico-chirurgical et obstétrical, Clinique Les Fontaines, CHU - Hôpital Roger-Salengro, Hôpital Jean-Verdier, CMC Floréal, Clinique Turin, Clinique Convert, Clinique de l’Estrée, Clinique des Orchidées, Hôpital Bicêtre, Polyclinique de Reims-Bezannes, Hôpital Antoine-Béclère, Centre orthopédique médico-chirurgical, Clinique Tivoli-Ducos, Hôtel-Dieu, Clinique Beau-Soleil, Clinique du Fief-de-Grimoire, Hôpital Saint-Camille, Clinique Ormeau centre, Hôpital privé Le Bois, Clinique Pasteur, Clinique Lille-Sud, Clinique Arago, CHU - Hôpital Dupuytren, Hôpital de la Croix-Saint-Simon, Clinique mutualiste Jules-Verne, Clinique Paris Lilas, CHR, CH Basse-Terre (Guadeloupe), Hôpital privé Natecia, Polyclinique Saint-Jean l’Ermitage, Institut Bergonié (CLCC), Polyclinique de Limoges - site Chénieux, CHU Sud-Réunion, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique de l’Yvette, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Desgenettes, Hôpital de la Timone (enfants), Pôle santé Oréliance, CHU - Hôpital Bretonneau, Clinique Marcel-Sembat, Clinique Sainte-Marie (GHICL), Centre Hospitalier Sainte-Marie, Clinique du Pré, Institut hospitalier Jacques-Cartier, Hôpital Saint-Louis, Hôpital privé Sévigné, Clinique Trenel, CH privé du Montgardé, Clinique des Cèdres, Clinique mutualiste de l’Estuaire, Clinique Jean Causse, CHU - Hôpital Gui-de-Chauliac, Clinique du Millénaire, CH privé Claude-Galien, EPS Barthélemy-Durand, CHU - American Memorial Hospital, Centre médico-chirurgical du Mans, Hôpital européen Georges-Pompidou, HCL - Hôpital Femme-mère-enfant, CH Esquirol, Hôpital privé, Clinique Saint-Jean-de-Dieu, CHU - Maternité, Hôpitaux Nord (Croix-Rousse), Institut franco-britannique Kléber, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Saint-Vincent-de-Paul, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes (Marne), Hôpital Corentin-Celton, Hôpital privé Vert-Coteau, Centre Henri-Becquerel (CLCC), Hôpital d'instruction des armées Percy, Clinique Mathilde, GCS Clinique du Ter, CHU - Hôpital Arnaud-de-Villeneuve, Hôpital Trousseau, Nouvelle clinique de Tours, CH Édouard-Toulouse, Hôpital privé de Marne Chantereine, Clinique Esquirol-Saint-Hilaire, Polyclinique Saint-Roch, Clinique de l’Union, Hôpital de la Conception, Hôpital Edouard-Herriot, Centre Hospitalier des Pyrénées, Centre psychothérapique de Nancy, Clinique mutualiste La Sagesse, Clinique La Croix du Sud, Hôpital Saint-Philibert (GHICL), CH/Clinique, Centre Psychothérapique, Centre Hospitalier d'Erstein, Nouvelle clinique Bel-Air, CHU - Hôpital Lapeyronie, CH Charles-Perrens, CHU de Pointe-à-Pitre, Pôle Santé République, Hôpital Beaujon, Polyclinique de la Baie, Institut d’hématologie et d'oncologie pédiatrique
2025-08-26 18:11:25,863 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Hôpitaux civils, Hôpital privé Armand-Brillard, Hôpital privé de Marne-la-Vallée, CHU - Hôpital Rangueil, Clinique Saint-Hilaire, Clinique Chantecler, Clinique de la Muette, Clinique du Cambrésis, Institut Curie (CLCC), Centre cardiologique du Nord, Polyclinique de Blois, Centre ambulatoire Kleber, Clinique Saint-George, CH privé Saint-Grégoire, CHU - Hôpital Saint-André, Clinique Fontvert, Institut Calot, Polyclinique Majorelle, CHU - Hôpital de la Cavale-Blanche, Clinique Kennedy, CHU - Hôpital Pellegrin, CHU de Nantes, Polyclinique Urbain-V, Clinique Sainte-Anne, Fondation Rothschild, Médipôle Garonne, CHU - Hôpital de la Mère et de l’Enfant, Hôpital Privé Nancy Lorraine, GH Saint-Vincent - Clinique Sainte-Barbe, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Hôpital privé d’Antony, Polyclinique Médipôle Saint-Roch, GHP Ambroise-Paré - Hartmann (92), Clinique du Pont-de-Chaume, Clinique des Ormeaux, Clinique Bretéché, Hôpital privé des Côtes-d’Armor, CHU-Hôpital Purpan/HFE, Clinique Delay, Institut de cancérologie Strasbourg Europe, Hôpital privé La Châtaigneraie, Polyclinique du Maine, Hôpital privé Dijon-Bourgogne, Clinique de la Sauvegarde, CH privé Saint-Martin, Polyclinique Aguilera, Hôpital Ambroise-Paré, CHU - Hôpital Central, Clinique de l’Anjou, Polyclinique Jean-Villar, Polyclinique du Parc-Drevon, Clinique Toulouse-Lautrec, Clinique Durieux, Gustave-Roussy (CLCC), Clinique d’Occitanie, Clinique Anne-Artois, Centre Hospitalier Gérard-Marchant, CHU - Hôpital Morvan, Hôpital privé Clairval, Clinique cardiologique, CHU - Hôpital Charles-Nicolle, CHU - Hôpital Robert-Debré, Groupe Hospitalier de la Rochelle, Polyclinique Saint-Jean, Clinique la Pergola, CHR de Metz-Thionville - Hôpital Bel-Air, Hôpital d'instruction des armées Sainte-Anne, Espm de L’agglomeration Lilloise, Polyclinique de Bordeaux-Tondu, Clinique Saint-Léonard, Hôpital Robert Schuman, Clinique Rhône Durance, Clinique Juge, Polyclinique Côte-Basque-Sud, CHU d'Amiens/Institut ophtalmologique de Picardie, CH national d’ophtalmologie des Quinze-Vingts, Centre Jean-Perrin (CLCC), Centre Hospitalier Les Murets, Polyclinique, Clinique Victor-Pauchet, Médipôle de Savoie, Hôpital Renée-Sabran, Clinique Maussins-Nollet, Clinique mutualiste de Bonneveine, Clinique Saint-Joseph, Institut ophtalmique, Hôpital privé Arras-Les Bonnettes, CHU Nantes - Hôpital Mère Enfant, Hôpital Foch, Hôpital privé Paul-d’Égine, Centre Hospitalier George Sand, Hôpital privé de La Miotte, Clinique Conti, CHU - Hôpitaux mère-enfants, Clinique Notre-Dame-de-l’Espérance, Clinique du Tertre-Rouge, Clinique Louis-Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Saint-Nabor, Clinique générale, Clinique de l’Espérance, CH Montfavet, CHU - Hôpital Claude-Huriez, Centre de cardiologie du Pays basque, Centre Hospitalier Drôme Vivarais, Hôpital Robert-Debré, EPSM de la Marne, Hôpital d'instruction des armées Bégin, Hôpital Nord Franche-Comté-Belfort, CHU - Hôpital civil, Clinique de Bercy, Clinique Sainte-Marie, Clinique Ambroise-Paré, CH Georges-Daumezon, Clinique Saint-Jean - Sud de France, Hôpital Avicenne, Santé Atlantique, CHU - Hôpital Saint-Eloi, Hôpital privé de Villeneuve-d’Ascq, CHP de l’Europe, Hôpital de la Croix Rousse (HCL) / CH, Polyclinique de Picardie, Clinique du Parc-Monceau, Clinique Saint-Charles, Polyclinique La Ligne bleue, Centre Oscar-Lambret (CLCC), Polyclinique Lyon-Nord, Clinique Rive-Gauche, Polyclinique Vauban, Euromed Cardio, CHU - Hôpital de Hautepierre, Clinique Rhéna, Clinique de Vitrolles (Bouches-du-Rhône), Institut Arthur-Vernes, Institut de cancérologie de l’Ouest, Clinique Belledonne, Hôpital privé Cannes-Oxford, Pôle de Santé du Villeneuvois, CHU - Hôpital Sud, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Les Fleurs, Clinique du Val-d’Or, CHU - Institut cœur-poumon, Centre Clinical, Clinique Belharra, Clinique Pasteur-Lanroze, Institut Arnault-Tzanck, Centre Hospitalier Le Mas Careiron, Clinique des Franciscaines, Hôpital privé de la Seine-Saint-Denis, Hôpital Paris Saint-Joseph, Clinique du Parc, Hôpital privé La Louvière, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Clinique de l’Orangerie, IUCT/Oncopole, Hôpital d'instruction des armées Legouest, CH Saint-Joseph-Saint-Luc, Hôpital privé Pays-de-Savoie, Institut universitaire de la face et du cou, Centre cardiologique, Hôpital privé de l’Ouest parisien, ASM, Polyclinique du Grand-Sud, Clinique ophtalmologique Thiers, Clinique Mutualiste de Bretagne Occidentale, Hôpital privé La Montagne Lambert, Clinique du Trocadéro, Hôpital Hôtel-Dieu, Hôpital de la Timone (Enfants), Institut Paoli-Calmettes (CLCC), Centre Hospitalier Henri Guerin, CHU de Martinique, EPSM Lille-Métropole, Hôpital des Massues, CH/clinique, CM Bénigne-Joly, Hôpital Bichat, Polyclinique Santa-Maria, GHI, CHU - Gabriel-Montpied, Polyclinique Saint-Côme, Clinique Saint-Amé, CHU - Hôpital d’Estaing, CHU Réunion, Clinique de Villeneuve-d’Ascq, Hôpital Louis-Mourier, Centre François-Baclesse (CLCC), Clinique Saint-Vincent, Centre de cardiologie Axium-Rambot, CMC de Parly-II, Hôpital Albert Schweitzer, CHR de Metz-Thionville - Hôpital de Mercy, Polyclinique de Poitiers, CMC Pierre-Cherest, CHU - site Nord, Polyclinique de Courlancy, Hôpitaux Sud, Clinique de la Plaine, Centre Georges-François-Leclerc (CLCC), Clinique de la Part-Dieu, Nouvel Hôpital de Navarre, Clinique du Renaison, Polyclinique de Limoges - site Émailleurs, Hôpital Necker-Enfants-Malades, Institut Curie, Hôpital Henri-Mondor, Hôpital privé de l’Estuaire, Hôpital d'instruction des armées Laveran, CHU - Hôpital Maison-Blanche, Centre de chirurgie ophtalmologique, Clinique Saint-François, Clinique ambulatoire de Domont, CH intercommunal, Hôpital Cochin, Institut mutualiste Montsouris, CMCO Côte d’Opale, Hôpital Pierre-Wertheimer, Hôpital de la Pitié-Salpêtrière, Polyclinique Saint-François, CHU - Hôpital Larrey, EPSM Etienne-Gourmelen, Hôpital privé de la Loire, Clinique urologique Nantes-Atlantis, Grand hôpital de l'Est-Francilien, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Augustin, Clinique Clémentville, Hôpital privé des Peupliers, GH, Hôpitaux pédiatriques, Clinique Saint-André, CHU - Hôpital Trousseau, Clinique de l'Alma, Centre Hospitalier Montperrin, Hôpital privé Nord Parisien, Clinique du Croisé-Laroche, Clinique de l’Atlantique, Les Franciscaines, EPSM Morbihan, Institut du cancer de Montpellier (CLCC), Hôpital de la Timone (adultes), Hôpital privé de Provence, Clinique mutualiste catalane, Clinique du Diaconat-Fonderie, Clinique Axium, CHI, CHU - Hôpital Purpan, Hôpital d'instruction des armées Robert-Picqué, Clinique mutualiste, IUCT Oncopole, Clinique du sport, Centre Hospitalier La Chartreuse, Infirmerie protestante de Lyon, Polyclinique de Navarre, CHU - Hôpital Clocheville, CHU - Hôpital Haut-Lévêque, Centre de la main, Epsan, Clinique Saint-Antoine, Clinique Bizet, Clinique Bouchard, Hôpital privé Drôme-Ardèche, Hôpital Saint-Joseph, CHU de Martinique - site Mère-Enfant, EPS Ville-Évrard, Clinique du Lac et d’Argonay, Hôpital privé du Vert-Galant, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital Belle-Isle, Clinique du Grand-Large, CH Henri-Laborit, GH Paul Guiraud, Hôpital privé Beauregard, Clinique Bon-Secours, Clinique Océane, Centre Antoine-Lacassagne (CLCC), Polyclinique de Kerio, Médipôle Hôpital Privé, Hôpitaux de Saint-Maurice, Pôle santé Léonard-de-Vinci, Clinique Sainte-Clotilde, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpitaux de Brabois, Clinique Monticelli-Vélodrome, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Hôpital privé de la Casamance, CHU - Hôpital de la Côte de nacre, Clinique mutualiste de la Porte-de-l'Orient, Clinique Ormeau Pyrénées, Clinique du Diaconat-Roosevelt, Clinique Jouvenet, CHU - Hôpital Nord, GHU Paris Psychiatrie et neurosciences, GH mutualiste, Clinique Jean le Bon, Centre Léon-Bérard (CLCC), Clinique Remusat, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Pontchaillou, Centre Hospitalier de Vauclaire, Clinique Claude-Bernard, CHU de La Réunion - Félix-Guyon, Hôpital Paul-Brousse, Hôpital Lariboisière-Fernand Widal, Polyclinique de Keraudren, CH Guillaume-Régnier, Hôpital Tenon, CHU Grenoble - Site Nord, CHU - Hôpital de l’Archet, Centre Eugène-Marquis (CLCC), Centre Hospitalier Maurice Despinoy, Clinique Victor-Hugo, Hôpital Louis-Pradel, Clinique de l'Essonne, Hôpital européen, Hôpital Lariboisière, Hôpital privé Jean-Mermoz, Clinique de l’Europe, Polyclinique Francheville, Institut Jean-Godinot (CLCC), Polyclinique du Beaujolais, Hôpital privé Paris-Essonne, Polyclinique Bordeaux-Rive droite, Hôpital des Diaconesses, Clinique Saint-Michel, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Paul, Polyclinique de la Région-Mantaise, Centre Hospitalier Le Vinatier, Hôpital privé de l’Est lyonnais, Hôpital Saint-Antoine, Clinique du Cèdre, Hôpital privé Toulon Hyères-Saint-Jean, Maison de santé Bagatelle, CHU - Centre chirurgical Emile-Gallé, Clinique Les Eaux-Claires, Clinique Honoré-Cave, Clinique Charcot, CHU d’Amiens, CMCO, EPSM de Saône-et-Loire, Clinique Saint-Pierre, CHU - Hôpital Pasteur, Hopital Joseph-Ducuing, Hôpital-clinique Claude-Bernard, Clinique de la Miséricorde, Hôpital Nord, Hôpital privé Saint-Martin, Groupe hospitalier Nord-Essonne, Centre médico-chirurgical et obstétrical, Clinique Les Fontaines, CHU - Hôpital Roger-Salengro, Hôpital Jean-Verdier, CMC Floréal, Clinique Turin, Clinique Convert, Clinique de l’Estrée, Clinique des Orchidées, Hôpital Bicêtre, Polyclinique de Reims-Bezannes, Hôpital Antoine-Béclère, Centre orthopédique médico-chirurgical, Clinique Tivoli-Ducos, Hôtel-Dieu, Clinique Beau-Soleil, Clinique du Fief-de-Grimoire, Hôpital Saint-Camille, Clinique Ormeau centre, Hôpital privé Le Bois, Clinique Pasteur, Clinique Lille-Sud, Clinique Arago, CHU - Hôpital Dupuytren, Hôpital de la Croix-Saint-Simon, Clinique mutualiste Jules-Verne, Clinique Paris Lilas, CHR, CH Basse-Terre (Guadeloupe), Hôpital privé Natecia, Polyclinique Saint-Jean l’Ermitage, Institut Bergonié (CLCC), Polyclinique de Limoges - site Chénieux, CHU Sud-Réunion, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique de l’Yvette, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Desgenettes, Hôpital de la Timone (enfants), Pôle santé Oréliance, CHU - Hôpital Bretonneau, Clinique Marcel-Sembat, Clinique Sainte-Marie (GHICL), Centre Hospitalier Sainte-Marie, Clinique du Pré, Institut hospitalier Jacques-Cartier, Hôpital Saint-Louis, Hôpital privé Sévigné, Clinique Trenel, CH privé du Montgardé, Clinique des Cèdres, Clinique mutualiste de l’Estuaire, Clinique Jean Causse, CHU - Hôpital Gui-de-Chauliac, Clinique du Millénaire, CH privé Claude-Galien, EPS Barthélemy-Durand, CHU - American Memorial Hospital, Centre médico-chirurgical du Mans, Hôpital européen Georges-Pompidou, HCL - Hôpital Femme-mère-enfant, CH Esquirol, Hôpital privé, Clinique Saint-Jean-de-Dieu, CHU - Maternité, Hôpitaux Nord (Croix-Rousse), Institut franco-britannique Kléber, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Saint-Vincent-de-Paul, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes (Marne), Hôpital Corentin-Celton, Hôpital privé Vert-Coteau, Centre Henri-Becquerel (CLCC), Hôpital d'instruction des armées Percy, Clinique Mathilde, GCS Clinique du Ter, CHU - Hôpital Arnaud-de-Villeneuve, Hôpital Trousseau, Nouvelle clinique de Tours, CH Édouard-Toulouse, Hôpital privé de Marne Chantereine, Clinique Esquirol-Saint-Hilaire, Polyclinique Saint-Roch, Clinique de l’Union, Hôpital de la Conception, Hôpital Edouard-Herriot, Centre Hospitalier des Pyrénées, Centre psychothérapique de Nancy, Clinique mutualiste La Sagesse, Clinique La Croix du Sud, Hôpital Saint-Philibert (GHICL), CH/Clinique, Centre Psychothérapique, Centre Hospitalier d'Erstein, Nouvelle clinique Bel-Air, CHU - Hôpital Lapeyronie, CH Charles-Perrens, CHU de Pointe-à-Pitre, Pôle Santé République, Hôpital Beaujon, Polyclinique de la Baie, Institut d’hématologie et d'oncologie pédiatrique
2025-08-26 18:11:25,864 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:11:25,864 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-26 18:11:25,864 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-26 18:11:25,867 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:25,868 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:25,868 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:25,868 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:25,868 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:25,868 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:25,868 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:26,341 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:30 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'289'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'306'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999677'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_7822c295c01c42518d8deb6383dc414e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549af9587a704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:26,342 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:26,342 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:26,344 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:26,344 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:26,344 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:26,345 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:30 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '289', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '306', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999677', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_7822c295c01c42518d8deb6383dc414e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549af9587a704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:26,345 [DEBUG] openai._base_client: request_id: req_7822c295c01c42518d8deb6383dc414e
2025-08-26 18:11:26,345 [DEBUG] app.utility.llm_helpers: LLM call 'detect_number_institutions' successful: {'prompt_tokens': 310, 'completion_tokens': 1, 'total_tokens': 311}, cost=4.71e-05
2025-08-26 18:11:26,346 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:26,346 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:26,346 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:11:26,346 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:26,348 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:26,349 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:26,349 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:26,349 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:26,349 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:26,350 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:26,350 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:27,474 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:31 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'539'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'701'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_f546edf9927f46399c558962e874f57a'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549afc58ae704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:27,474 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:27,474 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:27,484 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:27,484 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:27,484 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:27,484 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:31 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '539', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '701', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_f546edf9927f46399c558962e874f57a', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549afc58ae704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:27,485 [DEBUG] openai._base_client: request_id: req_f546edf9927f46399c558962e874f57a
2025-08-26 18:11:27,485 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:11:27,486 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:27,486 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:27,486 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:11:27,486 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:11:27,486 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result={'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:11:27,486 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:27,486 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:27,486 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:11:27,486 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:11:27,489 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:27,489 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:27,490 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:27,490 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:27,490 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:27,490 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:27,491 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:28,103 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:32 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'411'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'442'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_d50867233bcf4951a28f3d924a69d763'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549b037be4704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:28,104 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:28,104 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:28,118 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:28,118 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:28,118 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:28,118 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:32 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '411', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '442', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_d50867233bcf4951a28f3d924a69d763', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549b037be4704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:28,118 [DEBUG] openai._base_client: request_id: req_d50867233bcf4951a28f3d924a69d763
2025-08-26 18:11:28,119 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:11:28,119 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:28,119 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:11:28,119 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:11:28,119 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:11:28,119 [ERROR] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: Unexpected exception: 'float' object has no attribute 'get'
2025-08-26 18:11:28,122 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:28,122 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:28,123 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:28,123 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:28,123 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:28,123 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:28,123 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:28,958 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'623'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'656'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_2e75ee157fe641afa18bcf8dbb48c9fa'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549b076ff7704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:28,959 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:28,959 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:28,978 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:28,979 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:28,979 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:28,979 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:33 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '623', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '656', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_2e75ee157fe641afa18bcf8dbb48c9fa', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549b076ff7704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:28,979 [DEBUG] openai._base_client: request_id: req_2e75ee157fe641afa18bcf8dbb48c9fa
2025-08-26 18:11:28,980 [DEBUG] app.utility.llm_helpers: LLM call 'detect_specific_institution' successful: {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, cost=6.375e-05
2025-08-26 18:11:28,980 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Raw LLM response for specific institution detection: {'content': 'aucune correspondance', 'token_usage': {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, 'cost': 6.375e-05}
2025-08-26 18:11:28,980 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-26 18:11:28,980 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-26 18:11:28,980 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-26 18:11:28,982 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:11:28,983 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:11:28,983 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:11:28,983 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:11:28,984 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:11:28,984 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:11:28,984 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:11:29,491 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:11:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'328'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'352'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_228b1bfdc5024366a240ce3be39d6346'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'97549b0ccf47704e-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:11:29,491 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:11:29,491 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:11:29,499 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:11:29,499 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:11:29,500 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:11:29,500 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:11:33 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '328', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '352', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_228b1bfdc5024366a240ce3be39d6346', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '97549b0ccf47704e-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:11:29,500 [DEBUG] openai._base_client: request_id: req_228b1bfdc5024366a240ce3be39d6346
2025-08-26 18:11:29,501 [DEBUG] app.utility.llm_helpers: LLM call 'detect_public_private_preference' successful: {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, cost=3.27e-05
2025-08-26 18:11:29,501 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-26 18:11:29,501 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: consolidated results={'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:11:29,501 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city=None, city_detected=False, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: None
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: False
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-26 18:11:29,501 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-26 18:11:29,531 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:11:29,532 [DEBUG] app.services.data_processing_service: Institution list: Hôpitaux civils, Hôpital privé Armand-Brillard, Hôpital privé de Marne-la-Vallée, CHU - Hôpital Rangueil, Clinique Saint-Hilaire, Clinique Chantecler, Clinique de la Muette, Clinique du Cambrésis, Institut Curie (CLCC), Centre cardiologique du Nord, Polyclinique de Blois, Centre ambulatoire Kleber, Clinique Saint-George, CH privé Saint-Grégoire, CHU - Hôpital Saint-André, Clinique Fontvert, Institut Calot, Polyclinique Majorelle, CHU - Hôpital de la Cavale-Blanche, Clinique Kennedy, CHU - Hôpital Pellegrin, CHU de Nantes, Polyclinique Urbain-V, Clinique Sainte-Anne, Fondation Rothschild, Médipôle Garonne, CHU - Hôpital de la Mère et de l’Enfant, Hôpital Privé Nancy Lorraine, GH Saint-Vincent - Clinique Sainte-Barbe, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Hôpital privé d’Antony, Polyclinique Médipôle Saint-Roch, GHP Ambroise-Paré - Hartmann (92), Clinique du Pont-de-Chaume, Clinique des Ormeaux, Clinique Bretéché, Hôpital privé des Côtes-d’Armor, CHU-Hôpital Purpan/HFE, Clinique Delay, Institut de cancérologie Strasbourg Europe, Hôpital privé La Châtaigneraie, Polyclinique du Maine, Hôpital privé Dijon-Bourgogne, Clinique de la Sauvegarde, CH privé Saint-Martin, Polyclinique Aguilera, Hôpital Ambroise-Paré, CHU - Hôpital Central, Clinique de l’Anjou, Polyclinique Jean-Villar, Polyclinique du Parc-Drevon, Clinique Toulouse-Lautrec, Clinique Durieux, Gustave-Roussy (CLCC), Clinique d’Occitanie, Clinique Anne-Artois, Centre Hospitalier Gérard-Marchant, CHU - Hôpital Morvan, Hôpital privé Clairval, Clinique cardiologique, CHU - Hôpital Charles-Nicolle, CHU - Hôpital Robert-Debré, Groupe Hospitalier de la Rochelle, Polyclinique Saint-Jean, Clinique la Pergola, CHR de Metz-Thionville - Hôpital Bel-Air, Hôpital d'instruction des armées Sainte-Anne, Espm de L’agglomeration Lilloise, Polyclinique de Bordeaux-Tondu, Clinique Saint-Léonard, Hôpital Robert Schuman, Clinique Rhône Durance, Clinique Juge, Polyclinique Côte-Basque-Sud, CHU d'Amiens/Institut ophtalmologique de Picardie, CH national d’ophtalmologie des Quinze-Vingts, Centre Jean-Perrin (CLCC), Centre Hospitalier Les Murets, Polyclinique, Clinique Victor-Pauchet, Médipôle de Savoie, Hôpital Renée-Sabran, Clinique Maussins-Nollet, Clinique mutualiste de Bonneveine, Clinique Saint-Joseph, Institut ophtalmique, Hôpital privé Arras-Les Bonnettes, CHU Nantes - Hôpital Mère Enfant, Hôpital Foch, Hôpital privé Paul-d’Égine, Centre Hospitalier George Sand, Hôpital privé de La Miotte, Clinique Conti, CHU - Hôpitaux mère-enfants, Clinique Notre-Dame-de-l’Espérance, Clinique du Tertre-Rouge, Clinique Louis-Pasteur, Centre Hospitalier Le Bon Sauveur, Clinique Saint-Nabor, Clinique générale, Clinique de l’Espérance, CH Montfavet, CHU - Hôpital Claude-Huriez, Centre de cardiologie du Pays basque, Centre Hospitalier Drôme Vivarais, Hôpital Robert-Debré, EPSM de la Marne, Hôpital d'instruction des armées Bégin, Hôpital Nord Franche-Comté-Belfort, CHU - Hôpital civil, Clinique de Bercy, Clinique Sainte-Marie, Clinique Ambroise-Paré, CH Georges-Daumezon, Clinique Saint-Jean - Sud de France, Hôpital Avicenne, Santé Atlantique, CHU - Hôpital Saint-Eloi, Hôpital privé de Villeneuve-d’Ascq, CHP de l’Europe, Hôpital de la Croix Rousse (HCL) / CH, Polyclinique de Picardie, Clinique du Parc-Monceau, Clinique Saint-Charles, Polyclinique La Ligne bleue, Centre Oscar-Lambret (CLCC), Polyclinique Lyon-Nord, Clinique Rive-Gauche, Polyclinique Vauban, Euromed Cardio, CHU - Hôpital de Hautepierre, Clinique Rhéna, Clinique de Vitrolles (Bouches-du-Rhône), Institut Arthur-Vernes, Institut de cancérologie de l’Ouest, Clinique Belledonne, Hôpital privé Cannes-Oxford, Pôle de Santé du Villeneuvois, CHU - Hôpital Sud, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Polyclinique Les Fleurs, Clinique du Val-d’Or, CHU - Institut cœur-poumon, Centre Clinical, Clinique Belharra, Clinique Pasteur-Lanroze, Institut Arnault-Tzanck, Centre Hospitalier Le Mas Careiron, Clinique des Franciscaines, Hôpital privé de la Seine-Saint-Denis, Hôpital Paris Saint-Joseph, Clinique du Parc, Hôpital privé La Louvière, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Clinique de l’Orangerie, IUCT/Oncopole, Hôpital d'instruction des armées Legouest, CH Saint-Joseph-Saint-Luc, Hôpital privé Pays-de-Savoie, Institut universitaire de la face et du cou, Centre cardiologique, Hôpital privé de l’Ouest parisien, ASM, Polyclinique du Grand-Sud, Clinique ophtalmologique Thiers, Clinique Mutualiste de Bretagne Occidentale, Hôpital privé La Montagne Lambert, Clinique du Trocadéro, Hôpital Hôtel-Dieu, Hôpital de la Timone (Enfants), Institut Paoli-Calmettes (CLCC), Centre Hospitalier Henri Guerin, CHU de Martinique, EPSM Lille-Métropole, Hôpital des Massues, CH/clinique, CM Bénigne-Joly, Hôpital Bichat, Polyclinique Santa-Maria, GHI, CHU - Gabriel-Montpied, Polyclinique Saint-Côme, Clinique Saint-Amé, CHU - Hôpital d’Estaing, CHU Réunion, Clinique de Villeneuve-d’Ascq, Hôpital Louis-Mourier, Centre François-Baclesse (CLCC), Clinique Saint-Vincent, Centre de cardiologie Axium-Rambot, CMC de Parly-II, Hôpital Albert Schweitzer, CHR de Metz-Thionville - Hôpital de Mercy, Polyclinique de Poitiers, CMC Pierre-Cherest, CHU - site Nord, Polyclinique de Courlancy, Hôpitaux Sud, Clinique de la Plaine, Centre Georges-François-Leclerc (CLCC), Clinique de la Part-Dieu, Nouvel Hôpital de Navarre, Clinique du Renaison, Polyclinique de Limoges - site Émailleurs, Hôpital Necker-Enfants-Malades, Institut Curie, Hôpital Henri-Mondor, Hôpital privé de l’Estuaire, Hôpital d'instruction des armées Laveran, CHU - Hôpital Maison-Blanche, Centre de chirurgie ophtalmologique, Clinique Saint-François, Clinique ambulatoire de Domont, CH intercommunal, Hôpital Cochin, Institut mutualiste Montsouris, CMCO Côte d’Opale, Hôpital Pierre-Wertheimer, Hôpital de la Pitié-Salpêtrière, Polyclinique Saint-François, CHU - Hôpital Larrey, EPSM Etienne-Gourmelen, Hôpital privé de la Loire, Clinique urologique Nantes-Atlantis, Grand hôpital de l'Est-Francilien, Clinique du Val-d’Ouest Vendôme, Clinique Saint-Augustin, Clinique Clémentville, Hôpital privé des Peupliers, GH, Hôpitaux pédiatriques, Clinique Saint-André, CHU - Hôpital Trousseau, Clinique de l'Alma, Centre Hospitalier Montperrin, Hôpital privé Nord Parisien, Clinique du Croisé-Laroche, Clinique de l’Atlantique, Les Franciscaines, EPSM Morbihan, Institut du cancer de Montpellier (CLCC), Hôpital de la Timone (adultes), Hôpital privé de Provence, Clinique mutualiste catalane, Clinique du Diaconat-Fonderie, Clinique Axium, CHI, CHU - Hôpital Purpan, Hôpital d'instruction des armées Robert-Picqué, Clinique mutualiste, IUCT Oncopole, Clinique du sport, Centre Hospitalier La Chartreuse, Infirmerie protestante de Lyon, Polyclinique de Navarre, CHU - Hôpital Clocheville, CHU - Hôpital Haut-Lévêque, Centre de la main, Epsan, Clinique Saint-Antoine, Clinique Bizet, Clinique Bouchard, Hôpital privé Drôme-Ardèche, Hôpital Saint-Joseph, CHU de Martinique - site Mère-Enfant, EPS Ville-Évrard, Clinique du Lac et d’Argonay, Hôpital privé du Vert-Galant, Hôpital privé du Confluent, Polyclinique du Parc, Hôpital Belle-Isle, Clinique du Grand-Large, CH Henri-Laborit, GH Paul Guiraud, Hôpital privé Beauregard, Clinique Bon-Secours, Clinique Océane, Centre Antoine-Lacassagne (CLCC), Polyclinique de Kerio, Médipôle Hôpital Privé, Hôpitaux de Saint-Maurice, Pôle santé Léonard-de-Vinci, Clinique Sainte-Clotilde, Hôpital Saint-Vincent-de-Paul (GHICL), CHU - Hôpitaux de Brabois, Clinique Monticelli-Vélodrome, Centre Hospitalier du Rouvray, Polyclinique Saint Laurent, Hôpital privé de la Casamance, CHU - Hôpital de la Côte de nacre, Clinique mutualiste de la Porte-de-l'Orient, Clinique Ormeau Pyrénées, Clinique du Diaconat-Roosevelt, Clinique Jouvenet, CHU - Hôpital Nord, GHU Paris Psychiatrie et neurosciences, GH mutualiste, Clinique Jean le Bon, Centre Léon-Bérard (CLCC), Clinique Remusat, Clinique Geoffroy-Saint-Hilaire, CHU - Hôpital Pontchaillou, Centre Hospitalier de Vauclaire, Clinique Claude-Bernard, CHU de La Réunion - Félix-Guyon, Hôpital Paul-Brousse, Hôpital Lariboisière-Fernand Widal, Polyclinique de Keraudren, CH Guillaume-Régnier, Hôpital Tenon, CHU Grenoble - Site Nord, CHU - Hôpital de l’Archet, Centre Eugène-Marquis (CLCC), Centre Hospitalier Maurice Despinoy, Clinique Victor-Hugo, Hôpital Louis-Pradel, Clinique de l'Essonne, Hôpital européen, Hôpital Lariboisière, Hôpital privé Jean-Mermoz, Clinique de l’Europe, Polyclinique Francheville, Institut Jean-Godinot (CLCC), Polyclinique du Beaujolais, Hôpital privé Paris-Essonne, Polyclinique Bordeaux-Rive droite, Hôpital des Diaconesses, Clinique Saint-Michel, Institut de cancérologie de Lorraine (CLCC), Clinique Saint-Paul, Polyclinique de la Région-Mantaise, Centre Hospitalier Le Vinatier, Hôpital privé de l’Est lyonnais, Hôpital Saint-Antoine, Clinique du Cèdre, Hôpital privé Toulon Hyères-Saint-Jean, Maison de santé Bagatelle, CHU - Centre chirurgical Emile-Gallé, Clinique Les Eaux-Claires, Clinique Honoré-Cave, Clinique Charcot, CHU d’Amiens, CMCO, EPSM de Saône-et-Loire, Clinique Saint-Pierre, CHU - Hôpital Pasteur, Hopital Joseph-Ducuing, Hôpital-clinique Claude-Bernard, Clinique de la Miséricorde, Hôpital Nord, Hôpital privé Saint-Martin, Groupe hospitalier Nord-Essonne, Centre médico-chirurgical et obstétrical, Clinique Les Fontaines, CHU - Hôpital Roger-Salengro, Hôpital Jean-Verdier, CMC Floréal, Clinique Turin, Clinique Convert, Clinique de l’Estrée, Clinique des Orchidées, Hôpital Bicêtre, Polyclinique de Reims-Bezannes, Hôpital Antoine-Béclère, Centre orthopédique médico-chirurgical, Clinique Tivoli-Ducos, Hôtel-Dieu, Clinique Beau-Soleil, Clinique du Fief-de-Grimoire, Hôpital Saint-Camille, Clinique Ormeau centre, Hôpital privé Le Bois, Clinique Pasteur, Clinique Lille-Sud, Clinique Arago, CHU - Hôpital Dupuytren, Hôpital de la Croix-Saint-Simon, Clinique mutualiste Jules-Verne, Clinique Paris Lilas, CHR, CH Basse-Terre (Guadeloupe), Hôpital privé Natecia, Polyclinique Saint-Jean l’Ermitage, Institut Bergonié (CLCC), Polyclinique de Limoges - site Chénieux, CHU Sud-Réunion, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique de l’Yvette, CHU - Hôpital Jeanne-de-Flandre, Hôpital d'instruction des armées Desgenettes, Hôpital de la Timone (enfants), Pôle santé Oréliance, CHU - Hôpital Bretonneau, Clinique Marcel-Sembat, Clinique Sainte-Marie (GHICL), Centre Hospitalier Sainte-Marie, Clinique du Pré, Institut hospitalier Jacques-Cartier, Hôpital Saint-Louis, Hôpital privé Sévigné, Clinique Trenel, CH privé du Montgardé, Clinique des Cèdres, Clinique mutualiste de l’Estuaire, Clinique Jean Causse, CHU - Hôpital Gui-de-Chauliac, Clinique du Millénaire, CH privé Claude-Galien, EPS Barthélemy-Durand, CHU - American Memorial Hospital, Centre médico-chirurgical du Mans, Hôpital européen Georges-Pompidou, HCL - Hôpital Femme-mère-enfant, CH Esquirol, Hôpital privé, Clinique Saint-Jean-de-Dieu, CHU - Maternité, Hôpitaux Nord (Croix-Rousse), Institut franco-britannique Kléber, Hôpital Raymond-Poincaré, CH Lyon-Sud, Clinique Saint-Vincent-de-Paul, CHU Grenoble - Hôpital Sud, Polyclinique de Reims-Bezannes (Marne), Hôpital Corentin-Celton, Hôpital privé Vert-Coteau, Centre Henri-Becquerel (CLCC), Hôpital d'instruction des armées Percy, Clinique Mathilde, GCS Clinique du Ter, CHU - Hôpital Arnaud-de-Villeneuve, Hôpital Trousseau, Nouvelle clinique de Tours, CH Édouard-Toulouse, Hôpital privé de Marne Chantereine, Clinique Esquirol-Saint-Hilaire, Polyclinique Saint-Roch, Clinique de l’Union, Hôpital de la Conception, Hôpital Edouard-Herriot, Centre Hospitalier des Pyrénées, Centre psychothérapique de Nancy, Clinique mutualiste La Sagesse, Clinique La Croix du Sud, Hôpital Saint-Philibert (GHICL), CH/Clinique, Centre Psychothérapique, Centre Hospitalier d'Erstein, Nouvelle clinique Bel-Air, CHU - Hôpital Lapeyronie, CH Charles-Perrens, CHU de Pointe-à-Pitre, Pôle Santé République, Hôpital Beaujon, Polyclinique de la Baie, Institut d’hématologie et d'oncologie pédiatrique
2025-08-26 18:11:29,533 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-26 18:11:29,691 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-26 18:11:29,691 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-26 18:11:29,691 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-26 18:11:29,691 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: None
2025-08-26 18:11:29,692 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: False
2025-08-26 18:11:29,692 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-26 18:11:29,692 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-26 18:11:29,692 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-26 18:11:29,692 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-26 18:11:29,692 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: None, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-26 18:11:29,692 [INFO] app.services.data_processing_service: generate_data_response called
2025-08-26 18:11:29,692 [DEBUG] app.services.data_processing_service: Extracted values - specialty: 'Cancer de la vessie', institution_type: 'aucune correspondance', city: 'None'
2025-08-26 18:11:29,692 [DEBUG] app.services.data_processing_service: No institution type match found, loading by specialty only
2025-08-26 18:11:29,692 [INFO] app.services.data_processing_service: Filtering ranking by criteria: specialty='Cancer de la vessie', institution_type='None'
2025-08-26 18:11:29,692 [DEBUG] app.services.data_processing_service: Filtering ranking data - specialty: 'Cancer de la vessie', institution_type: 'None'
2025-08-26 18:11:29,692 [DEBUG] app.services.data_processing_service: Specialty type: <class 'str'>, length: 19
2025-08-26 18:11:29,694 [DEBUG] app.services.data_processing_service: Available specialties in ranking data: ['Ablation des varices' 'Accidents vasculaires cérébraux'
 'Accouchements à risques' 'Accouchements normaux'
 'Adénome de la prostate' 'Amygdales et végétations'
 'Angioplastie coronaire' 'Appendicite' 'Arthrose de la main' 'Audition'
 'Calculs urinaires' "Cancer de l'estomac et de l'œsophage"
 "Cancer de l'ovaire" "Cancer de l'utérus" 'Cancer de la prostate'
 'Cancer de la thyroïde' 'Cancer de la vessie'
 "Cancer des os de l'enfant et de l'adolescent"
 "Cancer du colon ou de l'intestin" 'Cancer du foie' 'Cancer du pancréas'
 'Cancer du poumon' 'Cancer du rein' 'Cancer du sein' 'Cancer ORL'
 'Cancers de la peau' 'Cardiologie interventionnelle' 'Cataracte'
 'Chirurgie cardiaque adulte' 'Chirurgie cardiaque pédiatrique'
 "Chirurgie de l'épaule" "Chirurgie de l'obésité"
 'Chirurgie de la cheville' 'Chirurgie de la cornée'
 'Chirurgie dentaire et orale de l’adulte'
 'Chirurgie dentaire et orale de l’enfant et de l’adolescent'
 'Chirurgie des artères' "Chirurgie des cancers osseux de l'adulte"
 'Chirurgie des carotides' 'Chirurgie des sarcomes des tissus mous'
 "Chirurgie des testicules de l'adulte"
 "Chirurgie des testicules de l'enfant et de l'adolescent"
 'Chirurgie du canal carpien' "Chirurgie du dos de l'adulte"
 "Chirurgie du dos de l'enfant et de l'adolescent"
 'Chirurgie du nez et des sinus' 'Chirurgie du pied' 'Chirurgie du rectum'
 'Chirurgie maxillo-faciale' 'Dépression' "Diabète de l'adulte"
 "Diabète de l'enfant et de l'adolescent" 'Endométriose'
 "Epilepsie de l'adulte" "Epilepsie de l'enfant et de l'adolescent"
 'Fibrome utérin' 'Glandes salivaires' 'Glaucome' "Hernies de l'abdomen"
 'Hypertension artérielle' 'Infarctus du myocarde'
 'Insuffisance cardiaque' "Leucémie de l'adulte"
 "Leucémie de l'enfant et de l'adolescent" 'Ligaments du genou'
 "Lymphome-Myélome de l'adulte" 'Maladie de Parkinson'
 "Maladies inflammatoires chroniques de l'intestin (MICI)"
 'Médecine vasculaire' 'Pneumologie' 'Proctologie' 'Prothèse de genou'
 'Prothèse de hanche' 'Rétine' 'Schizophrénie' 'Sclérose en plaques'
 'Stimulateurs cardiaques' 'Strabisme'
 'Stress post-traumatique de l’adulte' 'Troubles bipolaires'
 "Tumeurs du cerveau de l'adulte"
 "Tumeurs du cerveau de l'enfant et de l'adolescent" 'Urgences de la main'
 'Vésicule biliaire']
2025-08-26 18:11:29,695 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-26 18:11:29,695 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-26 18:11:29,695 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-26 18:11:29,695 [DEBUG] app.services.data_processing_service: Normalizing string: Accidents vasculaires cérébraux
2025-08-26 18:11:29,695 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements à risques
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements normaux
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-26 18:11:29,696 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'estomac et de l'œsophage
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer des os de l'enfant et de l'adolescent
2025-08-26 18:11:29,697 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du foie
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du pancréas
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cancers de la peau
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-26 18:11:29,698 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque pédiatrique
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-26 18:11:29,699 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des cancers osseux de l'adulte
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des sarcomes des tissus mous
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-26 18:11:29,700 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'enfant et de l'adolescent
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du rectum
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Dépression
2025-08-26 18:11:29,701 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'adulte
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'enfant et de l'adolescent
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'adulte
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'enfant et de l'adolescent
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-26 18:11:29,702 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Hypertension artérielle
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Insuffisance cardiaque
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'adulte
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'enfant et de l'adolescent
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Lymphome-Myélome de l'adulte
2025-08-26 18:11:29,703 [DEBUG] app.services.data_processing_service: Normalizing string: Maladie de Parkinson
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Maladies inflammatoires chroniques de l'intestin (MICI)
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Médecine vasculaire
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Schizophrénie
2025-08-26 18:11:29,704 [DEBUG] app.services.data_processing_service: Normalizing string: Sclérose en plaques
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Stress post-traumatique de l’adulte
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Troubles bipolaires
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'adulte
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'enfant et de l'adolescent
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-26 18:11:29,705 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-26 18:11:29,707 [DEBUG] app.services.data_processing_service: Normalized specialties in DataFrame: ["'ablation des varices'", "'accidents vasculaires cerebraux'", "'accouchements a risques'", "'accouchements normaux'", "'adenome de la prostate'", "'amygdales et vegetations'", "'angioplastie coronaire'", "'appendicite'", "'arthrose de la main'", "'audition'", "'calculs urinaires'", '"cancer de l\'estomac et de l\'œsophage"', '"cancer de l\'ovaire"', '"cancer de l\'uterus"', "'cancer de la prostate'", "'cancer de la thyroide'", "'cancer de la vessie'", '"cancer des os de l\'enfant et de l\'adolescent"', '"cancer du colon ou de l\'intestin"', "'cancer du foie'", "'cancer du pancreas'", "'cancer du poumon'", "'cancer du rein'", "'cancer du sein'", "'cancer orl'", "'cancers de la peau'", "'cardiologie interventionnelle'", "'cataracte'", "'chirurgie cardiaque adulte'", "'chirurgie cardiaque pediatrique'", '"chirurgie de l\'epaule"', '"chirurgie de l\'obesite"', "'chirurgie de la cheville'", "'chirurgie de la cornee'", "'chirurgie dentaire et orale de l’adulte'", "'chirurgie dentaire et orale de l’enfant et de l’adolescent'", "'chirurgie des arteres'", '"chirurgie des cancers osseux de l\'adulte"', "'chirurgie des carotides'", "'chirurgie des sarcomes des tissus mous'", '"chirurgie des testicules de l\'adulte"', '"chirurgie des testicules de l\'enfant et de l\'adolescent"', "'chirurgie du canal carpien'", '"chirurgie du dos de l\'adulte"', '"chirurgie du dos de l\'enfant et de l\'adolescent"', "'chirurgie du nez et des sinus'", "'chirurgie du pied'", "'chirurgie du rectum'", "'chirurgie maxillo-faciale'", "'depression'", '"diabete de l\'adulte"', '"diabete de l\'enfant et de l\'adolescent"', "'endometriose'", '"epilepsie de l\'adulte"', '"epilepsie de l\'enfant et de l\'adolescent"', "'fibrome uterin'", "'glandes salivaires'", "'glaucome'", '"hernies de l\'abdomen"', "'hypertension arterielle'", "'infarctus du myocarde'", "'insuffisance cardiaque'", '"leucemie de l\'adulte"', '"leucemie de l\'enfant et de l\'adolescent"', "'ligaments du genou'", '"lymphome-myelome de l\'adulte"', "'maladie de parkinson'", '"maladies inflammatoires chroniques de l\'intestin (mici)"', "'medecine vasculaire'", "'pneumologie'", "'proctologie'", "'prothese de genou'", "'prothese de hanche'", "'retine'", "'schizophrenie'", "'sclerose en plaques'", "'stimulateurs cardiaques'", "'strabisme'", "'stress post-traumatique de l’adulte'", "'troubles bipolaires'", '"tumeurs du cerveau de l\'adulte"', '"tumeurs du cerveau de l\'enfant et de l\'adolescent"', "'urgences de la main'", "'vesicule biliaire'"]
2025-08-26 18:11:29,708 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-26 18:11:29,708 [DEBUG] app.services.data_processing_service: Normalized specialty from query: ''cancer de la vessie''
2025-08-26 18:11:29,712 [DEBUG] app.services.data_processing_service: Found 2 rows matching single specialty 'Cancer de la vessie' (normalized: 'cancer de la vessie')
2025-08-26 18:11:29,712 [DEBUG] app.services.data_processing_service: Specialties found after specialty filtering: ['Cancer de la vessie']
2025-08-26 18:11:29,712 [INFO] app.services.data_processing_service: generate_response_links called with matching_rows: <class 'pandas.core.frame.DataFrame'>
2025-08-26 18:11:29,712 [INFO] app.services.data_processing_service: Generating ranking links
2025-08-26 18:11:29,712 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-26 18:11:29,712 [DEBUG] app.services.data_processing_service: Generating links for 2 matching rows
2025-08-26 18:11:29,714 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Public
2025-08-26 18:11:29,714 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'public'
2025-08-26 18:11:29,714 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Privé
2025-08-26 18:11:29,714 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'prive'
2025-08-26 18:11:29,714 [INFO] app.services.data_processing_service: Generated ranking links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-26 18:11:29,715 [INFO] app.services.data_processing_service: load_excel_sheets called with matching_rows of length: 2
2025-08-26 18:11:29,715 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Public' for category: 'Public'
2025-08-26 18:11:29,879 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Public' loaded successfully with 40 rows
2025-08-26 18:11:29,879 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Privé' for category: 'Privé'
2025-08-26 18:11:30,053 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Privé' loaded successfully with 20 rows
2025-08-26 18:11:30,053 [DEBUG] app.services.data_processing_service: Concatenating 2 dataframes
2025-08-26 18:11:30,055 [INFO] app.services.data_processing_service: Successfully loaded 2 sheets, total rows: 60
2025-08-26 18:11:30,055 [INFO] app.services.data_processing_service: Loaded specialty DataFrame
2025-08-26 18:11:30,055 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique specialties in DataFrame: N/A
2025-08-26 18:11:30,055 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique institution types in DataFrame: ['Public' 'Privé']
2025-08-26 18:11:30,056 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame columns: Index(['Rang', 'Etablissement', 'Finess', 'ACTIVITE', 'NOTORIETE', 'DMS',
       'RATIO_AMBU', 'INDICE_LOURDEUR', 'TX_ENDOSCOPIE', 'PRADO', 'Note / 20',
       'Catégorie'],
      dtype='object')
2025-08-26 18:11:30,072 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame head:    Rang                                      Etablissement     Finess  ACTIVITE  NOTORIETE   DMS  RATIO_AMBU  INDICE_LOURDEUR  TX_ENDOSCOPIE  PRADO  Note / 20 Catégorie
0     1         Institut mutualiste Montsouris, Paris (75)  750150104       254      71.65  4.80        0.39            43.38          91.73    1.0      18.63    Public
1     2                        Hôpital Foch, Suresnes (92)  920000650       373      58.71  5.70        5.36            42.19          79.89    1.0      18.50    Public
2     3                    Hôpital Saint-Louis, Paris (75)  750100075       310      43.23  4.42        9.35            37.68          93.87    1.0      18.27    Public
3     4      Hôpital européen Georges-Pompidou, Paris (75)  750803447       273      60.44  4.24        0.73            38.19          90.11    1.0      18.26    Public
4     5               Hôpital Robert Schuman, Vantoux (57)  570026252       263      17.11  4.62       12.93            41.16          96.96    1.0      18.25    Public
5     6  Clinique mutualiste de la Porte-de-l'Orient, L...  560002933       249      19.28  3.10        4.82            37.87          94.78    1.0      18.25    Public
6     7             CHU - Hôpital Pellegrin, Bordeaux (33)  330781360       220      23.64  5.48        2.73            47.08          85.00    1.0      18.19    Public
7     8                   Hôpital européen, Marseille (13)  130043664       266       7.89  5.58        0.75            39.96          90.98    1.0      17.91    Public
8     9         CHU - Hôpital Lapeyronie, Montpellier (34)  340785161       219      34.70  5.49        0.00            45.66          87.21    1.0      17.90    Public
9    10             Hôpital Paris Saint-Joseph, Paris (75)  750000523       255      56.08  3.79        0.00            36.76          92.55    1.0      17.84    Public
2025-08-26 18:11:30,072 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Filtering for specialty: 'Cancer de la vessie' and city: 'None'
2025-08-26 18:11:30,072 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Specialty match count: N/A
2025-08-26 18:11:30,072 [INFO] app.services.pipeline_orchestrator_service: No city detected, returning general ranking DataFrame
2025-08-26 18:11:30,072 [DEBUG] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned DataFrame: <class 'pandas.core.frame.DataFrame'>
2025-08-26 18:11:30,072 [DEBUG] app.services.pipeline_orchestrator_service: Checking if DataFrame is None
2025-08-26 18:11:30,073 [DEBUG] app.services.pipeline_orchestrator_service: Retrieved DataFrame shape: (60, 12)
2025-08-26 18:11:30,073 [DEBUG] app.services.pipeline_orchestrator_service: Checking for geolocation API errors
2025-08-26 18:11:30,073 [DEBUG] app.services.pipeline_orchestrator_service: Getting ranking link for UI
2025-08-26 18:11:30,073 [DEBUG] app.services.pipeline_orchestrator_service: Checking for specialty_ranking_unavailable
2025-08-26 18:11:30,073 [DEBUG] app.services.pipeline_orchestrator_service: Checking if institution is mentioned
2025-08-26 18:11:30,073 [DEBUG] app.services.pipeline_orchestrator_service: Checking if city is detected
2025-08-26 18:11:30,073 [INFO] app.services.pipeline_orchestrator_service: No city detected, returning general ranking
2025-08-26 18:11:30,078 [DEBUG] app.services.pipeline_orchestrator_service: Formatted response string: Voici les établissements privés :<br>Clinique Saint-Augustin, Bordeaux (33): Un établissement Privé. avec une note de 18.39 de 20<br>Polyclinique Médipôle Saint-Roch, Cabestany (66): Un établissement Privé. avec une note de 18.37 de 20<br>Hôpital privé de Provence, Aix-en-Provence (13): Un établissement Privé. avec une note de 18.34 de 20<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public. avec une note de 18.27 de 20
2025-08-26 18:11:30,078 [DEBUG] app.services.pipeline_orchestrator_service: Normalizing specialty for display: Cancer de la vessie
2025-08-26 18:11:30,078 [DEBUG] app.services.pipeline_orchestrator_service: Display specialty: Cancer de la vessie, is_no_match: False
2025-08-26 18:11:30,078 [DEBUG] app.services.pipeline_orchestrator_service: Result: Voici les 3 meilleurs établissements pour la pathologie Cancer de la vessie<br> 
Voici les établissements privés :<br>Clinique Saint-Augustin, Bordeaux (33): Un établissement Privé. avec une note de 18.39 de 20<br>Polyclinique Médipôle Saint-Roch, Cabestany (66): Un établissement Privé. avec une note de 18.37 de 20<br>Hôpital privé de Provence, Aix-en-Provence (13): Un établissement Privé. avec une note de 18.34 de 20<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public. avec une note de 18.27 de 20, Links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-26 18:11:30,078 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 2
2025-08-26 18:17:05,399 [INFO] app.api.routes: Initializing core services...
2025-08-26 18:17:05,400 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 18:17:05,400 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 18:17:05,400 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 18:17:05,400 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 18:17:05,401 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 18:17:05,402 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 18:17:05,402 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 18:17:05,504 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 18:17:05,504 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 18:17:05,505 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 18:17:05,514 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:17:05,514 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:17:05,722 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 18:17:05,723 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 18:17:05,723 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 18:17:05,723 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 18:17:05,724 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 18:17:05,724 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 18:17:05,800 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 18:17:05,800 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 18:17:05,801 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 18:17:05,803 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:17:05,804 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:17:05,804 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:17:05,804 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:17:05,804 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 18:17:05,806 [INFO] main: Creating FastAPI app
2025-08-26 18:17:05,807 [INFO] main: CORS middleware added
2025-08-26 18:17:05,808 [INFO] main: API router included
2025-08-26 18:17:13,580 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars
2025-08-26 18:17:13,580 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: None
2025-08-26 18:17:13,580 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-26 18:17:13,580 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=['conversation_limit', 'message_length', 'message_pertinence']
2025-08-26 18:17:13,580 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-26 18:17:13,586 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:13,613 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:13,613 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-26 18:17:13,652 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x119ff1e80>
2025-08-26 18:17:13,652 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11965ba40> server_hostname='api.openai.com' timeout=None
2025-08-26 18:17:13,685 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x119fd8190>
2025-08-26 18:17:13,686 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:13,686 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:13,686 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:13,686 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:13,686 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:14,826 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'814'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'972'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_cc034128c6ef44c49bd1b895b6b68aca'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=6DHrLfPMLeDY5QxzG161SaeyGtXEsxc2xf9GVciTGMI-1756225039-1.0.1.1-GRd1dzWSxGvzdhIlbDCVa5dS9sI4tpOkIlfD2xdzeGuJnsF3.PCQ2qqJOMqAtwF4GK_ie3vO2kggF9kBgXgowKpMMS.dmOOvWgUmM84XWO8; path=/; expires=Tue, 26-Aug-25 16:47:19 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=uigcrrXNvdawtaZk4HDBrXAasGS6gXi0DMPJ3gky6WQ-1756225039104-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3775f18e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:14,827 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:14,827 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:14,831 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:14,831 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:14,831 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:14,831 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Tue, 26 Aug 2025 16:17:19 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '814'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '972'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_cc034128c6ef44c49bd1b895b6b68aca'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=6DHrLfPMLeDY5QxzG161SaeyGtXEsxc2xf9GVciTGMI-1756225039-1.0.1.1-GRd1dzWSxGvzdhIlbDCVa5dS9sI4tpOkIlfD2xdzeGuJnsF3.PCQ2qqJOMqAtwF4GK_ie3vO2kggF9kBgXgowKpMMS.dmOOvWgUmM84XWO8; path=/; expires=Tue, 26-Aug-25 16:47:19 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=uigcrrXNvdawtaZk4HDBrXAasGS6gXi0DMPJ3gky6WQ-1756225039104-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '9754a3775f18e1b5-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-26 18:17:14,832 [DEBUG] openai._base_client: request_id: req_cc034128c6ef44c49bd1b895b6b68aca
2025-08-26 18:17:14,840 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_medical_pertinence' successful: {'prompt_tokens': 1112, 'completion_tokens': 1, 'total_tokens': 1113}, cost=0.00016739999999999998
2025-08-26 18:17:14,840 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-26 18:17:14,840 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-26 18:17:14,840 [DEBUG] app.features.sanity_checks.message_pertinence_check: medical_pertinence_result: {'result': 1, 'cost': 0.00016739999999999998, 'token_usage': 1113}
2025-08-26 18:17:14,840 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-26 18:17:14,844 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:14,845 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:14,845 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:14,845 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:14,845 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:14,846 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:14,846 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:15,614 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'575'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'595'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999168'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_d103fc117a054d27a880e4cc1eb280eb'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a37e9ac3e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:15,614 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:15,615 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:15,619 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:15,620 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:15,620 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:15,620 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:19 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '575', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '595', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999168', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_d103fc117a054d27a880e4cc1eb280eb', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a37e9ac3e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:15,621 [DEBUG] openai._base_client: request_id: req_d103fc117a054d27a880e4cc1eb280eb
2025-08-26 18:17:15,622 [DEBUG] app.utility.llm_helpers: LLM call 'sanity_check_chatbot_pertinence' successful: {'prompt_tokens': 810, 'completion_tokens': 1, 'total_tokens': 811}, cost=0.00012209999999999999
2025-08-26 18:17:15,622 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-26 18:17:15,622 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-26 18:17:15,622 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: Sanity check results: {'conversation_limit': {'passed': True}, 'message_length': {'passed': True}, 'message_pertinence': {'passed': True, 'cost': 0.00028949999999999994, 'token_usage': 1924}, 'passed': True, 'total_cost': 0.00028949999999999994, 'total_token_usage': 1924}
2025-08-26 18:17:15,622 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history=''
2025-08-26 18:17:15,623 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-26 18:17:15,623 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-26 18:17:15,623 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-26 18:17:15,623 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-26 18:17:15,788 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:17:15,789 [DEBUG] app.services.data_processing_service: Institution list: Clinique de l'Essonne, IUCT/Oncopole, Hôpital privé La Louvière, CHR de Metz-Thionville - Hôpital de Mercy, Clinique du Tertre-Rouge, Centre Hospitalier Henri Guerin, CHU de Pointe-à-Pitre, Clinique du Cèdre, Clinique Geoffroy-Saint-Hilaire, Clinique la Pergola, Hôpital de la Pitié-Salpêtrière, Clinique Louis-Pasteur, Polyclinique du Beaujolais, CMCO Côte d’Opale, Clinique Saint-Jean - Sud de France, Hôpital Beaujon, CHU Sud-Réunion, Institut Calot, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical du Mans, Polyclinique Médipôle Saint-Roch, Institut Curie (CLCC), Hôpital privé du Confluent, Polyclinique Côte-Basque-Sud, Clinique du Trocadéro, Polyclinique Lyon-Nord, Hôpital privé Cannes-Oxford, Médipôle Hôpital Privé, Polyclinique Saint Laurent, Institut de cancérologie de l’Ouest, CHU Grenoble - Hôpital Sud, CHU - Hôpital Pellegrin, Hôpital Privé Nancy Lorraine, Clinique Ormeau centre, CHU - Hôpital Charles-Nicolle, Groupe Hospitalier de la Rochelle, Clinique de l’Orangerie, Clinique du Cambrésis, Groupe hospitalier Nord-Essonne, Médipôle de Savoie, CHU - Hôpital Clocheville, Polyclinique de Keraudren, Hôpital privé Beauregard, Gustave-Roussy (CLCC), Clinique Kennedy, Polyclinique Vauban, Polyclinique du Maine, Clinique de la Muette, Clinique Bretéché, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique de l’Estrée, Clinique Saint-Augustin, Espm de L’agglomeration Lilloise, Clinique du Diaconat-Roosevelt, CHU - American Memorial Hospital, CHU - Hôpital Claude-Huriez, Hôpital Belle-Isle, CHU - Hôpital Trousseau, Hôpital Pierre-Wertheimer, CM Bénigne-Joly, Institut mutualiste Montsouris, Clinique de la Sauvegarde, Clinique de l’Yvette, CMC de Parly-II, CHU d’Amiens, CHU de Martinique - site Mère-Enfant, Clinique Fontvert, Clinique Delay, Clinique Monticelli-Vélodrome, Hôpital privé Drôme-Ardèche, Clinique Arago, Centre cardiologique, Polyclinique de Navarre, CH Georges-Daumezon, Hôpital Bicêtre, Clinique mutualiste, Clinique Trenel, Clinique Saint-Hilaire, CH Henri-Laborit, Centre Antoine-Lacassagne (CLCC), Clinique Jean Causse, CHU - Hôpital Larrey, Hôpital privé Paris-Essonne, Clinique Sainte-Marie, Clinique des Franciscaines, Polyclinique de Reims-Bezannes (Marne), Infirmerie protestante de Lyon, CHR de Metz-Thionville - Hôpital Bel-Air, Institut Curie, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Polyclinique de la Baie, CHU Grenoble - Site Nord, CHU - Hôpital Lapeyronie, Hôpital privé de Villeneuve-d’Ascq, Centre orthopédique médico-chirurgical, Hôpital Robert Schuman, Hôpital privé Natecia, Clinique Bouchard, CHU - Hôpital Haut-Lévêque, Clinique Rhône Durance, Polyclinique de Blois, Hôpital Saint-Louis, CHU - Hôpital d’Estaing, CHU Nantes - Hôpital Mère Enfant, Clinique Belledonne, CH privé du Montgardé, Hôpital Renée-Sabran, Clinique Les Fontaines, Clinique du sport, Clinique Saint-Charles, Maison de santé Bagatelle, Clinique ambulatoire de Domont, Polyclinique Majorelle, Pôle santé Léonard-de-Vinci, Centre ambulatoire Kleber, Clinique de la Part-Dieu, CH Montfavet, CH Charles-Perrens, HCL - Hôpital Femme-mère-enfant, CHU - Hôpital Central, Clinique du Grand-Large, CHU - Centre chirurgical Emile-Gallé, Centre Hospitalier Gérard-Marchant, Hôpital Jean-Verdier, Hôtel-Dieu, Hôpital privé Vert-Coteau, CHU - Hôpital Jeanne-de-Flandre, CMC Floréal, Hôpital d'instruction des armées Legouest, Hôpital privé de Marne-la-Vallée, Clinique de l’Europe, Hôpital Henri-Mondor, Polyclinique de la Région-Mantaise, Pôle de Santé du Villeneuvois, CHU - Gabriel-Montpied, Clinique Bizet, Hôpital d'instruction des armées Sainte-Anne, Clinique Ambroise-Paré, Clinique Saint-Nabor, Institut de cancérologie de Lorraine (CLCC), Clinique du Pré, Polyclinique de Limoges - site Émailleurs, Hôpital Louis-Mourier, Hôpital d'instruction des armées Desgenettes, Institut universitaire de la face et du cou, EPS Ville-Évrard, Centre Henri-Becquerel (CLCC), Hôpital de la Timone (adultes), Hôpital privé La Châtaigneraie, Centre Hospitalier des Pyrénées, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Pasteur, Hôpitaux civils, Clinique Saint-Jean-de-Dieu, CHU d'Amiens/Institut ophtalmologique de Picardie, Centre Hospitalier de Vauclaire, Clinique ophtalmologique Thiers, Clinique mutualiste de la Porte-de-l'Orient, Clinique Sainte-Marie (GHICL), Hôpital Louis-Pradel, CH national d’ophtalmologie des Quinze-Vingts, Centre psychothérapique de Nancy, Clinique Saint-Vincent-de-Paul, Clinique de la Miséricorde, Hôpital privé de Marne Chantereine, CH privé Claude-Galien, Clinique des Cèdres, GHU Paris Psychiatrie et neurosciences, Clinique Notre-Dame-de-l’Espérance, Centre Georges-François-Leclerc (CLCC), Clinique du Parc, Clinique Saint-Amé, Clinique urologique Nantes-Atlantis, Hôpital Avicenne, Polyclinique de Picardie, Clinique Toulouse-Lautrec, Santé Atlantique, Hôpital privé Arras-Les Bonnettes, Hôpital privé Jean-Mermoz, Clinique de l’Espérance, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Les Fleurs, EPSM Etienne-Gourmelen, CHU - Hôpital Saint-André, Euromed Cardio, Médipôle Garonne, Pôle santé Oréliance, Hôpital Nord Franche-Comté-Belfort, Polyclinique Francheville, CHU - Hôpital de Hautepierre, CH Basse-Terre (Guadeloupe), Hôpital privé Le Bois, Clinique Pasteur-Lanroze, EPSM Lille-Métropole, Institut de cancérologie Strasbourg Europe, Clinique mutualiste catalane, CHU - Hôpital Morvan, Clinique mutualiste de l’Estuaire, Clinique cardiologique, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, CHU Réunion, Hôpital privé des Peupliers, Centre médico-chirurgical et obstétrical, Clinique Sainte-Anne, Polyclinique de Poitiers, Clinique Saint-André, Hôpital Bichat, Clinique du Millénaire, CHU - Hôpital Maison-Blanche, Centre Hospitalier du Rouvray, Centre cardiologique du Nord, Centre Eugène-Marquis (CLCC), Clinique Saint-Paul, Hôpital privé Saint-Martin, Centre Hospitalier Maurice Despinoy, Hôpital de la Timone (enfants), Clinique Saint-Antoine, Hôpital Saint-Philibert (GHICL), Clinique Saint-Vincent, Hôpital privé, Clinique mutualiste de Bonneveine, Clinique de l'Alma, GHP Ambroise-Paré - Hartmann (92), Clinique Lille-Sud, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Paris Lilas, Centre Oscar-Lambret (CLCC), CHU - Maternité, Polyclinique de Bordeaux-Tondu, Clinique générale, Hôpital privé d’Antony, CHP de l’Europe, Hôpital privé Armand-Brillard, GHI, CMC Pierre-Cherest, Clinique du Fief-de-Grimoire, Hôpital privé de l’Estuaire, Hôpital privé de l’Ouest parisien, Hôpital privé de la Loire, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital de la Croix Rousse (HCL) / CH, Epsan, Clinique Mathilde, Clinique du Val-d’Or, Clinique des Orchidées, CHR, Hôpital Raymond-Poincaré, Centre Hospitalier Le Mas Careiron, Hôpital Hôtel-Dieu, Centre Hospitalier Le Bon Sauveur, Clinique Convert, Polyclinique Urbain-V, CH/Clinique, CHU - Hôpital Robert-Debré, Hôpital Lariboisière, Clinique du Croisé-Laroche, CHU - Hôpital Pontchaillou, Polyclinique de Courlancy, Clinique Victor-Hugo, Clinique Bon-Secours, Hôpital privé Sévigné, Clinique Charcot, CHI, Clinique Saint-Pierre, EPS Barthélemy-Durand, Hôpital de la Timone (Enfants), Hôpital privé de la Seine-Saint-Denis, Les Franciscaines, Centre Hospitalier La Chartreuse, Hôpital privé des Côtes-d’Armor, Centre Hospitalier Drôme Vivarais, CHU - Hôpital Sud, Hôpital Robert-Debré, Clinique de Bercy, CHU de La Réunion - Félix-Guyon, Centre Hospitalier Le Vinatier, Hôpital privé Dijon-Bourgogne, Hôpital Saint-Camille, CH Esquirol, Centre de chirurgie ophtalmologique, Hôpital d'instruction des armées Percy, Centre Hospitalier Montperrin, Hôpital Antoine-Béclère, CHU - Hôpital Purpan, Clinique de l’Atlantique, Clinique du Renaison, Clinique de l’Anjou, Hôpital d'instruction des armées Laveran, Hôpitaux pédiatriques, CHU - Hôpital de la Côte de nacre, Hopital Joseph-Ducuing, Polyclinique Saint-François, Hôpital privé Pays-de-Savoie, Clinique Saint-Joseph, Clinique d’Occitanie, Institut Paoli-Calmettes (CLCC), Institut franco-britannique Kléber, Hôpital privé de l’Est lyonnais, Hôpital Saint-Joseph, Clinique Juge, Clinique des Ormeaux, Hôpitaux de Saint-Maurice, Clinique Jouvenet, GH Saint-Vincent - Clinique Sainte-Barbe, CH privé Saint-Martin, CHU - Hôpitaux de Brabois, Polyclinique du Parc-Drevon, CHU - Hôpital Gui-de-Chauliac, Institut Jean-Godinot (CLCC), CHU - Hôpitaux mère-enfants, Institut hospitalier Jacques-Cartier, Hôpital d'instruction des armées Bégin, Clinique Anne-Artois, Polyclinique de Limoges - site Chénieux, Centre Hospitalier George Sand, Clinique Axium, Hôpital privé de la Casamance, Clinique du Val-d’Ouest Vendôme, Clinique Esquirol-Saint-Hilaire, Hôpital de la Conception, Hôpital privé Clairval, Hôpital Foch, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Turin, Clinique Saint-François, Hôpital privé de La Miotte, GH mutualiste, Hôpital Corentin-Celton, CHU - Hôpital Roger-Salengro, Clinique Clémentville, CHU de Martinique, Clinique Belharra, Polyclinique Bordeaux-Rive droite, Clinique Tivoli-Ducos, GCS Clinique du Ter, Polyclinique Santa-Maria, IUCT Oncopole, EPSM de Saône-et-Loire, Hôpitaux Sud, Hôpital Necker-Enfants-Malades, Clinique du Diaconat-Fonderie, CH Lyon-Sud, Centre de la main, Clinique Saint-Léonard, Hôpital européen, CHU - Hôpital Bretonneau, Hôpital européen Georges-Pompidou, Polyclinique Aguilera, ASM, Hôpital des Massues, Hôpital privé du Vert-Galant, Centre Hospitalier d'Erstein, CHU - site Nord, Grand hôpital de l'Est-Francilien, Hôpital Ambroise-Paré, CHU - Hôpital civil, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital Nord, Clinique de la Plaine, Clinique du Parc-Monceau, Hôpital d'instruction des armées Robert-Picqué, CHU de Nantes, Centre de cardiologie du Pays basque, Clinique Rhéna, Centre Hospitalier Les Murets, Nouvelle clinique Bel-Air, Clinique Beau-Soleil, CH privé Saint-Grégoire, Hôpital Lariboisière-Fernand Widal, Centre Léon-Bérard (CLCC), Hôpital-clinique Claude-Bernard, CH Édouard-Toulouse, Institut Arnault-Tzanck, Clinique Chantecler, Centre Jean-Perrin (CLCC), Clinique de Villeneuve-d’Ascq, Hôpital Cochin, Clinique Conti, Hôpital Paris Saint-Joseph, Polyclinique du Grand-Sud, Clinique mutualiste Jules-Verne, Clinique Ormeau Pyrénées, Hôpital des Diaconesses, Clinique Saint-George, EPSM de la Marne, CH/clinique, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique La Ligne bleue, CHU - Institut cœur-poumon, Polyclinique de Reims-Bezannes, Polyclinique du Parc, Centre Clinical, Clinique du Lac et d’Argonay, CHU-Hôpital Purpan/HFE, Clinique Claude-Bernard, Clinique du Pont-de-Chaume, EPSM Morbihan, CMCO, Clinique de l’Union, CH Guillaume-Régnier, Polyclinique Saint-Côme, CHU - Hôpital Dupuytren, Hôpital Albert Schweitzer, Polyclinique Saint-Jean, Clinique Saint-Michel, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôpital privé La Montagne Lambert, Clinique Océane, Hôpital privé Nord Parisien, CHU - Hôpital de la Cavale-Blanche, Polyclinique Saint-Roch, CHU - Hôpital Nord, Nouvel Hôpital de Navarre, Hôpital Trousseau, Clinique Rive-Gauche, Hôpital Tenon, Clinique Les Eaux-Claires, GH Paul Guiraud, CH intercommunal, CHU - Hôpital de l’Archet, CH Saint-Joseph-Saint-Luc, Clinique Jean le Bon, Clinique La Croix du Sud, Centre de cardiologie Axium-Rambot, Institut Arthur-Vernes, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Clinique Sainte-Clotilde, CHU - Hôpital Saint-Eloi, Fondation Rothschild, Hôpitaux Nord (Croix-Rousse), Polyclinique Jean-Villar, Clinique Remusat, Hôpital Saint-Antoine, GH, Centre Hospitalier Sainte-Marie, Clinique Honoré-Cave, Institut du cancer de Montpellier (CLCC), Institut Bergonié (CLCC), Polyclinique, CHU - Hôpital de la Mère et de l’Enfant, Clinique Marcel-Sembat, Pôle Santé République, Hôpital Edouard-Herriot, Centre François-Baclesse (CLCC), Hôpital privé de Provence, Institut ophtalmique, Hôpital Paul-Brousse, Clinique Pasteur, Clinique mutualiste La Sagesse, Nouvelle clinique de Tours, Clinique Durieux, Polyclinique de Kerio, Clinique Victor-Pauchet, Clinique Maussins-Nollet, Hôpital privé Paul-d’Égine
2025-08-26 18:17:15,790 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Clinique de l'Essonne, IUCT/Oncopole, Hôpital privé La Louvière, CHR de Metz-Thionville - Hôpital de Mercy, Clinique du Tertre-Rouge, Centre Hospitalier Henri Guerin, CHU de Pointe-à-Pitre, Clinique du Cèdre, Clinique Geoffroy-Saint-Hilaire, Clinique la Pergola, Hôpital de la Pitié-Salpêtrière, Clinique Louis-Pasteur, Polyclinique du Beaujolais, CMCO Côte d’Opale, Clinique Saint-Jean - Sud de France, Hôpital Beaujon, CHU Sud-Réunion, Institut Calot, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical du Mans, Polyclinique Médipôle Saint-Roch, Institut Curie (CLCC), Hôpital privé du Confluent, Polyclinique Côte-Basque-Sud, Clinique du Trocadéro, Polyclinique Lyon-Nord, Hôpital privé Cannes-Oxford, Médipôle Hôpital Privé, Polyclinique Saint Laurent, Institut de cancérologie de l’Ouest, CHU Grenoble - Hôpital Sud, CHU - Hôpital Pellegrin, Hôpital Privé Nancy Lorraine, Clinique Ormeau centre, CHU - Hôpital Charles-Nicolle, Groupe Hospitalier de la Rochelle, Clinique de l’Orangerie, Clinique du Cambrésis, Groupe hospitalier Nord-Essonne, Médipôle de Savoie, CHU - Hôpital Clocheville, Polyclinique de Keraudren, Hôpital privé Beauregard, Gustave-Roussy (CLCC), Clinique Kennedy, Polyclinique Vauban, Polyclinique du Maine, Clinique de la Muette, Clinique Bretéché, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique de l’Estrée, Clinique Saint-Augustin, Espm de L’agglomeration Lilloise, Clinique du Diaconat-Roosevelt, CHU - American Memorial Hospital, CHU - Hôpital Claude-Huriez, Hôpital Belle-Isle, CHU - Hôpital Trousseau, Hôpital Pierre-Wertheimer, CM Bénigne-Joly, Institut mutualiste Montsouris, Clinique de la Sauvegarde, Clinique de l’Yvette, CMC de Parly-II, CHU d’Amiens, CHU de Martinique - site Mère-Enfant, Clinique Fontvert, Clinique Delay, Clinique Monticelli-Vélodrome, Hôpital privé Drôme-Ardèche, Clinique Arago, Centre cardiologique, Polyclinique de Navarre, CH Georges-Daumezon, Hôpital Bicêtre, Clinique mutualiste, Clinique Trenel, Clinique Saint-Hilaire, CH Henri-Laborit, Centre Antoine-Lacassagne (CLCC), Clinique Jean Causse, CHU - Hôpital Larrey, Hôpital privé Paris-Essonne, Clinique Sainte-Marie, Clinique des Franciscaines, Polyclinique de Reims-Bezannes (Marne), Infirmerie protestante de Lyon, CHR de Metz-Thionville - Hôpital Bel-Air, Institut Curie, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Polyclinique de la Baie, CHU Grenoble - Site Nord, CHU - Hôpital Lapeyronie, Hôpital privé de Villeneuve-d’Ascq, Centre orthopédique médico-chirurgical, Hôpital Robert Schuman, Hôpital privé Natecia, Clinique Bouchard, CHU - Hôpital Haut-Lévêque, Clinique Rhône Durance, Polyclinique de Blois, Hôpital Saint-Louis, CHU - Hôpital d’Estaing, CHU Nantes - Hôpital Mère Enfant, Clinique Belledonne, CH privé du Montgardé, Hôpital Renée-Sabran, Clinique Les Fontaines, Clinique du sport, Clinique Saint-Charles, Maison de santé Bagatelle, Clinique ambulatoire de Domont, Polyclinique Majorelle, Pôle santé Léonard-de-Vinci, Centre ambulatoire Kleber, Clinique de la Part-Dieu, CH Montfavet, CH Charles-Perrens, HCL - Hôpital Femme-mère-enfant, CHU - Hôpital Central, Clinique du Grand-Large, CHU - Centre chirurgical Emile-Gallé, Centre Hospitalier Gérard-Marchant, Hôpital Jean-Verdier, Hôtel-Dieu, Hôpital privé Vert-Coteau, CHU - Hôpital Jeanne-de-Flandre, CMC Floréal, Hôpital d'instruction des armées Legouest, Hôpital privé de Marne-la-Vallée, Clinique de l’Europe, Hôpital Henri-Mondor, Polyclinique de la Région-Mantaise, Pôle de Santé du Villeneuvois, CHU - Gabriel-Montpied, Clinique Bizet, Hôpital d'instruction des armées Sainte-Anne, Clinique Ambroise-Paré, Clinique Saint-Nabor, Institut de cancérologie de Lorraine (CLCC), Clinique du Pré, Polyclinique de Limoges - site Émailleurs, Hôpital Louis-Mourier, Hôpital d'instruction des armées Desgenettes, Institut universitaire de la face et du cou, EPS Ville-Évrard, Centre Henri-Becquerel (CLCC), Hôpital de la Timone (adultes), Hôpital privé La Châtaigneraie, Centre Hospitalier des Pyrénées, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Pasteur, Hôpitaux civils, Clinique Saint-Jean-de-Dieu, CHU d'Amiens/Institut ophtalmologique de Picardie, Centre Hospitalier de Vauclaire, Clinique ophtalmologique Thiers, Clinique mutualiste de la Porte-de-l'Orient, Clinique Sainte-Marie (GHICL), Hôpital Louis-Pradel, CH national d’ophtalmologie des Quinze-Vingts, Centre psychothérapique de Nancy, Clinique Saint-Vincent-de-Paul, Clinique de la Miséricorde, Hôpital privé de Marne Chantereine, CH privé Claude-Galien, Clinique des Cèdres, GHU Paris Psychiatrie et neurosciences, Clinique Notre-Dame-de-l’Espérance, Centre Georges-François-Leclerc (CLCC), Clinique du Parc, Clinique Saint-Amé, Clinique urologique Nantes-Atlantis, Hôpital Avicenne, Polyclinique de Picardie, Clinique Toulouse-Lautrec, Santé Atlantique, Hôpital privé Arras-Les Bonnettes, Hôpital privé Jean-Mermoz, Clinique de l’Espérance, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Les Fleurs, EPSM Etienne-Gourmelen, CHU - Hôpital Saint-André, Euromed Cardio, Médipôle Garonne, Pôle santé Oréliance, Hôpital Nord Franche-Comté-Belfort, Polyclinique Francheville, CHU - Hôpital de Hautepierre, CH Basse-Terre (Guadeloupe), Hôpital privé Le Bois, Clinique Pasteur-Lanroze, EPSM Lille-Métropole, Institut de cancérologie Strasbourg Europe, Clinique mutualiste catalane, CHU - Hôpital Morvan, Clinique mutualiste de l’Estuaire, Clinique cardiologique, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, CHU Réunion, Hôpital privé des Peupliers, Centre médico-chirurgical et obstétrical, Clinique Sainte-Anne, Polyclinique de Poitiers, Clinique Saint-André, Hôpital Bichat, Clinique du Millénaire, CHU - Hôpital Maison-Blanche, Centre Hospitalier du Rouvray, Centre cardiologique du Nord, Centre Eugène-Marquis (CLCC), Clinique Saint-Paul, Hôpital privé Saint-Martin, Centre Hospitalier Maurice Despinoy, Hôpital de la Timone (enfants), Clinique Saint-Antoine, Hôpital Saint-Philibert (GHICL), Clinique Saint-Vincent, Hôpital privé, Clinique mutualiste de Bonneveine, Clinique de l'Alma, GHP Ambroise-Paré - Hartmann (92), Clinique Lille-Sud, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Paris Lilas, Centre Oscar-Lambret (CLCC), CHU - Maternité, Polyclinique de Bordeaux-Tondu, Clinique générale, Hôpital privé d’Antony, CHP de l’Europe, Hôpital privé Armand-Brillard, GHI, CMC Pierre-Cherest, Clinique du Fief-de-Grimoire, Hôpital privé de l’Estuaire, Hôpital privé de l’Ouest parisien, Hôpital privé de la Loire, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital de la Croix Rousse (HCL) / CH, Epsan, Clinique Mathilde, Clinique du Val-d’Or, Clinique des Orchidées, CHR, Hôpital Raymond-Poincaré, Centre Hospitalier Le Mas Careiron, Hôpital Hôtel-Dieu, Centre Hospitalier Le Bon Sauveur, Clinique Convert, Polyclinique Urbain-V, CH/Clinique, CHU - Hôpital Robert-Debré, Hôpital Lariboisière, Clinique du Croisé-Laroche, CHU - Hôpital Pontchaillou, Polyclinique de Courlancy, Clinique Victor-Hugo, Clinique Bon-Secours, Hôpital privé Sévigné, Clinique Charcot, CHI, Clinique Saint-Pierre, EPS Barthélemy-Durand, Hôpital de la Timone (Enfants), Hôpital privé de la Seine-Saint-Denis, Les Franciscaines, Centre Hospitalier La Chartreuse, Hôpital privé des Côtes-d’Armor, Centre Hospitalier Drôme Vivarais, CHU - Hôpital Sud, Hôpital Robert-Debré, Clinique de Bercy, CHU de La Réunion - Félix-Guyon, Centre Hospitalier Le Vinatier, Hôpital privé Dijon-Bourgogne, Hôpital Saint-Camille, CH Esquirol, Centre de chirurgie ophtalmologique, Hôpital d'instruction des armées Percy, Centre Hospitalier Montperrin, Hôpital Antoine-Béclère, CHU - Hôpital Purpan, Clinique de l’Atlantique, Clinique du Renaison, Clinique de l’Anjou, Hôpital d'instruction des armées Laveran, Hôpitaux pédiatriques, CHU - Hôpital de la Côte de nacre, Hopital Joseph-Ducuing, Polyclinique Saint-François, Hôpital privé Pays-de-Savoie, Clinique Saint-Joseph, Clinique d’Occitanie, Institut Paoli-Calmettes (CLCC), Institut franco-britannique Kléber, Hôpital privé de l’Est lyonnais, Hôpital Saint-Joseph, Clinique Juge, Clinique des Ormeaux, Hôpitaux de Saint-Maurice, Clinique Jouvenet, GH Saint-Vincent - Clinique Sainte-Barbe, CH privé Saint-Martin, CHU - Hôpitaux de Brabois, Polyclinique du Parc-Drevon, CHU - Hôpital Gui-de-Chauliac, Institut Jean-Godinot (CLCC), CHU - Hôpitaux mère-enfants, Institut hospitalier Jacques-Cartier, Hôpital d'instruction des armées Bégin, Clinique Anne-Artois, Polyclinique de Limoges - site Chénieux, Centre Hospitalier George Sand, Clinique Axium, Hôpital privé de la Casamance, Clinique du Val-d’Ouest Vendôme, Clinique Esquirol-Saint-Hilaire, Hôpital de la Conception, Hôpital privé Clairval, Hôpital Foch, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Turin, Clinique Saint-François, Hôpital privé de La Miotte, GH mutualiste, Hôpital Corentin-Celton, CHU - Hôpital Roger-Salengro, Clinique Clémentville, CHU de Martinique, Clinique Belharra, Polyclinique Bordeaux-Rive droite, Clinique Tivoli-Ducos, GCS Clinique du Ter, Polyclinique Santa-Maria, IUCT Oncopole, EPSM de Saône-et-Loire, Hôpitaux Sud, Hôpital Necker-Enfants-Malades, Clinique du Diaconat-Fonderie, CH Lyon-Sud, Centre de la main, Clinique Saint-Léonard, Hôpital européen, CHU - Hôpital Bretonneau, Hôpital européen Georges-Pompidou, Polyclinique Aguilera, ASM, Hôpital des Massues, Hôpital privé du Vert-Galant, Centre Hospitalier d'Erstein, CHU - site Nord, Grand hôpital de l'Est-Francilien, Hôpital Ambroise-Paré, CHU - Hôpital civil, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital Nord, Clinique de la Plaine, Clinique du Parc-Monceau, Hôpital d'instruction des armées Robert-Picqué, CHU de Nantes, Centre de cardiologie du Pays basque, Clinique Rhéna, Centre Hospitalier Les Murets, Nouvelle clinique Bel-Air, Clinique Beau-Soleil, CH privé Saint-Grégoire, Hôpital Lariboisière-Fernand Widal, Centre Léon-Bérard (CLCC), Hôpital-clinique Claude-Bernard, CH Édouard-Toulouse, Institut Arnault-Tzanck, Clinique Chantecler, Centre Jean-Perrin (CLCC), Clinique de Villeneuve-d’Ascq, Hôpital Cochin, Clinique Conti, Hôpital Paris Saint-Joseph, Polyclinique du Grand-Sud, Clinique mutualiste Jules-Verne, Clinique Ormeau Pyrénées, Hôpital des Diaconesses, Clinique Saint-George, EPSM de la Marne, CH/clinique, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique La Ligne bleue, CHU - Institut cœur-poumon, Polyclinique de Reims-Bezannes, Polyclinique du Parc, Centre Clinical, Clinique du Lac et d’Argonay, CHU-Hôpital Purpan/HFE, Clinique Claude-Bernard, Clinique du Pont-de-Chaume, EPSM Morbihan, CMCO, Clinique de l’Union, CH Guillaume-Régnier, Polyclinique Saint-Côme, CHU - Hôpital Dupuytren, Hôpital Albert Schweitzer, Polyclinique Saint-Jean, Clinique Saint-Michel, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôpital privé La Montagne Lambert, Clinique Océane, Hôpital privé Nord Parisien, CHU - Hôpital de la Cavale-Blanche, Polyclinique Saint-Roch, CHU - Hôpital Nord, Nouvel Hôpital de Navarre, Hôpital Trousseau, Clinique Rive-Gauche, Hôpital Tenon, Clinique Les Eaux-Claires, GH Paul Guiraud, CH intercommunal, CHU - Hôpital de l’Archet, CH Saint-Joseph-Saint-Luc, Clinique Jean le Bon, Clinique La Croix du Sud, Centre de cardiologie Axium-Rambot, Institut Arthur-Vernes, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Clinique Sainte-Clotilde, CHU - Hôpital Saint-Eloi, Fondation Rothschild, Hôpitaux Nord (Croix-Rousse), Polyclinique Jean-Villar, Clinique Remusat, Hôpital Saint-Antoine, GH, Centre Hospitalier Sainte-Marie, Clinique Honoré-Cave, Institut du cancer de Montpellier (CLCC), Institut Bergonié (CLCC), Polyclinique, CHU - Hôpital de la Mère et de l’Enfant, Clinique Marcel-Sembat, Pôle Santé République, Hôpital Edouard-Herriot, Centre François-Baclesse (CLCC), Hôpital privé de Provence, Institut ophtalmique, Hôpital Paul-Brousse, Clinique Pasteur, Clinique mutualiste La Sagesse, Nouvelle clinique de Tours, Clinique Durieux, Polyclinique de Kerio, Clinique Victor-Pauchet, Clinique Maussins-Nollet, Hôpital privé Paul-d’Égine
2025-08-26 18:17:15,790 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:17:15,793 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-26 18:17:15,793 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-26 18:17:15,796 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:15,796 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:15,796 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:15,797 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:15,797 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:15,797 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:15,797 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:16,398 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:20 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'405'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'428'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_946278842f5e4b89a89e3b6614529c21'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3849aabe1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:16,398 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:16,399 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:16,401 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:16,401 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:16,401 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:16,401 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:20 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '405', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '428', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_946278842f5e4b89a89e3b6614529c21', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a3849aabe1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:16,402 [DEBUG] openai._base_client: request_id: req_946278842f5e4b89a89e3b6614529c21
2025-08-26 18:17:16,402 [DEBUG] app.utility.llm_helpers: LLM call 'detect_number_institutions' successful: {'prompt_tokens': 310, 'completion_tokens': 1, 'total_tokens': 311}, cost=4.71e-05
2025-08-26 18:17:16,402 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:16,402 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:16,403 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:17:16,403 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:16,405 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:16,406 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:16,406 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:16,406 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:16,406 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:16,406 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:16,407 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:16,890 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'285'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'310'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_46950e5b551040169facb9057fd7c40f'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3886d24e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:16,891 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:16,891 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:16,898 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:16,898 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:16,898 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:16,898 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:21 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '285', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '310', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_46950e5b551040169facb9057fd7c40f', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a3886d24e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:16,899 [DEBUG] openai._base_client: request_id: req_46950e5b551040169facb9057fd7c40f
2025-08-26 18:17:16,899 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:17:16,899 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:16,899 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:16,900 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:17:16,900 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:17:16,900 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result={'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:17:16,900 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:16,900 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:16,900 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:17:16,900 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:16,902 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:16,903 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:16,903 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:16,903 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:16,904 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:16,904 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:16,904 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:17,345 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'265'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'280'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_f2027d76a4f84040a728cad743abdce1'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a38b7df7e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:17,346 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:17,346 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:17,349 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:17,349 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:17,349 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:17,350 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:21 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '265', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '280', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_f2027d76a4f84040a728cad743abdce1', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a38b7df7e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:17,350 [DEBUG] openai._base_client: request_id: req_f2027d76a4f84040a728cad743abdce1
2025-08-26 18:17:17,350 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:17:17,351 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:17,351 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:17,351 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:17:17,351 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:17:17,351 [ERROR] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: Unexpected exception: 'float' object has no attribute 'get'
2025-08-26 18:17:17,353 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:17,354 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:17,354 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:17,354 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:17,354 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:17,355 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:17,355 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:18,073 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'498'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'515'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_8551bc601acb42a98c97c0c8ca992b0c'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a38e4e00e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:18,074 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:18,074 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:18,079 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:18,079 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:18,079 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:18,079 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '498', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '515', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_8551bc601acb42a98c97c0c8ca992b0c', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a38e4e00e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:18,080 [DEBUG] openai._base_client: request_id: req_8551bc601acb42a98c97c0c8ca992b0c
2025-08-26 18:17:18,080 [DEBUG] app.utility.llm_helpers: LLM call 'detect_specific_institution' successful: {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, cost=6.375e-05
2025-08-26 18:17:18,080 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Raw LLM response for specific institution detection: {'content': 'aucune correspondance', 'token_usage': {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, 'cost': 6.375e-05}
2025-08-26 18:17:18,081 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-26 18:17:18,081 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-26 18:17:18,081 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-26 18:17:18,083 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:18,084 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:18,084 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:18,084 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:18,084 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:18,084 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:18,084 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:18,637 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'354'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'381'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_99353c468a0c4440b0193e2bb8087898'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a392dbb3e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:18,637 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:18,638 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:18,640 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:18,640 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:18,641 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:18,641 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '354', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '381', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_99353c468a0c4440b0193e2bb8087898', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a392dbb3e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:18,641 [DEBUG] openai._base_client: request_id: req_99353c468a0c4440b0193e2bb8087898
2025-08-26 18:17:18,642 [DEBUG] app.utility.llm_helpers: LLM call 'detect_public_private_preference' successful: {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, cost=3.27e-05
2025-08-26 18:17:18,642 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-26 18:17:18,642 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: consolidated results={'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:17:18,642 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:17:18,642 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city=None, city_detected=False, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-26 18:17:18,642 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-26 18:17:18,642 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: None
2025-08-26 18:17:18,642 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: False
2025-08-26 18:17:18,643 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-26 18:17:18,643 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-26 18:17:18,643 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-26 18:17:18,643 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-26 18:17:18,676 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:17:18,677 [DEBUG] app.services.data_processing_service: Institution list: Clinique de l'Essonne, IUCT/Oncopole, Hôpital privé La Louvière, CHR de Metz-Thionville - Hôpital de Mercy, Clinique du Tertre-Rouge, Centre Hospitalier Henri Guerin, CHU de Pointe-à-Pitre, Clinique du Cèdre, Clinique Geoffroy-Saint-Hilaire, Clinique la Pergola, Hôpital de la Pitié-Salpêtrière, Clinique Louis-Pasteur, Polyclinique du Beaujolais, CMCO Côte d’Opale, Clinique Saint-Jean - Sud de France, Hôpital Beaujon, CHU Sud-Réunion, Institut Calot, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical du Mans, Polyclinique Médipôle Saint-Roch, Institut Curie (CLCC), Hôpital privé du Confluent, Polyclinique Côte-Basque-Sud, Clinique du Trocadéro, Polyclinique Lyon-Nord, Hôpital privé Cannes-Oxford, Médipôle Hôpital Privé, Polyclinique Saint Laurent, Institut de cancérologie de l’Ouest, CHU Grenoble - Hôpital Sud, CHU - Hôpital Pellegrin, Hôpital Privé Nancy Lorraine, Clinique Ormeau centre, CHU - Hôpital Charles-Nicolle, Groupe Hospitalier de la Rochelle, Clinique de l’Orangerie, Clinique du Cambrésis, Groupe hospitalier Nord-Essonne, Médipôle de Savoie, CHU - Hôpital Clocheville, Polyclinique de Keraudren, Hôpital privé Beauregard, Gustave-Roussy (CLCC), Clinique Kennedy, Polyclinique Vauban, Polyclinique du Maine, Clinique de la Muette, Clinique Bretéché, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique de l’Estrée, Clinique Saint-Augustin, Espm de L’agglomeration Lilloise, Clinique du Diaconat-Roosevelt, CHU - American Memorial Hospital, CHU - Hôpital Claude-Huriez, Hôpital Belle-Isle, CHU - Hôpital Trousseau, Hôpital Pierre-Wertheimer, CM Bénigne-Joly, Institut mutualiste Montsouris, Clinique de la Sauvegarde, Clinique de l’Yvette, CMC de Parly-II, CHU d’Amiens, CHU de Martinique - site Mère-Enfant, Clinique Fontvert, Clinique Delay, Clinique Monticelli-Vélodrome, Hôpital privé Drôme-Ardèche, Clinique Arago, Centre cardiologique, Polyclinique de Navarre, CH Georges-Daumezon, Hôpital Bicêtre, Clinique mutualiste, Clinique Trenel, Clinique Saint-Hilaire, CH Henri-Laborit, Centre Antoine-Lacassagne (CLCC), Clinique Jean Causse, CHU - Hôpital Larrey, Hôpital privé Paris-Essonne, Clinique Sainte-Marie, Clinique des Franciscaines, Polyclinique de Reims-Bezannes (Marne), Infirmerie protestante de Lyon, CHR de Metz-Thionville - Hôpital Bel-Air, Institut Curie, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Polyclinique de la Baie, CHU Grenoble - Site Nord, CHU - Hôpital Lapeyronie, Hôpital privé de Villeneuve-d’Ascq, Centre orthopédique médico-chirurgical, Hôpital Robert Schuman, Hôpital privé Natecia, Clinique Bouchard, CHU - Hôpital Haut-Lévêque, Clinique Rhône Durance, Polyclinique de Blois, Hôpital Saint-Louis, CHU - Hôpital d’Estaing, CHU Nantes - Hôpital Mère Enfant, Clinique Belledonne, CH privé du Montgardé, Hôpital Renée-Sabran, Clinique Les Fontaines, Clinique du sport, Clinique Saint-Charles, Maison de santé Bagatelle, Clinique ambulatoire de Domont, Polyclinique Majorelle, Pôle santé Léonard-de-Vinci, Centre ambulatoire Kleber, Clinique de la Part-Dieu, CH Montfavet, CH Charles-Perrens, HCL - Hôpital Femme-mère-enfant, CHU - Hôpital Central, Clinique du Grand-Large, CHU - Centre chirurgical Emile-Gallé, Centre Hospitalier Gérard-Marchant, Hôpital Jean-Verdier, Hôtel-Dieu, Hôpital privé Vert-Coteau, CHU - Hôpital Jeanne-de-Flandre, CMC Floréal, Hôpital d'instruction des armées Legouest, Hôpital privé de Marne-la-Vallée, Clinique de l’Europe, Hôpital Henri-Mondor, Polyclinique de la Région-Mantaise, Pôle de Santé du Villeneuvois, CHU - Gabriel-Montpied, Clinique Bizet, Hôpital d'instruction des armées Sainte-Anne, Clinique Ambroise-Paré, Clinique Saint-Nabor, Institut de cancérologie de Lorraine (CLCC), Clinique du Pré, Polyclinique de Limoges - site Émailleurs, Hôpital Louis-Mourier, Hôpital d'instruction des armées Desgenettes, Institut universitaire de la face et du cou, EPS Ville-Évrard, Centre Henri-Becquerel (CLCC), Hôpital de la Timone (adultes), Hôpital privé La Châtaigneraie, Centre Hospitalier des Pyrénées, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Pasteur, Hôpitaux civils, Clinique Saint-Jean-de-Dieu, CHU d'Amiens/Institut ophtalmologique de Picardie, Centre Hospitalier de Vauclaire, Clinique ophtalmologique Thiers, Clinique mutualiste de la Porte-de-l'Orient, Clinique Sainte-Marie (GHICL), Hôpital Louis-Pradel, CH national d’ophtalmologie des Quinze-Vingts, Centre psychothérapique de Nancy, Clinique Saint-Vincent-de-Paul, Clinique de la Miséricorde, Hôpital privé de Marne Chantereine, CH privé Claude-Galien, Clinique des Cèdres, GHU Paris Psychiatrie et neurosciences, Clinique Notre-Dame-de-l’Espérance, Centre Georges-François-Leclerc (CLCC), Clinique du Parc, Clinique Saint-Amé, Clinique urologique Nantes-Atlantis, Hôpital Avicenne, Polyclinique de Picardie, Clinique Toulouse-Lautrec, Santé Atlantique, Hôpital privé Arras-Les Bonnettes, Hôpital privé Jean-Mermoz, Clinique de l’Espérance, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Les Fleurs, EPSM Etienne-Gourmelen, CHU - Hôpital Saint-André, Euromed Cardio, Médipôle Garonne, Pôle santé Oréliance, Hôpital Nord Franche-Comté-Belfort, Polyclinique Francheville, CHU - Hôpital de Hautepierre, CH Basse-Terre (Guadeloupe), Hôpital privé Le Bois, Clinique Pasteur-Lanroze, EPSM Lille-Métropole, Institut de cancérologie Strasbourg Europe, Clinique mutualiste catalane, CHU - Hôpital Morvan, Clinique mutualiste de l’Estuaire, Clinique cardiologique, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, CHU Réunion, Hôpital privé des Peupliers, Centre médico-chirurgical et obstétrical, Clinique Sainte-Anne, Polyclinique de Poitiers, Clinique Saint-André, Hôpital Bichat, Clinique du Millénaire, CHU - Hôpital Maison-Blanche, Centre Hospitalier du Rouvray, Centre cardiologique du Nord, Centre Eugène-Marquis (CLCC), Clinique Saint-Paul, Hôpital privé Saint-Martin, Centre Hospitalier Maurice Despinoy, Hôpital de la Timone (enfants), Clinique Saint-Antoine, Hôpital Saint-Philibert (GHICL), Clinique Saint-Vincent, Hôpital privé, Clinique mutualiste de Bonneveine, Clinique de l'Alma, GHP Ambroise-Paré - Hartmann (92), Clinique Lille-Sud, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Paris Lilas, Centre Oscar-Lambret (CLCC), CHU - Maternité, Polyclinique de Bordeaux-Tondu, Clinique générale, Hôpital privé d’Antony, CHP de l’Europe, Hôpital privé Armand-Brillard, GHI, CMC Pierre-Cherest, Clinique du Fief-de-Grimoire, Hôpital privé de l’Estuaire, Hôpital privé de l’Ouest parisien, Hôpital privé de la Loire, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital de la Croix Rousse (HCL) / CH, Epsan, Clinique Mathilde, Clinique du Val-d’Or, Clinique des Orchidées, CHR, Hôpital Raymond-Poincaré, Centre Hospitalier Le Mas Careiron, Hôpital Hôtel-Dieu, Centre Hospitalier Le Bon Sauveur, Clinique Convert, Polyclinique Urbain-V, CH/Clinique, CHU - Hôpital Robert-Debré, Hôpital Lariboisière, Clinique du Croisé-Laroche, CHU - Hôpital Pontchaillou, Polyclinique de Courlancy, Clinique Victor-Hugo, Clinique Bon-Secours, Hôpital privé Sévigné, Clinique Charcot, CHI, Clinique Saint-Pierre, EPS Barthélemy-Durand, Hôpital de la Timone (Enfants), Hôpital privé de la Seine-Saint-Denis, Les Franciscaines, Centre Hospitalier La Chartreuse, Hôpital privé des Côtes-d’Armor, Centre Hospitalier Drôme Vivarais, CHU - Hôpital Sud, Hôpital Robert-Debré, Clinique de Bercy, CHU de La Réunion - Félix-Guyon, Centre Hospitalier Le Vinatier, Hôpital privé Dijon-Bourgogne, Hôpital Saint-Camille, CH Esquirol, Centre de chirurgie ophtalmologique, Hôpital d'instruction des armées Percy, Centre Hospitalier Montperrin, Hôpital Antoine-Béclère, CHU - Hôpital Purpan, Clinique de l’Atlantique, Clinique du Renaison, Clinique de l’Anjou, Hôpital d'instruction des armées Laveran, Hôpitaux pédiatriques, CHU - Hôpital de la Côte de nacre, Hopital Joseph-Ducuing, Polyclinique Saint-François, Hôpital privé Pays-de-Savoie, Clinique Saint-Joseph, Clinique d’Occitanie, Institut Paoli-Calmettes (CLCC), Institut franco-britannique Kléber, Hôpital privé de l’Est lyonnais, Hôpital Saint-Joseph, Clinique Juge, Clinique des Ormeaux, Hôpitaux de Saint-Maurice, Clinique Jouvenet, GH Saint-Vincent - Clinique Sainte-Barbe, CH privé Saint-Martin, CHU - Hôpitaux de Brabois, Polyclinique du Parc-Drevon, CHU - Hôpital Gui-de-Chauliac, Institut Jean-Godinot (CLCC), CHU - Hôpitaux mère-enfants, Institut hospitalier Jacques-Cartier, Hôpital d'instruction des armées Bégin, Clinique Anne-Artois, Polyclinique de Limoges - site Chénieux, Centre Hospitalier George Sand, Clinique Axium, Hôpital privé de la Casamance, Clinique du Val-d’Ouest Vendôme, Clinique Esquirol-Saint-Hilaire, Hôpital de la Conception, Hôpital privé Clairval, Hôpital Foch, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Turin, Clinique Saint-François, Hôpital privé de La Miotte, GH mutualiste, Hôpital Corentin-Celton, CHU - Hôpital Roger-Salengro, Clinique Clémentville, CHU de Martinique, Clinique Belharra, Polyclinique Bordeaux-Rive droite, Clinique Tivoli-Ducos, GCS Clinique du Ter, Polyclinique Santa-Maria, IUCT Oncopole, EPSM de Saône-et-Loire, Hôpitaux Sud, Hôpital Necker-Enfants-Malades, Clinique du Diaconat-Fonderie, CH Lyon-Sud, Centre de la main, Clinique Saint-Léonard, Hôpital européen, CHU - Hôpital Bretonneau, Hôpital européen Georges-Pompidou, Polyclinique Aguilera, ASM, Hôpital des Massues, Hôpital privé du Vert-Galant, Centre Hospitalier d'Erstein, CHU - site Nord, Grand hôpital de l'Est-Francilien, Hôpital Ambroise-Paré, CHU - Hôpital civil, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital Nord, Clinique de la Plaine, Clinique du Parc-Monceau, Hôpital d'instruction des armées Robert-Picqué, CHU de Nantes, Centre de cardiologie du Pays basque, Clinique Rhéna, Centre Hospitalier Les Murets, Nouvelle clinique Bel-Air, Clinique Beau-Soleil, CH privé Saint-Grégoire, Hôpital Lariboisière-Fernand Widal, Centre Léon-Bérard (CLCC), Hôpital-clinique Claude-Bernard, CH Édouard-Toulouse, Institut Arnault-Tzanck, Clinique Chantecler, Centre Jean-Perrin (CLCC), Clinique de Villeneuve-d’Ascq, Hôpital Cochin, Clinique Conti, Hôpital Paris Saint-Joseph, Polyclinique du Grand-Sud, Clinique mutualiste Jules-Verne, Clinique Ormeau Pyrénées, Hôpital des Diaconesses, Clinique Saint-George, EPSM de la Marne, CH/clinique, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique La Ligne bleue, CHU - Institut cœur-poumon, Polyclinique de Reims-Bezannes, Polyclinique du Parc, Centre Clinical, Clinique du Lac et d’Argonay, CHU-Hôpital Purpan/HFE, Clinique Claude-Bernard, Clinique du Pont-de-Chaume, EPSM Morbihan, CMCO, Clinique de l’Union, CH Guillaume-Régnier, Polyclinique Saint-Côme, CHU - Hôpital Dupuytren, Hôpital Albert Schweitzer, Polyclinique Saint-Jean, Clinique Saint-Michel, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôpital privé La Montagne Lambert, Clinique Océane, Hôpital privé Nord Parisien, CHU - Hôpital de la Cavale-Blanche, Polyclinique Saint-Roch, CHU - Hôpital Nord, Nouvel Hôpital de Navarre, Hôpital Trousseau, Clinique Rive-Gauche, Hôpital Tenon, Clinique Les Eaux-Claires, GH Paul Guiraud, CH intercommunal, CHU - Hôpital de l’Archet, CH Saint-Joseph-Saint-Luc, Clinique Jean le Bon, Clinique La Croix du Sud, Centre de cardiologie Axium-Rambot, Institut Arthur-Vernes, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Clinique Sainte-Clotilde, CHU - Hôpital Saint-Eloi, Fondation Rothschild, Hôpitaux Nord (Croix-Rousse), Polyclinique Jean-Villar, Clinique Remusat, Hôpital Saint-Antoine, GH, Centre Hospitalier Sainte-Marie, Clinique Honoré-Cave, Institut du cancer de Montpellier (CLCC), Institut Bergonié (CLCC), Polyclinique, CHU - Hôpital de la Mère et de l’Enfant, Clinique Marcel-Sembat, Pôle Santé République, Hôpital Edouard-Herriot, Centre François-Baclesse (CLCC), Hôpital privé de Provence, Institut ophtalmique, Hôpital Paul-Brousse, Clinique Pasteur, Clinique mutualiste La Sagesse, Nouvelle clinique de Tours, Clinique Durieux, Polyclinique de Kerio, Clinique Victor-Pauchet, Clinique Maussins-Nollet, Hôpital privé Paul-d’Égine
2025-08-26 18:17:18,678 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-26 18:17:18,944 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-26 18:17:18,945 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: None
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: False
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: None, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-26 18:17:18,945 [DEBUG] app.services.pipeline_orchestrator_service: Calling build_ranking_dataframe_with_distances
2025-08-26 18:17:18,946 [INFO] app.services.pipeline_orchestrator_service: Building ranking DataFrame with distances: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', excel_path='/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx', detected_specialty='no specialty match'
2025-08-26 18:17:18,946 [INFO] app.services.pipeline_orchestrator_service: Extracting query parameters: prompt='Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?', detected_specialty='no specialty match', conv_history='None'
2025-08-26 18:17:18,946 [INFO] app.features.query_analysis.query_analyst: Initializing QueryAnalyst
2025-08-26 18:17:18,946 [INFO] app.features.query_analysis.city.city_analyst: Initializing CityAnalyst
2025-08-26 18:17:18,946 [INFO] app.features.query_analysis.city.city_detection: Initializing CityDetector
2025-08-26 18:17:18,946 [INFO] app.features.query_analysis.city.city_validation: Initializing CityChecker
2025-08-26 18:17:19,121 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:17:19,122 [DEBUG] app.services.data_processing_service: Institution list: Clinique de l'Essonne, IUCT/Oncopole, Hôpital privé La Louvière, CHR de Metz-Thionville - Hôpital de Mercy, Clinique du Tertre-Rouge, Centre Hospitalier Henri Guerin, CHU de Pointe-à-Pitre, Clinique du Cèdre, Clinique Geoffroy-Saint-Hilaire, Clinique la Pergola, Hôpital de la Pitié-Salpêtrière, Clinique Louis-Pasteur, Polyclinique du Beaujolais, CMCO Côte d’Opale, Clinique Saint-Jean - Sud de France, Hôpital Beaujon, CHU Sud-Réunion, Institut Calot, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical du Mans, Polyclinique Médipôle Saint-Roch, Institut Curie (CLCC), Hôpital privé du Confluent, Polyclinique Côte-Basque-Sud, Clinique du Trocadéro, Polyclinique Lyon-Nord, Hôpital privé Cannes-Oxford, Médipôle Hôpital Privé, Polyclinique Saint Laurent, Institut de cancérologie de l’Ouest, CHU Grenoble - Hôpital Sud, CHU - Hôpital Pellegrin, Hôpital Privé Nancy Lorraine, Clinique Ormeau centre, CHU - Hôpital Charles-Nicolle, Groupe Hospitalier de la Rochelle, Clinique de l’Orangerie, Clinique du Cambrésis, Groupe hospitalier Nord-Essonne, Médipôle de Savoie, CHU - Hôpital Clocheville, Polyclinique de Keraudren, Hôpital privé Beauregard, Gustave-Roussy (CLCC), Clinique Kennedy, Polyclinique Vauban, Polyclinique du Maine, Clinique de la Muette, Clinique Bretéché, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique de l’Estrée, Clinique Saint-Augustin, Espm de L’agglomeration Lilloise, Clinique du Diaconat-Roosevelt, CHU - American Memorial Hospital, CHU - Hôpital Claude-Huriez, Hôpital Belle-Isle, CHU - Hôpital Trousseau, Hôpital Pierre-Wertheimer, CM Bénigne-Joly, Institut mutualiste Montsouris, Clinique de la Sauvegarde, Clinique de l’Yvette, CMC de Parly-II, CHU d’Amiens, CHU de Martinique - site Mère-Enfant, Clinique Fontvert, Clinique Delay, Clinique Monticelli-Vélodrome, Hôpital privé Drôme-Ardèche, Clinique Arago, Centre cardiologique, Polyclinique de Navarre, CH Georges-Daumezon, Hôpital Bicêtre, Clinique mutualiste, Clinique Trenel, Clinique Saint-Hilaire, CH Henri-Laborit, Centre Antoine-Lacassagne (CLCC), Clinique Jean Causse, CHU - Hôpital Larrey, Hôpital privé Paris-Essonne, Clinique Sainte-Marie, Clinique des Franciscaines, Polyclinique de Reims-Bezannes (Marne), Infirmerie protestante de Lyon, CHR de Metz-Thionville - Hôpital Bel-Air, Institut Curie, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Polyclinique de la Baie, CHU Grenoble - Site Nord, CHU - Hôpital Lapeyronie, Hôpital privé de Villeneuve-d’Ascq, Centre orthopédique médico-chirurgical, Hôpital Robert Schuman, Hôpital privé Natecia, Clinique Bouchard, CHU - Hôpital Haut-Lévêque, Clinique Rhône Durance, Polyclinique de Blois, Hôpital Saint-Louis, CHU - Hôpital d’Estaing, CHU Nantes - Hôpital Mère Enfant, Clinique Belledonne, CH privé du Montgardé, Hôpital Renée-Sabran, Clinique Les Fontaines, Clinique du sport, Clinique Saint-Charles, Maison de santé Bagatelle, Clinique ambulatoire de Domont, Polyclinique Majorelle, Pôle santé Léonard-de-Vinci, Centre ambulatoire Kleber, Clinique de la Part-Dieu, CH Montfavet, CH Charles-Perrens, HCL - Hôpital Femme-mère-enfant, CHU - Hôpital Central, Clinique du Grand-Large, CHU - Centre chirurgical Emile-Gallé, Centre Hospitalier Gérard-Marchant, Hôpital Jean-Verdier, Hôtel-Dieu, Hôpital privé Vert-Coteau, CHU - Hôpital Jeanne-de-Flandre, CMC Floréal, Hôpital d'instruction des armées Legouest, Hôpital privé de Marne-la-Vallée, Clinique de l’Europe, Hôpital Henri-Mondor, Polyclinique de la Région-Mantaise, Pôle de Santé du Villeneuvois, CHU - Gabriel-Montpied, Clinique Bizet, Hôpital d'instruction des armées Sainte-Anne, Clinique Ambroise-Paré, Clinique Saint-Nabor, Institut de cancérologie de Lorraine (CLCC), Clinique du Pré, Polyclinique de Limoges - site Émailleurs, Hôpital Louis-Mourier, Hôpital d'instruction des armées Desgenettes, Institut universitaire de la face et du cou, EPS Ville-Évrard, Centre Henri-Becquerel (CLCC), Hôpital de la Timone (adultes), Hôpital privé La Châtaigneraie, Centre Hospitalier des Pyrénées, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Pasteur, Hôpitaux civils, Clinique Saint-Jean-de-Dieu, CHU d'Amiens/Institut ophtalmologique de Picardie, Centre Hospitalier de Vauclaire, Clinique ophtalmologique Thiers, Clinique mutualiste de la Porte-de-l'Orient, Clinique Sainte-Marie (GHICL), Hôpital Louis-Pradel, CH national d’ophtalmologie des Quinze-Vingts, Centre psychothérapique de Nancy, Clinique Saint-Vincent-de-Paul, Clinique de la Miséricorde, Hôpital privé de Marne Chantereine, CH privé Claude-Galien, Clinique des Cèdres, GHU Paris Psychiatrie et neurosciences, Clinique Notre-Dame-de-l’Espérance, Centre Georges-François-Leclerc (CLCC), Clinique du Parc, Clinique Saint-Amé, Clinique urologique Nantes-Atlantis, Hôpital Avicenne, Polyclinique de Picardie, Clinique Toulouse-Lautrec, Santé Atlantique, Hôpital privé Arras-Les Bonnettes, Hôpital privé Jean-Mermoz, Clinique de l’Espérance, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Les Fleurs, EPSM Etienne-Gourmelen, CHU - Hôpital Saint-André, Euromed Cardio, Médipôle Garonne, Pôle santé Oréliance, Hôpital Nord Franche-Comté-Belfort, Polyclinique Francheville, CHU - Hôpital de Hautepierre, CH Basse-Terre (Guadeloupe), Hôpital privé Le Bois, Clinique Pasteur-Lanroze, EPSM Lille-Métropole, Institut de cancérologie Strasbourg Europe, Clinique mutualiste catalane, CHU - Hôpital Morvan, Clinique mutualiste de l’Estuaire, Clinique cardiologique, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, CHU Réunion, Hôpital privé des Peupliers, Centre médico-chirurgical et obstétrical, Clinique Sainte-Anne, Polyclinique de Poitiers, Clinique Saint-André, Hôpital Bichat, Clinique du Millénaire, CHU - Hôpital Maison-Blanche, Centre Hospitalier du Rouvray, Centre cardiologique du Nord, Centre Eugène-Marquis (CLCC), Clinique Saint-Paul, Hôpital privé Saint-Martin, Centre Hospitalier Maurice Despinoy, Hôpital de la Timone (enfants), Clinique Saint-Antoine, Hôpital Saint-Philibert (GHICL), Clinique Saint-Vincent, Hôpital privé, Clinique mutualiste de Bonneveine, Clinique de l'Alma, GHP Ambroise-Paré - Hartmann (92), Clinique Lille-Sud, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Paris Lilas, Centre Oscar-Lambret (CLCC), CHU - Maternité, Polyclinique de Bordeaux-Tondu, Clinique générale, Hôpital privé d’Antony, CHP de l’Europe, Hôpital privé Armand-Brillard, GHI, CMC Pierre-Cherest, Clinique du Fief-de-Grimoire, Hôpital privé de l’Estuaire, Hôpital privé de l’Ouest parisien, Hôpital privé de la Loire, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital de la Croix Rousse (HCL) / CH, Epsan, Clinique Mathilde, Clinique du Val-d’Or, Clinique des Orchidées, CHR, Hôpital Raymond-Poincaré, Centre Hospitalier Le Mas Careiron, Hôpital Hôtel-Dieu, Centre Hospitalier Le Bon Sauveur, Clinique Convert, Polyclinique Urbain-V, CH/Clinique, CHU - Hôpital Robert-Debré, Hôpital Lariboisière, Clinique du Croisé-Laroche, CHU - Hôpital Pontchaillou, Polyclinique de Courlancy, Clinique Victor-Hugo, Clinique Bon-Secours, Hôpital privé Sévigné, Clinique Charcot, CHI, Clinique Saint-Pierre, EPS Barthélemy-Durand, Hôpital de la Timone (Enfants), Hôpital privé de la Seine-Saint-Denis, Les Franciscaines, Centre Hospitalier La Chartreuse, Hôpital privé des Côtes-d’Armor, Centre Hospitalier Drôme Vivarais, CHU - Hôpital Sud, Hôpital Robert-Debré, Clinique de Bercy, CHU de La Réunion - Félix-Guyon, Centre Hospitalier Le Vinatier, Hôpital privé Dijon-Bourgogne, Hôpital Saint-Camille, CH Esquirol, Centre de chirurgie ophtalmologique, Hôpital d'instruction des armées Percy, Centre Hospitalier Montperrin, Hôpital Antoine-Béclère, CHU - Hôpital Purpan, Clinique de l’Atlantique, Clinique du Renaison, Clinique de l’Anjou, Hôpital d'instruction des armées Laveran, Hôpitaux pédiatriques, CHU - Hôpital de la Côte de nacre, Hopital Joseph-Ducuing, Polyclinique Saint-François, Hôpital privé Pays-de-Savoie, Clinique Saint-Joseph, Clinique d’Occitanie, Institut Paoli-Calmettes (CLCC), Institut franco-britannique Kléber, Hôpital privé de l’Est lyonnais, Hôpital Saint-Joseph, Clinique Juge, Clinique des Ormeaux, Hôpitaux de Saint-Maurice, Clinique Jouvenet, GH Saint-Vincent - Clinique Sainte-Barbe, CH privé Saint-Martin, CHU - Hôpitaux de Brabois, Polyclinique du Parc-Drevon, CHU - Hôpital Gui-de-Chauliac, Institut Jean-Godinot (CLCC), CHU - Hôpitaux mère-enfants, Institut hospitalier Jacques-Cartier, Hôpital d'instruction des armées Bégin, Clinique Anne-Artois, Polyclinique de Limoges - site Chénieux, Centre Hospitalier George Sand, Clinique Axium, Hôpital privé de la Casamance, Clinique du Val-d’Ouest Vendôme, Clinique Esquirol-Saint-Hilaire, Hôpital de la Conception, Hôpital privé Clairval, Hôpital Foch, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Turin, Clinique Saint-François, Hôpital privé de La Miotte, GH mutualiste, Hôpital Corentin-Celton, CHU - Hôpital Roger-Salengro, Clinique Clémentville, CHU de Martinique, Clinique Belharra, Polyclinique Bordeaux-Rive droite, Clinique Tivoli-Ducos, GCS Clinique du Ter, Polyclinique Santa-Maria, IUCT Oncopole, EPSM de Saône-et-Loire, Hôpitaux Sud, Hôpital Necker-Enfants-Malades, Clinique du Diaconat-Fonderie, CH Lyon-Sud, Centre de la main, Clinique Saint-Léonard, Hôpital européen, CHU - Hôpital Bretonneau, Hôpital européen Georges-Pompidou, Polyclinique Aguilera, ASM, Hôpital des Massues, Hôpital privé du Vert-Galant, Centre Hospitalier d'Erstein, CHU - site Nord, Grand hôpital de l'Est-Francilien, Hôpital Ambroise-Paré, CHU - Hôpital civil, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital Nord, Clinique de la Plaine, Clinique du Parc-Monceau, Hôpital d'instruction des armées Robert-Picqué, CHU de Nantes, Centre de cardiologie du Pays basque, Clinique Rhéna, Centre Hospitalier Les Murets, Nouvelle clinique Bel-Air, Clinique Beau-Soleil, CH privé Saint-Grégoire, Hôpital Lariboisière-Fernand Widal, Centre Léon-Bérard (CLCC), Hôpital-clinique Claude-Bernard, CH Édouard-Toulouse, Institut Arnault-Tzanck, Clinique Chantecler, Centre Jean-Perrin (CLCC), Clinique de Villeneuve-d’Ascq, Hôpital Cochin, Clinique Conti, Hôpital Paris Saint-Joseph, Polyclinique du Grand-Sud, Clinique mutualiste Jules-Verne, Clinique Ormeau Pyrénées, Hôpital des Diaconesses, Clinique Saint-George, EPSM de la Marne, CH/clinique, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique La Ligne bleue, CHU - Institut cœur-poumon, Polyclinique de Reims-Bezannes, Polyclinique du Parc, Centre Clinical, Clinique du Lac et d’Argonay, CHU-Hôpital Purpan/HFE, Clinique Claude-Bernard, Clinique du Pont-de-Chaume, EPSM Morbihan, CMCO, Clinique de l’Union, CH Guillaume-Régnier, Polyclinique Saint-Côme, CHU - Hôpital Dupuytren, Hôpital Albert Schweitzer, Polyclinique Saint-Jean, Clinique Saint-Michel, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôpital privé La Montagne Lambert, Clinique Océane, Hôpital privé Nord Parisien, CHU - Hôpital de la Cavale-Blanche, Polyclinique Saint-Roch, CHU - Hôpital Nord, Nouvel Hôpital de Navarre, Hôpital Trousseau, Clinique Rive-Gauche, Hôpital Tenon, Clinique Les Eaux-Claires, GH Paul Guiraud, CH intercommunal, CHU - Hôpital de l’Archet, CH Saint-Joseph-Saint-Luc, Clinique Jean le Bon, Clinique La Croix du Sud, Centre de cardiologie Axium-Rambot, Institut Arthur-Vernes, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Clinique Sainte-Clotilde, CHU - Hôpital Saint-Eloi, Fondation Rothschild, Hôpitaux Nord (Croix-Rousse), Polyclinique Jean-Villar, Clinique Remusat, Hôpital Saint-Antoine, GH, Centre Hospitalier Sainte-Marie, Clinique Honoré-Cave, Institut du cancer de Montpellier (CLCC), Institut Bergonié (CLCC), Polyclinique, CHU - Hôpital de la Mère et de l’Enfant, Clinique Marcel-Sembat, Pôle Santé République, Hôpital Edouard-Herriot, Centre François-Baclesse (CLCC), Hôpital privé de Provence, Institut ophtalmique, Hôpital Paul-Brousse, Clinique Pasteur, Clinique mutualiste La Sagesse, Nouvelle clinique de Tours, Clinique Durieux, Polyclinique de Kerio, Clinique Victor-Pauchet, Clinique Maussins-Nollet, Hôpital privé Paul-d’Égine
2025-08-26 18:17:19,122 [DEBUG] app.features.query_analysis.query_analyst: run_all_detections called: text=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=, institution_list=Clinique de l'Essonne, IUCT/Oncopole, Hôpital privé La Louvière, CHR de Metz-Thionville - Hôpital de Mercy, Clinique du Tertre-Rouge, Centre Hospitalier Henri Guerin, CHU de Pointe-à-Pitre, Clinique du Cèdre, Clinique Geoffroy-Saint-Hilaire, Clinique la Pergola, Hôpital de la Pitié-Salpêtrière, Clinique Louis-Pasteur, Polyclinique du Beaujolais, CMCO Côte d’Opale, Clinique Saint-Jean - Sud de France, Hôpital Beaujon, CHU Sud-Réunion, Institut Calot, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical du Mans, Polyclinique Médipôle Saint-Roch, Institut Curie (CLCC), Hôpital privé du Confluent, Polyclinique Côte-Basque-Sud, Clinique du Trocadéro, Polyclinique Lyon-Nord, Hôpital privé Cannes-Oxford, Médipôle Hôpital Privé, Polyclinique Saint Laurent, Institut de cancérologie de l’Ouest, CHU Grenoble - Hôpital Sud, CHU - Hôpital Pellegrin, Hôpital Privé Nancy Lorraine, Clinique Ormeau centre, CHU - Hôpital Charles-Nicolle, Groupe Hospitalier de la Rochelle, Clinique de l’Orangerie, Clinique du Cambrésis, Groupe hospitalier Nord-Essonne, Médipôle de Savoie, CHU - Hôpital Clocheville, Polyclinique de Keraudren, Hôpital privé Beauregard, Gustave-Roussy (CLCC), Clinique Kennedy, Polyclinique Vauban, Polyclinique du Maine, Clinique de la Muette, Clinique Bretéché, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique de l’Estrée, Clinique Saint-Augustin, Espm de L’agglomeration Lilloise, Clinique du Diaconat-Roosevelt, CHU - American Memorial Hospital, CHU - Hôpital Claude-Huriez, Hôpital Belle-Isle, CHU - Hôpital Trousseau, Hôpital Pierre-Wertheimer, CM Bénigne-Joly, Institut mutualiste Montsouris, Clinique de la Sauvegarde, Clinique de l’Yvette, CMC de Parly-II, CHU d’Amiens, CHU de Martinique - site Mère-Enfant, Clinique Fontvert, Clinique Delay, Clinique Monticelli-Vélodrome, Hôpital privé Drôme-Ardèche, Clinique Arago, Centre cardiologique, Polyclinique de Navarre, CH Georges-Daumezon, Hôpital Bicêtre, Clinique mutualiste, Clinique Trenel, Clinique Saint-Hilaire, CH Henri-Laborit, Centre Antoine-Lacassagne (CLCC), Clinique Jean Causse, CHU - Hôpital Larrey, Hôpital privé Paris-Essonne, Clinique Sainte-Marie, Clinique des Franciscaines, Polyclinique de Reims-Bezannes (Marne), Infirmerie protestante de Lyon, CHR de Metz-Thionville - Hôpital Bel-Air, Institut Curie, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Polyclinique de la Baie, CHU Grenoble - Site Nord, CHU - Hôpital Lapeyronie, Hôpital privé de Villeneuve-d’Ascq, Centre orthopédique médico-chirurgical, Hôpital Robert Schuman, Hôpital privé Natecia, Clinique Bouchard, CHU - Hôpital Haut-Lévêque, Clinique Rhône Durance, Polyclinique de Blois, Hôpital Saint-Louis, CHU - Hôpital d’Estaing, CHU Nantes - Hôpital Mère Enfant, Clinique Belledonne, CH privé du Montgardé, Hôpital Renée-Sabran, Clinique Les Fontaines, Clinique du sport, Clinique Saint-Charles, Maison de santé Bagatelle, Clinique ambulatoire de Domont, Polyclinique Majorelle, Pôle santé Léonard-de-Vinci, Centre ambulatoire Kleber, Clinique de la Part-Dieu, CH Montfavet, CH Charles-Perrens, HCL - Hôpital Femme-mère-enfant, CHU - Hôpital Central, Clinique du Grand-Large, CHU - Centre chirurgical Emile-Gallé, Centre Hospitalier Gérard-Marchant, Hôpital Jean-Verdier, Hôtel-Dieu, Hôpital privé Vert-Coteau, CHU - Hôpital Jeanne-de-Flandre, CMC Floréal, Hôpital d'instruction des armées Legouest, Hôpital privé de Marne-la-Vallée, Clinique de l’Europe, Hôpital Henri-Mondor, Polyclinique de la Région-Mantaise, Pôle de Santé du Villeneuvois, CHU - Gabriel-Montpied, Clinique Bizet, Hôpital d'instruction des armées Sainte-Anne, Clinique Ambroise-Paré, Clinique Saint-Nabor, Institut de cancérologie de Lorraine (CLCC), Clinique du Pré, Polyclinique de Limoges - site Émailleurs, Hôpital Louis-Mourier, Hôpital d'instruction des armées Desgenettes, Institut universitaire de la face et du cou, EPS Ville-Évrard, Centre Henri-Becquerel (CLCC), Hôpital de la Timone (adultes), Hôpital privé La Châtaigneraie, Centre Hospitalier des Pyrénées, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Pasteur, Hôpitaux civils, Clinique Saint-Jean-de-Dieu, CHU d'Amiens/Institut ophtalmologique de Picardie, Centre Hospitalier de Vauclaire, Clinique ophtalmologique Thiers, Clinique mutualiste de la Porte-de-l'Orient, Clinique Sainte-Marie (GHICL), Hôpital Louis-Pradel, CH national d’ophtalmologie des Quinze-Vingts, Centre psychothérapique de Nancy, Clinique Saint-Vincent-de-Paul, Clinique de la Miséricorde, Hôpital privé de Marne Chantereine, CH privé Claude-Galien, Clinique des Cèdres, GHU Paris Psychiatrie et neurosciences, Clinique Notre-Dame-de-l’Espérance, Centre Georges-François-Leclerc (CLCC), Clinique du Parc, Clinique Saint-Amé, Clinique urologique Nantes-Atlantis, Hôpital Avicenne, Polyclinique de Picardie, Clinique Toulouse-Lautrec, Santé Atlantique, Hôpital privé Arras-Les Bonnettes, Hôpital privé Jean-Mermoz, Clinique de l’Espérance, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Les Fleurs, EPSM Etienne-Gourmelen, CHU - Hôpital Saint-André, Euromed Cardio, Médipôle Garonne, Pôle santé Oréliance, Hôpital Nord Franche-Comté-Belfort, Polyclinique Francheville, CHU - Hôpital de Hautepierre, CH Basse-Terre (Guadeloupe), Hôpital privé Le Bois, Clinique Pasteur-Lanroze, EPSM Lille-Métropole, Institut de cancérologie Strasbourg Europe, Clinique mutualiste catalane, CHU - Hôpital Morvan, Clinique mutualiste de l’Estuaire, Clinique cardiologique, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, CHU Réunion, Hôpital privé des Peupliers, Centre médico-chirurgical et obstétrical, Clinique Sainte-Anne, Polyclinique de Poitiers, Clinique Saint-André, Hôpital Bichat, Clinique du Millénaire, CHU - Hôpital Maison-Blanche, Centre Hospitalier du Rouvray, Centre cardiologique du Nord, Centre Eugène-Marquis (CLCC), Clinique Saint-Paul, Hôpital privé Saint-Martin, Centre Hospitalier Maurice Despinoy, Hôpital de la Timone (enfants), Clinique Saint-Antoine, Hôpital Saint-Philibert (GHICL), Clinique Saint-Vincent, Hôpital privé, Clinique mutualiste de Bonneveine, Clinique de l'Alma, GHP Ambroise-Paré - Hartmann (92), Clinique Lille-Sud, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Paris Lilas, Centre Oscar-Lambret (CLCC), CHU - Maternité, Polyclinique de Bordeaux-Tondu, Clinique générale, Hôpital privé d’Antony, CHP de l’Europe, Hôpital privé Armand-Brillard, GHI, CMC Pierre-Cherest, Clinique du Fief-de-Grimoire, Hôpital privé de l’Estuaire, Hôpital privé de l’Ouest parisien, Hôpital privé de la Loire, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital de la Croix Rousse (HCL) / CH, Epsan, Clinique Mathilde, Clinique du Val-d’Or, Clinique des Orchidées, CHR, Hôpital Raymond-Poincaré, Centre Hospitalier Le Mas Careiron, Hôpital Hôtel-Dieu, Centre Hospitalier Le Bon Sauveur, Clinique Convert, Polyclinique Urbain-V, CH/Clinique, CHU - Hôpital Robert-Debré, Hôpital Lariboisière, Clinique du Croisé-Laroche, CHU - Hôpital Pontchaillou, Polyclinique de Courlancy, Clinique Victor-Hugo, Clinique Bon-Secours, Hôpital privé Sévigné, Clinique Charcot, CHI, Clinique Saint-Pierre, EPS Barthélemy-Durand, Hôpital de la Timone (Enfants), Hôpital privé de la Seine-Saint-Denis, Les Franciscaines, Centre Hospitalier La Chartreuse, Hôpital privé des Côtes-d’Armor, Centre Hospitalier Drôme Vivarais, CHU - Hôpital Sud, Hôpital Robert-Debré, Clinique de Bercy, CHU de La Réunion - Félix-Guyon, Centre Hospitalier Le Vinatier, Hôpital privé Dijon-Bourgogne, Hôpital Saint-Camille, CH Esquirol, Centre de chirurgie ophtalmologique, Hôpital d'instruction des armées Percy, Centre Hospitalier Montperrin, Hôpital Antoine-Béclère, CHU - Hôpital Purpan, Clinique de l’Atlantique, Clinique du Renaison, Clinique de l’Anjou, Hôpital d'instruction des armées Laveran, Hôpitaux pédiatriques, CHU - Hôpital de la Côte de nacre, Hopital Joseph-Ducuing, Polyclinique Saint-François, Hôpital privé Pays-de-Savoie, Clinique Saint-Joseph, Clinique d’Occitanie, Institut Paoli-Calmettes (CLCC), Institut franco-britannique Kléber, Hôpital privé de l’Est lyonnais, Hôpital Saint-Joseph, Clinique Juge, Clinique des Ormeaux, Hôpitaux de Saint-Maurice, Clinique Jouvenet, GH Saint-Vincent - Clinique Sainte-Barbe, CH privé Saint-Martin, CHU - Hôpitaux de Brabois, Polyclinique du Parc-Drevon, CHU - Hôpital Gui-de-Chauliac, Institut Jean-Godinot (CLCC), CHU - Hôpitaux mère-enfants, Institut hospitalier Jacques-Cartier, Hôpital d'instruction des armées Bégin, Clinique Anne-Artois, Polyclinique de Limoges - site Chénieux, Centre Hospitalier George Sand, Clinique Axium, Hôpital privé de la Casamance, Clinique du Val-d’Ouest Vendôme, Clinique Esquirol-Saint-Hilaire, Hôpital de la Conception, Hôpital privé Clairval, Hôpital Foch, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Turin, Clinique Saint-François, Hôpital privé de La Miotte, GH mutualiste, Hôpital Corentin-Celton, CHU - Hôpital Roger-Salengro, Clinique Clémentville, CHU de Martinique, Clinique Belharra, Polyclinique Bordeaux-Rive droite, Clinique Tivoli-Ducos, GCS Clinique du Ter, Polyclinique Santa-Maria, IUCT Oncopole, EPSM de Saône-et-Loire, Hôpitaux Sud, Hôpital Necker-Enfants-Malades, Clinique du Diaconat-Fonderie, CH Lyon-Sud, Centre de la main, Clinique Saint-Léonard, Hôpital européen, CHU - Hôpital Bretonneau, Hôpital européen Georges-Pompidou, Polyclinique Aguilera, ASM, Hôpital des Massues, Hôpital privé du Vert-Galant, Centre Hospitalier d'Erstein, CHU - site Nord, Grand hôpital de l'Est-Francilien, Hôpital Ambroise-Paré, CHU - Hôpital civil, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital Nord, Clinique de la Plaine, Clinique du Parc-Monceau, Hôpital d'instruction des armées Robert-Picqué, CHU de Nantes, Centre de cardiologie du Pays basque, Clinique Rhéna, Centre Hospitalier Les Murets, Nouvelle clinique Bel-Air, Clinique Beau-Soleil, CH privé Saint-Grégoire, Hôpital Lariboisière-Fernand Widal, Centre Léon-Bérard (CLCC), Hôpital-clinique Claude-Bernard, CH Édouard-Toulouse, Institut Arnault-Tzanck, Clinique Chantecler, Centre Jean-Perrin (CLCC), Clinique de Villeneuve-d’Ascq, Hôpital Cochin, Clinique Conti, Hôpital Paris Saint-Joseph, Polyclinique du Grand-Sud, Clinique mutualiste Jules-Verne, Clinique Ormeau Pyrénées, Hôpital des Diaconesses, Clinique Saint-George, EPSM de la Marne, CH/clinique, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique La Ligne bleue, CHU - Institut cœur-poumon, Polyclinique de Reims-Bezannes, Polyclinique du Parc, Centre Clinical, Clinique du Lac et d’Argonay, CHU-Hôpital Purpan/HFE, Clinique Claude-Bernard, Clinique du Pont-de-Chaume, EPSM Morbihan, CMCO, Clinique de l’Union, CH Guillaume-Régnier, Polyclinique Saint-Côme, CHU - Hôpital Dupuytren, Hôpital Albert Schweitzer, Polyclinique Saint-Jean, Clinique Saint-Michel, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôpital privé La Montagne Lambert, Clinique Océane, Hôpital privé Nord Parisien, CHU - Hôpital de la Cavale-Blanche, Polyclinique Saint-Roch, CHU - Hôpital Nord, Nouvel Hôpital de Navarre, Hôpital Trousseau, Clinique Rive-Gauche, Hôpital Tenon, Clinique Les Eaux-Claires, GH Paul Guiraud, CH intercommunal, CHU - Hôpital de l’Archet, CH Saint-Joseph-Saint-Luc, Clinique Jean le Bon, Clinique La Croix du Sud, Centre de cardiologie Axium-Rambot, Institut Arthur-Vernes, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Clinique Sainte-Clotilde, CHU - Hôpital Saint-Eloi, Fondation Rothschild, Hôpitaux Nord (Croix-Rousse), Polyclinique Jean-Villar, Clinique Remusat, Hôpital Saint-Antoine, GH, Centre Hospitalier Sainte-Marie, Clinique Honoré-Cave, Institut du cancer de Montpellier (CLCC), Institut Bergonié (CLCC), Polyclinique, CHU - Hôpital de la Mère et de l’Enfant, Clinique Marcel-Sembat, Pôle Santé République, Hôpital Edouard-Herriot, Centre François-Baclesse (CLCC), Hôpital privé de Provence, Institut ophtalmique, Hôpital Paul-Brousse, Clinique Pasteur, Clinique mutualiste La Sagesse, Nouvelle clinique de Tours, Clinique Durieux, Polyclinique de Kerio, Clinique Victor-Pauchet, Clinique Maussins-Nollet, Hôpital privé Paul-d’Égine
2025-08-26 18:17:19,123 [INFO] app.features.query_analysis.specialty.specialty_detection: Detecting specialty from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:17:19,123 [INFO] app.features.query_analysis.specialty.specialty_detection: Specialty detected via keywords: Cancer de la vessie
2025-08-26 18:17:19,123 [DEBUG] app.features.query_analysis.number_institutions.number_institutions_detection: Detecting number_institutions from prompt: Quels sont les meilleurs hôpitaux à Paris pour la ...
2025-08-26 18:17:19,126 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nExtrayez le nombre d\'établissements demandés dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le nombre d\'établissements peut être mentionné de manière implicite si le contexte de la conversation montre qu\'on parle d\'un nombre spécifique.\n\nRépondez UNIQUEMENT avec le nombre (1-50) ou 0 si non mentionné.\n\nPar exemple: pour la phrase \'Quels sont les trois meilleurs hôpitaux pour soigner mon audition ?\', tu me retourneras: \'3\'.\n\nSi la phrase inclue une expression comme \'le plus xxx\' ou du superlatif qui implique implicitement une seule entité comme \'le meilleur\', alors tu me retourneras \'1\'\nPar exemple: pour la phrase \'Quel est la meilleur clinique de Nantes?\' ou \'Dis moi l\'établissement le plus populaire de France\' tu me retourneras: \'1\'.\n\nExemples avec contexte conversationnel:\n- Avec historique demandant "les 5 meilleurs", \'et privé?\' → 5 (garde le nombre du contexte)\n- Avec historique général, \'le meilleur\' → 1 (nouveau nombre explicite)\n- Avec historique sans nombre, \'aussi\' → 0 (aucun nombre mentionné)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:19,126 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:19,126 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:19,127 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:19,127 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:19,127 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:19,127 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:19,709 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:23 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'379'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'411'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999678'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_b10eb80f3b9441e1809958f251fbf5e0'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3996d7de1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:19,710 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:19,710 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:19,719 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:19,719 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:19,719 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:19,719 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:23 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '379', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '411', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999678', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_b10eb80f3b9441e1809958f251fbf5e0', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a3996d7de1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:19,719 [DEBUG] openai._base_client: request_id: req_b10eb80f3b9441e1809958f251fbf5e0
2025-08-26 18:17:19,720 [DEBUG] app.utility.llm_helpers: LLM call 'detect_number_institutions' successful: {'prompt_tokens': 310, 'completion_tokens': 1, 'total_tokens': 311}, cost=4.71e-05
2025-08-26 18:17:19,720 [DEBUG] app.features.query_analysis.city.city_analyst: process_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:19,720 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:19,720 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:17:19,720 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:19,723 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:19,724 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:19,724 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:19,725 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:19,725 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:19,725 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:19,725 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:20,238 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:24 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'325'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'348'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_590135f6f1cb4f02baa5dc9efdb2221e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a39d18b2e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:20,238 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:20,239 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:20,241 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:20,241 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:20,241 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:20,242 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:24 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '325', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '348', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_590135f6f1cb4f02baa5dc9efdb2221e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a39d18b2e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:20,242 [DEBUG] openai._base_client: request_id: req_590135f6f1cb4f02baa5dc9efdb2221e
2025-08-26 18:17:20,243 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:17:20,243 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:20,243 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:20,243 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:17:20,243 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:17:20,243 [DEBUG] app.features.query_analysis.city.city_analyst: CityAnalyst.process_city: city_result={'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:17:20,243 [DEBUG] app.features.query_analysis.city.city_validation: check called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:20,244 [DEBUG] app.features.query_analysis.city.city_detection: detect_city called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:20,244 [INFO] app.features.query_analysis.city.city_detection: Detecting city from prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'
2025-08-26 18:17:20,244 [DEBUG] app.features.query_analysis.city.city_detection: _detect_city_status called: prompt=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conv_history=
2025-08-26 18:17:20,247 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nAnalysez cette phrase pour détecter des informations de localisation.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Une ville peut être mentionnée de manière implicite si le contexte de la conversation montre qu'on parle d'une localisation spécifique.\n\nRépondez avec:\n- 0 si aucune localisation n'est mentionnée\n- 1 si ville étrangère  \n- 2 si confusion entre villes françaises\n- 3 si une ville ou localisation française claire est mentionnée\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant Paris, 'Et à Lyon ?' → 3 (Lyon est mentionné)\n- Avec historique sur Marseille, 'Merci' → 0 (aucune nouvelle localisation)\n- Avec historique général, 'À Londres ?' → 1 (ville étrangère)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:20,248 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:20,248 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:20,248 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:20,248 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:20,248 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:20,249 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:20,724 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:25 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'299'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'315'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999763'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_4534a40297fc43c58abe1718f758c63d'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3a06a0ee1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:20,724 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:20,724 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:20,729 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:20,729 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:20,729 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:20,730 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:25 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '299', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '315', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999763', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_4534a40297fc43c58abe1718f758c63d', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a3a06a0ee1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:20,730 [DEBUG] openai._base_client: request_id: req_4534a40297fc43c58abe1718f758c63d
2025-08-26 18:17:20,730 [DEBUG] app.utility.llm_helpers: LLM call 'detect_city_status' successful: {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, cost=3.315e-05
2025-08-26 18:17:20,731 [INFO] app.features.query_analysis.city.city_detection: Raw LLM response for city status: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:20,731 [WARNING] app.utility.wrappers: Failed to parse city response: {'content': '3', 'token_usage': {'prompt_tokens': 217, 'completion_tokens': 1, 'total_tokens': 218}, 'cost': 3.315e-05}
2025-08-26 18:17:20,731 [INFO] app.features.query_analysis.city.city_detection: Parsed city status: 0
2025-08-26 18:17:20,731 [INFO] app.features.query_analysis.city.city_detection: City detection result: {'city': None, 'detection_method': 'status', 'cost': 0.0, 'status_code': 0, 'token_usage': 0.0}
2025-08-26 18:17:20,731 [ERROR] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: Unexpected exception: 'float' object has no attribute 'get'
2025-08-26 18:17:20,734 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nUn des noms exact de ma liste d'établissements est il mentionné précisément dans cette phrase?\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un nom d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un établissement spécifique.\n\nVoici ma liste d'établissements: \n\nRéponds UNIQUEMENT avec le nom d'établissement exact de la liste si la phrase contient un des noms exacts d'établissement.\nSi aucun de ces établissement n'est mentionné dans ma phrase, renvoie moi EXACTEMENT ces deux mots: 'aucune correspondance'.\nSi la Ville de l'établissement est mentionnée mais pas le nom complet, par exemple 'Villeneuve-d'Ascq' est mentionné mais pas 'Clinique de Villeneuve-d'Ascq' alors tu renverras 'aucune correspondance'. \n\nVoici des exemples sans noms d'établissement: pour la phrase 'Je cherche un hôpital pour soigner mon audition à Toulon ?' ou 'Quelle est la meilleure clinique de Limoges?', tu me répondras 'aucune correspondance'.\nVoici un exemple avec noms d'établissement: pour la phrase 'Est-ce que l'Hôpital Edouard-Herriot est bon en cas de problèmes auditifs ?' tu me répondras 'Hôpital Edouard-Herriot'.\n\nExemples avec contexte conversationnel:\n- Avec historique mentionnant 'Hôpital Edouard-Herriot', 'et privé?' → 'aucune correspondance' (pas de nouvel établissement mentionné)\n- Avec historique général, 'à la Pitié-Salpêtrière' → 'Hôpital Pitié-Salpêtrière' (si ce nom exact existe dans la liste)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:20,735 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:20,735 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:20,735 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:20,735 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:20,736 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:20,736 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:21,308 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:25 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'394'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'418'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999566'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'2ms'), (b'x-request-id', b'req_459229fb71d6474ab87e7ff1877a9623'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3a36ae1e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:21,308 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:21,309 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:21,312 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:21,313 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:21,313 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:21,313 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:25 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '394', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '418', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999566', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '2ms', 'x-request-id': 'req_459229fb71d6474ab87e7ff1877a9623', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a3a36ae1e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:21,313 [DEBUG] openai._base_client: request_id: req_459229fb71d6474ab87e7ff1877a9623
2025-08-26 18:17:21,315 [DEBUG] app.utility.llm_helpers: LLM call 'detect_specific_institution' successful: {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, cost=6.375e-05
2025-08-26 18:17:21,315 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Raw LLM response for specific institution detection: {'content': 'aucune correspondance', 'token_usage': {'prompt_tokens': 409, 'completion_tokens': 4, 'total_tokens': 413}, 'cost': 6.375e-05}
2025-08-26 18:17:21,315 [DEBUG] app.features.query_analysis.institution_name.institution_name_detection: Specific institution detection result: aucune correspondance
2025-08-26 18:17:21,315 [DEBUG] app.features.query_analysis.institution_name.institution_name_validation: Validation result for 'aucune correspondance': False
2025-08-26 18:17:21,315 [INFO] app.features.query_analysis.institution_name.institution_name_validation: No specific institution detected, using fallback type
2025-08-26 18:17:21,318 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': "\nDétectez le type d'établissement de soin dans le message suivant.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ANALYSER: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Le type d'établissement peut être mentionné de manière implicite si le contexte de la conversation montre qu'on parle d'un type spécifique.\n\nRépondez UNIQUEMENT avec:\n- 0 si aucun type mentionné\n- 1 si public\n- 2 si privé\n\nExemples avec contexte conversationnel:\n- Avec historique sur les hôpitaux publics, 'et privé?' → 2 (demande maintenant le privé)\n- Avec historique sur les hôpitaux privés, 'et public?' → 1 (demande maintenant le public)\n- Avec historique général, 'aussi' → 0 (aucun type spécifique mentionné)\n", 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-26 18:17:21,319 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-26 18:17:21,319 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-26 18:17:21,319 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-26 18:17:21,320 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-26 18:17:21,320 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-26 18:17:21,320 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-26 18:17:22,624 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Tue, 26 Aug 2025 16:17:26 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'361'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1151'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999781'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'1ms'), (b'x-request-id', b'req_54547ba336cd497896487be5a2bef104'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'9754a3a71cd9e1b5-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-26 18:17:22,625 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-26 18:17:22,625 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-26 18:17:22,630 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-26 18:17:22,630 [DEBUG] httpcore.http11: response_closed.started
2025-08-26 18:17:22,630 [DEBUG] httpcore.http11: response_closed.complete
2025-08-26 18:17:22,630 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Tue, 26 Aug 2025 16:17:26 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '361', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1151', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999781', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '1ms', 'x-request-id': 'req_54547ba336cd497896487be5a2bef104', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '9754a3a71cd9e1b5-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-26 18:17:22,630 [DEBUG] openai._base_client: request_id: req_54547ba336cd497896487be5a2bef104
2025-08-26 18:17:22,631 [DEBUG] app.utility.llm_helpers: LLM call 'detect_public_private_preference' successful: {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, cost=3.27e-05
2025-08-26 18:17:22,631 [DEBUG] app.features.query_analysis.institution_type.institution_type_detection: Public/private preference detection result: no match
2025-08-26 18:17:22,631 [DEBUG] app.features.query_analysis.query_analyst: QueryAnalyst.run_all_detections: consolidated results={'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:17:22,631 [DEBUG] app.services.pipeline_orchestrator_service: Full detections dict: {'city': None, 'city_detected': False, 'city_detection_method': None, 'city_cost': 0.0, 'city_token_usage': 0, 'institution_name': None, 'institution_name_detection_method': 'llm', 'institution_name_cost': 6.375e-05, 'institution_name_token_usage': 413, 'institution_type': 'aucune correspondance', 'institution_type_detection_method': 'llm', 'institution_type_cost': 3.27e-05, 'institution_type_token_usage': {'prompt_tokens': 214, 'completion_tokens': 1, 'total_tokens': 215}, 'specialty': 'Cancer de la vessie', 'specialty_detection_method': 'keyword', 'specialty_cost': 0.0, 'specialty_token_usage': 0.0, 'original_detected_specialty': 'Cancer de la vessie', 'number_institutions': 3, 'number_institutions_detection_method': 'llm', 'number_institutions_cost': 4.71e-05, 'number_institutions_token_usage': 311}
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: set_detection_results: specialty='Cancer de la vessie', city=None, city_detected=False, institution_type='aucune correspondance', number_institutions=3, institution_name=None, institution_mentioned=None
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.specialty set to: 'Cancer de la vessie'
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.city set to: None
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.city_detected set to: False
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.institution_type set to: 'aucune correspondance'
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.number_institutions set to: 3
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.institution_name set to: None
2025-08-26 18:17:22,632 [DEBUG] app.services.data_processing_service: DataProcessor.institution_mentioned set to: None
2025-08-26 18:17:22,668 [INFO] app.services.data_processing_service: Getting institution list from coordinates DataFrame
2025-08-26 18:17:22,669 [DEBUG] app.services.data_processing_service: Institution list: Clinique de l'Essonne, IUCT/Oncopole, Hôpital privé La Louvière, CHR de Metz-Thionville - Hôpital de Mercy, Clinique du Tertre-Rouge, Centre Hospitalier Henri Guerin, CHU de Pointe-à-Pitre, Clinique du Cèdre, Clinique Geoffroy-Saint-Hilaire, Clinique la Pergola, Hôpital de la Pitié-Salpêtrière, Clinique Louis-Pasteur, Polyclinique du Beaujolais, CMCO Côte d’Opale, Clinique Saint-Jean - Sud de France, Hôpital Beaujon, CHU Sud-Réunion, Institut Calot, Institut d’hématologie et d'oncologie pédiatrique, Centre médico-chirurgical du Mans, Polyclinique Médipôle Saint-Roch, Institut Curie (CLCC), Hôpital privé du Confluent, Polyclinique Côte-Basque-Sud, Clinique du Trocadéro, Polyclinique Lyon-Nord, Hôpital privé Cannes-Oxford, Médipôle Hôpital Privé, Polyclinique Saint Laurent, Institut de cancérologie de l’Ouest, CHU Grenoble - Hôpital Sud, CHU - Hôpital Pellegrin, Hôpital Privé Nancy Lorraine, Clinique Ormeau centre, CHU - Hôpital Charles-Nicolle, Groupe Hospitalier de la Rochelle, Clinique de l’Orangerie, Clinique du Cambrésis, Groupe hospitalier Nord-Essonne, Médipôle de Savoie, CHU - Hôpital Clocheville, Polyclinique de Keraudren, Hôpital privé Beauregard, Gustave-Roussy (CLCC), Clinique Kennedy, Polyclinique Vauban, Polyclinique du Maine, Clinique de la Muette, Clinique Bretéché, Nouvelle clinique de La Ciotat (Bouches-du-Rhône), Clinique de l’Estrée, Clinique Saint-Augustin, Espm de L’agglomeration Lilloise, Clinique du Diaconat-Roosevelt, CHU - American Memorial Hospital, CHU - Hôpital Claude-Huriez, Hôpital Belle-Isle, CHU - Hôpital Trousseau, Hôpital Pierre-Wertheimer, CM Bénigne-Joly, Institut mutualiste Montsouris, Clinique de la Sauvegarde, Clinique de l’Yvette, CMC de Parly-II, CHU d’Amiens, CHU de Martinique - site Mère-Enfant, Clinique Fontvert, Clinique Delay, Clinique Monticelli-Vélodrome, Hôpital privé Drôme-Ardèche, Clinique Arago, Centre cardiologique, Polyclinique de Navarre, CH Georges-Daumezon, Hôpital Bicêtre, Clinique mutualiste, Clinique Trenel, Clinique Saint-Hilaire, CH Henri-Laborit, Centre Antoine-Lacassagne (CLCC), Clinique Jean Causse, CHU - Hôpital Larrey, Hôpital privé Paris-Essonne, Clinique Sainte-Marie, Clinique des Franciscaines, Polyclinique de Reims-Bezannes (Marne), Infirmerie protestante de Lyon, CHR de Metz-Thionville - Hôpital Bel-Air, Institut Curie, Polyclinique Saint-Privat, Centre chirurgical Marie-Lannelongue, Polyclinique de la Baie, CHU Grenoble - Site Nord, CHU - Hôpital Lapeyronie, Hôpital privé de Villeneuve-d’Ascq, Centre orthopédique médico-chirurgical, Hôpital Robert Schuman, Hôpital privé Natecia, Clinique Bouchard, CHU - Hôpital Haut-Lévêque, Clinique Rhône Durance, Polyclinique de Blois, Hôpital Saint-Louis, CHU - Hôpital d’Estaing, CHU Nantes - Hôpital Mère Enfant, Clinique Belledonne, CH privé du Montgardé, Hôpital Renée-Sabran, Clinique Les Fontaines, Clinique du sport, Clinique Saint-Charles, Maison de santé Bagatelle, Clinique ambulatoire de Domont, Polyclinique Majorelle, Pôle santé Léonard-de-Vinci, Centre ambulatoire Kleber, Clinique de la Part-Dieu, CH Montfavet, CH Charles-Perrens, HCL - Hôpital Femme-mère-enfant, CHU - Hôpital Central, Clinique du Grand-Large, CHU - Centre chirurgical Emile-Gallé, Centre Hospitalier Gérard-Marchant, Hôpital Jean-Verdier, Hôtel-Dieu, Hôpital privé Vert-Coteau, CHU - Hôpital Jeanne-de-Flandre, CMC Floréal, Hôpital d'instruction des armées Legouest, Hôpital privé de Marne-la-Vallée, Clinique de l’Europe, Hôpital Henri-Mondor, Polyclinique de la Région-Mantaise, Pôle de Santé du Villeneuvois, CHU - Gabriel-Montpied, Clinique Bizet, Hôpital d'instruction des armées Sainte-Anne, Clinique Ambroise-Paré, Clinique Saint-Nabor, Institut de cancérologie de Lorraine (CLCC), Clinique du Pré, Polyclinique de Limoges - site Émailleurs, Hôpital Louis-Mourier, Hôpital d'instruction des armées Desgenettes, Institut universitaire de la face et du cou, EPS Ville-Évrard, Centre Henri-Becquerel (CLCC), Hôpital de la Timone (adultes), Hôpital privé La Châtaigneraie, Centre Hospitalier des Pyrénées, Polyclinique Saint-Jean l’Ermitage, CHU - Hôpital Pasteur, Hôpitaux civils, Clinique Saint-Jean-de-Dieu, CHU d'Amiens/Institut ophtalmologique de Picardie, Centre Hospitalier de Vauclaire, Clinique ophtalmologique Thiers, Clinique mutualiste de la Porte-de-l'Orient, Clinique Sainte-Marie (GHICL), Hôpital Louis-Pradel, CH national d’ophtalmologie des Quinze-Vingts, Centre psychothérapique de Nancy, Clinique Saint-Vincent-de-Paul, Clinique de la Miséricorde, Hôpital privé de Marne Chantereine, CH privé Claude-Galien, Clinique des Cèdres, GHU Paris Psychiatrie et neurosciences, Clinique Notre-Dame-de-l’Espérance, Centre Georges-François-Leclerc (CLCC), Clinique du Parc, Clinique Saint-Amé, Clinique urologique Nantes-Atlantis, Hôpital Avicenne, Polyclinique de Picardie, Clinique Toulouse-Lautrec, Santé Atlantique, Hôpital privé Arras-Les Bonnettes, Hôpital privé Jean-Mermoz, Clinique de l’Espérance, Polyclinique Bordeaux-Nord-Aquitaine, Polyclinique Les Fleurs, EPSM Etienne-Gourmelen, CHU - Hôpital Saint-André, Euromed Cardio, Médipôle Garonne, Pôle santé Oréliance, Hôpital Nord Franche-Comté-Belfort, Polyclinique Francheville, CHU - Hôpital de Hautepierre, CH Basse-Terre (Guadeloupe), Hôpital privé Le Bois, Clinique Pasteur-Lanroze, EPSM Lille-Métropole, Institut de cancérologie Strasbourg Europe, Clinique mutualiste catalane, CHU - Hôpital Morvan, Clinique mutualiste de l’Estuaire, Clinique cardiologique, Clinique Mutualiste de Bretagne Occidentale, CHU - Hôpital Rangueil, CHU Réunion, Hôpital privé des Peupliers, Centre médico-chirurgical et obstétrical, Clinique Sainte-Anne, Polyclinique de Poitiers, Clinique Saint-André, Hôpital Bichat, Clinique du Millénaire, CHU - Hôpital Maison-Blanche, Centre Hospitalier du Rouvray, Centre cardiologique du Nord, Centre Eugène-Marquis (CLCC), Clinique Saint-Paul, Hôpital privé Saint-Martin, Centre Hospitalier Maurice Despinoy, Hôpital de la Timone (enfants), Clinique Saint-Antoine, Hôpital Saint-Philibert (GHICL), Clinique Saint-Vincent, Hôpital privé, Clinique mutualiste de Bonneveine, Clinique de l'Alma, GHP Ambroise-Paré - Hartmann (92), Clinique Lille-Sud, CHU - Hôpital Arnaud-de-Villeneuve, Clinique Paris Lilas, Centre Oscar-Lambret (CLCC), CHU - Maternité, Polyclinique de Bordeaux-Tondu, Clinique générale, Hôpital privé d’Antony, CHP de l’Europe, Hôpital privé Armand-Brillard, GHI, CMC Pierre-Cherest, Clinique du Fief-de-Grimoire, Hôpital privé de l’Estuaire, Hôpital privé de l’Ouest parisien, Hôpital privé de la Loire, Hôpital Saint-Vincent-de-Paul (GHICL), Hôpital de la Croix Rousse (HCL) / CH, Epsan, Clinique Mathilde, Clinique du Val-d’Or, Clinique des Orchidées, CHR, Hôpital Raymond-Poincaré, Centre Hospitalier Le Mas Careiron, Hôpital Hôtel-Dieu, Centre Hospitalier Le Bon Sauveur, Clinique Convert, Polyclinique Urbain-V, CH/Clinique, CHU - Hôpital Robert-Debré, Hôpital Lariboisière, Clinique du Croisé-Laroche, CHU - Hôpital Pontchaillou, Polyclinique de Courlancy, Clinique Victor-Hugo, Clinique Bon-Secours, Hôpital privé Sévigné, Clinique Charcot, CHI, Clinique Saint-Pierre, EPS Barthélemy-Durand, Hôpital de la Timone (Enfants), Hôpital privé de la Seine-Saint-Denis, Les Franciscaines, Centre Hospitalier La Chartreuse, Hôpital privé des Côtes-d’Armor, Centre Hospitalier Drôme Vivarais, CHU - Hôpital Sud, Hôpital Robert-Debré, Clinique de Bercy, CHU de La Réunion - Félix-Guyon, Centre Hospitalier Le Vinatier, Hôpital privé Dijon-Bourgogne, Hôpital Saint-Camille, CH Esquirol, Centre de chirurgie ophtalmologique, Hôpital d'instruction des armées Percy, Centre Hospitalier Montperrin, Hôpital Antoine-Béclère, CHU - Hôpital Purpan, Clinique de l’Atlantique, Clinique du Renaison, Clinique de l’Anjou, Hôpital d'instruction des armées Laveran, Hôpitaux pédiatriques, CHU - Hôpital de la Côte de nacre, Hopital Joseph-Ducuing, Polyclinique Saint-François, Hôpital privé Pays-de-Savoie, Clinique Saint-Joseph, Clinique d’Occitanie, Institut Paoli-Calmettes (CLCC), Institut franco-britannique Kléber, Hôpital privé de l’Est lyonnais, Hôpital Saint-Joseph, Clinique Juge, Clinique des Ormeaux, Hôpitaux de Saint-Maurice, Clinique Jouvenet, GH Saint-Vincent - Clinique Sainte-Barbe, CH privé Saint-Martin, CHU - Hôpitaux de Brabois, Polyclinique du Parc-Drevon, CHU - Hôpital Gui-de-Chauliac, Institut Jean-Godinot (CLCC), CHU - Hôpitaux mère-enfants, Institut hospitalier Jacques-Cartier, Hôpital d'instruction des armées Bégin, Clinique Anne-Artois, Polyclinique de Limoges - site Chénieux, Centre Hospitalier George Sand, Clinique Axium, Hôpital privé de la Casamance, Clinique du Val-d’Ouest Vendôme, Clinique Esquirol-Saint-Hilaire, Hôpital de la Conception, Hôpital privé Clairval, Hôpital Foch, CHU - Hôtel-Dieu - Hôpital mère-enfants, Clinique Turin, Clinique Saint-François, Hôpital privé de La Miotte, GH mutualiste, Hôpital Corentin-Celton, CHU - Hôpital Roger-Salengro, Clinique Clémentville, CHU de Martinique, Clinique Belharra, Polyclinique Bordeaux-Rive droite, Clinique Tivoli-Ducos, GCS Clinique du Ter, Polyclinique Santa-Maria, IUCT Oncopole, EPSM de Saône-et-Loire, Hôpitaux Sud, Hôpital Necker-Enfants-Malades, Clinique du Diaconat-Fonderie, CH Lyon-Sud, Centre de la main, Clinique Saint-Léonard, Hôpital européen, CHU - Hôpital Bretonneau, Hôpital européen Georges-Pompidou, Polyclinique Aguilera, ASM, Hôpital des Massues, Hôpital privé du Vert-Galant, Centre Hospitalier d'Erstein, CHU - site Nord, Grand hôpital de l'Est-Francilien, Hôpital Ambroise-Paré, CHU - Hôpital civil, Hôpital privé Toulon Hyères-Saint-Jean, Hôpital Nord, Clinique de la Plaine, Clinique du Parc-Monceau, Hôpital d'instruction des armées Robert-Picqué, CHU de Nantes, Centre de cardiologie du Pays basque, Clinique Rhéna, Centre Hospitalier Les Murets, Nouvelle clinique Bel-Air, Clinique Beau-Soleil, CH privé Saint-Grégoire, Hôpital Lariboisière-Fernand Widal, Centre Léon-Bérard (CLCC), Hôpital-clinique Claude-Bernard, CH Édouard-Toulouse, Institut Arnault-Tzanck, Clinique Chantecler, Centre Jean-Perrin (CLCC), Clinique de Villeneuve-d’Ascq, Hôpital Cochin, Clinique Conti, Hôpital Paris Saint-Joseph, Polyclinique du Grand-Sud, Clinique mutualiste Jules-Verne, Clinique Ormeau Pyrénées, Hôpital des Diaconesses, Clinique Saint-George, EPSM de la Marne, CH/clinique, Clinique de Vitrolles (Bouches-du-Rhône), Polyclinique La Ligne bleue, CHU - Institut cœur-poumon, Polyclinique de Reims-Bezannes, Polyclinique du Parc, Centre Clinical, Clinique du Lac et d’Argonay, CHU-Hôpital Purpan/HFE, Clinique Claude-Bernard, Clinique du Pont-de-Chaume, EPSM Morbihan, CMCO, Clinique de l’Union, CH Guillaume-Régnier, Polyclinique Saint-Côme, CHU - Hôpital Dupuytren, Hôpital Albert Schweitzer, Polyclinique Saint-Jean, Clinique Saint-Michel, Centre Psychothérapique, Hôpital de la Croix-Saint-Simon, Hôpital privé La Montagne Lambert, Clinique Océane, Hôpital privé Nord Parisien, CHU - Hôpital de la Cavale-Blanche, Polyclinique Saint-Roch, CHU - Hôpital Nord, Nouvel Hôpital de Navarre, Hôpital Trousseau, Clinique Rive-Gauche, Hôpital Tenon, Clinique Les Eaux-Claires, GH Paul Guiraud, CH intercommunal, CHU - Hôpital de l’Archet, CH Saint-Joseph-Saint-Luc, Clinique Jean le Bon, Clinique La Croix du Sud, Centre de cardiologie Axium-Rambot, Institut Arthur-Vernes, Grand Hôpital de l'Est Francilien Marne-la-Vallée, Clinique Sainte-Clotilde, CHU - Hôpital Saint-Eloi, Fondation Rothschild, Hôpitaux Nord (Croix-Rousse), Polyclinique Jean-Villar, Clinique Remusat, Hôpital Saint-Antoine, GH, Centre Hospitalier Sainte-Marie, Clinique Honoré-Cave, Institut du cancer de Montpellier (CLCC), Institut Bergonié (CLCC), Polyclinique, CHU - Hôpital de la Mère et de l’Enfant, Clinique Marcel-Sembat, Pôle Santé République, Hôpital Edouard-Herriot, Centre François-Baclesse (CLCC), Hôpital privé de Provence, Institut ophtalmique, Hôpital Paul-Brousse, Clinique Pasteur, Clinique mutualiste La Sagesse, Nouvelle clinique de Tours, Clinique Durieux, Polyclinique de Kerio, Clinique Victor-Pauchet, Clinique Maussins-Nollet, Hôpital privé Paul-d’Égine
2025-08-26 18:17:22,669 [DEBUG] app.services.data_processing_service: Loading ranking data from: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/classments-hopitaux-cliniques-2024.xlsx
2025-08-26 18:17:22,849 [DEBUG] app.services.data_processing_service: Loaded ranking DataFrame with 136 rows
2025-08-26 18:17:22,849 [DEBUG] app.services.data_processing_service: Ranking DataFrame columns: ['Spécialité', 'Catégorie', 'Sheet', 'Date']
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.specialty set to: 'Cancer de la vessie'
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city set to: None
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.city_detected set to: False
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_type set to: 'aucune correspondance'
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_name set to: None
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.institution_mentioned set to: None
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator.number_institutions set to: 3
2025-08-26 18:17:22,849 [DEBUG] app.services.pipeline_orchestrator_service: PipelineOrchestrator infos - specialty: Cancer de la vessie, city: None, institution_type: aucune correspondance, institution: None, institution_mentioned: None
2025-08-26 18:17:22,850 [INFO] app.services.data_processing_service: generate_data_response called
2025-08-26 18:17:22,850 [DEBUG] app.services.data_processing_service: Extracted values - specialty: 'Cancer de la vessie', institution_type: 'aucune correspondance', city: 'None'
2025-08-26 18:17:22,850 [DEBUG] app.services.data_processing_service: No institution type match found, loading by specialty only
2025-08-26 18:17:22,850 [INFO] app.services.data_processing_service: Filtering ranking by criteria: specialty='Cancer de la vessie', institution_type='None'
2025-08-26 18:17:22,850 [DEBUG] app.services.data_processing_service: Filtering ranking data - specialty: 'Cancer de la vessie', institution_type: 'None'
2025-08-26 18:17:22,850 [DEBUG] app.services.data_processing_service: Specialty type: <class 'str'>, length: 19
2025-08-26 18:17:22,852 [DEBUG] app.services.data_processing_service: Available specialties in ranking data: ['Ablation des varices' 'Accidents vasculaires cérébraux'
 'Accouchements à risques' 'Accouchements normaux'
 'Adénome de la prostate' 'Amygdales et végétations'
 'Angioplastie coronaire' 'Appendicite' 'Arthrose de la main' 'Audition'
 'Calculs urinaires' "Cancer de l'estomac et de l'œsophage"
 "Cancer de l'ovaire" "Cancer de l'utérus" 'Cancer de la prostate'
 'Cancer de la thyroïde' 'Cancer de la vessie'
 "Cancer des os de l'enfant et de l'adolescent"
 "Cancer du colon ou de l'intestin" 'Cancer du foie' 'Cancer du pancréas'
 'Cancer du poumon' 'Cancer du rein' 'Cancer du sein' 'Cancer ORL'
 'Cancers de la peau' 'Cardiologie interventionnelle' 'Cataracte'
 'Chirurgie cardiaque adulte' 'Chirurgie cardiaque pédiatrique'
 "Chirurgie de l'épaule" "Chirurgie de l'obésité"
 'Chirurgie de la cheville' 'Chirurgie de la cornée'
 'Chirurgie dentaire et orale de l’adulte'
 'Chirurgie dentaire et orale de l’enfant et de l’adolescent'
 'Chirurgie des artères' "Chirurgie des cancers osseux de l'adulte"
 'Chirurgie des carotides' 'Chirurgie des sarcomes des tissus mous'
 "Chirurgie des testicules de l'adulte"
 "Chirurgie des testicules de l'enfant et de l'adolescent"
 'Chirurgie du canal carpien' "Chirurgie du dos de l'adulte"
 "Chirurgie du dos de l'enfant et de l'adolescent"
 'Chirurgie du nez et des sinus' 'Chirurgie du pied' 'Chirurgie du rectum'
 'Chirurgie maxillo-faciale' 'Dépression' "Diabète de l'adulte"
 "Diabète de l'enfant et de l'adolescent" 'Endométriose'
 "Epilepsie de l'adulte" "Epilepsie de l'enfant et de l'adolescent"
 'Fibrome utérin' 'Glandes salivaires' 'Glaucome' "Hernies de l'abdomen"
 'Hypertension artérielle' 'Infarctus du myocarde'
 'Insuffisance cardiaque' "Leucémie de l'adulte"
 "Leucémie de l'enfant et de l'adolescent" 'Ligaments du genou'
 "Lymphome-Myélome de l'adulte" 'Maladie de Parkinson'
 "Maladies inflammatoires chroniques de l'intestin (MICI)"
 'Médecine vasculaire' 'Pneumologie' 'Proctologie' 'Prothèse de genou'
 'Prothèse de hanche' 'Rétine' 'Schizophrénie' 'Sclérose en plaques'
 'Stimulateurs cardiaques' 'Strabisme'
 'Stress post-traumatique de l’adulte' 'Troubles bipolaires'
 "Tumeurs du cerveau de l'adulte"
 "Tumeurs du cerveau de l'enfant et de l'adolescent" 'Urgences de la main'
 'Vésicule biliaire']
2025-08-26 18:17:22,853 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-26 18:17:22,854 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-26 18:17:22,854 [DEBUG] app.services.data_processing_service: Normalizing string: Ablation des varices
2025-08-26 18:17:22,854 [DEBUG] app.services.data_processing_service: Normalizing string: Accidents vasculaires cérébraux
2025-08-26 18:17:22,855 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements à risques
2025-08-26 18:17:22,855 [DEBUG] app.services.data_processing_service: Normalizing string: Accouchements normaux
2025-08-26 18:17:22,855 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-26 18:17:22,855 [DEBUG] app.services.data_processing_service: Normalizing string: Adénome de la prostate
2025-08-26 18:17:22,855 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Amygdales et végétations
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Angioplastie coronaire
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Appendicite
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Arthrose de la main
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Audition
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-26 18:17:22,856 [DEBUG] app.services.data_processing_service: Normalizing string: Calculs urinaires
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'estomac et de l'œsophage
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'ovaire
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de l'utérus
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la prostate
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la thyroïde
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-26 18:17:22,857 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer des os de l'enfant et de l'adolescent
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du colon ou de l'intestin
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du foie
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du pancréas
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du poumon
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du rein
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer du sein
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-26 18:17:22,858 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer ORL
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Cancers de la peau
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Cardiologie interventionnelle
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Cataracte
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque adulte
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie cardiaque pédiatrique
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'épaule
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-26 18:17:22,859 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de l'obésité
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cheville
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie de la cornée
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’adulte
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie dentaire et orale de l’enfant et de l’adolescent
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des artères
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des cancers osseux de l'adulte
2025-08-26 18:17:22,860 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des carotides
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des sarcomes des tissus mous
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'adulte
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie des testicules de l'enfant et de l'adolescent
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du canal carpien
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'adulte
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du dos de l'enfant et de l'adolescent
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du nez et des sinus
2025-08-26 18:17:22,861 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du pied
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie du rectum
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Chirurgie maxillo-faciale
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Dépression
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'adulte
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Diabète de l'enfant et de l'adolescent
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Endométriose
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'adulte
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Epilepsie de l'enfant et de l'adolescent
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-26 18:17:22,862 [DEBUG] app.services.data_processing_service: Normalizing string: Fibrome utérin
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Glandes salivaires
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Glaucome
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Hernies de l'abdomen
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Hypertension artérielle
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Infarctus du myocarde
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Insuffisance cardiaque
2025-08-26 18:17:22,863 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'adulte
2025-08-26 18:17:22,864 [DEBUG] app.services.data_processing_service: Normalizing string: Leucémie de l'enfant et de l'adolescent
2025-08-26 18:17:22,865 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-26 18:17:22,865 [DEBUG] app.services.data_processing_service: Normalizing string: Ligaments du genou
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Lymphome-Myélome de l'adulte
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Maladie de Parkinson
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Maladies inflammatoires chroniques de l'intestin (MICI)
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Médecine vasculaire
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Pneumologie
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-26 18:17:22,866 [DEBUG] app.services.data_processing_service: Normalizing string: Proctologie
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de genou
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Prothèse de hanche
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Rétine
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Schizophrénie
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Sclérose en plaques
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Stimulateurs cardiaques
2025-08-26 18:17:22,867 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Strabisme
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Stress post-traumatique de l’adulte
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Troubles bipolaires
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'adulte
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Tumeurs du cerveau de l'enfant et de l'adolescent
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Urgences de la main
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-26 18:17:22,868 [DEBUG] app.services.data_processing_service: Normalizing string: Vésicule biliaire
2025-08-26 18:17:22,870 [DEBUG] app.services.data_processing_service: Normalized specialties in DataFrame: ["'ablation des varices'", "'accidents vasculaires cerebraux'", "'accouchements a risques'", "'accouchements normaux'", "'adenome de la prostate'", "'amygdales et vegetations'", "'angioplastie coronaire'", "'appendicite'", "'arthrose de la main'", "'audition'", "'calculs urinaires'", '"cancer de l\'estomac et de l\'œsophage"', '"cancer de l\'ovaire"', '"cancer de l\'uterus"', "'cancer de la prostate'", "'cancer de la thyroide'", "'cancer de la vessie'", '"cancer des os de l\'enfant et de l\'adolescent"', '"cancer du colon ou de l\'intestin"', "'cancer du foie'", "'cancer du pancreas'", "'cancer du poumon'", "'cancer du rein'", "'cancer du sein'", "'cancer orl'", "'cancers de la peau'", "'cardiologie interventionnelle'", "'cataracte'", "'chirurgie cardiaque adulte'", "'chirurgie cardiaque pediatrique'", '"chirurgie de l\'epaule"', '"chirurgie de l\'obesite"', "'chirurgie de la cheville'", "'chirurgie de la cornee'", "'chirurgie dentaire et orale de l’adulte'", "'chirurgie dentaire et orale de l’enfant et de l’adolescent'", "'chirurgie des arteres'", '"chirurgie des cancers osseux de l\'adulte"', "'chirurgie des carotides'", "'chirurgie des sarcomes des tissus mous'", '"chirurgie des testicules de l\'adulte"', '"chirurgie des testicules de l\'enfant et de l\'adolescent"', "'chirurgie du canal carpien'", '"chirurgie du dos de l\'adulte"', '"chirurgie du dos de l\'enfant et de l\'adolescent"', "'chirurgie du nez et des sinus'", "'chirurgie du pied'", "'chirurgie du rectum'", "'chirurgie maxillo-faciale'", "'depression'", '"diabete de l\'adulte"', '"diabete de l\'enfant et de l\'adolescent"', "'endometriose'", '"epilepsie de l\'adulte"', '"epilepsie de l\'enfant et de l\'adolescent"', "'fibrome uterin'", "'glandes salivaires'", "'glaucome'", '"hernies de l\'abdomen"', "'hypertension arterielle'", "'infarctus du myocarde'", "'insuffisance cardiaque'", '"leucemie de l\'adulte"', '"leucemie de l\'enfant et de l\'adolescent"', "'ligaments du genou'", '"lymphome-myelome de l\'adulte"', "'maladie de parkinson'", '"maladies inflammatoires chroniques de l\'intestin (mici)"', "'medecine vasculaire'", "'pneumologie'", "'proctologie'", "'prothese de genou'", "'prothese de hanche'", "'retine'", "'schizophrenie'", "'sclerose en plaques'", "'stimulateurs cardiaques'", "'strabisme'", "'stress post-traumatique de l’adulte'", "'troubles bipolaires'", '"tumeurs du cerveau de l\'adulte"', '"tumeurs du cerveau de l\'enfant et de l\'adolescent"', "'urgences de la main'", "'vesicule biliaire'"]
2025-08-26 18:17:22,870 [DEBUG] app.services.data_processing_service: Normalizing string: Cancer de la vessie
2025-08-26 18:17:22,871 [DEBUG] app.services.data_processing_service: Normalized specialty from query: ''cancer de la vessie''
2025-08-26 18:17:22,875 [DEBUG] app.services.data_processing_service: Found 2 rows matching single specialty 'Cancer de la vessie' (normalized: 'cancer de la vessie')
2025-08-26 18:17:22,875 [DEBUG] app.services.data_processing_service: Specialties found after specialty filtering: ['Cancer de la vessie']
2025-08-26 18:17:22,875 [INFO] app.services.data_processing_service: generate_response_links called with matching_rows: <class 'pandas.core.frame.DataFrame'>
2025-08-26 18:17:22,875 [INFO] app.services.data_processing_service: Generating ranking links
2025-08-26 18:17:22,875 [DEBUG] app.services.data_processing_service: Checking if specialty is 'no match': Cancer de la vessie
2025-08-26 18:17:22,875 [DEBUG] app.services.data_processing_service: Generating links for 2 matching rows
2025-08-26 18:17:22,877 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Public
2025-08-26 18:17:22,877 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'public'
2025-08-26 18:17:22,877 [DEBUG] app.services.data_processing_service: Mapping institution type for URL: Privé
2025-08-26 18:17:22,877 [DEBUG] app.services.data_processing_service: Generating web link for specialty 'Cancer de la vessie' and institution_type 'prive'
2025-08-26 18:17:22,878 [INFO] app.services.data_processing_service: Generated ranking links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-26 18:17:22,878 [INFO] app.services.data_processing_service: load_excel_sheets called with matching_rows of length: 2
2025-08-26 18:17:22,878 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Public' for category: 'Public'
2025-08-26 18:17:23,056 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Public' loaded successfully with 40 rows
2025-08-26 18:17:23,056 [DEBUG] app.services.data_processing_service: Loading sheet: 'CANCER_VESSIE-Privé' for category: 'Privé'
2025-08-26 18:17:23,207 [DEBUG] app.services.data_processing_service: Sheet 'CANCER_VESSIE-Privé' loaded successfully with 20 rows
2025-08-26 18:17:23,208 [DEBUG] app.services.data_processing_service: Concatenating 2 dataframes
2025-08-26 18:17:23,209 [INFO] app.services.data_processing_service: Successfully loaded 2 sheets, total rows: 60
2025-08-26 18:17:23,209 [INFO] app.services.data_processing_service: Loaded specialty DataFrame
2025-08-26 18:17:23,209 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique specialties in DataFrame: N/A
2025-08-26 18:17:23,210 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Unique institution types in DataFrame: ['Public' 'Privé']
2025-08-26 18:17:23,210 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame columns: Index(['Rang', 'Etablissement', 'Finess', 'ACTIVITE', 'NOTORIETE', 'DMS',
       'RATIO_AMBU', 'INDICE_LOURDEUR', 'TX_ENDOSCOPIE', 'PRADO', 'Note / 20',
       'Catégorie'],
      dtype='object')
2025-08-26 18:17:23,225 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] DataFrame head:    Rang                                      Etablissement     Finess  ACTIVITE  NOTORIETE   DMS  RATIO_AMBU  INDICE_LOURDEUR  TX_ENDOSCOPIE  PRADO  Note / 20 Catégorie
0     1         Institut mutualiste Montsouris, Paris (75)  750150104       254      71.65  4.80        0.39            43.38          91.73    1.0      18.63    Public
1     2                        Hôpital Foch, Suresnes (92)  920000650       373      58.71  5.70        5.36            42.19          79.89    1.0      18.50    Public
2     3                    Hôpital Saint-Louis, Paris (75)  750100075       310      43.23  4.42        9.35            37.68          93.87    1.0      18.27    Public
3     4      Hôpital européen Georges-Pompidou, Paris (75)  750803447       273      60.44  4.24        0.73            38.19          90.11    1.0      18.26    Public
4     5               Hôpital Robert Schuman, Vantoux (57)  570026252       263      17.11  4.62       12.93            41.16          96.96    1.0      18.25    Public
5     6  Clinique mutualiste de la Porte-de-l'Orient, L...  560002933       249      19.28  3.10        4.82            37.87          94.78    1.0      18.25    Public
6     7             CHU - Hôpital Pellegrin, Bordeaux (33)  330781360       220      23.64  5.48        2.73            47.08          85.00    1.0      18.19    Public
7     8                   Hôpital européen, Marseille (13)  130043664       266       7.89  5.58        0.75            39.96          90.98    1.0      17.91    Public
8     9         CHU - Hôpital Lapeyronie, Montpellier (34)  340785161       219      34.70  5.49        0.00            45.66          87.21    1.0      17.90    Public
9    10             Hôpital Paris Saint-Joseph, Paris (75)  750000523       255      56.08  3.79        0.00            36.76          92.55    1.0      17.84    Public
2025-08-26 18:17:23,225 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Filtering for specialty: 'Cancer de la vessie' and city: 'None'
2025-08-26 18:17:23,225 [DEBUG] app.services.pipeline_orchestrator_service: [DEBUG] Specialty match count: N/A
2025-08-26 18:17:23,225 [INFO] app.services.pipeline_orchestrator_service: No city detected, returning general ranking DataFrame
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: build_ranking_dataframe_with_distances returned DataFrame: <class 'pandas.core.frame.DataFrame'>
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Checking if DataFrame is None
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Retrieved DataFrame shape: (60, 12)
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Checking for geolocation API errors
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Getting ranking link for UI
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Checking for specialty_ranking_unavailable
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Checking if institution is mentioned
2025-08-26 18:17:23,226 [DEBUG] app.services.pipeline_orchestrator_service: Checking if city is detected
2025-08-26 18:17:23,226 [INFO] app.services.pipeline_orchestrator_service: No city detected, returning general ranking
2025-08-26 18:17:23,232 [DEBUG] app.services.pipeline_orchestrator_service: Formatted response string: Voici les établissements privés :<br>Clinique Saint-Augustin, Bordeaux (33): Un établissement Privé. avec une note de 18.39 de 20<br>Polyclinique Médipôle Saint-Roch, Cabestany (66): Un établissement Privé. avec une note de 18.37 de 20<br>Hôpital privé de Provence, Aix-en-Provence (13): Un établissement Privé. avec une note de 18.34 de 20<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public. avec une note de 18.27 de 20
2025-08-26 18:17:23,232 [DEBUG] app.services.pipeline_orchestrator_service: Normalizing specialty for display: Cancer de la vessie
2025-08-26 18:17:23,232 [DEBUG] app.services.pipeline_orchestrator_service: Display specialty: Cancer de la vessie, is_no_match: False
2025-08-26 18:17:23,232 [DEBUG] app.services.pipeline_orchestrator_service: Result: Voici les 3 meilleurs établissements pour la pathologie Cancer de la vessie<br> 
Voici les établissements privés :<br>Clinique Saint-Augustin, Bordeaux (33): Un établissement Privé. avec une note de 18.39 de 20<br>Polyclinique Médipôle Saint-Roch, Cabestany (66): Un établissement Privé. avec une note de 18.37 de 20<br>Hôpital privé de Provence, Aix-en-Provence (13): Un établissement Privé. avec une note de 18.34 de 20<br>Voici les établissements publics :<br>Institut mutualiste Montsouris, Paris (75): Un établissement Public. avec une note de 18.63 de 20<br>Hôpital Foch, Suresnes (92): Un établissement Public. avec une note de 18.5 de 20<br>Hôpital Saint-Louis, Paris (75): Un établissement Public. avec une note de 18.27 de 20, Links: ['https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-public.php', 'https://www.lepoint.fr/hopitaux/classements/cancer-de-la-vessie-prive.php']
2025-08-26 18:17:23,232 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 2
2025-08-26 18:25:47,691 [INFO] app.api.routes: Initializing core services...
2025-08-26 18:25:47,691 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-26 18:25:47,691 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-26 18:25:47,692 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 18:25:47,692 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 18:25:47,693 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 18:25:47,693 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 18:25:47,693 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 18:25:47,806 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 18:25:47,806 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 18:25:47,806 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 18:25:47,810 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:25:47,810 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:25:48,024 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-26 18:25:48,024 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-26 18:25:48,024 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-26 18:25:48,025 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-26 18:25:48,025 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-26 18:25:48,025 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-26 18:25:48,100 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-26 18:25:48,100 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-26 18:25:48,100 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-26 18:25:48,102 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:25:48,102 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:25:48,102 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-26 18:25:48,102 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-26 18:25:48,102 [INFO] app.api.routes: Core services initialized successfully
2025-08-26 18:25:48,104 [INFO] main: Creating FastAPI app
2025-08-26 18:25:48,104 [INFO] main: CORS middleware added
2025-08-26 18:25:48,106 [INFO] main: API router included
