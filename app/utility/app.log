2025-08-25 19:09:25,592 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:09:25,592 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:09:25,592 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:09:25,592 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:09:25,592 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:09:25,595 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:09:25,595 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:09:25,595 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:09:25,846 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:09:25,847 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:09:25,847 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:09:25,859 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:09:25,859 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:09:26,085 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:09:26,085 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:09:26,085 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:09:26,086 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:09:26,086 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:09:26,086 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:09:26,170 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:09:26,170 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:09:26,170 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:09:26,172 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:09:26,172 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:09:26,172 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:09:26,172 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:09:26,172 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:09:26,174 [INFO] main: Creating FastAPI app
2025-08-25 19:09:26,174 [INFO] main: CORS middleware added
2025-08-25 19:09:26,176 [INFO] main: API router included
2025-08-25 19:09:41,982 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:09:41,982 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:09:41,982 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:09:41,982 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:09:41,983 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:09:41,993 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:09:42,021 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:09:42,022 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:09:42,059 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11d63cec0>
2025-08-25 19:09:42,059 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11cee0950> server_hostname='api.openai.com' timeout=None
2025-08-25 19:09:42,100 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11d5f1310>
2025-08-25 19:09:42,100 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:09:42,101 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:09:42,890 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:09:47 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'350'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'440'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_86d87c57553b4c81923d8548497a008a'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=er3OCuUwBqHSm6FMnr96m36rUs0zWsdhCklhlQ3gA.E-1756141787-1.0.1.1-5xdkatepmXYn7tP0qdkO.4ILrhLf12oObm27Gfqu1Np25R3X7Hic5TBpGg.9KddGfP8TbH2YwzoesxwaPCVOWGo8Tuwabs2hGSENV9i5tfo; path=/; expires=Mon, 25-Aug-25 17:39:47 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=SwCP2GqAAXGRjXeYC01_VfmtZr._uFBBQqfxNqVDmJg-1756141787183-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cb2f50cf411bd-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:09:42,892 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:09:42,892 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:09:42,898 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:09:42,898 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:09:42,898 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:09:42,899 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:09:47 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '350'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '440'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_86d87c57553b4c81923d8548497a008a'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=er3OCuUwBqHSm6FMnr96m36rUs0zWsdhCklhlQ3gA.E-1756141787-1.0.1.1-5xdkatepmXYn7tP0qdkO.4ILrhLf12oObm27Gfqu1Np25R3X7Hic5TBpGg.9KddGfP8TbH2YwzoesxwaPCVOWGo8Tuwabs2hGSENV9i5tfo; path=/; expires=Mon, 25-Aug-25 17:39:47 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=SwCP2GqAAXGRjXeYC01_VfmtZr._uFBBQqfxNqVDmJg-1756141787183-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cb2f50cf411bd-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:09:42,899 [DEBUG] openai._base_client: request_id: req_86d87c57553b4c81923d8548497a008a
2025-08-25 19:09:42,908 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:09:42,908 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:09:42,909 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:09:42,909 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:09:42,910 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:09:42,911 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 19:11:34,273 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:11:34,273 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:11:34,273 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:11:34,273 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:11:34,273 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:11:34,275 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:11:34,275 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:11:34,275 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:11:34,444 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:11:34,444 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:11:34,446 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:11:34,449 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:11:34,449 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:11:34,664 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:11:34,665 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:11:34,665 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:11:34,665 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:11:34,666 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:11:34,666 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:11:34,746 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:11:34,746 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:11:34,746 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:11:34,748 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:11:34,748 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:11:34,748 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:11:34,748 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:11:34,748 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:11:34,750 [INFO] main: Creating FastAPI app
2025-08-25 19:11:34,750 [INFO] main: CORS middleware added
2025-08-25 19:11:34,751 [INFO] main: API router included
2025-08-25 19:12:24,647 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:12:24,647 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:12:24,647 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:12:24,648 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:12:24,648 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:12:24,649 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:12:24,649 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:12:24,649 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:12:24,806 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:12:24,806 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:12:24,806 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:12:24,810 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:12:24,810 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:12:25,011 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:12:25,011 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:12:25,011 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:12:25,012 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:12:25,012 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:12:25,012 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:12:25,091 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:12:25,091 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:12:25,091 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:12:25,093 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:12:25,093 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:12:25,093 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:12:25,093 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:12:25,093 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:12:25,095 [INFO] main: Creating FastAPI app
2025-08-25 19:12:25,095 [INFO] main: CORS middleware added
2025-08-25 19:12:25,096 [INFO] main: API router included
2025-08-25 19:12:28,019 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:12:28,019 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:12:28,019 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:12:28,019 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:12:28,019 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:12:28,027 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:12:28,057 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:12:28,058 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:12:28,096 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11b900c20>
2025-08-25 19:12:28,096 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11b16ca70> server_hostname='api.openai.com' timeout=None
2025-08-25 19:12:28,116 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11b8ad310>
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:12:28,117 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:12:28,863 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:12:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'316'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'399'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_1497848f1d514fe1b665d1fa5858eaa1'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=LqJwa1B6ocdedW4BzF9_2fImrXBwkBmSZIWH3mZBGRM-1756141953-1.0.1.1-j652tG2XG9MVITzAgQzI2EEmDdiLno.TxwkOo22JP88V0.m43Y2UBSiAtIrt7gIQMXUlQzSycOuy6Ye5TYzEMiTPA1xtqbosUdhgpaPWpJk; path=/; expires=Mon, 25-Aug-25 17:42:33 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=7EihmUxG1Ncyx7xuByNmDB1J9tA5GMMEEUArZfuuqd8-1756141953169-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cb702be45defa-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:12:28,864 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:12:28,864 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:12:28,866 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:12:28,866 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:12:28,866 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:12:28,866 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:12:33 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '316'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '399'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_1497848f1d514fe1b665d1fa5858eaa1'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=LqJwa1B6ocdedW4BzF9_2fImrXBwkBmSZIWH3mZBGRM-1756141953-1.0.1.1-j652tG2XG9MVITzAgQzI2EEmDdiLno.TxwkOo22JP88V0.m43Y2UBSiAtIrt7gIQMXUlQzSycOuy6Ye5TYzEMiTPA1xtqbosUdhgpaPWpJk; path=/; expires=Mon, 25-Aug-25 17:42:33 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=7EihmUxG1Ncyx7xuByNmDB1J9tA5GMMEEUArZfuuqd8-1756141953169-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cb702be45defa-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:12:28,867 [DEBUG] openai._base_client: request_id: req_1497848f1d514fe1b665d1fa5858eaa1
2025-08-25 19:12:28,873 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:12:28,873 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:12:28,876 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:12:28,877 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:12:28,878 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:12:29,548 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:12:33 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'365'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'511'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_65556ba281c74a2caf30e2de31d1819e'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cb7077ae7defa-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:12:29,549 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:12:29,549 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:12:29,553 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:12:29,553 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:12:29,553 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:12:29,553 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:12:33 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '365', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '511', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_65556ba281c74a2caf30e2de31d1819e', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cb7077ae7defa-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:12:29,554 [DEBUG] openai._base_client: request_id: req_65556ba281c74a2caf30e2de31d1819e
2025-08-25 19:12:29,554 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:12:29,554 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:12:29,555 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:12:29,556 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:12:29,556 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:12:29,556 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 19:16:10,334 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:16:10,334 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:16:10,334 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:16:10,334 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:10,334 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:10,335 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:10,335 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:10,336 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:10,494 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:10,495 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:10,495 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:10,499 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:10,499 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:10,697 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:16:10,697 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:10,697 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:10,698 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:10,698 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:10,698 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:10,773 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:10,774 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:10,774 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:10,776 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:10,776 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:10,776 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:10,776 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:10,776 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:16:10,778 [INFO] main: Creating FastAPI app
2025-08-25 19:16:10,778 [INFO] main: CORS middleware added
2025-08-25 19:16:10,779 [INFO] main: API router included
2025-08-25 19:16:17,364 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:16:17,364 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:16:17,364 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:16:17,364 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:17,364 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:17,365 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:17,365 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:17,366 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:17,522 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:17,522 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:17,522 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:17,525 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:17,525 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:17,784 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:16:17,784 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:16:17,784 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:16:17,785 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:16:17,785 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:16:17,785 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:16:17,869 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:16:17,869 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:16:17,869 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:16:17,871 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:17,871 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:17,871 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:16:17,871 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:16:17,872 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:16:17,873 [INFO] main: Creating FastAPI app
2025-08-25 19:16:17,874 [INFO] main: CORS middleware added
2025-08-25 19:16:17,875 [INFO] main: API router included
2025-08-25 19:17:45,586 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:17:45,586 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:17:45,586 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:17:45,586 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:17:45,586 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:17:45,588 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:17:45,588 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:17:45,588 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:17:45,753 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:17:45,753 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:17:45,753 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:17:45,757 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:17:45,757 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:17:45,980 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:17:45,980 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:17:45,980 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:17:45,981 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:17:45,981 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:17:45,981 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:17:46,060 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:17:46,061 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:17:46,061 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:17:46,063 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:17:46,063 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:17:46,063 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:17:46,063 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:17:46,063 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:17:46,064 [INFO] main: Creating FastAPI app
2025-08-25 19:17:46,065 [INFO] main: CORS middleware added
2025-08-25 19:17:46,066 [INFO] main: API router included
2025-08-25 19:19:18,318 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:19:18,319 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:19:18,319 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:19:18,319 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:18,319 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:18,320 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:18,320 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:18,320 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:18,499 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:18,499 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:18,499 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:18,504 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:18,504 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:18,715 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:19:18,715 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:18,715 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:18,716 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:18,716 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:18,716 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:18,792 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:18,792 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:18,792 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:18,794 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:18,794 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:18,794 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:18,794 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:18,794 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:19:18,796 [INFO] main: Creating FastAPI app
2025-08-25 19:19:18,796 [INFO] main: CORS middleware added
2025-08-25 19:19:18,797 [INFO] main: API router included
2025-08-25 19:19:34,930 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:19:34,930 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:19:34,930 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:19:34,930 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:34,930 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:34,931 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:34,931 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:34,931 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:35,084 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:35,084 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:35,084 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:35,088 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:35,088 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:35,266 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:19:35,267 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:19:35,267 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:19:35,267 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:19:35,268 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:19:35,268 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:19:35,349 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:19:35,349 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:19:35,350 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:19:35,351 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:35,352 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:35,352 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:19:35,352 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:19:35,352 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:19:35,353 [INFO] main: Creating FastAPI app
2025-08-25 19:19:35,354 [INFO] main: CORS middleware added
2025-08-25 19:19:35,355 [INFO] main: API router included
2025-08-25 19:19:44,643 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:19:44,643 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:19:44,643 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:19:44,643 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:19:44,644 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:19:44,651 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:19:44,679 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:19:44,680 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:19:44,726 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11eaf8d70>
2025-08-25 19:19:44,726 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11e274a70> server_hostname='api.openai.com' timeout=None
2025-08-25 19:19:44,752 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11eab11d0>
2025-08-25 19:19:44,752 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:19:44,752 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:19:44,752 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:19:44,753 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:19:44,753 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:19:45,613 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:19:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'307'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'519'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_d340fd0aa83e43d5af89f885c60e35b8'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=dnszx.WItjkekikSkMI1l6KwHuYlNtX0yMpDzsMUy30-1756142389-1.0.1.1-nhcR3RxkLpchPBXWOZeSAKpC_IfcfGYWZfDnwI1W6ExW4eHOwJ40ck_4Kya6bUxEHqfWLRGJqy2AidDuHDMYSLUPht9yF6bjgACm8VWeK6Y; path=/; expires=Mon, 25-Aug-25 17:49:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=pjF32KC8rny5IM5dqcO5B7AIWLLnpiRi62yJEVpeMrc-1756142389953-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc1abf96fed4f-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:19:45,614 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:19:45,614 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:19:45,616 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:19:45,616 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:19:45,616 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:19:45,616 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:19:49 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '307'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '519'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_d340fd0aa83e43d5af89f885c60e35b8'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=dnszx.WItjkekikSkMI1l6KwHuYlNtX0yMpDzsMUy30-1756142389-1.0.1.1-nhcR3RxkLpchPBXWOZeSAKpC_IfcfGYWZfDnwI1W6ExW4eHOwJ40ck_4Kya6bUxEHqfWLRGJqy2AidDuHDMYSLUPht9yF6bjgACm8VWeK6Y; path=/; expires=Mon, 25-Aug-25 17:49:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=pjF32KC8rny5IM5dqcO5B7AIWLLnpiRi62yJEVpeMrc-1756142389953-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cc1abf96fed4f-MXP'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:19:45,616 [DEBUG] openai._base_client: request_id: req_d340fd0aa83e43d5af89f885c60e35b8
2025-08-25 19:19:45,623 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:19:45,623 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:19:45,626 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:19:45,627 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:19:45,627 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:19:45,628 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:19:46,174 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:19:50 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'350'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'371'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_71f9045523a14d278384beedd5cfa0b9'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc1b16f9aed4f-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:19:46,174 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:19:46,174 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:19:46,180 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:19:46,180 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:19:46,180 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:19:46,181 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:19:50 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '350', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '371', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_71f9045523a14d278384beedd5cfa0b9', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cc1b16f9aed4f-MXP', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:19:46,181 [DEBUG] openai._base_client: request_id: req_71f9045523a14d278384beedd5cfa0b9
2025-08-25 19:19:46,182 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:19:46,182 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:19:46,183 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:19:46,183 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:19:46,183 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:20:33,032 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:20:33,033 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:20:33,033 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:20:33,033 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:20:33,033 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:20:33,034 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:20:33,034 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:20:33,034 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:20:33,182 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:20:33,182 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:20:33,183 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:20:33,187 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:20:33,187 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:20:33,389 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:20:33,389 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:20:33,389 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:20:33,390 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:20:33,390 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:20:33,390 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:20:33,465 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:20:33,466 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:20:33,466 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:20:33,468 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:20:33,468 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:20:33,468 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:20:33,468 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:20:33,468 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:20:33,470 [INFO] main: Creating FastAPI app
2025-08-25 19:20:33,470 [INFO] main: CORS middleware added
2025-08-25 19:20:33,472 [INFO] main: API router included
2025-08-25 19:20:33,479 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:20:33,479 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:20:33,479 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:20:33,479 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:20:33,480 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:20:33,487 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:20:33,522 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:20:33,523 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:20:33,539 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ef90c20>
2025-08-25 19:20:33,539 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11e7a09e0> server_hostname='api.openai.com' timeout=None
2025-08-25 19:20:33,562 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11ef491d0>
2025-08-25 19:20:33,562 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:20:33,562 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:20:33,562 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:20:33,563 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:20:33,563 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:20:34,768 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:20:39 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'753'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'884'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_544cfc8864444857b86a9b58f2acc431'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=uF8xpDG3NmgDvFutDfRSxQ1HahDLc930w5eZUtMGNqc-1756142439-1.0.1.1-hNTG_9TJHo6QxoG4lyMGgQxosXthYXnEVgrZG68Y7a0Duk7jOM9pkqJqu21N_QG5UQISTcU8zVAQ7d6QDj4UrwWCyOzHA7hDLH_x99K1uxw; path=/; expires=Mon, 25-Aug-25 17:50:39 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=u0VCiO1KHLYnKJbrrP8kYEaNBFVfEteP0P_6qc90DZM-1756142439114-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc2dd09e21856-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:20:34,769 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:20:34,769 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:20:34,808 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:20:34,809 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:20:34,809 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:20:34,809 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:20:39 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '753'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '884'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_544cfc8864444857b86a9b58f2acc431'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=uF8xpDG3NmgDvFutDfRSxQ1HahDLc930w5eZUtMGNqc-1756142439-1.0.1.1-hNTG_9TJHo6QxoG4lyMGgQxosXthYXnEVgrZG68Y7a0Duk7jOM9pkqJqu21N_QG5UQISTcU8zVAQ7d6QDj4UrwWCyOzHA7hDLH_x99K1uxw; path=/; expires=Mon, 25-Aug-25 17:50:39 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=u0VCiO1KHLYnKJbrrP8kYEaNBFVfEteP0P_6qc90DZM-1756142439114-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cc2dd09e21856-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:20:34,810 [DEBUG] openai._base_client: request_id: req_544cfc8864444857b86a9b58f2acc431
2025-08-25 19:20:34,819 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:20:34,819 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:20:34,822 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:20:34,823 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:20:34,824 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:20:35,333 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:20:39 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'299'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'338'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_8f747dfbcfdf442ebc1acc4f00388fd6'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cc2e4edb31856-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:20:35,333 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:20:35,334 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:20:35,339 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:20:35,339 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:20:35,339 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:20:35,340 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:20:39 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '299', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '338', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_8f747dfbcfdf442ebc1acc4f00388fd6', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cc2e4edb31856-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:20:35,340 [DEBUG] openai._base_client: request_id: req_8f747dfbcfdf442ebc1acc4f00388fd6
2025-08-25 19:20:35,341 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:20:35,341 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:20:35,343 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:20:35,343 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:20:35,343 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:20:35,343 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 19:21:58,615 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:21:58,615 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:21:58,615 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:21:58,616 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:21:58,616 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:21:58,617 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:21:58,617 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:21:58,617 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:21:58,779 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:21:58,779 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:21:58,780 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:21:58,784 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:21:58,784 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:21:58,995 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:21:58,995 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:21:58,995 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:21:58,996 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:21:58,996 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:21:58,996 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:21:59,073 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:21:59,073 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:21:59,073 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:21:59,075 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:21:59,075 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:21:59,075 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:21:59,075 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:21:59,075 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:21:59,077 [INFO] main: Creating FastAPI app
2025-08-25 19:21:59,077 [INFO] main: CORS middleware added
2025-08-25 19:21:59,078 [INFO] main: API router included
2025-08-25 19:57:58,713 [INFO] app.api.routes: Initializing core services...
2025-08-25 19:57:58,713 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 19:57:58,713 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 19:57:58,713 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:57:58,713 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:57:58,715 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:57:58,715 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:57:58,715 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:57:58,873 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:57:58,874 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:57:58,874 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:57:58,880 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:57:58,880 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:57:59,106 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 19:57:59,107 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 19:57:59,107 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 19:57:59,109 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 19:57:59,109 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 19:57:59,109 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 19:57:59,191 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 19:57:59,191 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 19:57:59,192 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 19:57:59,194 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:57:59,194 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:57:59,194 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 19:57:59,194 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 19:57:59,194 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 19:57:59,196 [INFO] main: Creating FastAPI app
2025-08-25 19:57:59,196 [INFO] main: CORS middleware added
2025-08-25 19:57:59,198 [INFO] main: API router included
2025-08-25 19:58:12,683 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 19:58:12,694 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 19:58:12,694 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 19:58:12,694 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 19:58:12,694 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 19:58:12,702 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:58:12,746 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:58:12,746 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 19:58:12,783 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11af04c20>
2025-08-25 19:58:12,783 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11a7ac9e0> server_hostname='api.openai.com' timeout=None
2025-08-25 19:58:12,805 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11aeb5310>
2025-08-25 19:58:12,805 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:58:12,806 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:58:14,971 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:58:19 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'329'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'397'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_a4e15cd0b40b496c98b500d66c3ebb19'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=McuhbbYpv0tJvhx8d7G9z21XtBKAZnOKk2LcH2OJ0e0-1756144699-1.0.1.1-UI37GH6e28SzGrepJyZzte89E6F2S4lTyvGb1IZM1cvqWdl05p.UHstP8yOnw_4ZrV.ak4AAQihk.exvUE_BXPbebNXNd4BzSGRtuBBqIa8; path=/; expires=Mon, 25-Aug-25 18:28:19 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=f6KhXA5g2zdKzfHJEnC1l60Dp4KrsxId3qqPE3O.Nu0-1756144699503-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfa067997e1a0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:58:14,972 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:58:14,973 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:58:14,974 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:58:14,974 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:58:14,975 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:58:14,975 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 17:58:19 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '329'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '397'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_a4e15cd0b40b496c98b500d66c3ebb19'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=McuhbbYpv0tJvhx8d7G9z21XtBKAZnOKk2LcH2OJ0e0-1756144699-1.0.1.1-UI37GH6e28SzGrepJyZzte89E6F2S4lTyvGb1IZM1cvqWdl05p.UHstP8yOnw_4ZrV.ak4AAQihk.exvUE_BXPbebNXNd4BzSGRtuBBqIa8; path=/; expires=Mon, 25-Aug-25 18:28:19 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=f6KhXA5g2zdKzfHJEnC1l60Dp4KrsxId3qqPE3O.Nu0-1756144699503-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cfa067997e1a0-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 19:58:14,975 [DEBUG] openai._base_client: request_id: req_a4e15cd0b40b496c98b500d66c3ebb19
2025-08-25 19:58:14,982 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 19:58:14,982 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 19:58:14,983 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 19:58:14,987 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 19:58:14,987 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 19:58:14,988 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 19:58:14,988 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 19:58:14,988 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 19:58:14,989 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 19:58:14,989 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 19:58:15,555 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 17:58:20 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'312'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'407'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999168'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_28bb9a656102477a93a0c47d402a4314'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfa141b5ee1a0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 19:58:15,555 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 19:58:15,555 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 19:58:15,557 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 19:58:15,557 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 19:58:15,557 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 19:58:15,557 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 17:58:20 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '312', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '407', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999168', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_28bb9a656102477a93a0c47d402a4314', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cfa141b5ee1a0-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 19:58:15,557 [DEBUG] openai._base_client: request_id: req_28bb9a656102477a93a0c47d402a4314
2025-08-25 19:58:15,558 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 19:58:15,558 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 19:58:15,559 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 19:58:15,560 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 19:58:15,560 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 19:58:15,560 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 19:58:15,561 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:00:06,776 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:00:06,776 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:00:06,776 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:00:06,776 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:06,776 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:06,777 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:06,777 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:06,777 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:06,948 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:06,948 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:06,948 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:06,952 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:06,952 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:07,159 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:00:07,159 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:07,159 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:07,160 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:07,160 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:07,160 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:07,235 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:07,235 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:07,235 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:07,237 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:07,237 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:07,237 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:07,237 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:07,237 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:00:07,239 [INFO] main: Creating FastAPI app
2025-08-25 20:00:07,240 [INFO] main: CORS middleware added
2025-08-25 20:00:07,241 [INFO] main: API router included
2025-08-25 20:00:54,507 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:00:54,507 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:00:54,507 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:00:54,507 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:54,508 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:54,508 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:54,509 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:54,509 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:54,667 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:54,668 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:54,668 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:54,671 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:54,671 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:54,912 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:00:54,912 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:00:54,912 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:00:54,913 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:00:54,913 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:00:54,913 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:00:54,998 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:00:54,999 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:00:54,999 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:00:55,002 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:55,002 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:55,003 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:00:55,003 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:00:55,003 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:00:55,005 [INFO] main: Creating FastAPI app
2025-08-25 20:00:55,006 [INFO] main: CORS middleware added
2025-08-25 20:00:55,007 [INFO] main: API router included
2025-08-25 20:00:57,357 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:00:57,358 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:00:57,358 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:00:57,358 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:00:57,358 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:00:57,366 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:00:57,391 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:00:57,392 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:00:57,430 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11512cc20>
2025-08-25 20:00:57,430 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1149989e0> server_hostname='api.openai.com' timeout=None
2025-08-25 20:00:57,449 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1150dd310>
2025-08-25 20:00:57,449 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:00:57,449 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:00:57,450 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:00:57,450 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:00:57,450 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:00:58,133 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:01:02 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'406'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'496'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_603317768ed94b629941148e3f17553a'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=KaLvXE9vq0kjDqGJFy_1swSqfP3Ta7BLT1bcBNzfozg-1756144862-1.0.1.1-ByIkWP6pDyH8hJSdp.dwjmq83niVgwos6SuzRR83H5y9g3iB0an1VhQfjJGw9ggn73k0B9T3IgvKfEORdQDszwQErfhOq9usVjC0.wn8pvc; path=/; expires=Mon, 25-Aug-25 18:31:02 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=hRKHxHRmGgzuqzvZ9RceCJnMQNaw9ENVkxWgzW5HP20-1756144862678-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfe0b8e76e1f0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:00:58,134 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:00:58,135 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:00:58,144 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:00:58,144 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:00:58,145 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:00:58,145 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:01:02 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '406'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '496'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_603317768ed94b629941148e3f17553a'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=KaLvXE9vq0kjDqGJFy_1swSqfP3Ta7BLT1bcBNzfozg-1756144862-1.0.1.1-ByIkWP6pDyH8hJSdp.dwjmq83niVgwos6SuzRR83H5y9g3iB0an1VhQfjJGw9ggn73k0B9T3IgvKfEORdQDszwQErfhOq9usVjC0.wn8pvc; path=/; expires=Mon, 25-Aug-25 18:31:02 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=hRKHxHRmGgzuqzvZ9RceCJnMQNaw9ENVkxWgzW5HP20-1756144862678-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974cfe0b8e76e1f0-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:00:58,145 [DEBUG] openai._base_client: request_id: req_603317768ed94b629941148e3f17553a
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': None, 'token_usage': None}
2025-08-25 20:00:58,153 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:00:58,157 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:00:58,158 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:00:58,158 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:00:58,158 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:00:58,159 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:00:58,159 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:00:58,159 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:00:58,749 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:01:03 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'383'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'423'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_8a5ff6a688cc4225b76048fc7a69ff65'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974cfe0ff9a9e1f0-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:00:58,750 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:00:58,750 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:00:58,750 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:00:58,751 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:00:58,751 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:00:58,751 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:01:03 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '383', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '423', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_8a5ff6a688cc4225b76048fc7a69ff65', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974cfe0ff9a9e1f0-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:00:58,751 [DEBUG] openai._base_client: request_id: req_8a5ff6a688cc4225b76048fc7a69ff65
2025-08-25 20:00:58,752 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:00:58,752 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:00:58,752 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': None, 'token_usage': None}
2025-08-25 20:00:58,752 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:00:58,753 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:00:58,753 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:00:58,753 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:00:58,753 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:04:29,602 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:04:29,602 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:04:29,602 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:04:29,602 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:04:29,602 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:04:29,604 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:04:29,604 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:04:29,604 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:04:29,776 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:04:29,776 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:04:29,776 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:04:29,781 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:04:29,781 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:04:30,006 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:04:30,006 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:04:30,006 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:04:30,007 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:04:30,007 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:04:30,007 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:04:30,084 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:04:30,084 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:04:30,085 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:04:30,086 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:04:30,087 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:04:30,087 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:04:30,087 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:04:30,087 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:04:30,090 [INFO] main: Creating FastAPI app
2025-08-25 20:04:30,090 [INFO] main: CORS middleware added
2025-08-25 20:04:30,092 [INFO] main: API router included
2025-08-25 20:06:53,170 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:06:53,170 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:06:53,170 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:06:53,171 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:06:53,171 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:06:53,179 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:06:53,205 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:06:53,206 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:06:53,250 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cbf0d70>
2025-08-25 20:06:53,250 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11c498950> server_hostname='api.openai.com' timeout=None
2025-08-25 20:06:53,276 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cb9d310>
2025-08-25 20:06:53,276 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:06:53,276 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:06:53,277 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:06:53,277 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:06:53,277 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:06:53,861 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:06:58 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'325'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'404'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_f0e1548479044f5b81d8ec3c2271748b'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=g9KUvVwmg95_5l2eDPZ4bFD96ebiAST7DtMXL_1xIfM-1756145218-1.0.1.1-Q1z4FRaUQSys5gOauQTlf5qI6iLS9egcmKv1OQ4HbDs7vcFU1nDFmqCuzQb8jDXIXt0YLHm9GhDmloRA5rA2L.EfhULa1cTHAUyEHlrDp5w; path=/; expires=Mon, 25-Aug-25 18:36:58 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=Qn2IWPrLn3tmI7ixjgXjf9YdZv4xJUROl2E2k_uMjYs-1756145218429-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d06bbae04eddc-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:06:53,863 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:06:53,863 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:06:53,864 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:06:58 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '325'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '404'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_f0e1548479044f5b81d8ec3c2271748b'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=g9KUvVwmg95_5l2eDPZ4bFD96ebiAST7DtMXL_1xIfM-1756145218-1.0.1.1-Q1z4FRaUQSys5gOauQTlf5qI6iLS9egcmKv1OQ4HbDs7vcFU1nDFmqCuzQb8jDXIXt0YLHm9GhDmloRA5rA2L.EfhULa1cTHAUyEHlrDp5w; path=/; expires=Mon, 25-Aug-25 18:36:58 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=Qn2IWPrLn3tmI7ixjgXjf9YdZv4xJUROl2E2k_uMjYs-1756145218429-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d06bbae04eddc-MXP'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:06:53,864 [DEBUG] openai._base_client: request_id: req_f0e1548479044f5b81d8ec3c2271748b
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:06:53,871 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:06:53,875 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:06:53,876 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:06:53,876 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:06:53,876 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:06:53,876 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:06:53,877 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:06:53,877 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:06:55,122 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:06:59 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'406'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'862'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_ff701492415a457f820bab9c9b942f90'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d06bf6903eddc-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:06:55,123 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:06:55,123 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:06:55,127 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:06:55,127 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:06:55,127 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:06:55,127 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:06:59 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '406', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '862', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_ff701492415a457f820bab9c9b942f90', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d06bf6903eddc-MXP', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:06:55,127 [DEBUG] openai._base_client: request_id: req_ff701492415a457f820bab9c9b942f90
2025-08-25 20:06:55,128 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:06:55,128 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:06:55,128 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:06:55,128 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:06:55,129 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:06:55,130 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:06:55,130 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:06:55,130 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:09:59,760 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:09:59,761 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:09:59,761 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:09:59,761 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:09:59,761 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:09:59,762 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:09:59,762 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:09:59,762 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:09:59,926 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:09:59,926 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:09:59,927 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:09:59,931 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:09:59,931 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:10:00,134 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:10:00,134 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:10:00,134 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:10:00,135 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:10:00,135 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:10:00,135 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:10:00,212 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:10:00,213 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:10:00,213 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:10:00,215 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:10:00,215 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:10:00,215 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:10:00,215 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:10:00,215 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:10:00,217 [INFO] main: Creating FastAPI app
2025-08-25 20:10:00,218 [INFO] main: CORS middleware added
2025-08-25 20:10:00,219 [INFO] main: API router included
2025-08-25 20:16:59,817 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:16:59,817 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:16:59,817 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:16:59,817 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:16:59,817 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:16:59,818 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:16:59,818 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:16:59,818 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:16:59,979 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:16:59,979 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:16:59,979 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:16:59,983 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:16:59,984 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:17:00,181 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:17:00,181 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:17:00,182 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:17:00,182 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:17:00,182 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:17:00,182 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:17:00,257 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:17:00,257 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:17:00,258 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:17:00,259 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:17:00,260 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:17:00,260 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:17:00,260 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:17:00,260 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:17:00,262 [INFO] main: Creating FastAPI app
2025-08-25 20:17:00,262 [INFO] main: CORS middleware added
2025-08-25 20:17:00,263 [INFO] main: API router included
2025-08-25 20:17:25,093 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:17:25,094 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:17:25,094 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:17:25,094 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:17:25,094 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:17:25,102 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:17:25,132 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:17:25,133 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:17:25,172 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cdb8ec0>
2025-08-25 20:17:25,172 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x11c5c4a70> server_hostname='api.openai.com' timeout=None
2025-08-25 20:17:25,193 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11cd651d0>
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:17:25,194 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:17:25,195 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:17:26,436 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:17:31 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'396'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'499'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_bbc0d9e139a644b5873700940beeb828'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=hgVok5Ka7nA0ZdLifYUqzZZLMovb2w6c5hpsO165dcA-1756145851-1.0.1.1-SL4Z5Al8H4v17RkoM25C14jrbnxpHYJ62WqihAVACQtz1pqvyImlkJKRLRz4GVRaeAiXg62W4_BYoeUPy_JOtP6PuT8DkIUVasLWEMxl8CU; path=/; expires=Mon, 25-Aug-25 18:47:31 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=YKjPILS_FUFTYZrMUN9aKmXptFwuJvoFMVC_.szR8AE-1756145851061-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d16297f9670ea-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:17:26,437 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:17:26,438 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:17:26,444 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:17:26,444 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:17:26,444 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:17:26,444 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:17:31 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '396'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '499'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_bbc0d9e139a644b5873700940beeb828'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=hgVok5Ka7nA0ZdLifYUqzZZLMovb2w6c5hpsO165dcA-1756145851-1.0.1.1-SL4Z5Al8H4v17RkoM25C14jrbnxpHYJ62WqihAVACQtz1pqvyImlkJKRLRz4GVRaeAiXg62W4_BYoeUPy_JOtP6PuT8DkIUVasLWEMxl8CU; path=/; expires=Mon, 25-Aug-25 18:47:31 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=YKjPILS_FUFTYZrMUN9aKmXptFwuJvoFMVC_.szR8AE-1756145851061-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d16297f9670ea-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:17:26,445 [DEBUG] openai._base_client: request_id: req_bbc0d9e139a644b5873700940beeb828
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:17:26,452 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:17:26,456 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:17:26,457 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:17:26,457 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:17:26,457 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:17:26,458 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:17:26,458 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:17:26,458 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:17:27,278 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:17:31 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'370'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'398'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_f2b7dbde908340a19af9fd6e58c78268'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d16315bce70ea-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:17:27,279 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:17:27,279 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:17:27,286 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:17:27,287 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:17:27,287 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:17:27,287 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:17:31 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '370', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '398', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_f2b7dbde908340a19af9fd6e58c78268', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d16315bce70ea-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:17:27,288 [DEBUG] openai._base_client: request_id: req_f2b7dbde908340a19af9fd6e58c78268
2025-08-25 20:17:27,289 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:17:27,289 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:17:27,289 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:17:27,289 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:17:27,290 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:17:27,290 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:17:27,291 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:17:27,291 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 20:20:02,595 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:20:02,596 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:20:02,596 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:20:02,596 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:20:02,596 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:20:02,598 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:20:02,598 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:20:02,598 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:20:02,756 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:20:02,756 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:20:02,756 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:20:02,761 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:20:02,761 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:20:02,972 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:20:02,972 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:20:02,972 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:20:02,973 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:20:02,973 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:20:02,973 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:20:03,050 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:20:03,051 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:20:03,051 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:20:03,053 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:20:03,054 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:20:03,054 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:20:03,054 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:20:03,054 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:20:03,056 [INFO] main: Creating FastAPI app
2025-08-25 20:20:03,056 [INFO] main: CORS middleware added
2025-08-25 20:20:03,057 [INFO] main: API router included
2025-08-25 20:22:25,618 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:22:25,618 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:22:25,619 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:22:25,619 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:22:25,619 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:22:25,620 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:22:25,620 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:22:25,620 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:22:25,772 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:22:25,772 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:22:25,772 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:22:25,777 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:22:25,777 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:22:26,047 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:22:26,047 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:22:26,047 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:22:26,048 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:22:26,048 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:22:26,048 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:22:26,133 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:22:26,133 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:22:26,133 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:22:26,135 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:22:26,135 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:22:26,135 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:22:26,135 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:22:26,135 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:22:26,137 [INFO] main: Creating FastAPI app
2025-08-25 20:22:26,139 [INFO] main: CORS middleware added
2025-08-25 20:22:26,141 [INFO] main: API router included
2025-08-25 20:25:43,632 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:25:43,632 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:25:43,632 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:25:43,632 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:25:43,632 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:25:43,633 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:25:43,634 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:25:43,634 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:25:43,792 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:25:43,793 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:25:43,793 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:25:43,796 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:25:43,797 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:25:44,237 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:25:44,237 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:25:44,237 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:25:44,239 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:25:44,239 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:25:44,239 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:25:44,320 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:25:44,320 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:25:44,321 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:25:44,324 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:25:44,324 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:25:44,325 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:25:44,325 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:25:44,325 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:25:44,326 [INFO] main: Creating FastAPI app
2025-08-25 20:25:44,327 [INFO] main: CORS middleware added
2025-08-25 20:25:44,329 [INFO] main: API router included
2025-08-25 20:26:47,798 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:26:47,799 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:26:47,799 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:26:47,799 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:26:47,799 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:26:47,800 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:26:47,800 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:26:47,800 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:26:47,957 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:26:47,957 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:26:47,958 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:26:47,961 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:26:47,961 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:26:48,123 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:26:48,123 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:26:48,123 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:26:48,124 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:26:48,124 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:26:48,124 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:26:48,202 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:26:48,202 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:26:48,203 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:26:48,204 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:26:48,205 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:26:48,205 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:26:48,205 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:26:48,205 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:26:48,206 [INFO] main: Creating FastAPI app
2025-08-25 20:26:48,207 [INFO] main: CORS middleware added
2025-08-25 20:26:48,208 [INFO] main: API router included
2025-08-25 20:29:36,460 [INFO] app.api.routes: Initializing core services...
2025-08-25 20:29:36,460 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 20:29:36,460 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 20:29:36,460 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:29:36,460 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:29:36,462 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:29:36,462 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:29:36,462 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:29:36,610 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:29:36,610 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:29:36,610 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:29:36,614 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:29:36,614 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:29:36,835 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 20:29:36,835 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 20:29:36,835 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 20:29:36,836 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 20:29:36,836 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 20:29:36,836 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 20:29:36,919 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 20:29:36,919 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 20:29:36,919 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 20:29:36,921 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:29:36,922 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:29:36,922 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 20:29:36,922 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 20:29:36,922 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 20:29:36,924 [INFO] main: Creating FastAPI app
2025-08-25 20:29:36,924 [INFO] main: CORS middleware added
2025-08-25 20:29:36,925 [INFO] main: API router included
2025-08-25 20:30:15,784 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 20:30:15,784 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 20:30:15,784 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 20:30:15,784 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 20:30:15,784 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 20:30:15,792 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:30:15,819 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:30:15,820 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 20:30:15,862 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x118504d70>
2025-08-25 20:30:15,862 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x117d94a70> server_hostname='api.openai.com' timeout=None
2025-08-25 20:30:15,882 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x1184b51d0>
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:30:15,882 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:30:15,883 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:30:16,452 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:30:21 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'331'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'408'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_3960a411a4914a2385e019174587f7a2'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=ljvV_3k7dqLjYXWmE.4g3h4SQM0vhwMN2VWH9C7NVg4-1756146621-1.0.1.1-LgDKkIlAzIKEyS6wxQpTsA_6LGogH53OXo9IcIxR04dNBgVD.wiEHo.wIrP7L2X6_smIzY4kxhcMNY6kVhw6_y2SL_NaSLvh.qDs2KGjNUY; path=/; expires=Mon, 25-Aug-25 19:00:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=IPVuwF6T_ymKItzLPRWA2mcuQG7H1q6FSHrkL_bRFu4-1756146621141-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d28faaf94e161-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:30:16,453 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:30:16,453 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:30:16,457 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:30:16,457 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:30:16,457 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:30:16,457 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 18:30:21 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '331'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '408'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_3960a411a4914a2385e019174587f7a2'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=ljvV_3k7dqLjYXWmE.4g3h4SQM0vhwMN2VWH9C7NVg4-1756146621-1.0.1.1-LgDKkIlAzIKEyS6wxQpTsA_6LGogH53OXo9IcIxR04dNBgVD.wiEHo.wIrP7L2X6_smIzY4kxhcMNY6kVhw6_y2SL_NaSLvh.qDs2KGjNUY; path=/; expires=Mon, 25-Aug-25 19:00:21 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=IPVuwF6T_ymKItzLPRWA2mcuQG7H1q6FSHrkL_bRFu4-1756146621141-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d28faaf94e161-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 20:30:16,458 [DEBUG] openai._base_client: request_id: req_3960a411a4914a2385e019174587f7a2
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: med_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:30:16,465 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check chatbot pertinence prompt sent to LLM.
2025-08-25 20:30:16,468 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nVérifiez si cette question concerne le classement des hôpitaux.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur les classements d\'hôpitaux.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes.\n\nRépondez UNIQUEMENT avec:\n- 1 si la question est pertinente pour le chatbot (classement, recherche d\'établissement, etc.)\n- 0 si la question n\'est pas pertinente\n\nUne question est pertinente si elle concerne au moins un des cas suivants:\n- Une maladie, un symptôme ou une spécialité médicale  \n- Le classement des hôpitaux et cliniques  \n- La recherche d\'un hôpital, d\'une clinique ou d\'un service médical  \n- Une question de suivi sur les secteurs public/privé des hôpitaux\n\nExemples de questions pertinentes pour messages standalone (repondre 1):  \n- Quel est la meilleur clinique de France ?\n- Conseille moi un hôpital à Lyon \n- Je chercher un service de pneumologie\n- Où faire soigner mon glaucome ? \n- Je veux corriger mon audition\n- Il y a fréquemment du sang dans mes urines. Conseille-moi un hôpital. \n- Je veux cherche à faire soigner mes troubles bipôlaires\n- Est-ce que l\'Institut mutualiste Montsouris est bon ?\n- Y a-t-il des hôpitaux privés avec un service de cardiologie interventionnelle ?\n\nExemples de questions non pertinentes pour messages standalone (repondre 0):  \n- Pourquoi les hôpitaux sont-ils en crise ?  #Il s\'agit d\'une demande d\'information qui n\'est pas dans le cadre direct de la recherche d\'un établissement de soin\n- Dois-je prendre du paracétamol pour ma fièvre ? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n- Puis-je perdre la vue si j\'ai un glaucome? #Il s\'agit d\'une demande d\'expertise médical qui n\'est pas dans le cadre de la recherche d\'un établissement de soin\n\n\n\nExemples avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique sur les hôpitaux parisiens, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur les classements, \'Combien coûte une consultation ?\' → 0 (question sur les coûts, pas sur les classements)\n- Avec historique sur la recherche d\'hôpital, \'Merci beaucoup\' → 1 (remerciement dans contexte de recherche d\'hôpital)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 20:30:16,469 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 20:30:16,470 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 20:30:17,707 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 18:30:22 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'847'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'1076'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9999169'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'4ms'), (b'x-request-id', b'req_cdec87272ee14ad98746b29d2e236e58'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d28fe5f7ce161-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 20:30:17,708 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 20:30:17,708 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 20:30:17,715 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 20:30:17,715 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 20:30:17,715 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 20:30:17,715 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 18:30:22 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '847', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '1076', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9999169', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '4ms', 'x-request-id': 'req_cdec87272ee14ad98746b29d2e236e58', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d28fe5f7ce161-MRS', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 20:30:17,716 [DEBUG] openai._base_client: request_id: req_cdec87272ee14ad98746b29d2e236e58
2025-08-25 20:30:17,716 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for chatbot pertinence:
1
2025-08-25 20:30:17,716 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed chatbot pertinence value: 1 (type: <class 'int'>)
2025-08-25 20:30:17,717 [DEBUG] app.features.sanity_checks.message_pertinence_check: chatbot_result: {'result': 1, 'cost': 0.0, 'token_usage': {'prompt_tokens': 0, 'completion_tokens': 0, 'total_tokens': 0}}
2025-08-25 20:30:17,717 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 20:30:17,717 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 20:30:17,717 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 20:30:17,718 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 20:30:17,718 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:01:03,540 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:01:03,541 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:01:03,541 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:01:03,541 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:01:03,541 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:01:03,543 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:01:03,543 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:01:03,543 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:01:03,710 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:01:03,711 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:01:03,711 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:01:03,715 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:01:03,715 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:01:03,923 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:01:03,923 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:01:03,924 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:01:03,924 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:01:03,924 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:01:03,925 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:01:04,004 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:01:04,004 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:01:04,004 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:01:04,006 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:01:04,006 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:01:04,006 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:01:04,006 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:01:04,006 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:01:04,008 [INFO] main: Creating FastAPI app
2025-08-25 21:01:04,008 [INFO] main: CORS middleware added
2025-08-25 21:01:04,009 [INFO] main: API router included
2025-08-25 21:04:26,646 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:04:26,647 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:04:26,647 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:04:26,647 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:26,647 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:26,648 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:26,648 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:26,648 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:26,795 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:26,795 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:26,796 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:26,800 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:26,800 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:27,006 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:04:27,006 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:27,006 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:27,007 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:27,007 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:27,008 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:27,085 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:27,085 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:27,086 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:27,087 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:27,088 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:27,088 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:27,088 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:27,088 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:04:27,089 [INFO] main: Creating FastAPI app
2025-08-25 21:04:27,090 [INFO] main: CORS middleware added
2025-08-25 21:04:27,091 [INFO] main: API router included
2025-08-25 21:04:36,676 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:04:36,676 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:04:36,676 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:04:36,676 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:36,676 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:36,677 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:36,677 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:36,677 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:36,811 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:36,811 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:36,811 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:36,814 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:36,814 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:36,998 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:04:36,998 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:04:36,998 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:04:36,999 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:04:36,999 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:04:36,999 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:04:37,083 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:04:37,083 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:04:37,084 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:04:37,085 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:37,085 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:37,086 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:04:37,086 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:04:37,086 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:04:37,087 [INFO] main: Creating FastAPI app
2025-08-25 21:04:37,088 [INFO] main: CORS middleware added
2025-08-25 21:04:37,089 [INFO] main: API router included
2025-08-25 21:10:56,347 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:10:56,347 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:10:56,347 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:10:56,347 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:10:56,348 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:10:56,349 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:10:56,349 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:10:56,349 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:10:56,502 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:10:56,502 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:10:56,502 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:10:56,507 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:10:56,507 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:10:56,724 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:10:56,724 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:10:56,724 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:10:56,725 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:10:56,725 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:10:56,725 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:10:56,803 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:10:56,803 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:10:56,803 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:10:56,805 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:10:56,805 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:10:56,805 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:10:56,805 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:10:56,805 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:10:56,807 [INFO] main: Creating FastAPI app
2025-08-25 21:10:56,807 [INFO] main: CORS middleware added
2025-08-25 21:10:56,809 [INFO] main: API router included
2025-08-25 21:13:10,941 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:13:10,941 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:13:10,941 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:13:10,941 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:13:10,941 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:13:10,943 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:13:10,943 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:13:10,943 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:13:11,095 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:13:11,095 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:13:11,095 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:13:11,100 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:13:11,100 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:13:11,299 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:13:11,299 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:13:11,299 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:13:11,300 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:13:11,300 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:13:11,300 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:13:11,376 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:13:11,376 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:13:11,376 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:13:11,378 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:13:11,378 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:13:11,378 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:13:11,378 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:13:11,378 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:13:11,380 [INFO] main: Creating FastAPI app
2025-08-25 21:13:11,380 [INFO] main: CORS middleware added
2025-08-25 21:13:11,382 [INFO] main: API router included
2025-08-25 21:14:07,650 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:14:07,650 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:14:07,650 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:14:07,650 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:07,650 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:07,652 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:07,652 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:07,652 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:07,858 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:07,858 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:07,859 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:07,863 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:07,864 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:08,093 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:14:08,093 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:08,093 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:08,094 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:08,094 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:08,094 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:08,171 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:08,171 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:08,171 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:08,173 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:08,173 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:08,173 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:08,174 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:08,174 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:14:08,175 [INFO] main: Creating FastAPI app
2025-08-25 21:14:08,176 [INFO] main: CORS middleware added
2025-08-25 21:14:08,177 [INFO] main: API router included
2025-08-25 21:14:12,222 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:14:12,222 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:14:12,222 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:14:12,222 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:12,222 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:12,223 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:12,223 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:12,223 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:12,364 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:12,364 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:12,365 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:12,367 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:12,367 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:12,523 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:14:12,524 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:14:12,524 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:14:12,525 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:14:12,525 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:14:12,525 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:14:12,605 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:14:12,606 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:14:12,606 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:14:12,608 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:12,608 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:12,608 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:14:12,608 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:14:12,608 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:14:12,610 [INFO] main: Creating FastAPI app
2025-08-25 21:14:12,610 [INFO] main: CORS middleware added
2025-08-25 21:14:12,612 [INFO] main: API router included
2025-08-25 21:15:00,042 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:00,042 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:00,042 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:00,042 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:00,042 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:00,043 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:00,043 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:00,043 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:00,195 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:00,195 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:00,196 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:00,199 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:00,199 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:00,366 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:00,366 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:00,366 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:00,367 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:00,367 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:00,367 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:00,448 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:00,448 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:00,448 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:00,450 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:00,450 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:00,450 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:00,450 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:00,450 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:00,453 [INFO] main: Creating FastAPI app
2025-08-25 21:15:00,454 [INFO] main: CORS middleware added
2025-08-25 21:15:00,456 [INFO] main: API router included
2025-08-25 21:15:02,427 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:02,428 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:02,428 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:02,428 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:02,428 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:02,429 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:02,429 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:02,429 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:02,626 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:02,626 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:02,626 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:02,629 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:02,629 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:02,779 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:02,779 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:02,779 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:02,780 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:02,780 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:02,780 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:02,854 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:02,854 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:02,854 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:02,856 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:02,856 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:02,856 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:02,856 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:02,856 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:02,858 [INFO] main: Creating FastAPI app
2025-08-25 21:15:02,858 [INFO] main: CORS middleware added
2025-08-25 21:15:02,860 [INFO] main: API router included
2025-08-25 21:15:08,332 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:08,332 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:08,332 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:08,332 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:08,333 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:08,333 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:08,334 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:08,334 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:08,477 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:08,478 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:08,478 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:08,481 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:08,481 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:08,650 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:08,650 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:08,650 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:08,651 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:08,651 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:08,651 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:08,726 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:08,727 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:08,727 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:08,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:08,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:08,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:08,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:08,729 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:08,731 [INFO] main: Creating FastAPI app
2025-08-25 21:15:08,731 [INFO] main: CORS middleware added
2025-08-25 21:15:08,732 [INFO] main: API router included
2025-08-25 21:15:22,691 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:15:22,691 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:15:22,691 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:15:22,692 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:22,692 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:22,693 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:22,693 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:22,693 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:22,851 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:22,851 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:22,851 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:22,854 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:22,854 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:23,013 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:15:23,014 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:15:23,014 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:15:23,015 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:15:23,015 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:15:23,015 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:15:23,092 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:15:23,092 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:15:23,092 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:15:23,094 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:23,095 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:23,095 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:15:23,095 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:15:23,095 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:15:23,097 [INFO] main: Creating FastAPI app
2025-08-25 21:15:23,098 [INFO] main: CORS middleware added
2025-08-25 21:15:23,100 [INFO] main: API router included
2025-08-25 21:16:14,569 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:14,569 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:14,570 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:14,570 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:14,570 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:14,571 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:14,571 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:14,571 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:14,879 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:14,879 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:14,879 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:14,886 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:14,886 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:15,128 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:15,128 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:15,128 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:15,129 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:15,129 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:15,129 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:15,214 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:15,229 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:15,229 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:15,231 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:15,231 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:15,232 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:15,232 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:15,232 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:15,235 [INFO] main: Creating FastAPI app
2025-08-25 21:16:15,235 [INFO] main: CORS middleware added
2025-08-25 21:16:15,237 [INFO] main: API router included
2025-08-25 21:16:17,279 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:17,279 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:17,279 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:17,279 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:17,279 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:17,280 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:17,280 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:17,280 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:17,416 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:17,416 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:17,416 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:17,419 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:17,419 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:17,575 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:17,575 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:17,575 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:17,576 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:17,576 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:17,576 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:17,656 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:17,656 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:17,656 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:17,658 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:17,658 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:17,658 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:17,658 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:17,658 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:17,660 [INFO] main: Creating FastAPI app
2025-08-25 21:16:17,660 [INFO] main: CORS middleware added
2025-08-25 21:16:17,662 [INFO] main: API router included
2025-08-25 21:16:23,655 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:23,655 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:23,655 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:23,655 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:23,656 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:23,656 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:23,657 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:23,657 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:23,791 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:23,792 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:23,792 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:23,795 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:23,795 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:23,950 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:23,950 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:23,950 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:23,951 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:23,951 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:23,951 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:24,028 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:24,028 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:24,028 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:24,030 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:24,030 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:24,030 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:24,030 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:24,030 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:24,032 [INFO] main: Creating FastAPI app
2025-08-25 21:16:24,032 [INFO] main: CORS middleware added
2025-08-25 21:16:24,033 [INFO] main: API router included
2025-08-25 21:16:29,261 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:29,261 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:29,261 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:29,261 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:29,261 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:29,262 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:29,262 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:29,262 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:29,409 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:29,410 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:29,410 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:29,413 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:29,413 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:29,566 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:29,566 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:29,566 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:29,567 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:29,567 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:29,567 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:29,642 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:29,643 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:29,643 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:29,645 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:29,645 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:29,645 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:29,645 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:29,645 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:29,647 [INFO] main: Creating FastAPI app
2025-08-25 21:16:29,647 [INFO] main: CORS middleware added
2025-08-25 21:16:29,648 [INFO] main: API router included
2025-08-25 21:16:33,189 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:33,189 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:33,189 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:33,189 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:33,189 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:33,190 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:33,190 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:33,190 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:33,345 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:33,346 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:33,346 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:33,349 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:33,349 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:33,503 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:33,503 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:33,503 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:33,504 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:33,504 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:33,504 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:33,582 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:33,582 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:33,582 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:33,584 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:33,584 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:33,584 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:33,584 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:33,584 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:33,586 [INFO] main: Creating FastAPI app
2025-08-25 21:16:33,586 [INFO] main: CORS middleware added
2025-08-25 21:16:33,588 [INFO] main: API router included
2025-08-25 21:16:39,583 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:16:39,584 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:16:39,584 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:16:39,584 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:39,584 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:39,585 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:39,585 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:39,585 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:39,726 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:39,726 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:39,726 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:39,729 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:39,729 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:39,888 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:16:39,888 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:16:39,888 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:16:39,889 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:16:39,889 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:16:39,889 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:16:39,974 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:16:39,974 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:16:39,974 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:16:39,976 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:39,976 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:39,976 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:16:39,976 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:16:39,977 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:16:39,978 [INFO] main: Creating FastAPI app
2025-08-25 21:16:39,979 [INFO] main: CORS middleware added
2025-08-25 21:16:39,980 [INFO] main: API router included
2025-08-25 21:16:55,060 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:16:55,060 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:16:55,060 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:16:55,060 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:16:55,060 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:16:55,065 [ERROR] app.utility.llm_helpers: LLM invocation failed in sanity_check_medical_pertinence: Completions.create() got an unexpected keyword argument 'return_usage'
2025-08-25 21:16:55,066 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:16:55,066 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:16:55,066 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:16:55,067 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:16:55,067 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:18:33,450 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:18:33,451 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:18:33,451 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:18:33,451 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:18:33,451 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:18:33,452 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:18:33,452 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:18:33,453 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:18:33,599 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:18:33,599 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:18:33,599 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:18:33,603 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:18:33,604 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:18:33,837 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:18:33,837 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:18:33,837 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:18:33,838 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:18:33,838 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:18:33,838 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:18:33,918 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:18:33,918 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:18:33,918 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:18:33,920 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:18:33,920 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:18:33,920 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:18:33,920 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:18:33,920 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:18:33,922 [INFO] main: Creating FastAPI app
2025-08-25 21:18:33,923 [INFO] main: CORS middleware added
2025-08-25 21:18:33,924 [INFO] main: API router included
2025-08-25 21:18:42,001 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:18:42,001 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:18:42,002 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:18:42,002 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:18:42,002 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:18:42,007 [ERROR] app.utility.llm_helpers: LLM invocation failed in sanity_check_medical_pertinence: Completions.create() got an unexpected keyword argument 'return_usage'
2025-08-25 21:18:42,007 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:18:42,008 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:18:42,008 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:18:42,008 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:18:42,008 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:24:54,712 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:24:54,712 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:24:54,712 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:24:54,712 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:24:54,713 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:24:54,714 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:24:54,714 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:24:54,714 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:24:54,868 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:24:54,868 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:24:54,868 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:24:54,879 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:24:54,880 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:24:55,094 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:24:55,094 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:24:55,094 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:24:55,095 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:24:55,095 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:24:55,095 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:24:55,173 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:24:55,173 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:24:55,173 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:24:55,175 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:24:55,175 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:24:55,175 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:24:55,175 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:24:55,175 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:24:55,177 [INFO] main: Creating FastAPI app
2025-08-25 21:24:55,177 [INFO] main: CORS middleware added
2025-08-25 21:24:55,178 [INFO] main: API router included
2025-08-25 21:25:02,847 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:25:02,847 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:25:02,847 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:25:02,847 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:25:02,848 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:25:02,854 [ERROR] app.utility.llm_helpers: LLM invocation failed in sanity_check_medical_pertinence: Completions.create() got an unexpected keyword argument 'return_usage'
2025-08-25 21:25:02,854 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:25:02,855 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:25:02,855 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:25:02,855 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:25:02,857 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:27:00,774 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:27:00,774 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:27:00,774 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:27:00,774 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:27:00,774 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:27:00,775 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:27:00,776 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:27:00,776 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:27:00,950 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:27:00,950 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:27:00,950 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:27:00,954 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:27:00,955 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:27:01,189 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:27:01,189 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:27:01,189 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:27:01,190 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:27:01,190 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:27:01,190 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:27:01,273 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:27:01,273 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:27:01,273 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:27:01,275 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:27:01,275 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:27:01,275 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:27:01,275 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:27:01,276 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:27:01,277 [INFO] main: Creating FastAPI app
2025-08-25 21:27:01,278 [INFO] main: CORS middleware added
2025-08-25 21:27:01,280 [INFO] main: API router included
2025-08-25 21:28:14,263 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:28:14,263 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:28:14,263 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:28:14,263 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:28:14,263 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:28:14,265 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:28:14,265 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:28:14,265 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:28:14,419 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:28:14,419 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:28:14,419 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:28:14,423 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:28:14,423 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:28:14,684 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:28:14,684 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:28:14,684 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:28:14,685 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:28:14,685 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:28:14,685 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:28:14,767 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:28:14,768 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:28:14,769 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:28:14,771 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:28:14,771 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:28:14,771 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:28:14,771 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:28:14,771 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:28:14,773 [INFO] main: Creating FastAPI app
2025-08-25 21:28:14,774 [INFO] main: CORS middleware added
2025-08-25 21:28:14,775 [INFO] main: API router included
2025-08-25 21:28:43,436 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:28:43,436 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:28:43,436 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:28:43,436 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:28:43,436 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:28:43,446 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 21:28:43,475 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 21:28:43,475 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 21:28:43,511 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x112178ec0>
2025-08-25 21:28:43,511 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1118d0c20> server_hostname='api.openai.com' timeout=None
2025-08-25 21:28:43,545 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x11212d590>
2025-08-25 21:28:43,545 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 21:28:43,546 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 21:28:44,465 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 19:28:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'356'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'462'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_cbd43c2471c64a4a821e750f9045991e'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=LbrHI4uHPgVyG3Z5FFMNFQobskxerr22zpfzkGdMIMw-1756150129-1.0.1.1-B5YiOux2R_ltD1CIp1LTK8HmFaWC0aw1iQjXQHJ3U538ommxCyq2lYsJkxcB9LextX7Lv02n6P1VGj_TT5mEXtc2v8o0pmwk.YdGhN0m5PA; path=/; expires=Mon, 25-Aug-25 19:58:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=lgtONf0ak1aILamS2PL2jSSixxaVNJ3lOV5MUSFZbAk-1756150129443-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d7e9f5b45e1f9-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 21:28:44,466 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 21:28:44,466 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 21:28:44,467 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 21:28:44,467 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 21:28:44,467 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 21:28:44,467 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 19:28:49 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '356'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '462'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_cbd43c2471c64a4a821e750f9045991e'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=LbrHI4uHPgVyG3Z5FFMNFQobskxerr22zpfzkGdMIMw-1756150129-1.0.1.1-B5YiOux2R_ltD1CIp1LTK8HmFaWC0aw1iQjXQHJ3U538ommxCyq2lYsJkxcB9LextX7Lv02n6P1VGj_TT5mEXtc2v8o0pmwk.YdGhN0m5PA; path=/; expires=Mon, 25-Aug-25 19:58:49 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=lgtONf0ak1aILamS2PL2jSSixxaVNJ3lOV5MUSFZbAk-1756150129443-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d7e9f5b45e1f9-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 21:28:44,467 [DEBUG] openai._base_client: request_id: req_cbd43c2471c64a4a821e750f9045991e
2025-08-25 21:28:44,476 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 21:28:44,476 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 21:28:44,476 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:28:44,477 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:28:44,477 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:28:44,477 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:28:44,478 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:37:45,423 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:37:45,423 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:37:45,423 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:37:45,423 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:37:45,423 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:37:45,425 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:37:45,425 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:37:45,425 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:37:45,583 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:37:45,583 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:37:45,584 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:37:45,589 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:37:45,589 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:37:45,794 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:37:45,794 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:37:45,794 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:37:45,795 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:37:45,795 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:37:45,795 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:37:45,867 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:37:45,867 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:37:45,867 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:37:45,869 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:37:45,869 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:37:45,869 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:37:45,869 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:37:45,869 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:37:45,871 [INFO] main: Creating FastAPI app
2025-08-25 21:37:45,871 [INFO] main: CORS middleware added
2025-08-25 21:37:45,872 [INFO] main: API router included
2025-08-25 21:39:58,609 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:39:58,609 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:39:58,609 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:39:58,609 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:39:58,609 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:39:58,611 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:39:58,611 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:39:58,611 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:39:58,781 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:39:58,781 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:39:58,781 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:39:58,785 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:39:58,785 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:39:59,021 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:39:59,021 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:39:59,021 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:39:59,022 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:39:59,022 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:39:59,022 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:39:59,102 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:39:59,102 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:39:59,102 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:39:59,104 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:39:59,104 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:39:59,105 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:39:59,105 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:39:59,105 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:39:59,107 [INFO] main: Creating FastAPI app
2025-08-25 21:39:59,108 [INFO] main: CORS middleware added
2025-08-25 21:39:59,109 [INFO] main: API router included
2025-08-25 21:40:20,948 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:40:20,948 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:40:20,948 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:40:20,948 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:40:20,949 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:40:20,950 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:40:20,950 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:40:20,950 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:40:21,120 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:40:21,120 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:40:21,120 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:40:21,124 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:40:21,124 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:40:21,348 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:40:21,348 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:40:21,348 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:40:21,349 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:40:21,349 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:40:21,349 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:40:21,424 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:40:21,424 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:40:21,424 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:40:21,426 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:40:21,426 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:40:21,426 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:40:21,426 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:40:21,426 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:40:21,428 [INFO] main: Creating FastAPI app
2025-08-25 21:40:21,429 [INFO] main: CORS middleware added
2025-08-25 21:40:21,430 [INFO] main: API router included
2025-08-25 21:40:31,204 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:40:31,204 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:40:31,204 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:40:31,204 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:40:31,204 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:40:31,212 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 21:40:31,239 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 21:40:31,239 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 21:40:31,279 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116e50ec0>
2025-08-25 21:40:31,279 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1166dccb0> server_hostname='api.openai.com' timeout=None
2025-08-25 21:40:31,298 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116e05590>
2025-08-25 21:40:31,298 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 21:40:31,299 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 21:40:31,976 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 19:40:37 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'280'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'374'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_19d8d44ed683439899c7346dadece34b'), (b'cf-cache-status', b'DYNAMIC'), (b'Set-Cookie', b'__cf_bm=mCJ3EGo5sCyvbviLRNHgxn6WRCNWummYPUxKC2HIuWI-1756150837-1.0.1.1-y183w8fcQDOEzwtg48l_t5SZScc._ids8St57yz43JheUoeUlf7dmiFZ493.xLRwiBJMJcktD57VW6MiTM4o7anIRnKpUiN0xKS3fVnsfvg; path=/; expires=Mon, 25-Aug-25 20:10:37 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Set-Cookie', b'_cfuvid=UNJyuAjbNePmj6rU6tPUgHu10O1UBge52a9Xgjpuxzc-1756150837012-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d8fe72c0eb93b-MRS'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 21:40:31,978 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 21:40:31,978 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 21:40:31,979 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 21:40:31,979 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 21:40:31,979 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 21:40:31,979 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers([('date', 'Mon, 25 Aug 2025 19:40:37 GMT'), ('content-type', 'application/json'), ('transfer-encoding', 'chunked'), ('connection', 'keep-alive'), ('access-control-expose-headers', 'X-Request-ID'), ('openai-organization', 'user-bwwzz3meolxcqx9awsxeqau4'), ('openai-processing-ms', '280'), ('openai-project', 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), ('openai-version', '2020-10-01'), ('x-envoy-upstream-service-time', '374'), ('x-ratelimit-limit-requests', '10000'), ('x-ratelimit-limit-tokens', '10000000'), ('x-ratelimit-remaining-requests', '9999'), ('x-ratelimit-remaining-tokens', '9998878'), ('x-ratelimit-reset-requests', '6ms'), ('x-ratelimit-reset-tokens', '6ms'), ('x-request-id', 'req_19d8d44ed683439899c7346dadece34b'), ('cf-cache-status', 'DYNAMIC'), ('set-cookie', '__cf_bm=mCJ3EGo5sCyvbviLRNHgxn6WRCNWummYPUxKC2HIuWI-1756150837-1.0.1.1-y183w8fcQDOEzwtg48l_t5SZScc._ids8St57yz43JheUoeUlf7dmiFZ493.xLRwiBJMJcktD57VW6MiTM4o7anIRnKpUiN0xKS3fVnsfvg; path=/; expires=Mon, 25-Aug-25 20:10:37 GMT; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('strict-transport-security', 'max-age=31536000; includeSubDomains; preload'), ('x-content-type-options', 'nosniff'), ('set-cookie', '_cfuvid=UNJyuAjbNePmj6rU6tPUgHu10O1UBge52a9Xgjpuxzc-1756150837012-0.0.1.1-604800000; path=/; domain=.api.openai.com; HttpOnly; Secure; SameSite=None'), ('server', 'cloudflare'), ('cf-ray', '974d8fe72c0eb93b-MRS'), ('content-encoding', 'gzip'), ('alt-svc', 'h3=":443"; ma=86400')])
2025-08-25 21:40:31,980 [DEBUG] openai._base_client: request_id: req_19d8d44ed683439899c7346dadece34b
2025-08-25 21:40:31,987 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 21:40:31,987 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 21:40:31,988 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:40:31,988 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:40:31,989 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:40:31,989 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:40:31,989 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:41:43,964 [INFO] app.api.routes: Received /ask request with prompt length: 71 chars, specialty: 
2025-08-25 21:41:43,964 [INFO] app.services.pipeline_orchestrator_service: Starting pipeline processing - prompt: Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, detected_specialty: 
2025-08-25 21:41:43,964 [INFO] app.services.pipeline_orchestrator_service: Resetting PipelineOrchestrator attributes for new query
2025-08-25 21:41:43,964 [DEBUG] app.features.sanity_checks.sanity_checks_analyst: run_checks called: user_input=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?, conversation=[], conv_history=, checks_to_run=None
2025-08-25 21:41:43,964 [DEBUG] app.features.sanity_checks.message_pertinence_check: Sanity check medical pertinence prompt sent to LLM.
2025-08-25 21:41:43,967 [DEBUG] openai._base_client: Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'json_data': {'messages': [{'content': '\nÉvaluez si le message suivant a un rapport avec la santé humaine ou les services de soins.\n\nHISTORIQUE DE CONVERSATION:\n\n\nMESSAGE À ÉVALUER: \'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?\'\n\nSi un historique de conversation est fourni ci-dessus, analysez le nouveau message en tenant compte du contexte conversationnel. Un message peut être pertinent même s\'il semble incomplet ou ambigu, si le contexte de la conversation montre qu\'il s\'agit d\'une suite logique d\'une discussion sur la santé.\n\nATTENTION: Les questions de suivi sur les hôpitaux publics/privés sont TOUJOURS pertinentes. Les mots comme "privé", "public", "et privé?", "et public?" dans le contexte d\'une discussion sur les hôpitaux sont des continuations légitimes de discussions médicales.\nATTENTION: Toute question sur la méthodologie, la fréquence de mise à jour, les critères, ou le fonctionnement du classement des hôpitaux doit TOUJOURS être considérée comme pertinente, même si elle ne concerne pas directement une maladie ou un service de soins.\n\nRépondez UNIQUEMENT avec 1 si pertinent, 0 si non pertinent ou 2 si la question concerne la méthodologie de calcul du classement.\n\nExemples pour messages standalone (repondre 1): \n- \'J\'ai un cancer à Paris\' → 1\n- \'Cataracte\' → 1  \n- \'J\'ai mal aux pieds\' → 1\n- \'Les hôpitaux privés sont ils meilleurs que les publiques?\' → 1\n- \'Comment le classement est-il calculé ?\' → 1\n- \'Quels sont les critères du classement ?\' → 1\n- "Quels experts participent à l\'élaboration du classement ?"\' → 1\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\' → 1\n- "Comment sont traitées les données manquantes dans le classement ?"\' → 1\n- "Le classement est-il le même pour toutes les spécialités ?"\' → 1\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\' → 1\n- "Quels sont les changements dans la méthodologie cette année ?"\' → 1\n- "Comment puis-je accéder au détail de la méthodologie ?"\' → 1\n\nExemples pour messages standalone (repondre 0):\n- \'Je mange des frites\' → 0\n- \'Comment faire une tarte aux pommes ?\' → 0\n- \'Comment s\'abonner Le Point ?\' → 0\n- \'Quel est le meilleur restaurant à Paris ?\' → 0\n\n\nExemples de questions qui concernent la méthodologie de classement (repondre 2):\n- "Comment le classement est-il calculé ?"\n- "Quels sont les critères du classement ?" \n- "Pourquoi l\'hôpital X est mieux classé que Y ?"\n- "Comment sont choisis les critères du classement ?"\n- "Qui réalise le classement des hôpitaux ?"\n- "Quelle est la source des données utilisées pour le classement ?"\n- "Le classement prend-il en compte la satisfaction des patients ?"\n- "Comment sont pondérés les différents critères ?"\n- "Est-ce que le classement est mis à jour chaque année ?"\n- "Pourquoi certains hôpitaux ne figurent pas dans le classement ?"\n- "Comment puis-je vérifier la fiabilité du classement ?"\n- "Quels experts participent à l\'élaboration du classement ?"\n- "Le classement est-il influencé par des partenariats ou des sponsors ?"\n- "Comment sont traitées les données manquantes dans le classement ?"\n- "Le classement est-il le même pour toutes les spécialités ?"\n- "Comment sont comparés les hôpitaux publics et privés dans le classement ?"\n- "Quels sont les changements dans la méthodologie cette année ?"\n- "Comment puis-je accéder au détail de la méthodologie ?"\n\nExemples pour messages avec contexte conversationnel (TRÈS IMPORTANT):\n- Avec historique montrant une discussion sur les hôpitaux, \'Et à Lyon ?\' → 1 (question de suivi sur les hôpitaux)\n- Avec historique sur la cardiologie, \'Merci\' → 1 (remerciement dans contexte médical)\n- Avec historique sur hôpitaux publics, \'et privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique sur hôpitaux privés, \'et public?\' → 1 (question de suivi sur le secteur public)\n- Avec historique sur cardiologie publique, \'privé?\' → 1 (question de suivi sur le secteur privé)\n- Avec historique mentionnant "privés", \'et privé?\' → 1 (demande de précision sur le secteur privé)\n- Avec historique sur hôpitaux de Bordeaux, \'publics aussi?\' → 1 (question de suivi sur le secteur public)\n- Même avec contexte médical, \'Parle-moi de football\' → 0 (hors-sujet)\n- Avec historique sur les classements, "Comment sont déterminés les scores ?" → 2 (question sur la méthodologie de classement)\n', 'role': 'user'}], 'model': 'gpt-4o-mini', 'n': 1, 'stream': False, 'temperature': 0.7}}
2025-08-25 21:41:43,968 [DEBUG] openai._base_client: Sending HTTP Request: POST https://api.openai.com/v1/chat/completions
2025-08-25 21:41:43,969 [DEBUG] httpcore.connection: close.started
2025-08-25 21:41:43,969 [DEBUG] httpcore.connection: close.complete
2025-08-25 21:41:43,970 [DEBUG] httpcore.connection: connect_tcp.started host='api.openai.com' port=443 local_address=None timeout=None socket_options=None
2025-08-25 21:41:43,992 [DEBUG] httpcore.connection: connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116e079d0>
2025-08-25 21:41:43,992 [DEBUG] httpcore.connection: start_tls.started ssl_context=<ssl.SSLContext object at 0x1166dccb0> server_hostname='api.openai.com' timeout=None
2025-08-25 21:41:44,019 [DEBUG] httpcore.connection: start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x116dae3f0>
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_headers.started request=<Request [b'POST']>
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_headers.complete
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_body.started request=<Request [b'POST']>
2025-08-25 21:41:44,019 [DEBUG] httpcore.http11: send_request_body.complete
2025-08-25 21:41:44,020 [DEBUG] httpcore.http11: receive_response_headers.started request=<Request [b'POST']>
2025-08-25 21:41:44,673 [DEBUG] httpcore.http11: receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Mon, 25 Aug 2025 19:41:49 GMT'), (b'Content-Type', b'application/json'), (b'Transfer-Encoding', b'chunked'), (b'Connection', b'keep-alive'), (b'access-control-expose-headers', b'X-Request-ID'), (b'openai-organization', b'user-bwwzz3meolxcqx9awsxeqau4'), (b'openai-processing-ms', b'469'), (b'openai-project', b'proj_SWXdnAdXjpBzG5X1Y6WgOUzi'), (b'openai-version', b'2020-10-01'), (b'x-envoy-upstream-service-time', b'486'), (b'x-ratelimit-limit-requests', b'10000'), (b'x-ratelimit-limit-tokens', b'10000000'), (b'x-ratelimit-remaining-requests', b'9999'), (b'x-ratelimit-remaining-tokens', b'9998878'), (b'x-ratelimit-reset-requests', b'6ms'), (b'x-ratelimit-reset-tokens', b'6ms'), (b'x-request-id', b'req_079c6e598ee247c1b638653095d922cf'), (b'cf-cache-status', b'DYNAMIC'), (b'Strict-Transport-Security', b'max-age=31536000; includeSubDomains; preload'), (b'X-Content-Type-Options', b'nosniff'), (b'Server', b'cloudflare'), (b'CF-RAY', b'974d91adc8c6edb4-MXP'), (b'Content-Encoding', b'gzip'), (b'alt-svc', b'h3=":443"; ma=86400')])
2025-08-25 21:41:44,673 [INFO] httpx: HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-25 21:41:44,674 [DEBUG] httpcore.http11: receive_response_body.started request=<Request [b'POST']>
2025-08-25 21:41:44,676 [DEBUG] httpcore.http11: receive_response_body.complete
2025-08-25 21:41:44,676 [DEBUG] httpcore.http11: response_closed.started
2025-08-25 21:41:44,676 [DEBUG] httpcore.http11: response_closed.complete
2025-08-25 21:41:44,677 [DEBUG] openai._base_client: HTTP Response: POST https://api.openai.com/v1/chat/completions "200 OK" Headers({'date': 'Mon, 25 Aug 2025 19:41:49 GMT', 'content-type': 'application/json', 'transfer-encoding': 'chunked', 'connection': 'keep-alive', 'access-control-expose-headers': 'X-Request-ID', 'openai-organization': 'user-bwwzz3meolxcqx9awsxeqau4', 'openai-processing-ms': '469', 'openai-project': 'proj_SWXdnAdXjpBzG5X1Y6WgOUzi', 'openai-version': '2020-10-01', 'x-envoy-upstream-service-time': '486', 'x-ratelimit-limit-requests': '10000', 'x-ratelimit-limit-tokens': '10000000', 'x-ratelimit-remaining-requests': '9999', 'x-ratelimit-remaining-tokens': '9998878', 'x-ratelimit-reset-requests': '6ms', 'x-ratelimit-reset-tokens': '6ms', 'x-request-id': 'req_079c6e598ee247c1b638653095d922cf', 'cf-cache-status': 'DYNAMIC', 'strict-transport-security': 'max-age=31536000; includeSubDomains; preload', 'x-content-type-options': 'nosniff', 'server': 'cloudflare', 'cf-ray': '974d91adc8c6edb4-MXP', 'content-encoding': 'gzip', 'alt-svc': 'h3=":443"; ma=86400'})
2025-08-25 21:41:44,677 [DEBUG] openai._base_client: request_id: req_079c6e598ee247c1b638653095d922cf
2025-08-25 21:41:44,678 [DEBUG] app.features.sanity_checks.message_pertinence_check: Raw LLM response for medical pertinence:
1
2025-08-25 21:41:44,678 [DEBUG] app.features.sanity_checks.message_pertinence_check: Parsed medical pertinence value: 1 (type: <class 'int'>)
2025-08-25 21:41:44,678 [INFO] app.services.data_processing_service: Saving Q&A to CSV: question=Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?
2025-08-25 21:41:44,679 [DEBUG] app.services.data_processing_service: CSV written to /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/history/results_history.csv
2025-08-25 21:41:44,679 [INFO] app.services.pipeline_orchestrator_service: Sanity check failed, returning error message and halting pipeline.
2025-08-25 21:41:44,679 [INFO] app.api.routes: Response generated for /ask endpoint - Links found: 0
2025-08-25 21:41:44,679 [ERROR] app.api.routes: Error processing /ask request - Prompt: 'Quels sont les meilleurs hôpitaux à Paris pour la cancer de la vessie ?...', Error: 1 validation error for AskResponse
links
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-08-25 21:56:07,775 [INFO] app.api.routes: Initializing core services...
2025-08-25 21:56:07,776 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 21:56:07,776 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 21:56:07,776 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:56:07,776 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:56:07,778 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:56:07,779 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:56:07,779 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:56:07,975 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:56:07,975 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:56:07,975 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:56:07,980 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:56:07,980 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:56:08,207 [INFO] app.features.sanity_checks.sanity_checks_analyst: Initializing SanityChecksAnalyst
2025-08-25 21:56:08,207 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 21:56:08,207 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 21:56:08,208 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 21:56:08,208 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 21:56:08,208 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
2025-08-25 21:56:08,284 [INFO] app.services.llm_handler_service: ChatOpenAI model initialized
2025-08-25 21:56:08,284 [INFO] app.services.llm_handler_service: Trying to load mapping_word_path: /Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data/resultats_llm_v5.csv
2025-08-25 21:56:08,285 [INFO] app.services.llm_handler_service: Files in data directory (/Users/apassan/Documents/Dev/ChatbotHopitaux/backendchatbothopitaux/data): ['classments-hopitaux-cliniques-2024.xlsx', "Tableaux_d'honneur_2024_PRIVE.csv", 'fichier_hopitaux_avec_coordonnees_avec_privacitee.xlsx', "Tableaux_d'honneur_2024_PUBLIC.csv", 'resultats_llm_v5.csv']
2025-08-25 21:56:08,287 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:56:08,287 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:56:08,287 [INFO] app.features.conversation.conversation_analyst: Initializing ConversationAnalyst
2025-08-25 21:56:08,287 [INFO] app.features.conversation.llm_responder: Initializing LLMResponder
2025-08-25 21:56:08,287 [INFO] app.api.routes: Core services initialized successfully
2025-08-25 21:56:08,289 [INFO] main: Creating FastAPI app
2025-08-25 21:56:08,290 [INFO] main: CORS middleware added
2025-08-25 21:56:08,291 [INFO] main: API router included
2025-08-25 22:30:44,270 [INFO] app.api.routes: Initializing core services...
2025-08-25 22:30:44,271 [INFO] app.services.pipeline_orchestrator_service: Initializing PipelineOrchestrator
2025-08-25 22:30:44,271 [INFO] app.services.data_processing_service: Initializing DataProcessor
2025-08-25 22:30:44,271 [INFO] app.services.llm_handler_service: LLMHandler __init__ called
2025-08-25 22:30:44,271 [INFO] app.services.llm_handler_service: Initializing LLMHandler
2025-08-25 22:30:44,272 [INFO] app.services.llm_handler_service: init_model called: Initializing ChatOpenAI model
2025-08-25 22:30:44,272 [DEBUG] app.services.llm_handler_service: OPENAI_API_KEY loaded: set
2025-08-25 22:30:44,273 [DEBUG] app.services.llm_handler_service: Creating ChatOpenAI instance
